{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/IOT/IOT/myProject/main.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/IOT/IOT/myProject/main.vue","mtime":1602755284821},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.find\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from \"@/api/project/iot/IOT/project\";\nimport employeesSelect from '@/components/Select/employeesSelect';\nimport orgSelect from '@/components/Select/orgSelect.vue';\nimport Slider from \"@/components/Slider\";\nimport throttle from 'lodash/throttle';\nimport { mapState } from 'vuex';\nimport { getProvince, getCity, getArea } from '@/utils/city';\nexport default {\n  name: \"projectMain\",\n  props: ['title'],\n  components: {\n    employeesSelect: employeesSelect,\n    orgSelect: orgSelect,\n    Slider: Slider\n  },\n  computed: _objectSpread({}, mapState({\n    iot_project_type: function iot_project_type(state) {\n      return state.iotDict.iot_project_type;\n    }\n  })),\n  watch: {\n    'temp.province': function tempProvince(val) {\n      var _this = this;\n\n      this.cityList = getCity(val);\n\n      if (this.cityList && this.cityList.length) {\n        var arrIndex = this.cityList.find(function (i) {\n          return i.value == _this.temp.city;\n        });\n\n        if (!arrIndex) {\n          this.$set(this.temp, 'city', this.cityList[0].label);\n        }\n      } else {\n        this.$set(this.temp, 'city', undefined);\n      }\n    },\n    'temp.city': function tempCity(val) {\n      var _this2 = this;\n\n      this.areaList = getArea(this.temp.province, val);\n\n      if (this.areaList && this.areaList.length) {\n        var arrIndex = this.areaList.find(function (i) {\n          return i.value == _this2.temp.county;\n        });\n\n        if (!arrIndex) {\n          this.$set(this.temp, 'county', this.areaList[0].label);\n        }\n      } else {\n        this.$set(this.temp, 'county', undefined);\n      }\n    }\n  },\n  data: function data() {\n    return {\n      listLoading: false,\n      theight: 0,\n      //表格高度\n      list: [],\n      total: 0,\n      listQuery: {\n        page: true,\n        currentPage: 1,\n        pageSize: 4,\n        projectName: undefined\n      },\n      dialogFormVisible: false,\n      dialogFormType: undefined,\n      dialogFormVisibleBatch: false,\n      // 任务分配\n      dialogFormVisibleEmployees: false,\n      //人员列表弹出层\n      dialogFormVisibleslider: false,\n      //进度配置\n      itemValue: undefined,\n      //查询出的交付流程\n      subPace: undefined,\n      orderNumber: undefined,\n      temp: {\n        projectName: undefined,\n        projectType: undefined,\n        tenantOrgCode: undefined,\n        tenantOrgName: undefined,\n        projectManager: undefined,\n        projectManagerName: undefined,\n        province: undefined,\n        city: undefined,\n        county: undefined,\n        remark: undefined\n      },\n      batchTemp: {\n        data: null\n      },\n      tempVal: undefined,\n      rules: {\n        projectName: [{\n          required: true,\n          message: '项名称不能为空',\n          trigger: 'blur'\n        }, {\n          max: 100,\n          message: '长度不能超过100',\n          trigger: 'blur'\n        }, {\n          pattern: /^[\\u4e00-\\u9fa5]+$/,\n          message: '只允许中文输入',\n          trigger: 'blur'\n        }],\n        projectType: [{\n          required: true,\n          message: '请选择项目类型',\n          trigger: 'change'\n        }],\n        tenantOrgCode: [{\n          required: true,\n          message: '请选择所属企业',\n          trigger: 'change'\n        }],\n        projectManagerName: [{\n          required: true,\n          message: '请选择项目经理',\n          trigger: 'change'\n        }],\n        province: [{\n          required: true,\n          message: '请选择省份',\n          trigger: 'change'\n        }],\n        city: [{\n          required: true,\n          message: '请选择城市',\n          trigger: 'change'\n        }],\n        county: [{\n          required: true,\n          message: '请选择区',\n          trigger: 'change'\n        }]\n      },\n      provinceList: getProvince(),\n      cityList: null,\n      areaList: null\n    };\n  },\n  mounted: function mounted() {\n    var _this3 = this;\n\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this3.setTableHeight();\n    };\n\n    this.getList();\n  },\n  methods: {\n    setPage: function setPage(code, page) {\n      var path = '';\n      var name = '';\n      var params = {\n        code: code,\n        page: page\n      };\n\n      if (page == 'EM') {\n        path = \"/project/IOT/IOT/IOTEM\";\n        name = \"IOTEM\";\n      } else if (page == 'GA') {\n        path = \"/project/IOT/IOT/IOTGR\";\n        name = \"IOTGR\";\n      } else if (page == 'RW') {\n        path = \"/project/IOT/IOT/IOTRW\";\n        name = \"IOTRW\";\n      } else if (page == 'WS') {\n        path = \"/project/IOT/IOT/IOTIA\";\n        name = \"IOTIA\";\n      } else {\n        return this.$message({\n          title: this.$t('message.warning'),\n          message: \"该功能暂未开发！\",\n          type: \"warning\"\n        });\n      }\n\n      this.$router.push({\n        path: path,\n        params: params,\n        name: name\n      }); // this.$emit('setCode', code)\n      // this.$emit('setPage', page)\n    },\n    handleSizeChange: function handleSizeChange(val) {\n      this.listQuery.pageSize = val;\n      this.getList();\n    },\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.listQuery.currentPage = val;\n      this.getList();\n    },\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight();\n    },\n    //获取表格数据\n    getList: function getList() {\n      var _this4 = this;\n\n      this.listLoading = true;\n      api.queryProjects(this.listQuery).then(function (response) {\n        _this4.list = response.data.list;\n        _this4.total = response.data.pages.count;\n        setTimeout(function () {\n          _this4.listLoading = false;\n        }, 1.5 * 100);\n      });\n    },\n    //表格查询\n    handleQuery: function handleQuery() {\n      this.listQuery.currentPage = 1;\n      this.getList();\n    },\n    //新增按钮单击事件方法\n    handleCreate: function handleCreate() {\n      this.reTemp();\n      this.dialogFormType = 'create';\n      this.dialogFormVisible = true;\n    },\n    create: throttle(function () {\n      var _this5 = this;\n\n      this.$refs.tempRef.validate(function (valid) {\n        if (valid) {\n          api.addProject(_this5.temp).then(function () {\n            _this5.getList();\n\n            _this5.dialogFormVisible = false;\n\n            _this5.reTemp();\n\n            _this5.$notify({\n              title: '成功',\n              message: '新增成功',\n              type: 'success',\n              duration: 2000\n            });\n          });\n        } else {\n          return false;\n        }\n      });\n    }, 2000, {\n      leading: true,\n      trailing: false\n    }),\n    handleUpdate: function handleUpdate(code) {\n      var _this6 = this;\n\n      api.queryProject(code).then(function (res) {\n        _this6.temp = res.data;\n        _this6.dialogFormType = 'update';\n        _this6.dialogFormVisible = true;\n      });\n    },\n    update: throttle(function () {\n      var _this7 = this;\n\n      this.$refs.tempRef.validate(function (valid) {\n        if (valid) {\n          api.updateProject(_this7.temp.projectCode, _this7.temp).then(function () {\n            _this7.getList();\n\n            _this7.dialogFormVisible = false;\n\n            _this7.reTemp();\n\n            _this7.$notify({\n              title: '成功',\n              message: '修改成功',\n              type: 'success',\n              duration: 2000\n            });\n          });\n        } else {\n          return false;\n        }\n      });\n    }, 2000, {\n      leading: true,\n      trailing: false\n    }),\n    //删除按钮单击事件方法\n    handleDelete: function handleDelete(code) {\n      var _this8 = this;\n\n      this.$confirm('此操作将删除所选中数据, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        api.deleteProject(code).then(function () {\n          _this8.getList();\n\n          _this8.$message({\n            title: '成功',\n            message: '删除成功',\n            type: 'success',\n            duration: 2000\n          });\n        }).catch(function () {\n          _this8.getList();\n        });\n      }).catch(function () {\n        _this8.$message({\n          type: 'info',\n          message: '已取消删除'\n        });\n      });\n    },\n    // 任务分配\n    handleDistribution: function handleDistribution(code) {\n      var _this9 = this;\n\n      api.queryProject(code).then(function (res) {\n        _this9.temp = res.data;\n        _this9.batchTemp.data = res.data.projectDeliveryDTOS;\n        _this9.dialogFormVisibleBatch = true;\n      });\n    },\n    distribution: throttle(function () {\n      var _this10 = this;\n\n      api.queryBatch(this.temp.projectCode, this.batchTemp.data).then(function () {\n        _this10.getList();\n\n        _this10.dialogFormVisibleBatch = false;\n\n        _this10.$notify({\n          title: '成功',\n          message: '修改成功',\n          type: 'success',\n          duration: 2000\n        });\n      });\n    }, 2000, {\n      leading: true,\n      trailing: false\n    }),\n    // 获取负责人\n    getBatchEmployee: function getBatchEmployee(orderNumber) {\n      this.dialogFormVisibleEmployees = true;\n      this.orderNumber = orderNumber;\n    },\n    //获取人员\n    getEmployee: function getEmployee(val) {\n      this.tempVal = val;\n    },\n    handleEmployee: function handleEmployee() {\n      var _this11 = this;\n\n      if (this.dialogFormVisibleBatch) {\n        this.batchTemp.data.forEach(function (item) {\n          if (item.orderNumber == _this11.orderNumber) {\n            item.projectManager = _this11.tempVal.employeeCode;\n            item.projectManagerName = _this11.tempVal.employeeName;\n          }\n        });\n      } else {\n        this.$set(this.temp, 'projectManager', this.tempVal.employeeCode);\n        this.$set(this.temp, 'projectManagerName', this.tempVal.employeeName);\n      }\n\n      this.orderNumber == undefined;\n      this.dialogFormVisibleEmployees = false;\n    },\n    // 进度配置弹窗\n    show: throttle(function (projectCode, orderNumber) {\n      var _this12 = this;\n\n      api.queryOrderNumber(projectCode, orderNumber).then(function (res) {\n        _this12.itemValue = res.data;\n        _this12.subPace = Number(JSON.parse(JSON.stringify(res.data.pace)));\n        _this12.dialogFormVisibleslider = true;\n      });\n    }, 2000, {\n      leading: true,\n      trailing: false\n    }),\n    handleP: function handleP() {},\n    getPace: function getPace(val) {\n      this.itemValue.pace = val;\n      this.subPace = val;\n    },\n    handleUpdatePace: throttle(function () {\n      var _this13 = this;\n\n      api.updateOrderNumber(this.itemValue.projectCode, this.itemValue.orderNumber, this.itemValue).then(function () {\n        _this13.getList();\n\n        _this13.dialogFormVisibleslider = false;\n        return _this13.$notify({\n          title: '成功',\n          message: '修改成功',\n          type: 'success',\n          duration: 2000\n        });\n      });\n    }, 2000, {\n      leading: true,\n      trailing: false\n    }),\n    reTemp: function reTemp() {\n      this.temp = {};\n    }\n  }\n};",null]}