{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/options/optionsFormation/content/tabTaskList.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/options/optionsFormation/content/tabTaskList.vue","mtime":1599136050896},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.sort\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from \"@/api/project/srm/procurementDemand/divisionNeeds/divisionNeed\";\nimport dialogGysxz from '@/components/Dialog/dialogsGysxz'; //供应商选择\n\nimport { mapState } from \"vuex\";\nimport { DICT_CODE } from '@/utils/constant';\nimport caiGou from '@/components/Select/xtpt/caigou'; //下拉组件\n\nimport Pagination from \"@/components/Pagination\";\nexport default {\n  name: \"tabTaskList\",\n  components: {\n    caiGou: caiGou,\n    Pagination: Pagination,\n    dialogGysxz: dialogGysxz\n  },\n  data: function data() {\n    return {\n      theight: 0,\n      //表格高度\n      isSingle: false,\n      //表格是否单选 点击各按钮根据流程逻辑控制单多选\n      dataList: [],\n      itemList: [],\n      //从表数据\n      total: 0,\n      totalItem: 0,\n      spanArr: [],\n      listQuery: {\n        //查询\n        page: true,\n        currentPage: 1,\n        pageSize: 10,\n        orgCode: null,\n        materielType: null,\n        materielCode: null,\n        materielName: null,\n        supplierName: null,\n        state: null,\n        sourceType: null\n      },\n      DICT_CODE: DICT_CODE,\n      currentSelectedRow: null,\n      //当前选中的行\n      selectedRows: [],\n      //多选时选中的所有行\n      tableKey: 0,\n      //表格索引\n      filterConfig: [{\n        type: 'selectcaiGou',\n        label: '组织编码',\n        prop: 'orgCode',\n        width: '',\n        copmNum: 0,\n        class: 'filter-item'\n      }, {\n        type: 'dictSelect',\n        dType: 'dt_materiel_type',\n        label: '物料类型',\n        prop: 'materielType',\n        width: '',\n        class: 'filter-item ml_5'\n      }, {\n        type: 'commonInput',\n        label: '物料编码',\n        prop: 'materielCode',\n        width: '',\n        class: 'filter-item ml_5'\n      }, {\n        type: 'commonInput',\n        label: '物料名称',\n        prop: 'materielName',\n        width: '',\n        class: 'filter-item ml_5'\n      }, {\n        type: 'inputBtnGys',\n        label: '供应商',\n        prop: 'supplierName',\n        width: '',\n        class: 'ml_5'\n      }, {\n        type: 'dictSelect',\n        dType: 'dt_srm_pal',\n        label: '状态',\n        prop: 'state',\n        width: '',\n        optionArr: [],\n        class: 'filter-item ml_5'\n      }, {\n        type: 'dictSelect',\n        dType: 'dt_srm_pak',\n        label: '来源',\n        prop: 'sourceType',\n        width: '',\n        optionArr: [],\n        class: 'filter-item ml_5'\n      }],\n      oprateBtnConfig: [{\n        id: 0,\n        class: 'filter-item',\n        icon: 'el-icon-plus',\n        clickMethod: 'handleFormation',\n        name: '方案编制'\n      }, {\n        id: 1,\n        class: 'filter-item ml_5',\n        icon: 'el-icon-plus',\n        clickMethod: 'handleClassSet',\n        name: '分类设置'\n      }, {\n        id: 2,\n        class: 'filter-item ml_5',\n        icon: 'el-icon-plus',\n        clickMethod: 'handlePackage',\n        name: '打包'\n      }, {\n        id: 3,\n        class: 'filter-item ml_5',\n        icon: 'el-icon-plus',\n        clickMethod: 'handleunPackage',\n        name: '取消打包'\n      }, {\n        id: 4,\n        class: 'filter-item ml_5',\n        icon: 'el-icon-warning-outline',\n        clickMethod: 'handleAbort',\n        name: '驳回'\n      }, {\n        id: 5,\n        class: 'filter-item ml_5',\n        icon: 'el-icon-plus',\n        clickMethod: 'handleErrorFeedback',\n        name: '异常反馈'\n      }],\n      tableConfig: [{\n        label: '打包号',\n        prop: 'packageNo',\n        align: 'center',\n        width: '150'\n      }, {\n        label: '状态',\n        prop: 'stateCN',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '物料图号',\n        prop: 'mapNo',\n        align: 'center',\n        width: '150'\n      }, {\n        label: '特殊区分',\n        prop: 'specialDistinction',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '物料编码',\n        prop: 'materielCode',\n        align: 'center',\n        width: '120'\n      }, {\n        label: '物料名称',\n        prop: 'materielName',\n        align: 'center',\n        width: '120'\n      }, {\n        label: '责任人',\n        prop: 'score',\n        align: 'center',\n        width: 'auto'\n      }, //wu\n      {\n        label: '物料分类',\n        prop: 'materielClassName',\n        align: 'center',\n        width: 'auto'\n      }, //name\n      {\n        label: '供应商',\n        prop: 'supplierName',\n        align: 'center',\n        width: '180'\n      }, {\n        label: '规格',\n        prop: 'specification',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '材质',\n        prop: 'materielQuality',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '重量',\n        prop: 'weight',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '是否关重件',\n        prop: 'heavyParts',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '关联单号',\n        prop: 'associatedNo',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '计量单位',\n        prop: 'measurement',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '确定目标价',\n        prop: 'targetPrice',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '要求完成时间',\n        prop: 'completionDate',\n        align: 'center',\n        width: '150'\n      }, {\n        label: '组织编码',\n        prop: 'orgCode',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '项目号',\n        prop: 'projectNo',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '来源方式',\n        prop: 'sourceType',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '关联物料编码',\n        prop: 'associatedMateriel',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '设计师',\n        prop: 'designerName',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '任务分配人',\n        prop: 'evaluationModel7',\n        align: 'center',\n        width: 'auto'\n      }, //wu\n      {\n        label: '任务分配时间',\n        prop: 'evaluationModel8',\n        align: 'center',\n        width: '150'\n      }, //wu\n      {\n        label: '方案编号',\n        prop: 'planNo',\n        align: 'center',\n        width: 'auto'\n      }],\n      dialogConfig: [{\n        title: '供应商选择',\n        unMutiple: true\n      }]\n    };\n  },\n  created: function created() {},\n  computed: _objectSpread({}, mapState({\n    dt_materiel_type: function dt_materiel_type(state) {\n      return state.dt_materiel_type;\n    },\n    // dt_materiel_classify: state => state.dict.dt_materiel_classify,//物料分类\n    dt_srm_pak: function dt_srm_pak(state) {\n      return state.dict.dt_srm_pak;\n    },\n    dt_srm_pbd: function dt_srm_pbd(state) {\n      return state.dict.dt_srm_pbd;\n    },\n    //分工状态\n    dt_srm_pal: function dt_srm_pal(state) {\n      return state.dict.dt_srm_pal;\n    }\n  })),\n  mounted: function mounted() {\n    var _this = this;\n\n    // this.$store.dispatch(\"dict/getDicData\", [\"dt_materiel_type\", \"dt_materiel_classify\", \"dt_srm_pak\", \"dt_srm_pbd\", \"dt_srm_pal\"])\n    this.$store.dispatch(\"dict/getDicData\", [\"dt_materiel_type\", \"dt_srm_pak\", \"dt_srm_pbd\", \"dt_srm_pal\"]);\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this.setTableHeight();\n    };\n\n    this.getList();\n  },\n  methods: {\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight() - 40;\n    },\n    getSpanArr: function getSpanArr(data) {\n      data.sort(this.compareObj(\"packageNo\"));\n\n      for (var i = 0; i < data.length; i++) {\n        if (i === 0) {\n          this.spanArr.push(1);\n          this.pos = 0;\n        } else {\n          // 判断当前元素与上一个元素是否相同\n          if (data[i].packageNo === data[i - 1].packageNo) {\n            this.spanArr[this.pos] += 1;\n            this.spanArr.push(0);\n          } else {\n            this.spanArr.push(1);\n            this.pos = i;\n          }\n        }\n      }\n    },\n    compareObj: function compareObj(prop) {\n      return function (obj1, obj2) {\n        var val1 = obj1[prop];\n        var val2 = obj2[prop];\n\n        if (val1 < val2) {\n          return -1;\n        } else if (val1 > val2) {\n          return 1;\n        } else {\n          return 0;\n        }\n      };\n    },\n    objectSpanMethod: function objectSpanMethod(_ref) {\n      var rowIndex = _ref.rowIndex,\n          columnIndex = _ref.columnIndex;\n\n      if (columnIndex === 2) {\n        var _row = this.spanArr[rowIndex];\n\n        var _col = _row > 0 ? 1 : 0;\n\n        return {\n          rowspan: _row,\n          colspan: _col\n        };\n      }\n    },\n    //获取表格数据\n    getList: function getList() {\n      var _this2 = this;\n\n      api.queryRecords(this.listQuery).then(function (res) {\n        var options = [_this2.dt_srm_pbd];\n        res.data = _this2.$myFun.codeToName(res.data, options, ['state']);\n        _this2.dataList = res.data.list;\n        _this2.total = res.data.pages.count;\n        _this2.spanArr = [];\n\n        _this2.getSpanArr(_this2.dataList);\n      });\n    },\n    //表格查询\n    handleQuery: function handleQuery() {\n      this.listQuery.currentPage = 1;\n      this.getList();\n    },\n    //表格显示条数变化\n    handleSizeChange: function handleSizeChange(val) {\n      this.listQuery.pageSize = val;\n      this.getList();\n    },\n    //表格当前页变化\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.listQuery.currentPage = val;\n      this.getList();\n    },\n    //操作按钮事件\n    oprateClick: function oprateClick(id) {\n      switch (id) {\n        case 0:\n          {\n            this.handleFormation();\n            break;\n          }\n\n        case 1:\n          {\n            if (this.listQuery.orgCode) {\n              if (this.selectedRows.length === 1) {\n                this.$emit('showMC', this.listQuery.orgCode);\n              } else {\n                this.$message({\n                  type: 'warning',\n                  message: '请选择一条数据'\n                });\n              }\n            } else {\n              this.$message({\n                type: 'warning',\n                message: '请先选择组织编码'\n              });\n            }\n\n            break;\n          }\n\n        case 2:\n          {\n            this.handlePackage();\n            break;\n          }\n\n        case 3:\n          {\n            this.handleunPackage();\n            break;\n          }\n\n        case 4:\n          {\n            this.handleAbort();\n            break;\n          }\n\n        case 5:\n          {\n            this.$emit('showFB');\n            break;\n          }\n      }\n    },\n    handleFormation: function handleFormation() {\n      if (this.selectedRows) {\n        console.log(this.selectedRows, '22222');\n\n        if (this.selectedRows.length > 0) {\n          var editable = 'editable';\n          var noArr = [];\n\n          for (var i = 0; i < this.selectedRows.length; i++) {\n            if (!this.selectedRows[i].materielClassName) {\n              editable = 'mc';\n            }\n\n            noArr.push(this.selectedRows[i].packageNo);\n          }\n\n          for (var _i = 0; _i < noArr.length - 1; _i++) {\n            if (noArr[_i] !== noArr[_i + 1]) {\n              editable = 'packageNo';\n            }\n          }\n\n          for (var _i2 = 0; _i2 < this.selectedRows.length; _i2++) {\n            if (this.selectedRows[_i2].state !== 'PBD2') {\n              editable = 'fb';\n            }\n          }\n\n          if (editable === 'editable') {\n            this.$emit('setFormationState', 'taskedit', this.selectedRows.map(function (v) {\n              v.divisionId = v.rowId;\n              return v;\n            }));\n          } else if (editable === 'mc') {\n            this.$message({\n              type: 'warning',\n              message: '所选内容含有未进行分类设置的物料,不能进行方案编制'\n            });\n          } else if (editable === 'packageNo') {\n            this.$message({\n              type: 'warning',\n              message: '如果打包号非空，一次只能选择一个打包号的数据'\n            });\n          } else if (editable === 'fb') {\n            this.$message({\n              type: 'warning',\n              message: '只能选择发布状态的数据'\n            });\n          }\n        } else {\n          this.$message({\n            type: 'warning',\n            message: '请选择一条数据'\n          });\n        }\n      } else {\n        this.$message({\n          type: 'warning',\n          message: '请选择一条数据'\n        });\n      }\n    },\n    handlePackage: function handlePackage() {\n      var _this3 = this;\n\n      var rowIds = [];\n      this.selectedRows.forEach(function (item) {\n        rowIds.push(item.rowId);\n      });\n      var cdata = {\n        // packageNo: this.selectedRows[0].packageNo,\n        rowIds: rowIds,\n        method: \"PACK\"\n      };\n      api.handleRecords(cdata).then(function (res) {\n        console.log(res);\n\n        _this3.$message({\n          type: 'success',\n          message: '打包成功'\n        });\n\n        _this3.handleQuery();\n      });\n    },\n    handleunPackage: function handleunPackage() {\n      var _this4 = this;\n\n      var rowIds = [];\n      this.selectedRows.forEach(function (item) {\n        rowIds.push(item.rowId);\n      });\n      var cdata = {\n        // packageNo: this.selectedRows[0].packageNo,\n        rowIds: rowIds,\n        method: \"CANCEL_PACK\"\n      };\n      api.handleRecords(cdata).then(function (res) {\n        console.log(res);\n\n        _this4.$message({\n          type: 'success',\n          message: '取消打包成功'\n        });\n\n        _this4.handleQuery();\n      });\n    },\n    handleAbort: function handleAbort() {\n      var _this5 = this;\n\n      if (this.selectedRows.length === 1) {\n        var cdata = {\n          packageNo: this.selectedRows[0].packageNo,\n          method: \"REJECT\"\n        };\n        api.handleRecords(cdata).then(function (res) {\n          console.log(res);\n\n          _this5.$message({\n            type: 'success',\n            message: '驳回成功'\n          });\n\n          _this5.handleQuery();\n        });\n      } else {\n        this.$message({\n          type: 'warning',\n          message: '请选择一条数据'\n        });\n      }\n    },\n    setMC: function setMC(mdata) {\n      var _this6 = this;\n\n      var rowIds = [];\n      this.selectedRows.forEach(function (item) {\n        rowIds.push(item.rowId);\n      });\n      var cdata = {\n        materielClassDTO: {\n          materielClass: mdata[0].classCode,\n          materielClassName: mdata[0].className,\n          rowId: this.selectedRows[0].rowId\n        },\n        method: \"UPDATE_MATERIEL_CLASS\"\n      };\n      api.handleRecords(cdata).then(function (res) {\n        console.log(res);\n\n        _this6.$message({\n          type: 'success',\n          message: '分类设置成功'\n        });\n\n        _this6.handleQuery();\n      });\n    },\n    // 表格选择框选中 注:参数为选中的所有行的数组\n    selectChange: function selectChange(val) {\n      if (this.isSingle) {\n        if (val.length > 1) {\n          this.$refs.tb.clearSelection(); //清除其他行的选中\n\n          this.$refs.tb.toggleRowSelection(val[val.length - 1], \"selected\"); //单击行绑定点击事件\n        } else if (val.length === 1) {\n          this.selectedRows = val;\n          this.currentSelectedRow = val[val.length - 1]; // this.selectSameProp(this.dataList, \"packageNo\", val)\n        } else if (val.length === 0) {\n          this.selectedRows = val;\n          this.currentSelectedRow = null; // this.itemList = []\n        }\n      } else {\n        this.selectedRows = val;\n        this.currentSelectedRow = val[val.length - 1]; // this.selectSameProp(this.dataList, \"packageNo\", val)\n      }\n    },\n    // selectSameProp (data, prop, val) {\n    //     this.selectedRows = []\n    //     for (let j = 0; j < val.length; j++) {\n    //         for (var i = 0; i < data.length; i++) {\n    //             if (data[i][prop] === val[j][prop]) {\n    //                 this.selectedRows.push(data[i])\n    //             }\n    //         }\n    //     }\n    // },\n    showGys: function showGys() {\n      this.$refs.refGys.dialogVisible = true;\n    },\n    //供应商确认\n    handleGysClick: function handleGysClick(gysRows) {\n      this.listQuery.supplierCode = gysRows[0].supplierCode;\n      this.$set(this.listQuery, 'supplierName', gysRows[0].supplierName);\n    }\n  }\n};",null]}