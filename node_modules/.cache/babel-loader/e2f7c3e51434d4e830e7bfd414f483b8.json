{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentArchives/tab2.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentArchives/tab2.vue","mtime":1596610933377},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.function.name\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from '@/api/project/eas/el/equipmentArchives'; // import Pagination from '@/components/Pagination'\n\nimport { mapState } from 'vuex';\nexport default {\n  name: 'dispatchOrderManagement',\n  components: {},\n  props: ['deviceCode'],\n  data: function data() {\n    return {\n      fileList: [],\n      list: null,\n      total: 0,\n      theight: 0,\n      //表格高度\n      listQuery: {\n        fileType: undefined\n      },\n      temp: {\n        fileType: undefined,\n        category: undefined,\n        fileCode: undefined,\n        readName: undefined\n      },\n      files: undefined,\n      tableKey: [0]\n    };\n  },\n  created: function created() {// this.getList()\n  },\n  computed: _objectSpread({}, mapState({\n    dt_file_equipment: function dt_file_equipment(state) {\n      return state.eamDict.dt_file_equipment;\n    },\n    dt_file_type: function dt_file_type(state) {\n      return state.eamDict.dt_file_type;\n    }\n  }), {\n    myHeader: function myHeader() {\n      return {\n        authToken: window.sessionStorage.getItem('authToken')\n      };\n    }\n  }),\n  mounted: function mounted() {\n    var _this = this;\n\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this.setTableHeight();\n    };\n\n    this.temp.fileType = \"document\";\n    this.$store.dispatch('eamDict/getDicData', ['dt_file_equipment', 'dt_file_type']);\n  },\n  methods: {\n    getList: function getList() {\n      var _this2 = this;\n\n      var fileType = 'document';\n      api.queryFile(this.deviceCode, fileType).then(function (res) {\n        _this2.list = res.data;\n      });\n    },\n    value: function value() {},\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight() - 185;\n    },\n    handleDownload: function handleDownload() {\n      if (this.selectlistRow) {\n        api.download(this.selectlistRow.readName).then(function (res) {\n          var blob = new Blob([res.data], {\n            type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document;charset=utf-8'\n          }); //application/vnd.openxmlformats-officedocument.wordprocessingml.document这里表示doc类型\n\n          var contentDisposition = res.headers['content-disposition']; //从response的headers中获取filename, 后端response.setHeader(\"Content-disposition\", \"attachment; filename=xxxx.docx\") 设置的文件名;\n\n          var filename = contentDisposition.substring(contentDisposition.indexOf('=') + 1);\n          var downloadElement = document.createElement('a');\n          var href = window.URL.createObjectURL(blob); //创建下载的链接\n\n          downloadElement.style.display = 'none';\n          downloadElement.href = href;\n          downloadElement.download = filename; //下载后文件名\n\n          document.body.appendChild(downloadElement);\n          downloadElement.click(); //点击下载\n\n          document.body.removeChild(downloadElement); //下载完成移除元素\n\n          window.URL.revokeObjectURL(href); //释放掉blob对象\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    handleDelete: function handleDelete() {\n      var _this3 = this;\n\n      //删除列表\n      if (this.selectlistRow) {\n        this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          api.deleteFile(_this3.selectlistRow.fileCode).then(function () {\n            _this3.getList(), _this3.$message({\n              title: '成功',\n              message: '删除成功',\n              type: 'success',\n              duration: 2000\n            });\n          });\n        }).catch(function () {\n          _this3.$message({\n            type: 'info',\n            message: '已取消删除'\n          });\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    init: function init(val) {\n      this.subList = val;\n      this.getList();\n    },\n    fileExceed: function fileExceed() {\n      this.$message.error('一次最多上传10个文件');\n    },\n    beforeUpload: function beforeUpload(file) {\n      var testmsg = file.name.substring(file.name.lastIndexOf('.') + 1);\n      var extension = testmsg === 'xls';\n      var extension2 = testmsg === 'xlsx';\n      var extension3 = testmsg === 'pdf';\n      var extension4 = testmsg === 'docx';\n      var extension5 = testmsg === 'pptx';\n      var extension6 = testmsg === 'txt';\n      var isLt2M = file.size / 1024 / 1024 < 10;\n\n      if (!extension && !extension2 && !extension3 && !extension4 && !extension5 && !extension6) {\n        this.$message({\n          message: '上传文件只能是 xls、xlsx、pdf、docx、txt 格式!',\n          type: 'warning'\n        });\n      }\n\n      if (!isLt2M) {\n        this.$message({\n          message: '上传文件大小不能超过 10MB!',\n          type: 'warning'\n        });\n      }\n\n      return (extension || extension2 || extension3 || extension4 || extension5 || extension6) && isLt2M;\n    },\n    handleChange: function handleChange(file, fileList) {\n      this.files = fileList;\n    },\n    handleUpload: function handleUpload() {\n      var _this4 = this;\n\n      if (!this.subList) {\n        this.$message({\n          title: '警告',\n          message: '请选择设备',\n          type: 'warning'\n        });\n        return false;\n      }\n\n      if (!this.temp.category) {\n        this.$message({\n          title: '警告',\n          message: '请选择文件类别',\n          type: 'warning'\n        });\n        return false;\n      }\n\n      var data = new FormData();\n      this.files.forEach(function (file) {\n        data.append('files', file.raw);\n      });\n      api.uploadFile(this.deviceCode, data, {\n        category: this.temp.category,\n        fileType: this.temp.fileType\n      }).then(function () {\n        _this4.$refs.upload.clearFiles();\n\n        _this4.$message({\n          title: '成功',\n          message: '上传成功',\n          type: 'success',\n          duration: 2000\n        });\n\n        _this4.getList();\n      });\n    },\n    // 获取表格选中时的数据\n    selectRow: function selectRow(val) {\n      this.selectlistRow = val[val.length - 1];\n\n      if (val.length > 1) {\n        this.$refs.mainList.clearSelection();\n        this.$refs.mainList.toggleRowSelection(val.pop());\n      }\n\n      this.$refs.mainList.setCurrentRow(this.selectlistRow);\n    },\n    //主表行点击\n    showSubTable: function showSubTable(val) {\n      this.$refs.mainList.clearSelection();\n      this.$refs.mainList.toggleRowSelection(val);\n    }\n  }\n};",null]}