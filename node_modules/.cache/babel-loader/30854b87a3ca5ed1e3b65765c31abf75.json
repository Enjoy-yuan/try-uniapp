{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EMS/energyReport/analysisEnergyReport/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EMS/energyReport/analysisEnergyReport/index.vue","mtime":1596610933521},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from '@/api/project/ems/energyReport/index.js';\nexport default {\n  name: 'analysisEnergyReport',\n  //重点产品报表\n  data: function data() {\n    return {\n      theight: 0,\n      //表格高度\n      isSingle: true,\n      //表格是否单选 点击各按钮根据流程逻辑控制单多选\n      list: [],\n      yAxisData: [],\n      barData: {\n        id: 'oneBar-analysisEnergy',\n        data: null\n      },\n      pieData: {\n        id: 'pie-analysisEnergy',\n        data: null\n      },\n      barBtmData: {\n        id: 'btn-analysisEnergy',\n        data: null\n      },\n      xAxisBtm: [],\n      dataTime: undefined,\n      listQuery: {\n        //查询\n        beginTime: undefined,\n        endTime: undefined\n      },\n      color: ['#fd6361', '#02b7ae', '#37454e', '#ff9669', '#05b7ab', '#606b6d'] //黄 蓝 黑 灰 红 橘  绿\n\n    };\n  },\n  // watch: {\n  //     'barData.data' (val) {\n  //         this.getBar(\n  //             val,\n  //             '',\n  //             this.yAxisData,\n  //             '',\n  //             '日分项用能同比分析',\n  //             '',\n  //             15\n  //         )\n  //     }\n  // },\n  mounted: function mounted() {\n    var _this = this;\n\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this.setTableHeight();\n    };\n\n    this.getList();\n  },\n  destroyed: function destroyed() {\n    this.setTableHeight();\n    this.getList();\n  },\n  methods: {\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight();\n    },\n    //获取表格数据\n    getList: function getList() {\n      var _this2 = this;\n\n      api.analysisEnergy(this.listQuery).then(function (res) {\n        var btmList = res.data.list1;\n        var pieList = res.data.pieList;\n        var contrastList = res.data.list;\n        var key = Object.getOwnPropertyNames(btmList);\n        var data = [];\n        _this2.xAxisBtm = [];\n        btmList[key[0]].forEach(function (item, i) {\n          data.push({\n            name: item.energyItemName,\n            type: 'bar',\n            stack: '总量',\n            label: {\n              show: true,\n              position: 'insideRight'\n            },\n            itemStyle: {\n              normal: {\n                color: _this2.color[i]\n              }\n            },\n            data: []\n          });\n        });\n        key.forEach(function (item) {\n          btmList[item].forEach(function (i, index) {\n            i.day = i.day.split('-')[1] + '-' + i.day.split('-')[2];\n\n            if (btmList[item].energyItemName == data.name) {\n              data[index].data.push(btmList[item][index].meterData); // data[index].data.push(Math.ceil(Math.random() * 10))\n            }\n          });\n\n          _this2.xAxisBtm.push(btmList[item][0].day);\n        });\n        var pieData = [];\n        pieList.forEach(function (item) {\n          pieData.push({\n            value: item.meterData,\n            name: item.energyItemName\n          });\n        });\n        var yAxisData = contrastList.map(function (i) {\n          return i.energyItemName;\n        });\n        _this2.yAxisData = yAxisData;\n        var topList = [{\n          name: '昨日',\n          type: 'bar',\n          itemStyle: {\n            normal: {\n              color: '#37454e',\n              barBorderRadius: [0, 10, 5, 0]\n            }\n          },\n          data: []\n        }, {\n          name: '今日',\n          type: 'bar',\n          itemStyle: {\n            normal: {\n              color: '#05b7ab',\n              //\n              barBorderRadius: [0, 5, 10, 0]\n            }\n          },\n          data: []\n        }];\n        contrastList.forEach(function (item) {\n          topList.forEach(function (i, index) {\n            if (i.name == '昨日') {\n              topList[index].data.push(item.yesterdayData);\n            } else if (i.name == '今日') {\n              topList[index].data.push(item.todayData);\n            }\n          });\n        });\n        _this2.pieData.data = pieData;\n        _this2.barBtmData.data = data;\n        _this2.barData.data = topList;\n\n        _this2.getBar(_this2.barData, '', _this2.yAxisData, '', '日分项用能同比分析', '', 15);\n\n        _this2.getBar(_this2.barBtmData, _this2.xAxisBtm, '', '', '过去31天分项用能趋势图', 45, '');\n\n        _this2.getPie(_this2.pieData, '过去31天分项用能饼图');\n      });\n    },\n    getBar: function getBar(chartData, xAxis, yAxis, legend, name, xRotate, gridLeft) {\n      var _this3 = this;\n\n      legend = legend ? legend : null;\n      xRotate = xRotate ? xRotate : 0;\n      gridLeft = gridLeft ? gridLeft : 8;\n      xAxis = xAxis ? xAxis : null;\n      yAxis = yAxis ? yAxis : null;\n      name = name ? name : '';\n      var axisLine = {\n        lineStyle: {\n          color: '#d9d9d9'\n        }\n      };\n      var opt = {\n        title: {\n          text: name\n        },\n        grid: {\n          left: \"\".concat(gridLeft, \"%\")\n        },\n        tooltip: {\n          trigger: 'axis',\n          axisPointer: {\n            type: 'shadow'\n          }\n        },\n        xAxis: {\n          data: xAxis,\n          axisLabel: {\n            //坐标轴刻度标签的相关设置。\n            interval: 0,\n            rotate: xRotate\n          },\n          axisLine: axisLine\n        },\n        yAxis: {\n          data: yAxis,\n          axisLine: {\n            show: false,\n            lineStyle: axisLine.lineStyle\n          },\n          axisTick: {\n            show: false\n          }\n        },\n        legend: {\n          left: 'center',\n          data: legend,\n          top: '6%'\n        },\n        series: chartData.data // this.$nextTick(() => {\n        //     var myChart = this.$echarts.init(this.$refs[chartData.id])\n        //     myChart.setOption(opt, true)\n        // })\n\n      };\n      setTimeout(function () {\n        var myChart = _this3.$echarts.init(_this3.$refs[chartData.id]);\n\n        myChart.setOption(opt, true);\n      }, 500);\n    },\n    getPie: function getPie(chartData, name, legend) {\n      var _this4 = this;\n\n      name = name ? name : '';\n      legend = legend ? legend : null;\n      var opt = {\n        title: {\n          text: name\n        },\n        tooltip: {\n          confine: true,\n          trigger: 'item',\n          formatter: '{b} : {c} ({d}%)'\n        },\n        legend: {\n          left: 'center',\n          data: legend,\n          top: '6%'\n        },\n        series: [{\n          type: 'pie',\n          radius: '60%',\n          center: ['50%', '55%'],\n          selectedMode: 'single',\n          itemStyle: {\n            normal: {\n              color: function color(params) {\n                //自定义颜色\n                var color = ['#606b6d', '#fd6361', '#ff9669', '#05b7ab', '#fd6361', '#02b7ae', '#37454e'];\n                return color[params.dataIndex];\n              }\n            }\n          },\n          data: chartData.data\n        }]\n      };\n      setTimeout(function () {\n        var myChart = _this4.$echarts.init(_this4.$refs[chartData.id]);\n\n        myChart.setOption(opt, true);\n      }, 500); // this.$nextTick(() => {\n      //     this.myChart = this.$echarts.init(this.$refs[chartData.id])\n      //     this.myChart.setOption(opt, true)\n      // })\n    },\n    //表格查询\n    handleQuery: function handleQuery() {\n      this.listQuery.currentPage = 1;\n      this.getList();\n    }\n  }\n};",null]}