{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/dialog/dialogQuoteLevel1.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/dialog/dialogQuoteLevel1.vue","mtime":1596610933761},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { createQuote, updateQuote } from \"@/api/project/srm/supplierSelect/supplierRFQ/supplierRFQAnswer\";\nimport { mapState } from \"vuex\";\nimport { DICT_CODE } from '@/utils/constant';\nimport caiGou from '@/components/Select/xtpt/caigou'; //下拉组件\n\nimport dialogQuoteLevel1Ref from \"./dialogQuoteLevel1Ref\"; //参照报价\n\nexport default {\n  name: 'dialogQuoteLevel1',\n  props: ['title'],\n  components: {\n    caiGou: caiGou,\n    dialogQuoteLevel1Ref: dialogQuoteLevel1Ref\n  },\n  data: function data() {\n    var _this = this;\n\n    var compareDate = function compareDate(rule, value, callback) {\n      if (value < _this.formData.validDateStart) {\n        return callback(new Error('有效期起不能大于有效期止'));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      isComputed: undefined,\n      dialogVisible: false,\n      tabName: 'tabQuote',\n      DICT_CODE: DICT_CODE,\n      constVal: {\n        managementRate: 0,\n        profitRate: 0,\n        financialRate: 0\n      },\n      methodType: 'add',\n      formData: {\n        rowId: null,\n        rfqNo: null,\n        supplierCode: null,\n        supplierName: null,\n        quotedDate: null,\n        materielCode: null,\n        materielName: null,\n        materielClass: null,\n        materielClassName: null,\n        weight: null,\n        settlementMethod: null,\n        otherMethod: null,\n        currency: null,\n        validDateStart: null,\n        validDateEnd: null,\n        remark: null,\n        firstYearDecline: null,\n        secondYearDecline: null,\n        thirdYearDecline: null,\n        forthYearDecline: null,\n        fifthYearDecline: null,\n        rawMaterialCost: 0,\n        designCost: 0,\n        logisticsCost: 0,\n        recoveryValue: 0,\n        managementRate: 0,\n        otherCost: 0,\n        outsourcingCost: 0,\n        managementCost: 0,\n        profitRate: 0,\n        toolingCost: 0,\n        financialRate: 0,\n        processingCost: 0,\n        financialCost: 0,\n        realPrice: 0,\n        wasteLoss: 0,\n        packingCost: 0\n      },\n      totalQuotation: {\n        designCost: 0,\n        financialCost: 0,\n        financialRate: 0,\n        logisticsCost: 0,\n        managementCost: 0,\n        managementRate: 0,\n        materielCode: 0,\n        materielName: 0,\n        otherCost: 0,\n        outsourcingCost: 0,\n        packingCost: 0,\n        processingCost: 0,\n        profit: 0,\n        profitRate: 0,\n        quotedDate: null,\n        rawMaterialCost: 0,\n        realPrice: 0,\n        recoveryValue: 0,\n        toolingCost: 0,\n        version: 0,\n        wasteLoss: 0\n      },\n      rules: {\n        settlementMethod: [{\n          required: true,\n          message: '请选择',\n          trigger: 'blur'\n        }],\n        currency: [{\n          required: true,\n          message: '请选择',\n          trigger: 'blur'\n        }],\n        validDateEnd: [{\n          validator: compareDate,\n          trigger: 'blur'\n        }]\n      },\n      formConfig: [{\n        type: 'commonInput',\n        disabled: true,\n        label: '供应商编码',\n        prop: 'supplierCode',\n        width: ''\n      }, {\n        type: 'commonInput',\n        disabled: true,\n        label: '供应商名称',\n        prop: 'supplierName',\n        width: ''\n      }, {\n        type: 'date',\n        label: '报价时间',\n        prop: 'quotedDate',\n        width: ''\n      }, {\n        type: 'commonInput',\n        disabled: true,\n        label: '物料编码',\n        prop: 'materielCode',\n        width: ''\n      }, {\n        type: 'commonInput',\n        disabled: true,\n        label: '物料名称',\n        prop: 'materielName',\n        width: ''\n      }, {\n        type: 'commonInput',\n        disabled: true,\n        label: '物料分类',\n        prop: 'materielClassName',\n        width: ''\n      }, {\n        type: 'commonInput',\n        label: '重量(KG)',\n        prop: 'weight',\n        width: ''\n      }, //wu\n      {\n        type: 'dictSelect',\n        dType: 'dt_srm_pdr',\n        label: '结算方式',\n        prop: 'settlementMethod',\n        width: ''\n      }, //wu dict dt_srm_pdr\n      {\n        type: 'commonInput',\n        label: '其它方式说明',\n        prop: 'otherMethod',\n        width: ''\n      }, //wu\n      {\n        type: 'dictSelect',\n        dType: 'dt_srm_pdk',\n        label: '币种',\n        prop: 'currency',\n        width: ''\n      }, //wu dict\n      {\n        type: 'date',\n        label: '有效期起',\n        disabled: true,\n        prop: 'validDateStart',\n        width: ''\n      }, {\n        type: 'date',\n        label: '有效期止',\n        disabled: true,\n        prop: 'validDateEnd',\n        width: ''\n      }, {\n        type: 'textarea',\n        label: '备注',\n        prop: 'remark',\n        width: '780px',\n        rows: \"2\"\n      }, {\n        type: 'inputArr',\n        label: '承诺降幅',\n        prop: 'prop4',\n        width: '',\n        inputArr: [{\n          type: 'commonInput',\n          label: '第一年',\n          prop: 'firstYearDecline',\n          width: '',\n          styleObj: {}\n        }, {\n          type: 'commonInput',\n          label: '第二年',\n          prop: 'secondYearDecline',\n          width: '',\n          styleObj: {\n            marginLeft: '10px'\n          }\n        }, {\n          type: 'commonInput',\n          label: '第三年',\n          prop: 'thirdYearDecline',\n          width: '',\n          styleObj: {\n            marginLeft: '10px'\n          }\n        }, {\n          type: 'commonInput',\n          label: '第四年',\n          prop: 'forthYearDecline',\n          width: '',\n          styleObj: {\n            marginLeft: '10px'\n          }\n        }, {\n          type: 'commonInput',\n          label: '第五年',\n          prop: 'fifthYearDecline',\n          width: '',\n          styleObj: {\n            marginLeft: '10px'\n          }\n        }]\n      }, {\n        type: 'commonInput',\n        inputType: 'number',\n        label: '原材料费用',\n        prop: 'rawMaterialCost',\n        width: ''\n      }, //A\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        label: '设计/实验费用',\n        prop: 'designCost',\n        width: ''\n      }, //M\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        label: '运输费用',\n        prop: 'logisticsCost',\n        width: ''\n      }, //I\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        label: '回收价值',\n        prop: 'recoveryValue',\n        width: ''\n      }, //A6\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        label: '管理费率',\n        prop: 'managementRate',\n        width: ''\n      }, //常量参数\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        label: '其他销售费用',\n        prop: 'otherCost',\n        width: ''\n      }, //J\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        label: '外购外协费用',\n        prop: 'outsourcingCost',\n        width: ''\n      }, //B\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        disabled: true,\n        label: '管理费用',\n        prop: 'managementCost',\n        width: ''\n      }, //F=(A-A6+B+C+D+E) *管理费率\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        label: '利润率',\n        prop: 'profitRate',\n        width: ''\n      }, //常量参数\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        label: '专业工装分摊费',\n        prop: 'toolingCost',\n        width: ''\n      }, //C\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        label: '财务费率',\n        prop: 'financialRate',\n        width: ''\n      }, //常量参数\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        disabled: true,\n        label: '利润',\n        prop: 'profit',\n        width: ''\n      }, //K=(A-A6+B+C+D+E+F+G) *利润率\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        label: '加工费',\n        prop: 'processingCost',\n        width: ''\n      }, //D\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        disabled: true,\n        label: '财务费用',\n        prop: 'financialCost',\n        width: ''\n      }, //G=(A-A6+B+C+D+E) *财务费率\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        disabled: true,\n        label: '核实价',\n        prop: 'realPrice',\n        width: ''\n      }, //L=A-A6+B+C+D+E+F+G+H+I+J+K+M\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        label: '废品损失',\n        prop: 'wasteLoss',\n        width: ''\n      }, //E\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        label: '包装费用',\n        prop: 'packingCost',\n        width: '' //H\n\n      }],\n      dialogConfig: [{\n        title: '参照报价',\n        unMutiple: false\n      }]\n    };\n  },\n  computed: _objectSpread({}, mapState({\n    dt_srm_pdr: function dt_srm_pdr(state) {\n      return state.dict.dt_srm_pdr;\n    },\n    //结算方式\n    dt_srm_pdk: function dt_srm_pdk(state) {\n      return state.dict.dt_srm_pdk;\n    },\n    //币种\n    dt_const: function dt_const(state) {\n      return state.srmBisSelect.dt_const;\n    } //常量\n\n  }), {\n    managementCost: function managementCost() {\n      var val = (parseFloat(this.formData.rawMaterialCost ? this.formData.rawMaterialCost : 0) - parseFloat(this.formData.recoveryValue ? this.formData.recoveryValue : 0) + parseFloat(this.formData.outsourcingCost ? this.formData.outsourcingCost : 0) + parseFloat(this.formData.toolingCost ? this.formData.toolingCost : 0) + parseFloat(this.formData.processingCost ? this.formData.processingCost : 0) + parseFloat(this.formData.wasteLoss ? this.formData.wasteLoss : 0)) * parseFloat(this.formData.managementRate ? this.formData.managementRate : 0);\n      this.$set(this.formData, 'managementCost', val);\n      return val;\n    },\n    profit: function profit() {\n      var val = (parseFloat(this.formData.rawMaterialCost ? this.formData.rawMaterialCost : 0) - parseFloat(this.formData.recoveryValue ? this.formData.recoveryValue : 0) + parseFloat(this.formData.outsourcingCost ? this.formData.outsourcingCost : 0) + parseFloat(this.formData.toolingCost ? this.formData.toolingCost : 0) + parseFloat(this.formData.processingCost ? this.formData.processingCost : 0) + parseFloat(this.formData.wasteLoss ? this.formData.wasteLoss : 0) + parseFloat(this.formData.managementCost ? this.formData.managementCost : 0) + parseFloat(this.formData.financialCost ? this.formData.financialCost : 0)) * parseFloat(this.formData.profitRate ? this.formData.profitRate : 0);\n      this.$set(this.formData, 'profit', val);\n      return val;\n    },\n    financialCost: function financialCost() {\n      var val = (parseFloat(this.formData.rawMaterialCost ? this.formData.rawMaterialCost : 0) - parseFloat(this.formData.recoveryValue ? this.formData.recoveryValue : 0) + parseFloat(this.formData.outsourcingCost ? this.formData.outsourcingCost : 0) + parseFloat(this.formData.toolingCost ? this.formData.toolingCost : 0) + parseFloat(this.formData.processingCost ? this.formData.processingCost : 0) + parseFloat(this.formData.wasteLoss ? this.formData.wasteLoss : 0)) * parseFloat(this.formData.financialRate ? this.formData.financialRate : 0);\n      this.$set(this.formData, 'financialCost', val);\n      return val;\n    },\n    realPrice: function realPrice() {\n      var val = parseFloat(this.formData.rawMaterialCost ? this.formData.rawMaterialCost : 0) - parseFloat(this.formData.recoveryValue ? this.formData.recoveryValue : 0) + parseFloat(this.formData.outsourcingCost ? this.formData.outsourcingCost : 0) + parseFloat(this.formData.toolingCost ? this.formData.toolingCost : 0) + parseFloat(this.formData.processingCost ? this.formData.processingCost : 0) + parseFloat(this.formData.wasteLoss ? this.formData.wasteLoss : 0) + parseFloat(this.formData.managementCost ? this.formData.managementCost : 0) + parseFloat(this.formData.financialCost ? this.formData.financialCost : 0) + parseFloat(this.formData.packingCost ? this.formData.packingCost : 0) + parseFloat(this.formData.logisticsCost ? this.formData.logisticsCost : 0) + parseFloat(this.formData.otherCost ? this.formData.otherCost : 0) + parseFloat(this.formData.profit ? this.formData.profit : 0) + parseFloat(this.formData.designCost ? this.formData.designCost : 0);\n      this.$set(this.formData, 'realPrice', val);\n      return val;\n    }\n  }),\n  watch: {\n    'managementCost': function managementCost() {},\n    'profit': function profit() {},\n    'financialCost': function financialCost() {},\n    'realPrice': function realPrice() {}\n  },\n  mounted: function mounted() {\n    this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pdr\", \"dt_srm_pdk\"]);\n    this.$store.dispatch(\"srmBisSelect/getBisData\", [\"dt_cate_platformSeries\", \"dt_const\"]);\n  },\n  methods: {\n    setConst: function setConst() {\n      var _this2 = this;\n\n      if (this.dt_const) {\n        this.dt_const.data.forEach(function (item) {\n          if (item.typeEncoding === 'PBE0') {\n            _this2.constVal.managementRate = item.constantValue;\n\n            _this2.$set(_this2.formData, 'managementRate', item.constantValue);\n          } else if (item.typeEncoding === 'PBE1') {\n            _this2.constVal.profitRate = item.constantValue;\n\n            _this2.$set(_this2.formData, 'profitRate', item.constantValue);\n          } else if (item.typeEncoding === 'PBE4') {\n            _this2.constVal.financialRate = item.constantValue;\n\n            _this2.$set(_this2.formData, 'financialRate', item.constantValue);\n          }\n        });\n      }\n    },\n    handleConfirm: function handleConfirm() {\n      var _this3 = this;\n\n      this.$refs.formData.validate(function (valid) {\n        if (valid) {\n          _this3.$confirm('确认保存吗?', '提示', {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }).then(function () {\n            if (_this3.methodType === 'add') {\n              var cdata = {\n                method: \"FIRST\",\n                quotationSource: 'notice',\n                quotedProposalDTO: _this3.formData\n              };\n\n              _this3.setTotalQuotation(); //后面注释掉\n\n\n              cdata.quotedProposalDTO.quotationSource = 'notice';\n              cdata.quotedProposalDTO.totalQuotation = _this3.totalQuotation;\n              createQuote(cdata).then(function (res) {\n                _this3.methodType = 'edit';\n                _this3.formData.rowId = res.data;\n\n                _this3.$message({\n                  type: 'success',\n                  message: '新增报价成功'\n                });\n\n                _this3.dialogVisible = false;\n\n                _this3.$emit('refresh');\n              });\n            } else {\n              var _cdata = {\n                method: \"FIRST\",\n                quotationSource: 'notice',\n                quotedProposalDTO: _this3.formData //后面注释掉\n\n              };\n              _cdata.quotedProposalDTO.quotationSource = 'notice';\n              var totalQuotation = {\n                totalQuotation: parseFloat(_this3.formData.designCost),\n                logisticsCost: parseFloat(_this3.formData.logisticsCost),\n                recoveryValue: parseFloat(_this3.formData.recoveryValue),\n                managementRate: parseFloat(_this3.formData.managementRate),\n                otherCost: parseFloat(_this3.formData.otherCost),\n                outsourcingCost: parseFloat(_this3.formData.outsourcingCost),\n                managementCost: parseFloat(_this3.formData.managementCost),\n                profitRate: parseFloat(_this3.formData.profitRate),\n                toolingCost: parseFloat(_this3.formData.toolingCost),\n                financialRate: parseFloat(_this3.formData.financialRate),\n                profit: parseFloat(_this3.formData.profit),\n                processingCost: parseFloat(_this3.formData.processingCost),\n                financialCost: parseFloat(_this3.formData.financialCost),\n                realPrice: parseFloat(_this3.formData.realPrice),\n                wasteLoss: parseFloat(_this3.formData.wasteLoss),\n                packingCost: parseFloat(_this3.formData.packingCost),\n                materielCode: _this3.formData.materielCode,\n                materielName: _this3.formData.materielName\n              };\n              _cdata.quotedProposalDTO.totalQuotation = totalQuotation;\n              console.log(_cdata, 'rrr');\n              updateQuote(_cdata).then(function () {\n                _this3.$message({\n                  type: 'success',\n                  message: '编辑报价成功'\n                });\n\n                _this3.dialogVisible = false;\n\n                _this3.$emit('refresh');\n              });\n            }\n          }).catch(function () {\n            _this3.$message({\n              type: 'info',\n              message: '已取消'\n            });\n          });\n        }\n      });\n    },\n    handleQuoteRef: function handleQuoteRef() {\n      this.$refs.refQuoteRef.dialogVisible = true;\n    },\n    initTotalQuotation: function initTotalQuotation() {\n      for (var par in this.totalQuotation) {\n        this.$set(this.totalQuotation, par, 0);\n      }\n    },\n    setTotalQuotation: function setTotalQuotation() {\n      for (var key in this.formData) {\n        for (var par in this.totalQuotation) {\n          if (key === par) {\n            this.$set(this.totalQuotation, key, this.formData[key]);\n          }\n        }\n      }\n    },\n    initForm: function initForm(fdata, row, status) {\n      this.isComputed = row;\n      console.log(fdata, row, 'yyyy');\n      this.initTotalQuotation();\n\n      if (this.$refs['formData']) {\n        this.$refs['formData'].resetFields();\n        this.$refs['formData'].clearValidate();\n      }\n\n      if (row) {\n        for (var key in this.formData) {\n          for (var par in row) {\n            if (key === par) {\n              this.$set(this.formData, key, row[key]);\n            }\n          }\n        }\n      }\n\n      if (status == 'edit') {\n        this.formData.rawMaterialCost = row.totalQuotation.rawMaterialCost;\n        this.formData.designCost = row.totalQuotation.designCost;\n        this.formData.logisticsCost = row.totalQuotation.logisticsCost;\n        this.formData.recoveryValue = row.totalQuotation.recoveryValue;\n        this.formData.managementRate = row.totalQuotation.managementRate;\n        this.formData.otherCost = row.totalQuotation.otherCost;\n        this.formData.outsourcingCost = row.totalQuotation.outsourcingCost;\n        this.formData.managementCost = row.totalQuotation.managementCost;\n        this.formData.profitRate = row.totalQuotation.profitRate;\n        this.formData.toolingCost = row.totalQuotation.toolingCost;\n        this.formData.financialRate = row.totalQuotation.financialRate;\n        this.formData.profit = row.totalQuotation.profit;\n        this.formData.processingCost = row.totalQuotation.processingCost;\n        this.formData.financialCost = row.totalQuotation.financialCost;\n        this.formData.realPrice = row.totalQuotation.realPrice;\n        this.formData.wasteLoss = row.totalQuotation.wasteLoss;\n        this.formData.packingCost = row.totalQuotation.packingCost;\n      }\n\n      if (fdata) {\n        for (var _key in this.formData) {\n          for (var _par in fdata) {\n            if (_key === _par) {\n              console.log(_key);\n\n              if (fdata[_key]) {\n                this.$set(this.formData, _key, fdata[_key]);\n              }\n            }\n          }\n        }\n      }\n\n      this.setConst();\n      console.log(this.formData);\n    },\n    resetTemp: function resetTemp() {\n      this.formData = {\n        rowId: null,\n        rfqNo: null,\n        supplierCode: null,\n        supplierName: null,\n        quotedDate: null,\n        materielCode: null,\n        materielName: null,\n        materielClass: null,\n        materielClassName: null,\n        weight: null,\n        settlementMethod: null,\n        otherMethod: null,\n        currency: null,\n        validDateStart: null,\n        validDateEnd: null,\n        remark: null,\n        firstYearDecline: null,\n        secondYearDecline: null,\n        thirdYearDecline: null,\n        forthYearDecline: null,\n        fifthYearDecline: null,\n        rawMaterialCost: 0,\n        designCost: 0,\n        logisticsCost: 0,\n        recoveryValue: 0,\n        managementRate: 0,\n        otherCost: 0,\n        outsourcingCost: 0,\n        managementCost: 0,\n        profitRate: 0,\n        toolingCost: 0,\n        financialRate: 0,\n        processingCost: 0,\n        financialCost: 0,\n        realPrice: 0,\n        wasteLoss: 0,\n        packingCost: 0\n      };\n    }\n  }\n};",null]}