{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/contractManage/contractTemplate/templateMaintenance/actuarialList.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/contractManage/contractTemplate/templateMaintenance/actuarialList.vue","mtime":1599136050760},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.function.name\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from \"@/api/project/srm/contractManage/templateMaintenance\";\nimport * as apitree from \"@/api/project/srm/dataBase/dictMaintenance\";\nimport { DICT_CODE } from '@/utils/constant';\nimport caiGou from '@/components/Select/xtpt/caigou'; //下拉组件\n\nimport Pagination from \"@/components/Pagination\";\nimport contentA from \"./content/contentA\";\nimport contentB from \"./content/contentB\";\nimport contentC from \"./content/contentC\";\nimport addItem from \"./content/addItem\";\nimport { mapState } from \"vuex\";\nexport default {\n  name: \"paymentMethod\",\n  components: {\n    Pagination: Pagination,\n    caiGou: caiGou,\n    contentA: contentA,\n    contentB: contentB,\n    contentC: contentC,\n    addItem: addItem\n  },\n  data: function data() {\n    return {\n      DICT_CODE: DICT_CODE,\n      theight: 0,\n      //表格高度\n      isSingle: true,\n      //表格是否单选 点击各按钮根据流程逻辑控制单多选\n      list: [],\n      total: 0,\n      listQuery: {\n        //查询\n        page: true,\n        currentPage: 1,\n        pageSize: 15\n      },\n      currentSelectedRow: null,\n      //当前选中的行\n      selectedRows: null,\n      //多选时选中的所有行\n      tableKey: 0,\n      //表格索引\n      contractCode: '',\n      //合同模板号\n      contractType: '',\n      //合同类型\n      orgCode: '',\n      //采购组织\n      dialogVisible: false,\n      dialogStatus: '',\n      show: false,\n      tabName: 'contentA',\n      temp: {\n        versionNo: undefined,\n        rowId: undefined,\n        contractTemplateItemDTOS: []\n      },\n      dialogVisibleItem: false,\n      dialogVisiblezf: false,\n      dialogVisiblesx: false,\n      dialogVisiblesc: false,\n      dialogVisiblefz: false,\n      deleteId: null,\n      //删除id\n      status: '',\n      //控制三个页签的新增编辑\n      rowId: null\n    };\n  },\n  created: function created() {},\n  computed: _objectSpread({}, mapState({\n    dt_srm_p0: function dt_srm_p0(state) {\n      return state.dict.dt_srm_p0;\n    },\n    dt_srm_pdv: function dt_srm_pdv(state) {\n      return state.dict.dt_srm_pdv;\n    }\n  })),\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_p0\", 'dt_srm_pdv']);\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this.setTableHeight();\n    };\n\n    this.getList();\n  },\n  watch: {\n    'dt_srm_pdv': function dt_srm_pdv() {\n      this.getList();\n    }\n  },\n  methods: {\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight();\n    },\n    //获取采购组织名称\n    selectName: function selectName(val) {\n      this.temp.purchaseOrgName = val;\n    },\n    //页签切换点击事件\n    handleClick: function handleClick(tab) {\n      if (tab.name === 'contentC') {\n        this.$nextTick(function () {\n          this.$refs.contentC.getList();\n        });\n      }\n    },\n    //主表新增\n    createA: function createA(val) {\n      var _this2 = this;\n\n      this.status = val;\n      setTimeout(function () {\n        if (_this2.status != 'contentC') {\n          _this2.$refs.addItem.show = false;\n        } else {\n          _this2.$refs.addItem.show = true;\n        }\n      }, 1.5 * 100);\n\n      if (this.temp.versionNo === undefined) {\n        if (this.temp.years && this.temp.contractType && this.temp.purchaseOrg) {\n          var dto = {\n            parentCode: 'dt_srm_qtsx',\n            currentPage: 1,\n            pageSize: 15\n          };\n          apitree.queryRecords(dto).then(function (res) {\n            var dataList = res.data.list.map(function (v) {\n              v.content = \"\";\n              var dto = {\n                content: v.content,\n                project: v.name,\n                orderNo: v.weight,\n                itemType: 'other'\n              };\n              return dto;\n            });\n            _this2.temp.contractTemplateItemDTOS = dataList;\n            api.addRecord(_this2.temp).then(function (res) {\n              _this2.temp = res.data;\n\n              _this2.$message({\n                title: '成功',\n                message: '主信息新增成功',\n                type: 'success',\n                duration: 2000\n              });\n\n              _this2.$nextTick(function () {\n                this.$refs.contentC.getList();\n              });\n\n              _this2.getList();\n            });\n          });\n          setTimeout(function () {\n            _this2.$refs.addItem.resetTemp();\n          }, 1.5 * 100);\n          this.dialogStatus = 'create';\n          this.dialogVisibleItem = true;\n        } else {\n          this.$message({\n            title: '警告',\n            message: '请选择年度,合同类型,采购组织',\n            type: 'warning',\n            duration: 2000\n          });\n        }\n      } else if (this.temp.versionNo !== undefined) {\n        setTimeout(function () {\n          _this2.$refs.addItem.resetTemp();\n        }, 1.5 * 100);\n        this.dialogStatus = 'create';\n        this.dialogVisibleItem = true;\n      }\n    },\n    //三页签明细编辑\n    updateA: function updateA(val, row) {\n      var _this3 = this;\n\n      this.status = val;\n      this.dialogStatus = 'update';\n      this.dialogVisibleItem = true;\n      setTimeout(function () {\n        if (_this3.status != 'contentC') {\n          _this3.$refs.addItem.show = false;\n        } else {\n          _this3.$refs.addItem.show = true;\n        }\n\n        _this3.$refs.addItem.temp = _objectSpread({}, row); // this.$set(this.$refs.addItem.temp, 'orderNo', row.orderNo)\n        // this.$set(this.$refs.addItem.temp, 'content', row.content)\n        // this.$set(this.$refs.addItem.temp, 'rowId', row.rowId)\n      }, 1.5 * 100);\n    },\n    //三页签明细编辑确定按钮\n    updateDataItem: function updateDataItem() {\n      var _this4 = this;\n\n      if (this.status === 'contentA') {\n        var dto = {\n          content: this.removeTAG(this.$refs.addItem.temp.content),\n          orderNo: this.$refs.addItem.temp.orderNo,\n          itemType: 'contract',\n          parentId: this.temp.rowId,\n          project: ''\n        };\n        api.updateRecordItem(this.$refs.addItem.temp.rowId, dto).then(function () {\n          _this4.$message({\n            title: '成功',\n            message: '编辑成功',\n            type: 'success',\n            duration: 2000\n          });\n\n          _this4.dialogVisibleItem = false;\n\n          _this4.$refs.contentA.getList();\n        });\n      } else if (this.status === 'contentB') {\n        var _dto = {\n          content: this.removeTAG(this.$refs.addItem.temp.content),\n          orderNo: this.$refs.addItem.temp.orderNo,\n          itemType: 'nomal',\n          parentId: this.temp.rowId,\n          project: ''\n        };\n        api.updateRecordItem(this.$refs.addItem.temp.rowId, _dto).then(function () {\n          _this4.$message({\n            title: '成功',\n            message: '编辑成功',\n            type: 'success',\n            duration: 2000\n          });\n\n          _this4.dialogVisibleItem = false;\n\n          _this4.$refs.contentB.getList();\n        });\n      } else if (this.status === 'contentC') {\n        var _dto2 = {\n          content: this.removeTAG(this.$refs.addItem.temp.content),\n          orderNo: this.$refs.addItem.temp.orderNo,\n          itemType: 'other',\n          parentId: this.temp.rowId,\n          project: this.$refs.addItem.temp.project\n        };\n        api.updateRecordItem(this.$refs.addItem.temp.rowId, _dto2).then(function () {\n          _this4.$message({\n            title: '成功',\n            message: '编辑成功',\n            type: 'success',\n            duration: 2000\n          });\n\n          _this4.dialogVisibleItem = false;\n\n          _this4.$refs.contentC.getList();\n        });\n      }\n    },\n    //过滤标签\n    removeTAG: function removeTAG(str) {\n      return str.replace(/<[^>]+>/g, \"\");\n    },\n    //三页签明细新增确定按钮单击事件\n    createDataItem: function createDataItem() {\n      var _this5 = this;\n\n      if (this.status === 'contentA') {\n        var dto = {\n          content: this.removeTAG(this.$refs.addItem.temp.content),\n          orderNo: this.$refs.addItem.temp.orderNo,\n          itemType: 'contract',\n          project: '',\n          parentId: 1\n        };\n        api.addRecordItem(this.temp.rowId, dto).then(function () {\n          _this5.$message({\n            title: '成功',\n            message: '新增成功',\n            type: 'success',\n            duration: 2000\n          });\n\n          _this5.dialogVisibleItem = false;\n\n          _this5.$refs.contentA.getList();\n        });\n      } else if (this.status === 'contentB') {\n        var _dto3 = {\n          content: this.removeTAG(this.$refs.addItem.temp.content),\n          orderNo: this.$refs.addItem.temp.orderNo,\n          itemType: 'nomal',\n          project: '',\n          parentId: 1\n        };\n        api.addRecordItem(this.temp.rowId, _dto3).then(function () {\n          _this5.$message({\n            title: '成功',\n            message: '新增成功',\n            type: 'success',\n            duration: 2000\n          });\n\n          _this5.dialogVisibleItem = false;\n\n          _this5.$refs.contentB.getList();\n        });\n      } else if (this.status === 'contentC') {\n        var _dto4 = {\n          content: this.removeTAG(this.$refs.addItem.temp.content),\n          orderNo: this.$refs.addItem.temp.orderNo,\n          itemType: 'other',\n          project: this.$refs.addItem.temp.project,\n          parentId: 1\n        };\n        api.addRecordItem(this.temp.rowId, _dto4).then(function () {\n          _this5.$message({\n            title: '成功',\n            message: '新增成功',\n            type: 'success',\n            duration: 2000\n          });\n\n          _this5.dialogVisibleItem = false;\n\n          _this5.$refs.contentC.getList();\n        });\n      }\n    },\n    refresh: function refresh() {\n      this.getList();\n    },\n    //获取表格数据\n    getList: function getList() {\n      var _this6 = this;\n\n      api.queryRecords(this.listQuery).then(function (res) {\n        var options = [_this6.dt_srm_p0, _this6.dt_srm_pdv];\n        res.data.list = _this6.$myFun.srmCodeToName(res.data.list, options, ['state', 'contractType']);\n        _this6.list = res.data.list;\n        _this6.total = res.data.pages.count;\n      });\n    },\n    //表格查询\n    handleQuery: function handleQuery() {\n      this.listQuery.currentPage = 1;\n      this.getList();\n    },\n    //新增按钮单击事件方法\n    handleCreate: function handleCreate() {\n      this.resetTemp();\n      this.$nextTick(function () {\n        this.$refs.contentA.list = [];\n        this.$refs.contentB.list = [];\n        this.$refs.contentC.list = [];\n      });\n      this.dialogStatus = 'create'; // this.show = false\n\n      this.dialogVisible = true;\n    },\n    //编辑按钮单击事件方法\n    handleUpdate: function handleUpdate(index, val) {\n      this.dialogStatus = 'update'; // this.show = true\n\n      this.temp = _objectSpread({}, val);\n      this.$nextTick(function () {\n        this.$refs.contentA.getList();\n        this.$refs.contentB.getList();\n        this.$refs.contentC.getList();\n      });\n      this.dialogVisible = true;\n    },\n    createData: function createData() {\n      var _this7 = this;\n\n      var dto = {\n        parentCode: 'dt_srm_qtsx',\n        currentPage: 1,\n        pageSize: 15\n      };\n      apitree.queryRecords(dto).then(function (res) {\n        var dataList = res.data.list.map(function (v) {\n          v.content = \"\";\n          var dto = {\n            content: v.content,\n            project: v.name,\n            orderNo: v.weight,\n            itemType: 'other'\n          };\n          return dto;\n        });\n        _this7.temp.contractTemplateItemDTOS = dataList;\n        api.addRecord(_this7.temp).then(function () {\n          _this7.$message({\n            title: '成功',\n            message: '新增成功',\n            type: 'success',\n            duration: 2000\n          });\n\n          _this7.dialogVisible = false;\n\n          _this7.getList();\n        });\n      });\n    },\n    updateData: function updateData() {\n      var _this8 = this;\n\n      api.updateRecord(this.temp.rowId, this.temp).then(function () {\n        _this8.$message({\n          title: '成功',\n          message: '编辑成功',\n          type: 'success',\n          duration: 2000\n        });\n\n        _this8.dialogVisible = false;\n\n        _this8.getList();\n      });\n    },\n    //删除按钮单击事件方法\n    handleDelete: function handleDelete(index, val) {\n      console.log(index, val);\n      this.orgCode = val.purchaseOrgName;\n      this.contractCode = val.versionNo;\n      this.deleteId = val.rowId;\n      this.dialogVisiblesc = true;\n    },\n    //删除按钮确定事件\n    deleteData: function deleteData() {\n      var _this9 = this;\n\n      api.deleteRecord(this.deleteId).then(function () {\n        _this9.$message({\n          title: '成功',\n          message: '删除成功',\n          type: 'success',\n          duration: 2000\n        });\n\n        _this9.dialogVisiblesc = false;\n\n        _this9.getList();\n      });\n    },\n    //作废按钮单击事件\n    handeCancel: function handeCancel(index, val) {\n      this.dialogVisiblezf = true;\n      this.contractType = val.contractTypeCN;\n      this.orgCode = val.purchaseOrgName;\n      this.contractCode = val.versionNo;\n      this.rowId = val.rowId;\n    },\n    //作废弹框确定按钮单击事件\n    cancel: function cancel() {\n      var _this10 = this;\n\n      var dto = {\n        method: 'invalid'\n      };\n      api.updateEffect(this.rowId, dto).then(function () {\n        _this10.$message({\n          title: '成功',\n          message: '废除成功',\n          type: 'success',\n          duration: 2000\n        });\n\n        _this10.getList();\n\n        _this10.dialogVisiblezf = false;\n      });\n    },\n    //生效按钮单击事件\n    handleEffect: function handleEffect(index, val) {\n      this.orgCode = val.purchaseOrgName;\n      this.contractCode = val.versionNo;\n      this.rowId = val.rowId;\n      this.dialogVisiblesx = true;\n    },\n    //生效弹框确定按钮单击事件\n    Effect: function Effect() {\n      var _this11 = this;\n\n      var dto = {\n        method: 'publish'\n      };\n      api.updateEffect(this.rowId, dto).then(function () {\n        _this11.$message({\n          title: '成功',\n          message: '发布成功',\n          type: 'success',\n          duration: 2000\n        });\n\n        _this11.getList();\n\n        _this11.dialogVisiblesx = false;\n      });\n    },\n    //预览按钮单击事件\n    handlePreview: function handlePreview(index, val) {\n      this.$emit('setState', 'preview', val);\n    },\n    //复制按钮单击事件\n    handleCopy: function handleCopy() {\n      if (this.selectlistRow) {\n        if (this.selectlistRow.state === 'P003') {\n          this.orgCode = this.selectlistRow.purchaseOrgName;\n          this.contractCode = this.selectlistRow.versionNo;\n          this.dialogVisiblefz = true;\n        } else {\n          this.$message({\n            title: '警告',\n            message: '只有发布状态才可复制',\n            type: 'warning',\n            duration: 2000\n          });\n        }\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning',\n          duration: 2000\n        });\n      }\n    },\n    //复制弹框确定按钮单击事件\n    confirmCopy: function confirmCopy() {\n      var _this12 = this;\n\n      api.addRecordCopy(this.selectlistRow.rowId).then(function () {\n        _this12.$message({\n          title: '成功',\n          message: '复制成功',\n          type: 'success',\n          duration: 2000\n        });\n\n        _this12.getList();\n\n        _this12.dialogVisiblefz = false;\n      });\n    },\n    // 表格选择框选中 注:参数为选中的所有行的数组\n    selectChange: function selectChange(val) {\n      this.selectlistRow = val[val.length - 1];\n\n      if (val.length > 1) {\n        this.$refs.tb.clearSelection();\n        this.$refs.tb.toggleRowSelection(val.pop());\n      }\n\n      this.$refs.tb.setCurrentRow(this.selectlistRow);\n    },\n    //点击表格某一行\n    rowClick: function rowClick(val) {\n      this.$refs.tb.clearSelection();\n      this.$refs.tb.toggleRowSelection(val);\n    },\n    resetTemp: function resetTemp() {\n      this.temp = {\n        versionNo: undefined,\n        years: undefined,\n        contractType: undefined,\n        purchaseOrg: undefined,\n        remark: undefined\n      };\n    }\n  }\n};",null]}