{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/supplierRFQ/supplierRFQAnswer/dialog/dialogQuote.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/supplierRFQ/supplierRFQAnswer/dialog/dialogQuote.vue","mtime":1596610934107},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { createQuote, updateQuote, queryQuoteRow } from \"@/api/project/srm/supplierSelect/supplierRFQ/supplierRFQAnswer\";\nimport { queryRecords } from \"@/api/project/srm/supplierSelection/constantParameters\";\nimport { mapState } from \"vuex\";\nimport { DICT_CODE } from '@/utils/constant';\nimport caiGou from '@/components/Select/xtpt/caigou'; //下拉组件\n\nimport tabQuote from \"../tab/tabQuote\";\nimport tabYCLcost from \"../tab/tabYCLcost\";\nimport tabWGcost from \"../tab/tabWGcost\";\nimport tabZYcost from \"../tab/tabZYcost\";\nimport tabJGcost from \"../tab/tabJGcost\";\nimport tabBZcost from \"../tab/tabBZcost\";\nimport tabWLcost from \"../tab/tabWLcost\";\nimport dialogQuoteRef from \"./dialogQuoteRef\"; //参照报价\n\nexport default {\n  name: 'dialogQuote',\n  props: ['title'],\n  components: {\n    caiGou: caiGou,\n    dialogQuoteRef: dialogQuoteRef,\n    tabQuote: tabQuote,\n    tabYCLcost: tabYCLcost,\n    tabWGcost: tabWGcost,\n    tabZYcost: tabZYcost,\n    tabJGcost: tabJGcost,\n    tabBZcost: tabBZcost,\n    tabWLcost: tabWLcost\n  },\n  data: function data() {\n    return {\n      dialogVisible: false,\n      tabName: 'tabQuote',\n      methodType: 'add',\n      DICT_CODE: DICT_CODE,\n      orgCode: null,\n      params: null,\n      priceData: {},\n      formData: {\n        rowId: null,\n        rfqNo: null,\n        supplierCode: null,\n        supplierName: null,\n        quotedDate: null,\n        materielCode: null,\n        materielName: null,\n        materielClass: null,\n        materielClassName: null,\n        weight: null,\n        settlementMethod: null,\n        otherMethod: null,\n        currency: null,\n        validDateStart: null,\n        validDateEnd: null,\n        designCost: null,\n        otherCost: null,\n        firstYearDecline: null,\n        secondYearDecline: null,\n        thirdYearDecline: null,\n        forthYearDecline: null,\n        fifthYearDecline: null,\n        remark: null,\n        totalQuotation: null\n      },\n      totalQuotation: {\n        designCost: 0,\n        financialCost: 0,\n        financialRate: null,\n        logisticsCost: 0,\n        managementCost: 0,\n        managementRate: null,\n        materielCode: 0,\n        materielName: 0,\n        otherCost: 0,\n        outsourcingCost: 0,\n        packingCost: 0,\n        processingCost: 0,\n        profit: 0,\n        profitRate: 0,\n        quotedDate: null,\n        rawMaterialCost: 0,\n        realPrice: 0,\n        recoveryValue: 0,\n        toolingCost: 0,\n        version: 0,\n        wasteLoss: 0\n      },\n      rules: {\n        settlementMethod: [{\n          required: true,\n          message: '请选择',\n          trigger: 'blur'\n        }]\n      },\n      formConfig: [{\n        type: 'commonInput',\n        disabled: true,\n        label: '供应商编码',\n        prop: 'supplierCode',\n        width: ''\n      }, {\n        type: 'commonInput',\n        disabled: true,\n        label: '供应商名称',\n        prop: 'supplierName',\n        width: ''\n      }, {\n        type: 'date',\n        label: '报价时间',\n        prop: 'quotedDate',\n        width: ''\n      }, {\n        type: 'commonInput',\n        disabled: true,\n        label: '物料编码',\n        prop: 'materielCode',\n        width: ''\n      }, {\n        type: 'commonInput',\n        disabled: true,\n        label: '物料名称',\n        prop: 'materielName',\n        width: ''\n      }, {\n        type: 'commonInput',\n        disabled: true,\n        label: '物料分类',\n        prop: 'materielClassName',\n        width: ''\n      }, {\n        type: 'commonInput',\n        label: '重量(KG)',\n        prop: 'weight',\n        width: ''\n      }, //wu\n      {\n        type: 'dictSelect',\n        dType: 'dt_srm_pdr',\n        label: '结算方式',\n        prop: 'settlementMethod',\n        width: ''\n      }, //wu dict dt_srm_pdr\n      {\n        type: 'commonInput',\n        label: '其它方式说明',\n        prop: 'otherMethod',\n        width: ''\n      }, //wu\n      {\n        type: 'dictSelect',\n        dType: 'dt_srm_pdk',\n        label: '币种',\n        prop: 'currency',\n        width: ''\n      }, //wu dict\n      {\n        type: 'date',\n        label: '有效期起',\n        prop: 'validDateStart',\n        width: ''\n      }, {\n        type: 'date',\n        label: '有效期止',\n        prop: 'validDateEnd',\n        width: ''\n      }, {\n        type: 'commonInput',\n        label: '设计/实验费用',\n        prop: 'designCost',\n        width: ''\n      }, {\n        type: 'commonInput',\n        label: '其他费用',\n        prop: 'otherCost',\n        width: ''\n      }, {\n        type: 'inputArr',\n        label: '承诺降幅',\n        prop: 'prop4',\n        width: '',\n        inputArr: [{\n          type: 'commonInput',\n          label: '第一年',\n          prop: 'firstYearDecline',\n          width: '',\n          styleObj: {}\n        }, {\n          type: 'commonInput',\n          label: '第二年',\n          prop: 'secondYearDecline',\n          width: '',\n          styleObj: {\n            marginLeft: '8px'\n          }\n        }, {\n          type: 'commonInput',\n          label: '第三年',\n          prop: 'thirdYearDecline',\n          width: '',\n          styleObj: {\n            marginLeft: '8px'\n          }\n        }, {\n          type: 'commonInput',\n          label: '第四年',\n          prop: 'forthYearDecline',\n          width: '',\n          styleObj: {\n            marginLeft: '8px'\n          }\n        }, {\n          type: 'commonInput',\n          label: '第五年',\n          prop: 'fifthYearDecline',\n          width: '',\n          styleObj: {\n            marginLeft: '8px'\n          }\n        }]\n      }, {\n        type: 'textarea',\n        label: '备注',\n        prop: 'remark',\n        width: '800px',\n        rows: \"2\"\n      }],\n      tabConfig: [{\n        label: '报价表',\n        name: 'tabQuote',\n        prop: 'tabQuote'\n      }, {\n        label: '原材料费用',\n        name: 'tabYCLcost',\n        prop: 'tabYCLcost'\n      }, {\n        label: '外购/协费用',\n        name: 'tabWGcost',\n        prop: 'tabWGcost'\n      }, {\n        label: '专用工装费用',\n        name: 'tabZYcost',\n        prop: 'tabZYcost'\n      }, {\n        label: '加工费用',\n        name: 'tabJGcost',\n        prop: 'tabJGcost'\n      }, {\n        label: '包装费用',\n        name: 'tabBZcost',\n        prop: 'tabBZcost'\n      }, {\n        label: '物流费用',\n        name: 'tabWLcost',\n        prop: 'tabWLcost'\n      }],\n      dialogConfig: [{\n        title: '参照报价',\n        unMutiple: false\n      }]\n    };\n  },\n  computed: _objectSpread({}, mapState({\n    dt_srm_pdr: function dt_srm_pdr(state) {\n      return state.dict.dt_srm_pdr;\n    },\n    //结算方式\n    dt_srm_pdk: function dt_srm_pdk(state) {\n      return state.dict.dt_srm_pdk;\n    } //币种\n\n  })),\n  mounted: function mounted() {\n    this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pdr\", \"dt_srm_pdk\"]);\n  },\n  watch: {\n    'formData.designCost': function formDataDesignCost(val) {\n      if (this.$refs.tabQuoteRef) this.$refs.tabQuoteRef[0].changeFormValue('designCost', val);\n    },\n    'formData.otherCost': function formDataOtherCost(val) {\n      if (this.$refs.tabQuoteRef) this.$refs.tabQuoteRef[0].changeFormValue('otherCost', val);\n    }\n  },\n  methods: {\n    handleConfirm: function handleConfirm() {\n      var _this = this;\n\n      this.$refs.formData.validate(function (valid) {\n        if (valid) {\n          _this.$confirm('确认保存吗?', '提示', {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }).then(function () {\n            if (_this.methodType === 'add' && !_this.formData.rowId) {\n              var cdata = {\n                method: \"ITEM\",\n                quotationSource: 'rfq',\n                quotedProposalDTO: _this.formData // 后面注释掉\n\n              };\n              cdata.quotedProposalDTO.quotationSource = 'rfq';\n              var dto = {\n                purchaseOrg: _this.orgCode,\n                currentPage: 1,\n                pageSize: 10\n              };\n              queryRecords(dto).then(function (res) {\n                console.log(res, 'pppppp');\n                res = res.data.list.filter(function (v) {\n                  return v.typeEncoding == 'PBE1' || v.typeEncoding == 'PBE4' || v.typeEncoding == 'PBE0';\n                });\n                res.forEach(function (val) {\n                  if (val.typeEncoding == 'PBE1') {\n                    _this.totalQuotation.managementRate = val.constantValue;\n                  }\n\n                  if (val.typeEncoding == 'PBE4') {\n                    _this.totalQuotation.financialRate = val.constantValue;\n                  }\n\n                  if (val.typeEncoding == 'PBE0') {\n                    _this.totalQuotation.profitRate = val.constantValue;\n                  }\n                });\n              });\n              cdata.quotedProposalDTO.totalQuotation = _this.totalQuotation;\n              console.log(cdata.quotedProposalDTO.totalQuotation, _this.formData.quotedDate, 'cdata.quotedProposalDTO.totalQuotation'); // cdata.quotedProposalDTO.totalQuotation.quotedDate = this.formData.quotedDate\n\n              createQuote(cdata).then(function (res) {\n                _this.methodType = 'edit';\n                _this.formData.rowId = res.data;\n\n                _this.$message({\n                  type: 'success',\n                  message: '新增报价成功'\n                }); // this.dialogVisible = false\n\n\n                _this.$emit('refresh');\n              });\n            } else {\n              var _cdata = {\n                method: \"ITEM\",\n                quotationSource: 'rfq',\n                quotedProposalDTO: _this.formData // 后面注释掉\n\n              };\n              _cdata.quotedProposalDTO.quotationSource = 'rfq';\n              updateQuote(_cdata).then(function () {\n                _this.$message({\n                  type: 'success',\n                  message: '编辑报价成功'\n                }); // this.dialogVisible = false\n\n\n                _this.$emit('refresh');\n              });\n            }\n          });\n        }\n      });\n    },\n    handleQuoteRef: function handleQuoteRef() {\n      this.$refs.refQuoteRef.dialogVisible = true;\n      this.$refs.refQuoteRef.getList(this.priceData);\n    },\n    initForm: function initForm(fdata, row) {\n      var _this2 = this;\n\n      console.log(fdata, row, 'fdata, row');\n      this.tabName = 'tabQuote';\n      this.$nextTick(function () {\n        _this2.$refs.tabQuoteRef[0].initTable();\n\n        _this2.$refs.tabYCLcostRef[0].getItems();\n\n        _this2.$refs.tabWGcostRef[0].getItems();\n\n        _this2.$refs.tabZYcostRef[0].getItems();\n\n        _this2.$refs.tabJGcostRef[0].getItems();\n\n        _this2.$refs.tabBZcostRef[0].getItems();\n\n        _this2.$refs.tabWLcostRef[0].getItems();\n      });\n      this.priceData = fdata;\n\n      if (this.$refs['formData']) {\n        this.$refs['formData'].resetFields();\n        this.$refs['formData'].clearValidate();\n      }\n\n      if (row) {\n        for (var key in this.formData) {\n          for (var par in row) {\n            if (key === par) {\n              this.$set(this.formData, key, row[key]);\n            }\n          }\n        }\n      } else {\n        for (var _key in this.formData) {\n          this.$set(this.formData, _key, null);\n        }\n      }\n\n      if (fdata) {\n        for (var _key2 in this.formData) {\n          for (var _par in fdata) {\n            if (_key2 === _par) {\n              this.$set(this.formData, _key2, fdata[_key2]);\n            }\n          }\n        }\n      }\n\n      if (row && row.totalQuotation) {\n        this.$nextTick(function () {\n          _this2.$refs.tabQuoteRef[0].initTable(row.totalQuotation);\n        });\n      }\n    },\n    getTotalQuotation: function getTotalQuotation() {\n      var _this3 = this;\n\n      queryQuoteRow(this.params).then(function (res) {\n        _this3.$nextTick(function () {\n          _this3.$refs.tabQuoteRef[0].initTable(res.data.totalQuotation);\n        });\n      });\n    }\n  }\n};",null]}