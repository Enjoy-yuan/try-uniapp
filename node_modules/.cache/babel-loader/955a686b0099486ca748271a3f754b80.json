{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierManagement/supplierAccess/reviewFeedback/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierManagement/supplierAccess/reviewFeedback/index.vue","mtime":1596610933947},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapState, mapGetters } from \"vuex\";\nimport * as api from \"@/api/project/srm/supplierManage/supplierAccess/reviewFeedback\";\nimport { DICT_CODE } from '@/utils/constant';\nimport caiGou from '@/components/Select/xtpt/caigou'; //下拉组件\n// import * as api from \"@/api/system/role\"\n\nimport Pagination from \"@/components/Pagination\";\nimport dialogFeedback from \"./dialog/dialogFeedback\";\nimport dialogPersonSelect from '@/components/Dialog/dialogPersonSelect.vue'; //选择人\n\nimport dialogMaterielCategory from '@/components/Dialog/dialogMaterielCategory'; //物料分类选择\n// import { mapState } from \"vuex\"\n\nexport default {\n  name: \"reviewFeedback\",\n  components: {\n    caiGou: caiGou,\n    Pagination: Pagination,\n    dialogFeedback: dialogFeedback,\n    dialogPersonSelect: dialogPersonSelect,\n    dialogMaterielCategory: dialogMaterielCategory\n  },\n  data: function data() {\n    return {\n      theight: 0,\n      //表格高度\n      isSingle: true,\n      //表格是否单选 点击各按钮根据流程逻辑控制单多选\n      dataList: [],\n      total: 0,\n      totalItem: 0,\n      listQuery: {\n        //查询\n        page: true,\n        currentPage: 1,\n        pageSize: 10,\n        orgCode: null,\n        investigateNo: null,\n        materielClass: null,\n        supplierName: null,\n        planSource: null,\n        taskUser: null,\n        taskUserName: null,\n        startDate: null,\n        endDate: null\n      },\n      itemQuery: {\n        page: true,\n        currentPage: 1,\n        pageSize: 10,\n        evaluationNo: null\n      },\n      rangeDate: null,\n      DICT_CODE: DICT_CODE,\n      currentSelectedRow: null,\n      //当前选中的行\n      selectedRows: [],\n      //多选时选中的所有行\n      tableKey: 0,\n      //表格索引\n      filterConfig: [{\n        type: 'selectcaiGou',\n        label: '采购组织',\n        prop: 'orgCode',\n        width: '',\n        copmNum: 0,\n        class: 'filter-item'\n      }, {\n        type: 'commonInput',\n        label: '考察计划号',\n        prop: 'investigateNo',\n        width: '',\n        class: 'filter-item ml_5'\n      }, {\n        type: 'inputBtnMC',\n        label: '物料分类',\n        prop: 'materielClassName',\n        width: '',\n        class: 'ml_5'\n      }, {\n        type: 'dictSelect',\n        dType: 'dt_srm_p0',\n        label: '状态',\n        prop: 'state',\n        width: '',\n        class: 'filter-item ml_5'\n      }, {\n        type: 'commonInput',\n        label: '供应商名称',\n        prop: 'supplierName',\n        width: '',\n        class: 'filter-item ml_5'\n      }, {\n        type: 'dictSelect',\n        dType: 'dt_srm_pai',\n        label: '计划来源',\n        prop: 'planSource',\n        width: '',\n        optionArr: [],\n        class: 'filter-item ml_5'\n      }, {\n        type: 'inputBtnPerson',\n        label: '接收人',\n        prop: 'taskUserName',\n        copmNum: 1,\n        class: 'ml_5'\n      }, //wu\n      {\n        type: 'daterange',\n        label: '考察时间段',\n        prop: 'par9',\n        width: '250px',\n        startpl: '考察时间',\n        endpl: '结束时间',\n        class: 'filter-item'\n      }],\n      tableConfig: [{\n        label: '状态',\n        prop: 'stateCN',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '计划来源',\n        prop: 'planSourceCN',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '供应商',\n        prop: 'supplierName',\n        align: 'center',\n        width: '180'\n      }, {\n        label: '物料分类',\n        prop: 'materielClassName',\n        align: 'center',\n        width: '180'\n      }, {\n        label: '采购组织',\n        prop: 'orgName',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '考察计划',\n        prop: 'investigateNo',\n        align: 'center',\n        width: '150'\n      }, {\n        label: '考察部门',\n        prop: 'department',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '考察部门名称',\n        prop: 'departmentName',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '考察项',\n        prop: 'itemCN',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '是否考察',\n        prop: 'investigate',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '理由',\n        prop: 'reason',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '考察人',\n        prop: 'investigateUser',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '评价人',\n        prop: 'evaluateUserName',\n        align: 'center',\n        width: 'auto'\n      }],\n      dialogConfig: [{\n        title: '考察反馈计划'\n      }, {\n        title: '接收人选择',\n        unMutiple: true,\n        propCode: 'taskUser',\n        propName: 'taskUserName',\n        required: false\n      }, {\n        title: '选择物料分类',\n        isRequired: false,\n        unMutiple: true\n      }]\n    };\n  },\n  created: function created() {},\n  computed: _objectSpread({}, mapGetters(['domainCode', 'domainCodeName']), mapState({\n    dt_srm_p0: function dt_srm_p0(state) {\n      return state.dict.dt_srm_p0;\n    },\n    //状态\n    dt_srm_pai: function dt_srm_pai(state) {\n      return state.dict.dt_srm_pai;\n    },\n    dt_srm_pb4: function dt_srm_pb4(state) {\n      return state.dict.dt_srm_pb4;\n    } //考察项\n\n  })),\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_p0\", \"dt_srm_pai\", \"dt_srm_pb4\"]);\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this.setTableHeight();\n    };\n\n    this.setDefault();\n    this.getList();\n  },\n  watch: {\n    'rangeDate': function rangeDate(value) {\n      if (value) {\n        this.listQuery.startDate = value[0];\n        this.listQuery.endDate = value[1];\n      }\n    },\n    'domainCode': function domainCode(value) {\n      this.$set(this.listQuery, 'taskUser', value);\n    }\n  },\n  methods: {\n    //设置默认值\n    setDefault: function setDefault() {\n      this.$set(this.listQuery, 'taskUser', this.domainCode);\n      this.$set(this.listQuery, 'taskUserName', this.domainCodeName);\n      this.$set(this.listQuery, 'state', 'P002');\n    },\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight();\n    },\n    //获取表格数据\n    getList: function getList() {\n      var _this2 = this;\n\n      api.queryFeedback(this.listQuery).then(function (res) {\n        var options = [_this2.dt_srm_p0, _this2.dt_srm_pai, _this2.dt_srm_pb4];\n        res.data = _this2.$myFun.codeToName(res.data, options, ['state', 'planSource', 'item']);\n        _this2.dataList = res.data.list;\n        _this2.total = res.data.pages.count;\n      });\n    },\n    //表格查询\n    handleQuery: function handleQuery() {\n      this.listQuery.currentPage = 1;\n      this.getList();\n    },\n    //表格显示条数变化\n    handleSizeChange: function handleSizeChange(val) {\n      this.listQuery.pageSize = val;\n      this.getList();\n    },\n    //表格当前页变化\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.listQuery.currentPage = val;\n      this.getList();\n    },\n    //表格操作编辑\n    handleFeedback: function handleFeedback(index, row) {\n      var _this3 = this;\n\n      console.log('反馈', index, row);\n      api.queryProjectItem(row.investigateNo, row.rowId).then(function (res) {\n        console.log('queryProjectItem', res);\n        _this3.$refs.refFeedback.dialogVisible = true;\n        _this3.$refs.refFeedback.isEdit = true;\n\n        _this3.$refs.refFeedback.initForm(res.data);\n      });\n    },\n    //确认添加/编辑\n    confirmFeedback: function confirmFeedback(cdata) {\n      var _this4 = this;\n\n      api.updateProjectRecords(cdata.feedbackItemDTO.investigateNo, cdata.feedbackItemDTO.rowId, cdata).then(function (res) {\n        console.log('updateProjectRecords', res);\n\n        _this4.$message({\n          type: 'success',\n          message: '反馈提交成功'\n        });\n\n        _this4.getList();\n      });\n    },\n    showPerson: function showPerson(propCode, propName, title) {\n      this.dialogConfig[1].title = title;\n      this.dialogConfig[1].propCode = propCode;\n      this.dialogConfig[1].propName = propName;\n      this.$refs.refPerson.dialogVisible = true;\n    },\n    personConfirm: function personConfirm(val, propCode, propName) {\n      if (propCode === 'taskUser') {\n        this.$set(this.listQuery, propCode, val[0].employeeCode);\n        this.$set(this.listQuery, propName, val[0].employeeName);\n      }\n    },\n    showMC: function showMC() {\n      if (!this.listQuery.orgCode) {\n        this.$message({\n          type: 'warning',\n          message: '请先选择组织编码'\n        });\n      } else {\n        this.$refs.refMC.listQuery.orgCode = this.listQuery.orgCode;\n        this.$refs.refMC.handleQuery();\n        this.$refs.refMC.dialogVisible = true;\n      }\n    },\n    handleConfirmMC: function handleConfirmMC(data) {\n      this.listQuery.materielClass = data[0].classCode;\n      this.$set(this.listQuery, 'materielClassName', data[0].className);\n    } //清空接收人@blur=\"clearTaskUser\"\n    // clearTaskUser (val) {\n    //     if (this.listQuery.taskUserName !== this.domainCodeName) {\n    //         this.$set(this.listQuery, 'taskUser', null)\n    //         this.$set(this.listQuery, 'taskUserName', null)\n    //     }\n    // }\n\n  }\n};",null]}