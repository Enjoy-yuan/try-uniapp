{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentArchives/tab1.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentArchives/tab1.vue","mtime":1596610933376},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from '@/api/project/eas/el/equipmentArchives'; // import Pagination from '@/components/Pagination'\n\nimport { mapState } from 'vuex';\nexport default {\n  name: 'dispatchOrderManagement',\n  components: {},\n  props: ['deviceCode'],\n  data: function data() {\n    return {\n      // basurl:'113.57.169.228:7954',\n      fileList: [],\n      list: null,\n      newArr: [],\n      subList: [],\n      total: 0,\n      theight: 0,\n      //表格高度\n      listQuery: {\n        fileType: undefined\n      },\n      temp: {\n        fileType: undefined,\n        category: undefined,\n        fileCode: undefined,\n        readName: undefined\n      },\n      files: undefined,\n      tableKey: [0]\n    };\n  },\n  created: function created() {\n    this.getSetDefaults();\n  },\n  computed: _objectSpread({}, mapState({\n    dt_file_equipment: function dt_file_equipment(state) {\n      return state.eamDict.dt_file_equipment;\n    },\n    dt_file_type: function dt_file_type(state) {\n      return state.eamDict.dt_file_type;\n    }\n  })),\n  mounted: function mounted() {\n    var _this = this;\n\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this.setTableHeight();\n    };\n\n    this.temp.fileType = \"img\";\n    this.$store.dispatch('eamDict/getDicData', ['dt_file_equipment', 'dt_file_type']);\n  },\n  methods: {\n    getList: function getList() {\n      var _this2 = this;\n\n      var fileType = 'img';\n      api.queryFile(this.deviceCode, fileType).then(function (res) {\n        _this2.list = res.data;\n        _this2.newArr = [];\n\n        for (var i = 0; i < _this2.list.length; i++) {\n          api.queryPic(_this2.list[i].readName).then(function (res) {\n            res.config.url = res.config.url.replace(process.env.VUE_APP_BASE_API11, process.env.VUE_APP_BASE_API11_URL);\n\n            _this2.newArr.push(res.config.url);\n\n            return _this2.newArr;\n          });\n        }\n      });\n    },\n    getSetDefaults: function getSetDefaults() {\n      this.$viewer.setDefaults({\n        // inline: true,\n        button: true,\n        //右上角按钮\n        navbar: true,\n        //底部缩略图\n        title: false,\n        //当前图片标题\n        toolbar: true,\n        //底部工具栏\n        tooltip: false,\n        //显示缩放百分比\n        movable: true,\n        //是否可以移动\n        zoomable: false,\n        //是否可以缩放\n        rotatable: false,\n        //是否可旋转\n        scalable: false,\n        //是否可翻转\n        transition: false,\n        //使用 CSS3 过度\n        fullscreen: false,\n        //播放时是否全屏\n        keyboard: true,\n        //是否支持键盘\n        url: 'data-source',\n        viewed: function viewed(e) {\n          if (e.detail.index === 1) {\n            this.viewer.rotate(20);\n          }\n        }\n      });\n    },\n    value: function value() {},\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight() - 100;\n    },\n    handleDelete: function handleDelete() {\n      var _this3 = this;\n\n      //删除列表\n      if (this.selectlistRow) {\n        this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          api.deleteFile(_this3.selectlistRow.fileCode).then(function () {\n            _this3.getList(), _this3.$message({\n              title: '成功',\n              message: '删除成功',\n              type: 'success',\n              duration: 2000\n            });\n          });\n        }).catch(function () {\n          _this3.$message({\n            type: 'info',\n            message: '已取消删除'\n          });\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    init: function init(val) {\n      this.newArr = [];\n      this.subList = val;\n      this.getList();\n    },\n    fileExceed: function fileExceed() {\n      this.$message.error('一次最多上传10个文件');\n    },\n    beforeUpload: function beforeUpload(file) {\n      var isJPG = file.type === 'image/jpeg';\n      var isPNG = file.type === 'image/png';\n      var isPG = isJPG || isPNG; //限制图片格式为jpg / png\n\n      var isLt2M = file.size / 1024 / 1024 < 10; //限制图片大小\n\n      if (!isPG) {\n        this.$message.error('上传头像图片只能是 JPG 或 PNG 格式!');\n      }\n\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 10MB!');\n      }\n\n      return isPG && isLt2M;\n    },\n    handleChange: function handleChange(file, fileList) {\n      this.files = fileList;\n    },\n    uploadFile: function uploadFile() {},\n    handleUpload: function handleUpload() {\n      var _this4 = this;\n\n      if (!this.subList) {\n        this.$message({\n          title: '警告',\n          message: '请选择设备',\n          type: 'warning'\n        });\n        return false;\n      }\n\n      if (!this.temp.category) {\n        this.$message({\n          title: '警告',\n          message: '请选择文件类别',\n          type: 'warning'\n        });\n        return false;\n      }\n\n      var data = new FormData();\n      this.files.forEach(function (file) {\n        data.append('files', file.raw);\n      });\n      api.uploadFile(this.deviceCode, data, {\n        category: this.temp.category,\n        fileType: this.temp.fileType\n      }).then(function () {\n        _this4.$refs.upload.clearFiles();\n\n        _this4.$message({\n          title: '成功',\n          message: '上传成功',\n          type: 'success',\n          duration: 2000\n        });\n\n        _this4.getList();\n      });\n    },\n    // 获取表格选中时的数据\n    selectRow: function selectRow(val) {\n      this.selectlistRow = val[val.length - 1];\n\n      if (val.length > 1) {\n        this.$refs.mainList.clearSelection();\n        this.$refs.mainList.toggleRowSelection(val[val.length - 1], 'selected');\n      }\n    }\n  }\n};",null]}