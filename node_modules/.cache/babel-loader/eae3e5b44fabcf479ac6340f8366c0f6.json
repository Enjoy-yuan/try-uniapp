{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/dialog/dialogQuoteTotal.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/dialog/dialogQuoteTotal.vue","mtime":1596610933768},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { createQuote, updateQuote } from \"@/api/project/srm/supplierSelect/supplierRFQ/supplierRFQAnswer\";\nimport { mapState } from \"vuex\";\nimport { DICT_CODE } from '@/utils/constant';\nimport caiGou from '@/components/Select/xtpt/caigou'; //下拉组件\n\nimport dialogQuoteTotalRef from \"./dialogQuoteTotalRef\"; //参照报价\n\nexport default {\n  name: 'dialogQuoteTotal',\n  props: ['title'],\n  methodType: 'add',\n  components: {\n    caiGou: caiGou,\n    dialogQuoteTotalRef: dialogQuoteTotalRef\n  },\n  data: function data() {\n    return {\n      dialogVisible: false,\n      DICT_CODE: DICT_CODE,\n      formData: {\n        rowId: null,\n        rfqNo: null,\n        supplierCode: null,\n        supplierName: null,\n        quotedDate: null,\n        settlementMethod: null,\n        otherMethod: null,\n        currency: null,\n        remark: null\n      },\n      totalQuotationItems: {\n        fifthYearDecline: 0,\n        firstYearDecline: 0,\n        forthYearDecline: 0,\n        materielCode: null,\n        materielName: null,\n        modeCost: 0,\n        modeQuantity: 0,\n        quotedDate: null,\n        remark: null,\n        secondYearDecline: 0,\n        taxFree: 0,\n        taxFreePrice: 0,\n        thirdYearDecline: 0,\n        version: 0\n      },\n      rules: {\n        currency: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        otherMethod: [{\n          required: true,\n          message: '请选择',\n          trigger: 'blur'\n        }]\n      },\n      formConfig: [{\n        type: 'commonInput',\n        disabled: true,\n        label: '供应商编码',\n        prop: 'supplierCode',\n        width: ''\n      }, {\n        type: 'commonInput',\n        disabled: true,\n        label: '供应商名称',\n        prop: 'supplierName',\n        width: ''\n      }, {\n        type: 'date',\n        label: '报价时间',\n        prop: 'quotedDate',\n        width: ''\n      }, {\n        type: 'dictSelect',\n        dType: 'dt_srm_pdr',\n        label: '结算方式',\n        prop: 'settlementMethod',\n        width: ''\n      }, //wu dict dt_srm_pdr\n      {\n        type: 'commonInput',\n        label: '其它方式说明',\n        prop: 'otherMethod',\n        width: ''\n      }, {\n        type: 'dictSelect',\n        dType: 'dt_srm_pdk',\n        label: '币种',\n        prop: 'currency',\n        width: ''\n      }, {\n        type: 'textarea',\n        label: '备注',\n        prop: 'remark',\n        width: '780px',\n        rows: \"2\"\n      }],\n      tableData: [],\n      tableConfig: [{\n        label: '产品',\n        prop: 'no1',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '物料编码',\n        prop: 'materielCode',\n        align: 'center',\n        width: '100'\n      }, {\n        label: '物料名称',\n        prop: 'materielName',\n        align: 'center',\n        width: '120'\n      }, {\n        type: 'commonInput',\n        label: '不含税(无模摊)',\n        prop: 'taxFree',\n        align: 'center',\n        width: '120'\n      }, {\n        type: 'commonInput',\n        label: '模摊费',\n        prop: 'modeCost',\n        align: 'center',\n        width: 'auto'\n      }, {\n        type: 'commonInput',\n        label: '模摊数量',\n        prop: 'modeQuantity',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '不含税价',\n        prop: 'taxFree',\n        align: 'center',\n        width: 'auto'\n      }, {\n        type: 'inputArr',\n        label: '承诺降幅',\n        prop: 'prop4',\n        width: '',\n        inputArr: [{\n          type: 'commonInput',\n          label: '第一年',\n          prop: 'firstYearDecline',\n          width: ''\n        }, {\n          type: 'commonInput',\n          label: '第二年',\n          prop: 'secondYearDecline',\n          width: ''\n        }, {\n          type: 'commonInput',\n          label: '第三年',\n          prop: 'thirdYearDecline',\n          width: ''\n        }, {\n          type: 'commonInput',\n          label: '第四年',\n          prop: 'forthYearDecline',\n          width: ''\n        }, {\n          type: 'commonInput',\n          label: '第五年',\n          prop: 'fifthYearDecline',\n          width: ''\n        }]\n      }, {\n        label: '报价版本',\n        prop: 'version',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '备注',\n        prop: 'remark',\n        align: 'center',\n        width: 'auto'\n      }],\n      dialogConfig: [{\n        title: '参照报价',\n        unMutiple: false\n      }]\n    };\n  },\n  computed: _objectSpread({}, mapState({\n    dt_srm_pdr: function dt_srm_pdr(state) {\n      return state.dict.dt_srm_pdr;\n    },\n    //结算方式\n    dt_srm_pdk: function dt_srm_pdk(state) {\n      return state.dict.dt_srm_pdk;\n    } //币种\n\n  })),\n  mounted: function mounted() {\n    this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pdr\", \"dt_srm_pdk\"]);\n  },\n  methods: {\n    handleConfirm: function handleConfirm() {\n      var _this = this;\n\n      this.$refs.formData.validate(function (valid) {\n        if (valid) {\n          _this.$confirm('确认保存吗?', '提示', {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }).then(function () {\n            _this.tableData[0].quotedDate = _this.formData.quotedDate;\n\n            if (_this.methodType === 'add' && !_this.formData.rowId) {\n              var cdata = {\n                method: \"TOTAL\",\n                quotationSource: 'notice',\n                totalQuotedProposalDTO: _this.formData //后面注释掉\n\n              };\n              cdata.totalQuotedProposalDTO.quotationSource = 'notice';\n\n              _this.setTable();\n\n              cdata.totalQuotedProposalDTO.totalQuotationItems = _this.tableData.map(function (v) {\n                v.taxFreePrice = v.taxFree;\n                v.firstYearDecline = parseFloat(v.firstYearDecline);\n                return v;\n              });\n              console.log(cdata, 'yyyy');\n              createQuote(cdata).then(function (res) {\n                _this.methodType = 'edit';\n                _this.formData.rowId = res.data;\n\n                _this.$message({\n                  type: 'success',\n                  message: '新增报价成功'\n                });\n\n                _this.dialogVisible = false;\n\n                _this.$emit('refresh');\n              });\n            } else {\n              var _cdata = {\n                method: \"TOTAL\",\n                quotationSource: 'notice',\n                totalQuotedProposalDTO: _this.formData //后面注释掉\n\n              };\n              _cdata.totalQuotedProposalDTO.quotationSource = 'notice';\n              _cdata.totalQuotedProposalDTO.totalQuotationItems = _this.tableData.map(function (v) {\n                v.taxFreePrice = v.taxFree;\n                v.firstYearDecline = parseFloat(v.firstYearDecline);\n                return v;\n              });\n              updateQuote(_cdata).then(function () {\n                _this.$message({\n                  type: 'success',\n                  message: '编辑报价成功'\n                });\n\n                _this.dialogVisible = false;\n\n                _this.$emit('refresh');\n              });\n            }\n          });\n        }\n      });\n    },\n    handleQuoteRef: function handleQuoteRef() {\n      this.$refs.refQuoteTotal.dialogVisible = true;\n    },\n    setTable: function setTable() {\n      var _this2 = this;\n\n      this.tableData.forEach(function (item, index) {\n        _this2.$set(_this2.tableData[index], 'quotedDate', _this2.formData.quotedDate);\n      });\n    },\n    initForm: function initForm(fdata, row, tdata) {\n      var _this3 = this;\n\n      this.tableData = [];\n\n      if (row !== null) {\n        this.tableData = row;\n        this.formData.quotedDate = row[0].quotedDate;\n        this.formData.settlementMethod = row[0].settlementMethod;\n        this.formData.otherMethod = row[0].otherMethod;\n        this.formData.currency = row[0].currency;\n        this.formData.remark = row[0].remark;\n      } else {\n        tdata.forEach(function (item, index) {\n          _this3.tableData.push(JSON.parse(JSON.stringify(_this3.totalQuotationItems)));\n\n          for (var key in item) {\n            for (var par in fdata) {\n              if (key === par) {\n                _this3.$set(_this3.tableData[index], key, item[key]);\n              }\n            }\n          }\n\n          _this3.$set(_this3.tableData, index, _this3.tableData[index]);\n        });\n      } // this.initTotalQuotation()\n      // if (this.$refs['formData']) {\n      //     this.$refs['formData'].resetFields()\n      //     this.$refs['formData'].clearValidate()\n      // }\n\n\n      if (row) {\n        for (var key in this.formData) {\n          for (var par in row) {\n            if (key === par) {\n              this.$set(this.formData, key, row[key]);\n            }\n          }\n        }\n      } else {\n        for (var _key in this.formData) {\n          this.$set(this.formData, _key, null);\n        }\n      }\n\n      if (fdata) {\n        for (var _key2 in this.formData) {\n          for (var _par in fdata) {\n            if (_key2 === _par) {\n              this.$set(this.formData, _key2, fdata[_key2]);\n            }\n          }\n        }\n      }\n    }\n  }\n};",null]}