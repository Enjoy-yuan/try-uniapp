{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/ESC/CheckPlan/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/ESC/CheckPlan/index.vue","mtime":1596610933407},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from '@/api/project/eas/ESC/checkPlan'; // 增、删、改api引入\n\nimport { DT_ORG_TYPE } from '@/utils/constant';\nimport Pagination from '@/components/Pagination';\nimport { mapState } from 'vuex'; // 基本数据引入\n\nimport caiGou from '@/components/Select/xtpt/caigou'; //下拉组件\n\nimport eqmtSelect from \"../../components/eqmtSelect\";\nexport default {\n  name: 'CheckPlan',\n  components: {\n    Pagination: Pagination,\n    caiGou: caiGou,\n    eqmtSelect: eqmtSelect\n  },\n  data: function data() {\n    return {\n      checked: undefined,\n      checkList: [],\n      theight: 0,\n      //表格高度\n      list: [],\n      fromList: [],\n      lists: [],\n      total: 0,\n      tableKey: [0, 1, 2],\n      //表格索引\n      timeRange: undefined,\n      listQuery: {\n        orgCode: undefined,\n        inspectMethod: undefined,\n        inspectType: undefined,\n        deviceCode: undefined,\n        inspectTimeStart: undefined,\n        inspectTimeEnd: undefined,\n        currentPage: 1,\n        pageSize: 15\n      },\n      listQuery1: {\n        //从表查询\n        currentPage: 1,\n        pageSize: 15\n      },\n      temp: {\n        deviceCodes: [],\n        inspectMethod: undefined,\n        inspectType: undefined,\n        nextInspectTime: undefined,\n        orgCode: undefined,\n        orgName: undefined,\n        remark: undefined,\n        rollCycle: undefined,\n        rollCycleUtil: undefined\n      },\n      DT_ORG_TYPE: DT_ORG_TYPE,\n      dialogStatus: '',\n      dialogFormVisible: false,\n      dialogFormVisible2: false,\n      fromDialogFormVisible: false,\n      selectedRows: [],\n      //多选时选中的所有行\n      selectFromList: [] //从表选中\n\n    };\n  },\n  computed: _objectSpread({}, mapState({\n    dt_inspect_method: function dt_inspect_method(state) {\n      return state.eamDict.dt_inspect_method;\n    },\n    dt_inspect_type: function dt_inspect_type(state) {\n      return state.eamDict.dt_inspect_type;\n    },\n    dt_inspect_plan_cycle: function dt_inspect_plan_cycle(state) {\n      return state.eamDict.dt_inspect_plan_cycle;\n    }\n  })),\n  watch: {\n    // 监听时间区间数组 写入到对应字段\n    // 'temp.timeRange' (value) {\n    //     if (value) {\n    //         this.temp.startDate = value[0]\n    //         this.temp.endDate = value[1]\n    //     }\n    // },\n    'timeRange': function timeRange(value) {\n      if (value) {\n        this.listQuery.inspectTimeStart = value[0];\n        this.listQuery.inspectTimeEnd = value[1];\n      } else {\n        this.listQuery.inspectTimeStart = undefined;\n        this.listQuery.inspectTimeEnd = undefined;\n      }\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$store.dispatch('eamDict/getDicData', ['dt_inspect_method', 'dt_inspect_type', 'dt_inspect_plan_cycle']);\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this.setTableHeight();\n    };\n\n    setTimeout(function () {\n      _this.getList();\n    }, 500);\n  },\n  methods: {\n    confirmDevice: function confirmDevice() {\n      var obj = {};\n      this.temp.deviceCodes = this.temp.deviceCodes.concat(this.$refs.eqmtSelect.currentSelect);\n      this.temp.deviceCodes = this.temp.deviceCodes.reduce(function (cur, next) {\n        obj[next.deviceCode] ? \"\" : obj[next.deviceCode] = true && cur.push(next);\n        return cur;\n      }, []);\n      this.fromDialogFormVisible = false;\n    },\n    cancelDevice: function cancelDevice() {\n      this.$refs.eqmtSelect.listQuery.page = 1;\n      this.fromDialogFormVisible = false;\n    },\n    handleCheckRow: function handleCheckRow(row) {\n      var _this2 = this;\n\n      this.dialogFormVisible2 = true;\n      api.querySingleRecord(row.inspectPlanCode, row.deviceCode).then(function (res) {\n        _this2.lists = res.data;\n      });\n    },\n    // 修改当前行检验计划单\n    handleEditRow: function handleEditRow(row) {\n      var _this3 = this;\n\n      api.querySingleRecords(row.inspectPlanCode, row.deviceCode).then(function (res) {\n        _this3.temp = res.data;\n        _this3.dialogStatus = 'update';\n        _this3.dialogFormVisible = true;\n      });\n    },\n    //编辑确认\n    update: function update() {\n      var _this4 = this;\n\n      this.$refs['temp'].validate(function (valid) {\n        if (valid) {\n          api.patchSingleRecords(_this4.temp.inspectPlanCode, _this4.temp.deviceCode, _this4.temp).then(function (res) {\n            if (res.status == 201) {\n              _this4.dialogFormVisible = false;\n\n              _this4.$message({\n                title: '成功',\n                message: '修改成功',\n                type: 'success',\n                duration: 2000\n              });\n\n              _this4.getList();\n            }\n          });\n        }\n      });\n    },\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight();\n    },\n    getList: function getList() {\n      var _this5 = this;\n\n      //获取表格数据\n      api.queryRecords(this.listQuery).then(function (res) {\n        _this5.list = _this5.$myFun.codeToName(res.data, [_this5.dt_inspect_method, _this5.dt_inspect_type, _this5.dt_inspect_plan_cycle], ['inspectMethod', 'inspectType', 'rollCycleUtil']).list;\n        _this5.total = res.data.pages.count;\n      });\n    },\n    resetTemp: function resetTemp() {\n      this.temp = {\n        deviceCodes: [],\n        inspectMethod: undefined,\n        inspectType: undefined,\n        nextInspectTime: undefined,\n        orgCode: undefined,\n        orgName: undefined,\n        remark: undefined,\n        rollCycle: undefined,\n        rollCycleUtil: undefined\n      };\n    },\n    handleQuery: function handleQuery() {\n      //表格查询\n      this.listQuery.currentPage = 1;\n      this.getList(); // this.fromList = undefined\n    },\n    handleCreate: function handleCreate() {\n      //新增按钮单击事件方法\n      this.resetTemp();\n      this.dialogStatus = 'create';\n      this.dialogFormVisible = true;\n    },\n    create: function create() {\n      var _this6 = this;\n\n      if (this.temp.deviceCodes.length == 0) {\n        this.$message({\n          title: '警告',\n          message: '请选择设备',\n          type: 'warning'\n        });\n        return false;\n      }\n\n      this.temp.deviceCodes = this.temp.deviceCodes.map(function (item) {\n        return item.deviceCode;\n      }); //编辑确认\n\n      this.$refs['temp'].validate(function (valid) {\n        if (valid) {\n          // 添加bom\n          api.addRecords(_this6.temp).then(function () {\n            _this6.getList();\n\n            _this6.dialogFormVisible = false;\n\n            _this6.$message({\n              title: '成功',\n              message: '新增成功',\n              type: 'success',\n              duration: 2000\n            });\n          });\n        }\n      });\n    },\n    //删除按钮单击事件方法\n    handleDelete: function handleDelete() {\n      var _this7 = this;\n\n      if (this.selectedRows) {\n        this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          api.deleteRecords(_this7.selectedRows.inspectPlanCode, _this7.selectedRows.deviceCode).then(function () {\n            _this7.getList(), _this7.$message({\n              title: '成功',\n              message: '删除成功',\n              type: 'success',\n              duration: 2000\n            });\n          });\n        }).catch(function () {\n          _this7.$message({\n            type: 'info',\n            message: '已取消删除'\n          });\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条计划',\n          type: 'warning'\n        });\n      }\n    },\n    selectRow: function selectRow(val) {\n      this.selectedRows = val[val.length - 1];\n\n      if (val.length > 1) {\n        this.$refs.tb.clearSelection();\n        this.$refs.tb.toggleRowSelection(val.pop());\n      }\n\n      this.$refs.tb.setCurrentRow(this.selectlistRow);\n    },\n    rowClick: function rowClick(val) {\n      this.$refs.tb.clearSelection();\n      this.$refs.tb.toggleRowSelection(val);\n    },\n    selectChange: function selectChange(val) {\n      this.selectedRows = val;\n    },\n    handleClose: function handleClose() {\n      this.resetTemp();\n      this.$refs.temp.resetFields();\n    },\n    handleCloses: function handleCloses() {},\n    //从表选择框选中\n    selectFromChange: function selectFromChange(val) {\n      this.selectFromList = val;\n\n      if (val.length > 1) {\n        this.$refs.tb2.clearSelection();\n        this.$refs.tb2.toggleRowSelection(val[val.length - 1]);\n      }\n\n      this.$refs.tb2.setCurrentRow(this.selectFromList[0]);\n    },\n    handleCreateFrom: function handleCreateFrom() {\n      var _this8 = this;\n\n      this.fromDialogStatus = 'create';\n\n      if (!this.temp.orgCode) {\n        this.$message({\n          title: '警告',\n          message: '请选择组织编码',\n          type: 'warning'\n        });\n        return;\n      }\n\n      this.fromDialogFormVisible = true;\n      setTimeout(function () {\n        _this8.$refs.eqmtSelect.getList();\n      }, 0);\n    },\n    rowClickFrom: function rowClickFrom(val) {\n      this.$refs.tb2.toggleRowSelection(val, 'selected'); //单击行绑定点击事件\n    }\n  }\n};",null]}