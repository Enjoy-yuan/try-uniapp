{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/options/optionsFormation/content/formation.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/options/optionsFormation/content/formation.vue","mtime":1599136050895},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { createRecords, updateRecords, queryReqList } from \"@/api/project/srm/supplierSelect/options/option\";\nimport { mapState } from \"vuex\";\nimport dialogOrgSelect from '@/components/Dialog/dialogOrgSelect';\nimport dialogPersonSelect from '@/components/Dialog/dialogPersonSelect.vue'; //选择人\n\nimport dialogWlxzbyzsj from '@/components/Dialog/dialogWlxzbyzsj.vue'; //主数据物料选择\n\nimport dialogGysxz from '@/components/Dialog/dialogsGysxz'; //供应商选择\n\nimport { DICT_CODE } from '@/utils/constant';\nimport caiGou from '@/components/Select/xtpt/caigou'; //下拉组件\n\nexport default {\n  name: 'formation',\n  components: {\n    caiGou: caiGou,\n    dialogOrgSelect: dialogOrgSelect,\n    dialogPersonSelect: dialogPersonSelect,\n    dialogGysxz: dialogGysxz,\n    dialogWlxzbyzsj: dialogWlxzbyzsj\n  },\n  data: function data() {\n    return {\n      status: undefined,\n      formationState: 'add',\n      tabName: 'tabQuote',\n      changeable: false,\n      dataListSupplier: [],\n      dataListMateriel: [],\n      dataListReq: [],\n      DICT_CODE: DICT_CODE,\n      tableKey: [0, 1, 2],\n      personType: 'form',\n      rfqPersonIndex: null,\n      formData: {\n        planNo: null,\n        orgCode: null,\n        orgName: null,\n        choiceMethod: null,\n        technicalBidDeadline: null,\n        quotationDeadline: null,\n        editOrgCode: null,\n        technicalBidOpeningTime: null,\n        businessOpeningTime: null,\n        editorName: null,\n        quotationMethod: null,\n        planDesc: null,\n        remark: null\n      },\n      rules: {\n        orgCode: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        prop8: [{\n          required: true,\n          message: '请选择',\n          trigger: 'blur'\n        }]\n      },\n      oprateBtnConfig: [{\n        id: 0,\n        class: 'filter-item',\n        icon: 'el-icon-document-delete',\n        clickMethod: 'handleCancel',\n        name: '取消'\n      }, {\n        id: 1,\n        class: 'filter-item ml_5',\n        icon: 'el-icon-check',\n        clickMethod: 'handleSave',\n        name: '保存'\n      }],\n      formConfig: [{\n        type: 'commonInput',\n        label: '方案编号',\n        prop: 'planNo',\n        width: ''\n      }, {\n        type: 'selectcaiGou',\n        label: '采购组织',\n        prop: 'orgCode',\n        width: ''\n      }, {\n        type: 'dictSelect',\n        dType: 'dt_srm_pdf',\n        label: '选择方式',\n        prop: 'choiceMethod',\n        width: ''\n      }, {\n        type: 'date',\n        label: '技术投标止',\n        prop: 'technicalBidDeadline',\n        width: ''\n      }, {\n        type: 'date',\n        label: '报价截止',\n        prop: 'quotationDeadline',\n        width: ''\n      }, {\n        type: 'inputBtnOrg',\n        label: '登记单位',\n        prop: 'editOrgCode',\n        width: ''\n      }, //code+name\n      {\n        type: 'datetime',\n        label: '技术开标',\n        prop: 'technicalBidOpeningTime',\n        width: ''\n      }, {\n        type: 'datetime',\n        label: '商务开标',\n        prop: 'businessOpeningTime',\n        width: ''\n      }, {\n        type: 'inputBtnPerson',\n        label: '登记人',\n        prop: 'editorName',\n        width: ''\n      }, {\n        type: 'dictSelect',\n        dType: 'dt_srm_pdi',\n        label: '报价方式',\n        prop: 'quotationMethod',\n        width: ''\n      }, {\n        type: 'textarea',\n        label: '方案描述',\n        prop: 'planDesc',\n        width: '800px',\n        rows: \"2\"\n      }, {\n        type: 'textarea',\n        label: '备注',\n        prop: 'remark',\n        width: '800px',\n        rows: \"2\"\n      }],\n      tableConfig: {\n        \"materielTable\": [{\n          label: '打包号',\n          showData: true,\n          prop: 'packageNo',\n          align: 'center',\n          width: '150'\n        }, {\n          label: '需求分工ID',\n          showData: false,\n          prop: 'divisionId',\n          align: 'center',\n          width: '150'\n        }, {\n          label: '物料图号',\n          showData: true,\n          prop: 'mapNo',\n          align: 'center',\n          width: '150'\n        }, {\n          label: '特殊区分',\n          showData: true,\n          prop: 'specialDistinction',\n          align: 'center',\n          width: 'auto'\n        }, {\n          label: '物料编码',\n          showData: true,\n          prop: 'materielCode',\n          align: 'center',\n          width: 'auto'\n        }, {\n          label: '物料名称',\n          showData: true,\n          prop: 'materielName',\n          align: 'center',\n          width: '120'\n        }, //?\n        {\n          type: 'numInput',\n          showData: true,\n          label: '基准年',\n          prop: 'baseYearQuantity',\n          align: 'center',\n          width: '120'\n        }, {\n          type: 'numInput',\n          showData: true,\n          label: '第一年需求',\n          prop: 'firstYearQuantity',\n          align: 'center',\n          width: '120'\n        }, {\n          type: 'numInput',\n          showData: true,\n          label: '第二年需求',\n          prop: 'secondYearQuantity',\n          align: 'center',\n          width: '120'\n        }, {\n          type: 'numInput',\n          showData: true,\n          label: '第三年需求',\n          prop: 'thirdYearQuantity',\n          align: 'center',\n          width: '120'\n        }, {\n          type: 'numInput',\n          showData: true,\n          label: '第四年需求',\n          prop: 'forthYearQuantity',\n          align: 'center',\n          width: '120'\n        }, {\n          type: 'numInput',\n          showData: true,\n          label: '第五年需求',\n          prop: 'fifthYearQuantity',\n          align: 'center',\n          width: '120'\n        }, {\n          label: '责任人',\n          showData: true,\n          prop: 'score',\n          align: 'center',\n          width: 'auto'\n        }, //wu\n        {\n          label: '物料分类',\n          showData: true,\n          prop: 'materielClass',\n          align: 'center',\n          width: '180'\n        }, {\n          label: '物料分类名称',\n          showData: true,\n          prop: 'materielClassName',\n          align: 'center',\n          width: '140'\n        }, //materielClassName\n        {\n          label: '规格',\n          showData: true,\n          prop: 'specification',\n          align: 'center',\n          width: 'auto'\n        }, {\n          label: '材质',\n          showData: true,\n          prop: 'materielQuality',\n          align: 'center',\n          width: 'auto'\n        }, {\n          label: '重量',\n          showData: true,\n          prop: 'weight',\n          align: 'center',\n          width: 'auto'\n        }, {\n          label: '物料类型',\n          showData: true,\n          prop: 'materielType',\n          align: 'center',\n          width: '180'\n        }, //Name dict\n        {\n          label: '是否关重件',\n          showData: true,\n          prop: 'heavyParts',\n          align: 'center',\n          width: 'auto'\n        }, {\n          label: '关联单号',\n          showData: true,\n          prop: 'associatedNo',\n          align: 'center',\n          width: 'auto'\n        }, {\n          label: '计量单位',\n          showData: true,\n          prop: 'measurement',\n          align: 'center',\n          width: 'auto'\n        }, {\n          label: '确定目标价',\n          showData: true,\n          prop: 'targetPrice',\n          align: 'center',\n          width: 'auto'\n        }, {\n          label: '要求完成时间',\n          showData: true,\n          prop: 'completionDate',\n          align: 'center',\n          width: '150'\n        }, {\n          label: '项目号',\n          showData: true,\n          prop: 'projectNo',\n          align: 'center',\n          width: '150'\n        }, {\n          label: '来源方式',\n          showData: true,\n          prop: 'sourceType',\n          align: 'center',\n          width: 'auto'\n        }, //来源类型 dict\n        {\n          label: '关联物料编码',\n          showData: true,\n          prop: 'associatedMateriel',\n          align: 'center',\n          width: 'auto'\n        }, {\n          label: '设计师',\n          showData: true,\n          prop: 'designerName',\n          align: 'center',\n          width: 'auto'\n        }],\n        \"supplierTable\": [{\n          label: '供应商编码',\n          prop: 'supplierCode',\n          align: 'center',\n          width: 'auto'\n        }, {\n          label: '供应商名称',\n          prop: 'supplierName',\n          align: 'center',\n          width: '180'\n        }, {\n          label: '是否试制指定',\n          prop: 'rialProduce',\n          align: 'center',\n          width: 'auto',\n          type: 'checkbox'\n        }, {\n          label: '推荐理由',\n          prop: 'recommendReason',\n          align: 'center',\n          width: '200',\n          type: 'commonInput'\n        }],\n        \"reqTable\": [{\n          label: '资料',\n          prop: 'contentExplain',\n          align: 'center',\n          width: 'auto'\n        }, {\n          label: 'RFQ类型',\n          prop: 'rfqName',\n          align: 'center',\n          width: 'auto'\n        }, {\n          type: 'checkbox',\n          label: '是否下发',\n          prop: 'download',\n          align: 'center',\n          width: 'auto'\n        }, {\n          type: 'checkbox',\n          label: '是否提交',\n          prop: 'submit',\n          align: 'center',\n          width: 'auto'\n        }, {\n          type: 'checkbox',\n          label: '是否评审',\n          prop: 'audit',\n          align: 'center',\n          width: 'auto'\n        }, {\n          type: 'inputBtnPerson',\n          label: '评审人',\n          prop: 'auditorName',\n          align: 'center',\n          width: 'auto'\n        }]\n      },\n      dialogConfig: [{\n        title: '登记单位选择',\n        unMutiple: true\n      }, {\n        title: '登记人选择',\n        unMutiple: true,\n        propCode: 'editor',\n        propName: 'editorName',\n        required: false\n      }, {\n        title: '供应商信息选择',\n        unMutiple: false,\n        isRequired: false\n      }, {\n        title: '物料主数据选择',\n        unMutiple: false,\n        isRequired: false\n      }]\n    };\n  },\n  created: function created() {},\n  computed: _objectSpread({}, mapState({\n    dt_srm_pdg: function dt_srm_pdg(state) {\n      return state.dict.dt_srm_pdg;\n    },\n    dt_srm_pdf: function dt_srm_pdf(state) {\n      return state.dict.dt_srm_pdf;\n    },\n    //选择方式\n    dt_srm_pdi: function dt_srm_pdi(state) {\n      return state.dict.dt_srm_pdi;\n    } //报价方式\n\n  })),\n  mounted: function mounted() {\n    this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pdg\", \"dt_srm_pdf\", \"dt_srm_pdi\"]);\n  },\n  watch: {\n    'formData.orgCode': function formDataOrgCode() {\n      this.$refs.refZsjWlxz.listQuery.purchaseOrg = this.formData.orgCode;\n      this.$refs.refZsjWlxz.isEdit = true;\n\n      if (this.changeable) {\n        this.getReqData();\n      }\n    },\n    'formData.choiceMethod': function formDataChoiceMethod() {\n      if (this.changeable) {\n        this.getReqData();\n      }\n    }\n  },\n  methods: {\n    getReqData: function getReqData() {\n      var _this = this;\n\n      queryReqList({\n        purchaseOrg: this.formData.orgCode,\n        businessType: this.formData.choiceMethod\n      }).then(function (res) {\n        var options = [_this.dt_srm_pdg];\n        res.data = _this.$myFun.srmCodeToName(res.data, options, ['attachmentType']);\n        res.data.map(function (item) {\n          item.rfqType = item.attachmentType;\n          item.rfqName = item.attachmentTypeCN;\n          item.download = true;\n        });\n        _this.dataListReq = res.data;\n      });\n    },\n    //操作按钮事件\n    oprateClick: function oprateClick(id) {\n      switch (id) {\n        case 0:\n          {\n            this.$emit('changeState', 'list');\n            break;\n          }\n\n        case 1:\n          {\n            this.handleSave();\n            break;\n          }\n      }\n    },\n    handleSave: function handleSave() {\n      var _this2 = this;\n\n      this.$refs.formData.validate(function (valid) {\n        if (valid) {\n          _this2.$confirm('确认保存吗?', '提示', {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }).then(function () {\n            if (_this2.dataListReq) {\n              _this2.dataListReq.forEach(function (item) {\n                if (!item.download) {\n                  item.download = false;\n                } else {\n                  item.download = true;\n                }\n\n                if (!item.submit) {\n                  item.submit = false;\n                } else {\n                  item.submit = true;\n                }\n\n                if (!item.audit) {\n                  item.audit = false;\n                } else {\n                  item.audit = true;\n                }\n              });\n            }\n\n            if (_this2.dataListSupplier) {\n              _this2.dataListSupplier.forEach(function (item) {\n                if (!item.rialProduce) {\n                  item.rialProduce = false;\n                } else {\n                  item.rialProduce = true;\n                }\n              });\n            }\n\n            if (_this2.formationState === 'add' || _this2.formationState === 'taskedit') {\n              var sdata = _this2.formData;\n              sdata.purchasePlanMaterielDTOs = _this2.dataListMateriel;\n              sdata.purchasePlanRfqDTOs = _this2.dataListReq;\n              sdata.purchasePlanSupplierDTOs = _this2.dataListSupplier;\n              createRecords(sdata).then(function () {\n                _this2.$emit('changeState', 'list');\n\n                _this2.$message({\n                  type: 'success',\n                  message: '新增成功'\n                });\n              });\n            } else if (_this2.formationState === 'edit') {\n              _this2.dataListMateriel.map(function (item) {\n                item.planNo = _this2.formData.planNo;\n              });\n\n              _this2.dataListReq.map(function (item) {\n                item.planNo = _this2.formData.planNo;\n              });\n\n              _this2.dataListSupplier.map(function (item) {\n                item.planNo = _this2.formData.planNo;\n              });\n\n              var _sdata = _this2.formData;\n              _sdata.purchasePlanMaterielDTOs = _this2.dataListMateriel;\n              _sdata.purchasePlanRfqDTOs = _this2.dataListReq;\n              _sdata.purchasePlanSupplierDTOs = _this2.dataListSupplier;\n              var cData = {\n                method: \"UPDATE\",\n                planNo: _this2.formData.planNo,\n                purchasePlanDTO: _sdata\n              };\n              updateRecords(cData).then(function () {\n                _this2.$emit('changeState', 'list');\n\n                _this2.$message({\n                  type: 'success',\n                  message: '编辑成功'\n                });\n              });\n            }\n          });\n        }\n      });\n    },\n    initForm: function initForm(type, row) {\n      var _this3 = this;\n\n      this.$refs['formData'].resetFields();\n      this.$refs['formData'].clearValidate();\n\n      if (type === 'add') {\n        this.changeable = true;\n        this.oprateBtnConfig[1].name = '保存新增方案';\n        this.dataListSupplier = [];\n        this.dataListMateriel = [];\n        this.dataListReq = [];\n        this.changeable = true;\n      } else if (type === 'edit') {\n        this.oprateBtnConfig[1].name = '保存编辑方案';\n        this.dataListMateriel = row.purchasePlanMaterielDTOs;\n        this.dataListReq = row.purchasePlanRfqDTOs;\n        this.dataListSupplier = row.purchasePlanSupplierDTOs;\n\n        for (var key in this.formData) {\n          for (var par in row) {\n            if (key === par) {\n              this.$set(this.formData, key, row[key]);\n            }\n          }\n        }\n\n        this.$nextTick(function () {\n          _this3.changeable = true;\n        });\n      } else if (type === 'taskedit') {\n        this.status = type;\n        this.changeable = true;\n        this.oprateBtnConfig[1].name = '保存清单方案';\n        row.forEach(function (item, index) {\n          _this3.dataListMateriel.push({});\n\n          var _loop = function _loop(_par) {\n            _this3.tableConfig['materielTable'].forEach(function (mitem) {\n              if (_par === mitem.prop) {\n                _this3.dataListMateriel[index][_par] = item[_par];\n              }\n            });\n\n            for (var _key in _this3.formData) {\n              if (_key === _par) {\n                _this3.$set(_this3.formData, _key, item[_key]);\n              }\n            }\n          };\n\n          for (var _par in item) {\n            _loop(_par);\n          }\n        });\n      } // this.changeable = true\n\n    },\n    //1新增物料\n    handleAddM: function handleAddM() {\n      if (this.formData.orgCode) {\n        this.$refs.refZsjWlxz.listQuery.purchaseOrg = this.formData.orgCode;\n        this.$refs.refZsjWlxz.isEdit = true;\n        this.$refs.refZsjWlxz.checkProp = ['materialCode', 'materielCode'];\n        this.$refs.refZsjWlxz.valueType = 'row';\n        this.$refs.refZsjWlxz.listSelected = JSON.parse(JSON.stringify(this.dataListMateriel));\n        this.$refs.refZsjWlxz.dialogVisible = true;\n      } else {\n        this.$message({\n          type: 'warning',\n          message: '请先选择采购组织'\n        });\n      }\n    },\n    //刷新物料\n    handleRefreshM: function handleRefreshM() {\n      this.dataListSupplier = [];\n    },\n    confirmMateriel: function confirmMateriel(data) {\n      console.log(data, 'kkkk');\n      data.map(function (item) {\n        item.materielCode = item.materialCode;\n        item.materielName = item.materialName;\n        item.materielClass = item.materialClassification;\n        item.materielClassName = item.materialClassificationName;\n      });\n      this.dataListMateriel = JSON.parse(JSON.stringify(data));\n    },\n    //2新增供应商\n    handleAddS: function handleAddS() {\n      var addable = true;\n      var materielClassArr = [];\n      var materielClassNameArr = [];\n\n      if (this.dataListMateriel) {\n        if (this.dataListMateriel.length > 0) {\n          for (var i = 0; i < this.dataListMateriel.length; i++) {\n            if (!this.dataListMateriel[i].materielClass) {\n              addable = false;\n              break;\n            } else {\n              materielClassArr.push(this.dataListMateriel[i].materielClass);\n              materielClassNameArr.push(this.dataListMateriel[i].materielClassName);\n            }\n          }\n        } else {\n          addable = false;\n        }\n      } else {\n        addable = false;\n      }\n\n      if (addable) {\n        this.$refs.refGys.valueType = 'row';\n        this.$refs.refGys.listQuery.materielClass = materielClassArr.join(','); //物料分类 内容与wms主数据不一 暂不使用该条件\n        // this.$refs.refGys.listQuery.materielClassName = materielClassNameArr.join(',')\n\n        this.$refs.refGys.listQuery.isExist = 1;\n        this.$refs.refGys.listSelected = JSON.parse(JSON.stringify(this.dataListSupplier));\n        this.$refs.refGys.getList();\n        this.$refs.refGys.dialogVisible = true;\n      } else {\n        this.$message({\n          type: 'warning',\n          message: '请先选择物料信息'\n        });\n      }\n    },\n    //供应商确认\n    handleGysClick: function handleGysClick(gysRows) {\n      this.dataListSupplier = JSON.parse(JSON.stringify(gysRows));\n    },\n    handleDeleteM: function handleDeleteM(index, row) {\n      var _this4 = this;\n\n      console.log(index, row);\n      this.$confirm('确认要删除该数据项吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this4.dataListMateriel = _this4.dataListMateriel.filter(function (item) {\n          var isD = true;\n\n          if (row.materielCode === item.materielCode) {\n            isD = false;\n          }\n\n          return isD;\n        });\n\n        _this4.$message({\n          type: 'success',\n          message: '删除成功'\n        });\n      }).catch(function () {\n        _this4.$message({\n          type: 'info',\n          message: '已取消'\n        });\n      });\n    },\n    handleDeleteS: function handleDeleteS(index, row) {\n      var _this5 = this;\n\n      console.log(index, row);\n      this.$confirm('确认要删除该数据项吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this5.dataListSupplier = _this5.dataListSupplier.filter(function (item) {\n          var isD = true;\n\n          if (row.supplierCode === item.supplierCode) {\n            isD = false;\n          }\n\n          return isD;\n        });\n\n        _this5.$message({\n          type: 'success',\n          message: '删除成功'\n        });\n      }).catch(function () {\n        _this5.$message({\n          type: 'info',\n          message: '已取消'\n        });\n      });\n    },\n    showOrg: function showOrg() {\n      this.$refs.refOrg.dialogVisible = true;\n    },\n    confirmOrg: function confirmOrg(data) {\n      console.log(data);\n\n      if (data) {\n        this.$set(this.formData, 'editOrgCode', data[0].organizationCode);\n        this.$set(this.formData, 'editOrgName', data[0].organizationName);\n      }\n    },\n    showPerson: function showPerson(type, index) {\n      this.personType = type;\n\n      if (type === 'form') {\n        this.dialogConfig[1].propCode = 'editor';\n        this.dialogConfig[1].propName = 'editorName';\n      } else if (type === 'list') {\n        this.rfqPersonIndex = index;\n        this.dialogConfig[1].propCode = 'auditor';\n        this.dialogConfig[1].propName = 'auditorName';\n      }\n\n      this.$refs.refPerson.dialogVisible = true;\n    },\n    personConfirm: function personConfirm(val, propCode, propName) {\n      if (this.personType === 'form') {\n        this.$set(this.formData, propCode, val[0].employeeCode);\n        this.$set(this.formData, propName, val[0].employeeName);\n      } else if (this.personType === 'list') {\n        this.$set(this.dataListReq[this.rfqPersonIndex], propCode, val[0].employeeCode);\n        this.$set(this.dataListReq[this.rfqPersonIndex], propName, val[0].employeeName);\n      }\n    },\n    orgname: function orgname(name) {\n      this.formData.orgName = name;\n    }\n  }\n};",null]}