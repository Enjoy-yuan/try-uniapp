{"remainingRequest":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/cf_web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/cf_web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/cf_web/src/views/system/organizationStructure/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/cf_web/src/views/system/organizationStructure/index.vue","mtime":1600927611532},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/cf_web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Pagination from \"@/components/Pagination\"; // Secondary package based on el-pagination\n\nimport * as api from \"@/api/system/organization\";\nimport { parseTime } from \"@/utils\";\nimport { mapState } from \"vuex\";\nexport default {\n  name: \"organizationStructure\",\n  components: {\n    Pagination: Pagination\n  },\n  data: function data() {\n    return {\n      treeData: [],\n      defaultProps: {\n        children: \"children\",\n        label: \"organizationName\"\n      },\n      tableKey: 0,\n      theight: 0,\n      //表格高度\n      list: [],\n      total: 0,\n      orgType: [],\n      orgFun: [],\n      orgName: [],\n      listLoading: true,\n      listQuery: {\n        parentOrgCode: undefined,\n        currentPage: 1,\n        pageSize: 15,\n        organizationCode: undefined,\n        organizationName: undefined\n      },\n      showReviewer: false,\n      temp: {\n        state: 1,\n        email: undefined,\n        postalCode: undefined\n      },\n      dialogFormVisible: false,\n      dialogStatus: \"\",\n      dialogPvVisible: false,\n      pvData: [],\n      rules: {\n        organizationCode: [{\n          required: true,\n          message: this.$t(\"validate.required\"),\n          trigger: \"blur\"\n        }, {\n          max: 32,\n          message: this.$t(\"validate.max32\"),\n          trigger: \"blur\"\n        }],\n        organizationName: [{\n          required: true,\n          message: this.$t(\"validate.required\"),\n          trigger: \"blur\"\n        }, {\n          max: 32,\n          message: this.$t(\"validate.max32\"),\n          trigger: \"blur\"\n        }],\n        parentId: [{\n          required: true,\n          message: this.$t(\"validate.required\"),\n          trigger: \"blur\"\n        }],\n        type: [{\n          required: true,\n          message: this.$t(\"validate.required\"),\n          trigger: \"blur\"\n        }],\n        businessFunction: [{\n          required: true,\n          message: this.$t(\"validate.required\"),\n          trigger: \"blur\"\n        }],\n        mobile: [{\n          max: 32,\n          message: this.$t(\"validate.max32\"),\n          trigger: \"blur\"\n        }]\n      },\n      contentStyleObj: {\n        height: \"\"\n      },\n      downloadLoading: false\n    };\n  },\n  computed: _objectSpread({}, mapState({\n    dt_org_type: function dt_org_type(state) {\n      return state.dict.dt_org_type;\n    },\n    dt_org_function: function dt_org_function(state) {\n      return state.dict.dt_org_function;\n    }\n  })),\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$store.dispatch(\"dict/getDicData\", [\"dt_org_type\", \"dt_org_function\"]);\n    this.getList();\n    this.getHeight();\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this.setTableHeight();\n\n      _this.setTreeHeight();\n    };\n\n    this.setTreeHeight();\n  },\n  methods: {\n    treeGetList: function treeGetList() {\n      var _this2 = this;\n\n      //点击树查询\n      api.selectlists(this.listQuery).then(function (response) {\n        var options = [_this2.dt_org_type, _this2.dt_org_function];\n        response.data.list = _this2.$myFun.codeToName(response.data.list, options, [\"type\", \"businessFunction\"]);\n        _this2.list = response.data.list;\n        _this2.total = response.data.pages.count;\n      });\n    },\n    getList: function getList() {\n      var _this3 = this;\n\n      //查询组织列表\n      setTimeout(function () {\n        api.selectlists(_this3.listQuery).then(function (response) {\n          var options = [_this3.dt_org_type, _this3.dt_org_function];\n          response.data = _this3.$myFun.codeToName(response.data, options, [\"type\", \"businessFunction\"]);\n          _this3.list = response.data.list;\n          _this3.total = response.data.pages.count;\n        }), api.selecttree().then(function (response) {\n          //获取树数据\n          _this3.treeData = _this3.$myFun.addTreeRoot(response.data);\n          _this3.orgName = response.data.map(function (itmes) {\n            return [itmes.rowId, itmes.organizationName];\n          });\n        });\n      }, 1.5 * 100);\n    },\n    handleFilter: function handleFilter() {\n      var _this4 = this;\n\n      //查询\n      this.listQuery.page = 1;\n      api.selectlists(this.listQuery).then(function (response) {\n        var options = [_this4.dt_org_type, _this4.dt_org_function];\n        response.data = _this4.$myFun.codeToName(response.data, options, [\"type\", \"businessFunction\"]);\n        _this4.list = response.data.list;\n      });\n    },\n    resetTemp: function resetTemp() {\n      //重置temp\n      this.temp = {\n        state: 1,\n        parentId: this.temp.parentId\n      };\n    },\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight();\n    },\n    //树高度设置\n    setTreeHeight: function setTreeHeight() {\n      this.contentStyleObj.height = this.$myFun.getTreehHeight();\n    },\n    filertOrgName: function filertOrgName(val) {\n      for (var i = 0; i < this.orgName.length; i++) {\n        if (this.orgName[i][0] == val) {\n          return this.orgName[i][1];\n        }\n\n        if (val == 0) {\n          return \"根目录\";\n        }\n      }\n    },\n    handleCreate: function handleCreate() {\n      var _this5 = this;\n\n      //新增弹窗调用\n      if (this.temp.parentId || this.temp.parentId == 0) {\n        this.resetTemp();\n        this.dialogStatus = \"create\";\n        this.dialogFormVisible = true;\n        this.$nextTick(function () {\n          _this5.$refs[\"dataForm\"].clearValidate();\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请选择上级菜单\",\n          type: \"warning\"\n        });\n      }\n    },\n    createData: function createData() {\n      var _this6 = this;\n\n      //新增\n      this.$refs[\"dataForm\"].validate(function (valid) {\n        if (valid) {\n          api.creat(_this6.temp).then(function () {\n            _this6.getList();\n\n            _this6.dialogFormVisible = false;\n\n            _this6.$message({\n              title: _this6.$t(\"message.success\"),\n              message: _this6.$t(\"message.createSuccessed\"),\n              type: \"success\",\n              duration: 2000\n            });\n          });\n        }\n      });\n    },\n    handleUpdate: function handleUpdate() {\n      var _this7 = this;\n\n      if (this.selectlistRow && this.selectlistRow.length == 1) {\n        api.selectlist(this.selectlistRow[0].organizationCode).then(function (res) {\n          res = res.data;\n          _this7.temp = res; // copy obj\n\n          _this7.dialogStatus = \"update\";\n          _this7.dialogFormVisible = true;\n\n          _this7.$nextTick(function () {\n            _this7.$refs[\"dataForm\"].clearValidate();\n          });\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请选择一条信息\",\n          type: \"warning\"\n        });\n      }\n    },\n    updateData: function updateData() {\n      var _this8 = this;\n\n      this.$refs[\"dataForm\"].validate(function (valid) {\n        if (valid) {\n          api.updatalist(_this8.temp.organizationCode, _this8.temp).then(function () {\n            _this8.getList();\n\n            _this8.dialogFormVisible = false;\n\n            _this8.$message({\n              title: \"成功\",\n              message: \"更新成功\",\n              type: \"success\",\n              duration: 2000\n            });\n          });\n        }\n      });\n    },\n    // 获取表格选中时的数据\n    selectRow: function selectRow(val) {\n      if (val.length > 1) {\n        this.$refs.tb_a.clearSelection(); //清除其他行的选中\n\n        this.$refs.tb_a.toggleRowSelection(val[val.length - 1], \"selected\"); //单击行绑定点击事件\n      } else if (val.length === 1) {\n        this.selectlistRow = val;\n      }\n    },\n    rowClick: function rowClick(val) {\n      this.$refs.tb_a.clearSelection(); //清除其他行的选中\n\n      this.$refs.tb_a.toggleRowSelection(val); //单击行绑定点击事件\n    },\n    handleDelete: function handleDelete() {\n      var _this9 = this;\n\n      //删除列表\n      if (this.selectlistRow && this.selectlistRow.length == 1) {\n        this.$confirm(\"此操作将删除所选中数据, 是否继续?\", \"提示\", {\n          confirmButtonText: \"确定\",\n          cancelButtonText: \"取消\",\n          type: \"warning\"\n        }).then(function () {\n          _this9.listLoading = true;\n          var ids = [];\n\n          _this9.selectlistRow.forEach(function (val, index) {\n            ids[index] = val.organizationCode;\n          });\n\n          api.deletelist(ids).then(function () {\n            _this9.getList(), _this9.$message({\n              title: \"成功\",\n              message: \"删除成功\",\n              type: \"success\",\n              duration: 2000\n            });\n          });\n        }).catch(function () {\n          _this9.$message({\n            type: \"info\",\n            message: \"已取消删除\"\n          });\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请选择一条信息\",\n          type: \"warning\"\n        });\n      }\n    },\n    handleDownload: function handleDownload() {\n      var _this10 = this;\n\n      this.downloadLoading = true;\n      import(\"@/vendor/Export2Excel\").then(function (excel) {\n        var tHeader = [\"编码\", \"名称\", \"类型\", \"父级ID\", \"联系人\", \"地址\", \"邮箱\", \"业务类型\", \"电话\", \"备注\", \"状态\", \"邮编\"];\n        var filterVal = [\"organizationCode\", \"organizationName\", \"typeCN\", \"parentId\", \"contact\", \"adress\", \"email\", \"businessFunctionCN\", \"mobile\", \"remark\", \"state\", \"postalCode\"];\n\n        var data = _this10.formatJson(filterVal, _this10.list);\n\n        excel.export_json_to_excel({\n          header: tHeader,\n          data: data,\n          filename: \"table-list\"\n        });\n        _this10.downloadLoading = false;\n      });\n    },\n    formatJson: function formatJson(filterVal, jsonData) {\n      return jsonData.map(function (v) {\n        return filterVal.map(function (j) {\n          if (j === \"timestamp\") {\n            return parseTime(v[j]);\n          } else {\n            return v[j];\n          }\n        });\n      });\n    },\n    getHeight: function getHeight() {\n      this.contentStyleObj.height = document.body.scrollHeight - 110 + \"px\";\n    },\n    handleNodeClick: function handleNodeClick(data) {\n      //点击树查询\n      this.temp.parentId = data.rowId;\n      this.listQuery.parentOrgCode = data.rowId;\n      this.treeGetList();\n    }\n  }\n};",null]}