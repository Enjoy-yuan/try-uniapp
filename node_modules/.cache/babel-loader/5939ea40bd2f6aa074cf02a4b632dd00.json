{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/enableRules/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/enableRules/index.vue","mtime":1596610933327},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from \"@/api/data-base/enable-rules\";\nimport Pagination from \"@/components/Pagination\";\nimport orgSelect from \"@/components/Select/orgSelect.vue\";\nimport { DT_ORG_TYPE } from \"@/utils/constant\";\nimport * as api1 from \"@/api/data-base/warehouse\";\nimport materielDictItemTable from \"@/components/Table/materiel-dict-item-table.vue\";\nimport wlxzbyzsj from \"@/components/Select/wlxzbyzsj.vue\";\nexport default {\n  name: \"enableRules\",\n  components: {\n    Pagination: Pagination,\n    orgSelect: orgSelect,\n    materielDictItemTable: materielDictItemTable,\n    wlxzbyzsj: wlxzbyzsj\n  },\n  data: function data() {\n    return {\n      list: null,\n      list1: null,\n      list2: null,\n      list3: null,\n      listSub: null,\n      tableKey: [0, 1, 2],\n      //表格索引，虚拟dom渲染表格时使用\n      theight: 0,\n      stheight: 0,\n      //右子表高度\n      tableKeysub: 0,\n      total: 0,\n      total1: 0,\n      total2: 0,\n      total3: 0,\n      totalSub: 0,\n      listQuery: {\n        currentPage: 1,\n        pageSize: 10,\n        orgName: undefined,\n        warehouseCode: undefined\n      },\n      listQuery1: {\n        currentPage: 1,\n        pageSize: 10,\n        warehouseCode: undefined,\n        batchRuleId: undefined\n      },\n      listQuery2: {\n        currentPage: 1,\n        pageSize: 10\n      },\n      listQuery3: {\n        currentPage: 1,\n        pageSize: 10\n      },\n      dto: {\n        batchRuleDiff: undefined,\n        batchRulePreparation: undefined\n      },\n      dtoupdate: {\n        batchRuleDiff: undefined,\n        batchRulePreparation: undefined\n      },\n      parentsRows3: null,\n      temp: {\n        orgName: undefined,\n        warehouseCode: undefined,\n        warehouseName: undefined,\n        ruleDivision: undefined,\n        ruleType: undefined,\n        ruleCode: undefined,\n        batchRule: undefined,\n        dataItem: undefined,\n        objCode: undefined,\n        remark: undefined,\n        typeCode: undefined,\n        typeName: undefined,\n        batchEnabled: undefined\n      },\n      dialogFormVisible: false,\n      dialogFormVisible1: false,\n      dialogFormVisible2: false,\n      typeDialogVisible: false,\n      partDialogVisible: false,\n      dialogStatus: \"\",\n      // DICT_CODE: DICT_CODE,\n      DT_ORG_TYPE: DT_ORG_TYPE,\n      // TWO_STATE_OPTIONS: TWO_STATE_OPTIONS,\n      rules: {}\n    };\n  },\n  created: function created() {\n    this.getList();\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this.setTableHeight();\n    };\n  },\n  methods: {\n    getList: function getList() {\n      var _this2 = this;\n\n      this.list1 = [];\n      this.listSub = [];\n      api1.queryRecords(this.listQuery).then(function (res) {\n        _this2.list = res.data.list;\n        _this2.total = res.data.pages.count;\n\n        _this2.$nextTick(function () {\n          this.checked();\n        });\n      });\n    },\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight() + 52;\n      this.stheight = this.theight / 2 - 23;\n    },\n    checked: function checked() {\n      this.$refs.tb.toggleRowSelection(this.list[0], true); //官网方法，重点\n    },\n    getList1: function getList1() {\n      var _this3 = this;\n\n      this.listQuery1.warehouseCode = this.selectlistRow.warehouseCode;\n      api.queryRecords(this.listQuery1).then(function (res) {\n        _this3.list1 = res.data;\n        _this3.total1 = res.data.length;\n      });\n    },\n    getListSub: function getListSub() {\n      var _this4 = this;\n\n      api.queryItems(this.selectlistRow3.rowId).then(function (res) {\n        _this4.listSub = res.data;\n        _this4.totalSub = res.data.length;\n      });\n    },\n    materialxz: function materialxz() {\n      var _this5 = this;\n\n      //物料选中中弹窗确认按钮\n      if (this.$refs.wlxzRef.listSelected.length > 0) {\n        var temp = this.$refs.wlxzRef.listSelected.map(function (v) {\n          var temp = {\n            warehouseCode: _this5.selectlistRow.warehouseCode,\n            objectCode: v.materielCode,\n            objectDescribe: v.materielName,\n            batchRuleId: _this5.selectlistRow3.rowId\n          };\n          return temp;\n        });\n        this.createByActiveName(temp); // this.partDialogVisible = false;\n      } else {\n        this.$message({\n          title: this.$t(\"message.warning\"),\n          message: this.$t(\"message.checkedplease\"),\n          type: \"warning\"\n        });\n      }\n    },\n    //  selectPartRow(rows) { //父子通信\n    //     this.parentsRows = rows\n    // },\n    selectPartRow: function selectPartRow(rows) {\n      this.parentsRows = rows;\n    },\n    selectRow: function selectRow(val) {\n      //表一复选框选中方法\n      this.selectlistRow = val[val.length - 1];\n\n      if (val.length > 1) {\n        this.$refs.tb.clearSelection();\n        this.$refs.tb.toggleRowSelection(val.pop());\n      }\n\n      this.$refs.tb.setCurrentRow(this.selectlistRow);\n\n      if (this.selectlistRow) {\n        this.getList1();\n        this.listSub = [];\n      }\n    },\n    selectRow1: function selectRow1(val) {\n      //表一单击行选中方法\n      this.selectlistRow1 = val;\n      this.$refs.tb.clearSelection();\n      this.$refs.tb.toggleRowSelection(val); //单击行绑定点击事件\n    },\n    selectRow2: function selectRow2(val) {\n      //新增编辑弹窗\n      this.selectlistRow2 = val;\n    },\n    selectRow3: function selectRow3(val) {\n      //表二复选框选中方法\n      this.selectlistRow3 = val[val.length - 1];\n\n      if (val.length > 1) {\n        this.$refs.tb1.clearSelection();\n        this.$refs.tb1.toggleRowSelection(val.pop());\n      }\n\n      if (this.selectlistRow3) {\n        this.getListSub();\n      }\n    },\n    selectRowSub: function selectRowSub(val) {\n      //表二单击行选中方法\n      this.selectlistRowSub = val;\n      this.$refs.tb1.clearSelection();\n      this.$refs.tb1.toggleRowSelection(val); //单击行绑定点击事件\n    },\n    selectRowfl: function selectRowfl(val) {\n      this.selectlistRowfl = val;\n    },\n    selectTypeRow: function selectTypeRow(rows) {\n      var _this6 = this;\n\n      var temp = rows.map(function (v) {\n        var temp = {\n          warehouseCode: _this6.selectlistRow.warehouseCode,\n          objectCode: v.dictItemKey,\n          objectDescribe: v.dictItemValue,\n          batchRuleId: _this6.selectlistRow3.rowId\n        };\n        return temp;\n      });\n      this.createByActiveName1(temp);\n    },\n    createByActiveName: function createByActiveName(temp) {\n      this.createBatch(temp);\n    },\n    createByActiveName1: function createByActiveName1(temp) {\n      this.createfl(temp);\n    },\n    createfl: function createfl(temp) {\n      var _this7 = this;\n\n      api.addRecordpc(this.selectlistRow3.rowId, temp).then(function () {\n        _this7.getList3();\n\n        _this7.typeDialogVisible = false;\n        _this7.partDialogVisible = false;\n\n        _this7.$notify({\n          title: \"成功\",\n          message: \"新增成功\",\n          type: \"success\",\n          duration: 2000\n        });\n      });\n    },\n    createBatch: function createBatch(temp) {\n      var _this8 = this;\n\n      api.addRecordpc(this.selectlistRow3.rowId, temp).then(function () {\n        _this8.getList3();\n\n        _this8.typeDialogVisible = false;\n        _this8.partDialogVisible = false;\n\n        _this8.$notify({\n          title: \"成功\",\n          message: \"新增成功\",\n          type: \"success\",\n          duration: 2000\n        });\n\n        _this8.getListSub();\n      });\n    },\n    handleCreate: function handleCreate() {\n      var _this9 = this;\n\n      this.resetTemp();\n\n      if (this.selectlistRow) {\n        this.dialogStatus = \"create\";\n        this.temp.batchRuleDiffName = this.selectlistRow.batchRuleDiffName;\n        api.queryRecordsbz(this.selectlistRow).then(function (res) {\n          _this9.list2 = res.data;\n          _this9.total2 = res.data.length;\n        });\n        this.dialogFormVisible = true;\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请选择一条信息\",\n          type: \"warning\"\n        });\n      }\n    },\n    create: function create() {\n      var _this10 = this;\n\n      if (this.selectlistRow2) {\n        this.dto.batchRuleDiff = this.selectlistRow.batchRuleDiff;\n        this.dto.batchRulePreparation = this.selectlistRow2;\n        api.addRecord(this.selectlistRow.warehouseCode, this.dto).then(function () {\n          _this10.getList1();\n\n          _this10.dialogFormVisible = false;\n\n          _this10.$notify({\n            title: \"成功\",\n            message: \"新增成功\",\n            type: \"success\",\n            duration: 2000\n          });\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请选择新增信息\",\n          type: \"warning\"\n        });\n      }\n    },\n    getList3: function getList3() {\n      var _this11 = this;\n\n      api.queryRecordsbfl(this.selectlistRow3.rowId).then(function (res) {\n        _this11.list3 = res.data;\n        _this11.total = res.data.length;\n      });\n    },\n    handleType: function handleType() {\n      var _this12 = this;\n\n      this.resetTemp();\n\n      if (this.selectlistRow3) {\n        this.dialogStatus = \"create\";\n        this.dialogFormVisible1 = true;\n        this.temp.batchEnabled = this.selectlistRow3.batchRuleDiffName;\n        api.queryRecordsbfl(this.selectlistRow3.rowId).then(function (res) {\n          _this12.list3 = res.data;\n          _this12.total = res.data.length;\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请选择一条信息\",\n          type: \"warning\"\n        });\n      }\n    },\n    handleUpdate: function handleUpdate() {\n      var _this13 = this;\n\n      this.resetTemp();\n\n      if (this.selectlistRow3) {\n        this.dialogStatus = \"update\";\n        api.queryRecordsbz1(this.selectlistRow3.rowId).then(function (res) {\n          var b = [];\n          var a = res.data;\n          api.queryRecordsbz(_this13.selectlistRow).then(function (res) {\n            b = res.data;\n            _this13.temp.batchRuleDiffName = _this13.selectlistRow3.batchRuleDiffName;\n            _this13.dialogFormVisible = true;\n            _this13.list2 = res.data;\n            _this13.total2 = res.data.length;\n\n            _this13.$nextTick(function () {\n              var _this14 = this;\n\n              // //在渲染之后执行toggleRowSelection方法\n              // this.$refs.dd.toggleRowSelection(this.list2[b.indexOf(a[0])]); //判断a的值是不是在b数组里并返回索引\n              b.forEach(function (val, index) {\n                a.forEach(function (val1) {\n                  if (val.rulePrepCode == val1.rulePrepCode) {\n                    _this14.$refs.dd.toggleRowSelection(_this14.list2[index]);\n                  }\n                });\n              });\n            });\n          });\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请选择一条信息\",\n          type: \"warning\"\n        });\n      }\n    },\n    update: function update() {\n      var _this15 = this;\n\n      // this.dtoupdate.batchRuleId=this.selectlistRow3.rowId\n      this.dtoupdate.batchRuleDiff = this.selectlistRow3.batchRuleDiff;\n      this.dtoupdate.batchRulePreparation = this.selectlistRow2;\n      api.updateRecord(this.selectlistRow3.rowId, this.dtoupdate).then(function () {\n        _this15.getList1();\n\n        _this15.dialogFormVisible = false;\n\n        _this15.$notify({\n          title: \"成功\",\n          message: \"编辑成功\",\n          type: \"success\",\n          duration: 2000\n        });\n      });\n    },\n    handleDelete: function handleDelete() {\n      var _this16 = this;\n\n      if (this.selectlistRow3) {\n        this.$confirm(\"此操作将永久删除该文件,是否继续?\", \"提示\", {\n          confirmButtonText: \"确定\",\n          cancelButtonText: \"取消\",\n          type: \"warning\"\n        }).then(function () {\n          api.deleteRecord(_this16.selectlistRow3.rowId).then(function () {\n            _this16.getList1();\n\n            _this16.$notify({\n              title: \"成功\",\n              message: \"删除成功\",\n              type: \"success\",\n              duration: 2000\n            });\n          });\n        }).catch(function () {\n          _this16.$message({\n            type: \"info\",\n            message: \"已取消删除\"\n          });\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请选择一条信息\",\n          type: \"warning\"\n        });\n      }\n    },\n    handleDeletefl: function handleDeletefl() {\n      var _this17 = this;\n\n      if (this.selectlistRowfl && this.selectlistRowfl.length == 1) {\n        this.$confirm(\"此操作将永久删除该文件,是否继续?\", \"提示\", {\n          confirmButtonText: \"确定\",\n          cancelButtonText: \"取消\",\n          type: \"warning\"\n        }).then(function () {\n          api.deleteRecordfl(_this17.selectlistRow3.rowId, _this17.selectlistRowfl[0].objectCode).then(function () {\n            _this17.getList3();\n\n            _this17.$notify({\n              title: \"成功\",\n              message: \"删除成功\",\n              type: \"success\",\n              duration: 2000\n            });\n          });\n        }).catch(function () {\n          _this17.$message({\n            type: \"info\",\n            message: \"已取消删除\"\n          });\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请选择一条信息\",\n          type: \"warning\"\n        });\n      }\n    },\n    handleMateriel: function handleMateriel() {\n      if (this.temp.batchEnabled == \"按物料分类\") {\n        this.typeDialogVisible = true;\n      }\n\n      if (this.temp.batchEnabled == \"全作用\") {\n        this.typeDialogVisible = true;\n      } else if (this.temp.batchEnabled == \"按物料编码\") {\n        this.partDialogVisible = true; // this.$nextTick(()=>{\n        //     this.$refs.wlxzRef.listSelected = [...this.list3];\n        //     this.$refs.wlxzRef.getList();\n        // })\n      }\n    },\n    handleLead: function handleLead() {},\n    update1: function update1() {},\n    handleQuery: function handleQuery() {\n      this.listQuery.currentPage = 1;\n      this.getList();\n    },\n    handleSizeChange: function handleSizeChange(val) {\n      this.listQuery.pageSize = val;\n      this.getList();\n    },\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.listQuery.currentPage = val;\n      this.getList();\n    },\n    handleClose: function handleClose() {\n      this.resetTemp();\n    },\n    toggleSelection: function toggleSelection(rows) {\n      var _this18 = this;\n\n      if (rows) {\n        rows.forEach(function (row) {\n          _this18.$refs.dd.toggleRowSelection(row);\n        });\n      } else {\n        this.$refs.dd.clearSelection();\n      }\n    },\n    resetTemp: function resetTemp() {\n      this.temp = {\n        orgName: undefined,\n        warehouseCode: undefined,\n        warehouseName: undefined,\n        ruleDivision: undefined,\n        ruleType: undefined,\n        ruleCode: undefined,\n        batchRule: undefined,\n        dataItem: undefined,\n        objCode: undefined,\n        remark: undefined\n      };\n    }\n  }\n};",null]}