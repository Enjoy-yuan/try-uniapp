{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/supplierRFQ/supplierRFQAnswer/tab/tabYCLcost.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/supplierRFQ/supplierRFQAnswer/tab/tabYCLcost.vue","mtime":1599136050912},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { queryQuoteItem, createQuoteItem, updateQuoteItem, deleteQuoteItem, queryQuoteDetails } from \"@/api/project/srm/supplierSelect/supplierRFQ/supplierRFQAnswer\";\nexport default {\n  props: ['parentRowId'],\n  name: 'tabYCLcost',\n  data: function data() {\n    return {\n      tableData: [],\n      rules: {\n        subpartName: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        subpartCode: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        materialName: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        factory: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        specification: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        unitPrice: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        consumptionQuota: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        netWeight: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        recoveredUnitPrice: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        rejectRate: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }]\n      },\n      formData: {\n        parentRowId: null,\n        subpartName: null,\n        subpartCode: null,\n        materialName: null,\n        factory: null,\n        specification: null,\n        materielClass: null,\n        unitPrice: null,\n        consumptionQuota: null,\n        subtotalCost: null,\n        netWeight: null,\n        recoveredUnitPrice: null,\n        recyclableWeight: null,\n        recoveryValue: null,\n        rejectRate: null,\n        wasteLoss: null\n      },\n      formConfig: [{\n        type: 'commonInput',\n        required: true,\n        label: '子件名称',\n        prop: 'subpartName',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '子件编码',\n        prop: 'subpartCode',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '材料名/牌号',\n        prop: 'materialName',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '生产厂',\n        prop: 'factory',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '规格型号',\n        prop: 'specification',\n        width: ''\n      }, {\n        type: 'commonInput',\n        label: '计量单位',\n        prop: 'measurement',\n        width: ''\n      }, {\n        type: 'commonInput',\n        inputType: 'number',\n        required: true,\n        label: '单价',\n        prop: 'unitPrice',\n        width: ''\n      }, //A1\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        required: true,\n        label: '消耗定额',\n        prop: 'consumptionQuota',\n        width: ''\n      }, //A2\n      {\n        type: 'commonInput',\n        calculate: 'item.unitPrice*item.consumptionQuota',\n        inputType: 'number',\n        disabled: true,\n        label: '费用小计',\n        prop: 'subtotalCost',\n        width: ''\n      }, // A1*A2\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        required: true,\n        label: '净重',\n        prop: 'netWeight',\n        width: ''\n      }, // A3\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        required: true,\n        label: '回收单价',\n        prop: 'recoveredUnitPrice',\n        width: ''\n      }, // A5\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        disabled: true,\n        label: '可回收重量',\n        prop: 'recyclableWeight',\n        width: ''\n      }, // A4  (A2-A3)*0.98\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        disabled: true,\n        label: '回收价值',\n        prop: 'recoveryValue',\n        width: ''\n      }, // A6=A4*A5\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        required: true,\n        label: '废品率',\n        prop: 'rejectRate',\n        width: ''\n      }, // A7\n      {\n        type: 'commonInput',\n        inputType: 'number',\n        disabled: true,\n        label: '废品损失',\n        prop: 'wasteLoss',\n        width: '' //A8 = A1*A3*A7\n\n      }],\n      tableConfig: [// { label: '序号', prop: 'prop1', align: 'center', width: 'auto' },\n      {\n        label: '子件名称',\n        prop: 'subpartName',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '子件编码',\n        prop: 'subpartCode',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '材料名/牌号',\n        prop: 'materialName',\n        align: 'center',\n        width: '120'\n      }, {\n        label: '生产厂',\n        prop: 'factory',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '规格型号',\n        prop: 'specification',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '单价',\n        prop: 'unitPrice',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '消耗定额',\n        prop: 'consumptionQuota',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '计量单位',\n        prop: 'measurement',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '费用小计',\n        prop: 'subtotalCost',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '净重',\n        prop: 'netWeight',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '可回收重量',\n        prop: 'recyclableWeight',\n        align: 'center',\n        width: '120'\n      }, {\n        label: '回收单价',\n        prop: 'recoveredUnitPrice',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '回收价值',\n        prop: 'recoveryValue',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '废品率(%)',\n        prop: 'rejectRate',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '废品损失',\n        prop: 'wasteLoss',\n        align: 'center',\n        width: 'auto'\n      }]\n    };\n  },\n  watch: {\n    'formData.unitPrice': function formDataUnitPrice(val) {\n      this.$set(this.formData, 'subtotalCost', (val * this.formData.consumptionQuota).toFixed(4));\n      this.$set(this.formData, 'wasteLoss', (this.formData.rejectRate * this.formData.netWeight * val / 100).toFixed(4));\n    },\n    'formData.consumptionQuota': function formDataConsumptionQuota(val) {\n      this.$set(this.formData, 'subtotalCost', (val * this.formData.unitPrice).toFixed(4));\n      this.$set(this.formData, 'recyclableWeight', ((val - this.formData.netWeight) * 0.98).toFixed(4));\n    },\n    'formData.netWeight': function formDataNetWeight(val) {\n      this.$set(this.formData, 'recyclableWeight', ((this.formData.consumptionQuota - val) * 0.98).toFixed(4));\n      this.$set(this.formData, 'wasteLoss', (this.formData.rejectRate * this.formData.unitPrice * val / 100).toFixed(4));\n    },\n    'formData.recyclableWeight': function formDataRecyclableWeight(val) {\n      this.$set(this.formData, 'recoveryValue', (this.formData.recoveredUnitPrice * val).toFixed(4));\n    },\n    'formData.recoveredUnitPrice': function formDataRecoveredUnitPrice(val) {\n      this.$set(this.formData, 'recoveryValue', (this.formData.recyclableWeight * val).toFixed(4));\n    },\n    'formData.rejectRate': function formDataRejectRate(val) {\n      this.$set(this.formData, 'wasteLoss', (this.formData.unitPrice * this.formData.netWeight * val / 100).toFixed(4));\n    }\n  },\n  mounted: function mounted() {\n    this.getItems();\n  },\n  methods: {\n    getItems: function getItems() {\n      var _this = this;\n\n      if (this.parentRowId) {\n        queryQuoteDetails({\n          parentRowId: this.parentRowId,\n          method: 'RAW_MATERIAL_COST'\n        }).then(function (res) {\n          _this.tableData = res.data;\n\n          _this.calculateSum();\n        });\n      }\n    },\n    calculateSum: function calculateSum() {\n      var subtotalCosts = 0;\n      var recoveryValues = 0;\n      var wasteLosses = 0;\n      this.tableData.forEach(function (item) {\n        subtotalCosts += item.subtotalCost;\n        recoveryValues += item.recoveryValue;\n        wasteLosses += item.wasteLoss;\n      });\n      var dataSum = {\n        key: 'sum',\n        subpartName: '合计',\n        subtotalCost: subtotalCosts,\n        recoveryValue: recoveryValues,\n        wasteLoss: wasteLosses\n      };\n      this.tableData.push(dataSum);\n    },\n    handleUpdate: function handleUpdate(row) {\n      var _this2 = this;\n\n      queryQuoteItem({\n        rowId: row.rowId,\n        method: 'RAW_MATERIAL_COST'\n      }).then(function (res) {\n        _this2.formData = res.data;\n      });\n    },\n    handleDelete: function handleDelete(row) {\n      var _this3 = this;\n\n      this.$confirm('确认删除吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        deleteQuoteItem({\n          parentRowId: _this3.parentRowId,\n          rowId: row.rowId,\n          method: 'RAW_MATERIAL_COST'\n        }).then(function () {\n          _this3.getItems();\n\n          _this3.$emit('getTotalQuotation');\n        });\n      }).catch(function () {\n        _this3.$message({\n          type: 'info',\n          message: '已取消'\n        });\n      });\n    },\n    resetForm: function resetForm() {\n      for (var par in this.formData) {\n        if (par !== 'parentRowId') {\n          this.$set(this.formData, par, null);\n        }\n      }\n\n      this.$refs['refForm'].resetFields();\n      this.$refs['refForm'].clearValidate();\n    },\n    handleConfirm: function handleConfirm() {\n      var _this4 = this;\n\n      this.$refs.refForm.validate(function (valid) {\n        if (valid) {\n          _this4.$confirm('确认保存吗?', '提示', {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }).then(function () {\n            //rawMaterialCostDTO\n            _this4.formData.parentRowId = _this4.parentRowId;\n\n            if (_this4.formData.rowId) {\n              var cdata = {\n                rawMaterialCostDTO: _this4.formData,\n                method: \"RAW_MATERIAL_COST\"\n              };\n              updateQuoteItem(_this4.formData.rowId, cdata).then(function () {\n                _this4.getItems();\n\n                _this4.$emit('getTotalQuotation');\n\n                _this4.$message({\n                  type: 'success',\n                  message: '保存成功'\n                });\n\n                _this4.resetForm();\n              });\n            } else {\n              var _cdata = {\n                rawMaterialCostDTO: _this4.formData,\n                method: \"RAW_MATERIAL_COST\"\n              };\n              createQuoteItem(_cdata).then(function () {\n                _this4.getItems();\n\n                _this4.$emit('getTotalQuotation');\n\n                _this4.resetForm();\n\n                _this4.$message({\n                  type: 'success',\n                  message: '新增成功'\n                });\n              });\n            }\n          }).catch(function () {\n            _this4.$message({\n              type: 'info',\n              message: '已取消'\n            });\n          });\n        }\n      });\n    }\n  }\n};",null]}