{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/bidEvaluation/priceReview/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/bidEvaluation/priceReview/index.vue","mtime":1603420637358},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from \"@/api/project/srm/supplierSelect/priceReview\";\nimport Pagination from \"@/components/Pagination\";\nimport { mapState } from \"vuex\";\nimport twoOffer from \"./dialog/twoOffer\";\nimport priceCompare from \"./dialog/priceCompare\";\nimport manyCompare from \"./dialog/manyCompare\";\nimport upload from '@/components/Dialog/upload'; //附件上传\n\nimport examine from \"@/components/Dialog/examine\"; //方案审核\n\nexport default {\n  name: \"priceReview\",\n  components: {\n    Pagination: Pagination,\n    twoOffer: twoOffer,\n    priceCompare: priceCompare,\n    manyCompare: manyCompare,\n    upload: upload,\n    examine: examine\n  },\n  data: function data() {\n    return {\n      functionCode: null,\n      fileType: null,\n      theight: 0,\n      isSingle: true,\n      //表格是否单选 点击各按钮根据流程逻辑控制单多选\n      currentSelectedRow: null,\n      //当前选中的行\n      selectedRows: null,\n      //多选时选中的所有行\n      list: null,\n      listSub: null,\n      total: 0,\n      selectedrow: null,\n      //主表选中行\n      radio: 3,\n      competitionState: '',\n      selectedState: '',\n      selectlistRowSub: [],\n      listQuery: {\n        page: true,\n        currentPage: 1,\n        pageSize: 10,\n        isBusinessOpening: 1,\n        state: 'PDJ3'\n      },\n      sublistQuery: {\n        page: true,\n        currentPage: 1,\n        pageSize: 10\n      },\n      tableKey: [0, 1] //表格索引，虚拟dom渲染表格时使用\n\n    };\n  },\n  computed: _objectSpread({}, mapState({\n    dt_srm_pdj: function dt_srm_pdj(state) {\n      return state.dict.dt_srm_pdj;\n    },\n    dt_srm_pdf: function dt_srm_pdf(state) {\n      return state.dict.dt_srm_pdf;\n    }\n  })),\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pdj\", 'dt_srm_pdf']);\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this.setTableHeight();\n    };\n\n    this.getList();\n  },\n  filters: {\n    statusFilterA: function statusFilterA(a) {\n      if (a === '1') {\n        return \"入选\";\n      } else if (a == '0') {\n        return \"未入选\";\n      }\n    },\n    statusFilterB: function statusFilterB(a) {\n      if (a === '1') {\n        return \"入围\";\n      } else if (a == '0') {\n        return \"未入围\";\n      }\n    }\n  },\n  methods: {\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight() - 185;\n    },\n    //入围状态控制\n    changeValueA: function changeValueA(val) {\n      console.log(val);\n    },\n    //入选状态控制\n    changeValueB: function changeValueB(val) {\n      if (val == 1) {\n        this.competitionState = 1;\n      }\n    },\n    checked: function checked() {\n      this.$refs.tb.toggleRowSelection(this.list[0], true); //官网方法，重点\n    },\n    refresh: function refresh() {\n      this.getList();\n    },\n    //显示主表\n    getList: function getList() {\n      var _this2 = this;\n\n      api.queryRecords(this.listQuery).then(function (res) {\n        var options = [_this2.dt_srm_pdj, _this2.dt_srm_pdf];\n        res.data.list = _this2.$myFun.srmCodeToName(res.data.list, options, ['priceEvaluationState', 'choiceMethod']);\n        _this2.list = res.data.list;\n        _this2.total = res.data.pages.count;\n\n        _this2.$nextTick(function () {\n          this.checked();\n        });\n      });\n    },\n    //显示从表\n    getSubList: function getSubList() {\n      var _this3 = this;\n\n      var dto = {\n        materielCode: this.selectlistRow.materielCode,\n        planNo: this.selectlistRow.planNo,\n        quoteRounds: this.selectlistRow.quoteRounds\n      };\n      api.queryRecordItems(dto).then(function (res) {\n        _this3.listSub = res.data;\n      });\n    },\n    //终止选择\n    handleEndSelect: function handleEndSelect() {\n      var _this4 = this;\n\n      if (this.selectlistRow) {\n        var dto = {\n          planNo: this.selectlistRow.planNo,\n          materielCode: this.selectlistRow.materielCode,\n          method: 'stop'\n        };\n        api.endSelect(dto).then(function () {\n          _this4.$message({\n            title: '成功',\n            message: '终止选择成功',\n            type: 'success',\n            duration: 2000\n          });\n\n          _this4.listSub = [];\n\n          _this4.getList();\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    //确认选择\n    handleConfirmSelect: function handleConfirmSelect() {\n      var _this5 = this;\n\n      if (this.selectlistRow) {\n        var dto = {\n          planNo: this.selectlistRow.planNo,\n          materielCode: this.selectlistRow.materielCode,\n          method: 'confirm'\n        };\n        api.endSelect(dto).then(function () {\n          _this5.$message({\n            title: '成功',\n            message: '选择确认成功',\n            type: 'success',\n            duration: 2000\n          });\n\n          _this5.listSub = [];\n\n          _this5.getList();\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    //导入按钮\n    handleImport: function handleImport() {\n      var _this6 = this;\n\n      if (this.selectlistRow) {\n        this.functionCode = this.selectlistRow.planNo;\n        this.fileType = 'document';\n        this.$nextTick(function () {\n          _this6.$refs.upload.getList();\n\n          _this6.$refs.upload.dialogVisible = true;\n        });\n      } else {\n        this.$message({\n          type: 'warning',\n          message: '请先选择一条信息'\n        });\n      }\n    },\n    //审核按钮单击事件\n    handleExamine: function handleExamine() {\n      if (this.selectlistRow) {\n        this.$refs.examine.dialogVisible = true;\n        this.$refs.examine.temp.rowId = this.selectlistRow.rowId;\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning',\n          duration: 2000\n        });\n      }\n    },\n    //选择按钮单击事件\n    handleSelect: function handleSelect() {\n      var _this7 = this;\n\n      if (this.selectlistRowSub && this.selectlistRowSub.length > 0) {\n        if (this.competitionState !== '' || this.selectedState !== '') {\n          if (this.competitionState == '0' && this.selectedState == '1') {\n            this.$message({\n              title: '警告',\n              message: '未入围不能入选',\n              type: 'warning'\n            });\n          } else {\n            var dto = {\n              competitionState: this.competitionState,\n              selectedState: this.selectedState,\n              rowIds: []\n            };\n            this.selectlistRowSub.forEach(function (val, index) {\n              dto.rowIds[index] = val.rowId;\n            });\n            api.select(dto).then(function () {\n              _this7.$message({\n                title: '成功',\n                message: '选择成功',\n                type: 'success',\n                duration: 2000\n              });\n\n              _this7.getList();\n            });\n          }\n        } else {\n          this.$message({\n            title: '警告',\n            message: '请选择入围或入选',\n            type: 'warning'\n          });\n        }\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请先勾选记录',\n          type: 'warning'\n        });\n      }\n    },\n    //二次报价单击事件\n    handleTwoOffer: function handleTwoOffer() {\n      if (this.selectlistRow) {\n        if (this.selectlistRowSub && this.selectlistRowSub.length > 0) {\n          this.$refs.twoOffer.dialogVisible = true;\n          this.$refs.twoOffer.list = [this.selectlistRow];\n          this.$refs.twoOffer.subList = this.selectlistRowSub;\n        } else {\n          this.$message({\n            title: '警告',\n            message: '请先勾选记录',\n            type: 'warning'\n          });\n        }\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    //价格构成对比按钮单击事件\n    priceCompare: function priceCompare() {\n      var _this8 = this;\n\n      if (this.selectlistRowSub && this.selectlistRowSub.length > 0) {\n        this.$refs.priceCompare.dialogVisible = true;\n        var dto = {\n          materielCode: this.selectlistRow.materielCode,\n          planNo: this.selectlistRow.planNo,\n          quoteRounds: this.selectlistRow.quoteRounds,\n          quotationMethod: this.selectlistRowSub[0].quotationMethod,\n          supplierCode: []\n        };\n        this.selectlistRowSub.forEach(function (val, index) {\n          dto.supplierCode[index] = val.supplierCode;\n        });\n        dto.supplierCode = dto.supplierCode.join(',');\n        this.$nextTick(function () {\n          _this8.$refs.priceCompare.getList(dto);\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请勾选信息\",\n          type: \"warning\"\n        });\n      }\n    },\n    manyCompare: function manyCompare() {\n      if (this.selectlistRowSub.length == 1) {\n        var dto = {\n          materielCode: this.selectlistRow.materielCode,\n          planNo: this.selectlistRow.planNo,\n          supplierCode: this.selectlistRowSub[0].supplierCode,\n          quotationMethod: this.selectlistRowSub[0].quotationMethod // this.selectlistRowSub.forEach((val, index) => {\n          //     dto.supplierCode[index] = val.supplierCode\n          // })\n\n        };\n        this.$refs.manyCompare.dialogVisible = true;\n        this.$refs.manyCompare.listSub = [];\n        this.$refs.manyCompare.getList(dto);\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请勾选一条信息\",\n          type: \"warning\"\n        });\n      }\n    },\n    //发布\n    handlePublish: function handlePublish() {},\n    //删除\n    handleDelete: function handleDelete() {},\n    //查询\n    handleQuery: function handleQuery() {\n      this.listSub = [];\n      this.listQuery.currentPage = 1;\n      this.getList();\n    },\n    // 表格选择框选中 注:参数为选中的所有行的数组\n    selectChange: function selectChange(val) {\n      this.selectlistRow = val[val.length - 1];\n\n      if (val.length > 1) {\n        this.$refs.tb.clearSelection();\n        this.$refs.tb.toggleRowSelection(val.pop());\n      }\n\n      if (this.selectlistRow) {\n        this.getSubList();\n      }\n\n      this.$refs.tb.setCurrentRow(this.selectlistRow);\n    },\n    //点击表格某一行\n    rowClick: function rowClick(val) {\n      this.$refs.tb.clearSelection();\n      this.$refs.tb.toggleRowSelection(val);\n    },\n    // 获取表格选中时的数据\n    selectRowSub: function selectRowSub(val) {\n      this.selectlistRowSub = val;\n    },\n    rowClickSub: function rowClickSub(val) {\n      this.$refs.tbSub.toggleRowSelection(val);\n    },\n    //加载时默认选中第一行\n    setFirstLine: function setFirstLine() {\n      var _this9 = this;\n\n      this.$nextTick(function () {\n        _this9.$refs.tbmain.setCurrentRow(_this9.list[0]);\n      });\n    }\n  }\n};",null]}