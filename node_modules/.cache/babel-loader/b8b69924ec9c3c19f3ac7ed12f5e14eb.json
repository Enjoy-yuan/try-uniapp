{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/system/systemMenu/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/system/systemMenu/index.vue","mtime":1602760491255},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Pagination from '@/components/Pagination'; // Secondary package based on el-pagination\n\nimport { selectDatas, addData, deleteData, selectEndpoints, addRelation, renewData } from '@/api/system/menu';\nimport SelectTree from '@/components/SelectTree/index.vue';\nimport SelectTreeOption from '@/components/SelectTreeOption'; // Secondary package based on el-pagination\n\nimport { refreshMenu } from '@/utils/tool';\nimport resource from '@/utils/resource';\nimport getAllHasChildrenRowId from '@/utils/addRouter';\nexport default {\n  name: 'systemMenu',\n  components: {\n    Pagination: Pagination,\n    SelectTree: SelectTree,\n    SelectTreeOption: SelectTreeOption\n  },\n  data: function data() {\n    return {\n      //下拉框树数据\n      isClearable: true,\n      // 可清空（可选）\n      isAccordion: true,\n      // 可收起（可选）\n      valueId: undefined,\n      // 初始ID（可选）\n      props: {\n        // 配置项（必选）\n        value: 'id',\n        label: 'name',\n        children: 'children' // disabled:true\n\n      },\n      //下拉框树数据\n      tableKey: 0,\n      list: [],\n      listRelation: [],\n      listUnrelation: [],\n      icons: this.$myFun.getSVG,\n      treeData: [],\n      theight: 0,\n      //表格高度\n      btnFucList: [{\n        rowId: '1',\n        btnFunc: '添加',\n        btnName: 'btnAdd'\n      }, {\n        rowId: '2',\n        btnFunc: '编辑',\n        btnName: 'btnEdit'\n      }, {\n        rowId: '3',\n        btnFunc: '删除',\n        btnName: 'btnDelete'\n      }],\n      //按钮列表\n      total: 0,\n      total1: 0,\n      total2: 0,\n      listLoading: true,\n      circle: '',\n      listQuery: {\n        parentId: 0,\n        currentPage: 1,\n        pageSize: 15,\n        page: 1\n      },\n      listQuery2: {\n        currentPage: 1,\n        pageSize: 10,\n        page: 1\n      },\n      listQueryZy: {\n        currentPage: 1,\n        pageSize: 10,\n        page: true,\n        url: undefined\n      },\n      temp: {\n        allowEmptyValue: 'PC',\n        icons: undefined\n      },\n      treeList: [],\n      allCodes: [],\n      dialogFormVisible: false,\n      dialogFormUser: false,\n      btnAuthorityDialog: false,\n      //按钮权限弹框\n      btnSelectRow: [],\n      childId: [],\n      dialogStatus: '',\n      activeName2: 'first',\n      rules: {\n        catalogCode: [{\n          required: true,\n          message: this.$t('validate.required'),\n          trigger: 'blur'\n        }, {\n          max: 100,\n          message: this.$t('validate.max32'),\n          trigger: 'blur'\n        }],\n        catalogName: [{\n          required: true,\n          message: this.$t('validate.required'),\n          trigger: 'blur'\n        }, {\n          max: 100,\n          message: this.$t('validate.max32'),\n          trigger: 'blur'\n        }],\n        nodeType: [{\n          required: true,\n          message: this.$t('validate.required'),\n          trigger: 'blur'\n        }]\n      },\n      dialogPvVisible: false,\n      pvData: [],\n      defaultProps: {\n        rowId: 'rowId',\n        // 父级唯一标识\n        children: 'children',\n        label: 'catalogName'\n      },\n      contentStyleObj: {\n        height: null\n      }\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$store.dispatch('dict/getDicData', ['dt_org_type', 'dt_org_function']); //表格高度自适应\n\n    window.onresize = function () {\n      _this.setTableHeight();\n\n      _this.setTreeHeight();\n    };\n\n    this.getTree();\n    this.getList();\n  },\n  methods: {\n    getValue: function getValue(value) {\n      this.valueId = value;\n      this.$set(this.temp, 'icons', value);\n      console.log(this.valueId, this.temp, 'this.valueId,this.temp');\n    },\n    //添加按钮\n    addButton: function addButton() {\n      this.btnFucList.push({\n        rowId: '',\n        btnFunc: '',\n        btnName: ''\n      });\n    },\n    //删除按钮\n    deleteButton: function deleteButton() {},\n    //保存按钮\n    confirmBtnList: function confirmBtnList() {},\n    btnSelectChange: function btnSelectChange(val) {\n      this.btnSelectRow = val;\n    },\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight();\n    },\n    resetTemp: function resetTemp() {\n      this.temp = {\n        nodeType: 1,\n        allowEmptyValue: 'PC'\n      };\n    },\n    pidFilter: function pidFilter(value) {\n      //父目录过滤器\n      if (value === 0) {\n        return '根目录';\n      } else {\n        for (var i = 0; i < this.list.length; i++) {\n          if (this.list[i].rowId == value) {\n            return this.list[i].catalogName;\n          }\n        }\n      }\n    },\n    handleTabClick: function handleTabClick(tab) {\n      //选项卡切换\n      if (tab.name == 'second') {\n        this.getListRelation();\n      } else {\n        this.getListUnelation();\n      }\n    },\n    destroyed: function destroyed() {\n      //自适应窗体大小\n      this.setTreeHeight();\n      window.removeEventListener('resize', this.setTableHeight);\n      window.removeEventListener('resize', this.setTreeHeight);\n    },\n    getList: function getList() {\n      var _this2 = this;\n\n      //获取数据\n      selectDatas(this.listQuery).then(function (response) {\n        _this2.list = response.data.list.filter(function (v) {\n          if (resource[v.url]) {\n            if (v.parentId == 0 || getAllHasChildrenRowId.indexOf(v.rowId) > 0) {\n              v.icons = v.icons || 'setting-fill';\n            } else {\n              v.icons = v.icons || 'circle';\n            }\n\n            return v;\n          }\n        });\n        _this2.total = response.data.pages.count;\n        setTimeout(function () {\n          _this2.setTableHeight();\n\n          _this2.setTreeHeight();\n        }, 100);\n      });\n    },\n    getTree: function getTree() {\n      var _this3 = this;\n\n      //获取树数据\n      selectDatas().then(function (response) {\n        _this3.treeData = _this3.$myFun.addTreeRoot(response.data);\n        setTimeout(function () {\n          _this3.listLoading = false;\n        }, 1.5 * 100);\n      });\n    },\n    //树高度设置\n    setTreeHeight: function setTreeHeight() {\n      this.contentStyleObj.height = this.$myFun.getTreehHeight();\n    },\n    handleCreate: function handleCreate() {\n      var _this4 = this;\n\n      //新增弹窗调用\n      if (this.listQuery.parentId || this.listQuery.parentId === 0) {\n        this.resetTemp();\n        this.dialogStatus = 'create';\n        this.valueId = undefined;\n        this.$set(this.temp, 'icons', undefined);\n        this.dialogFormVisible = true;\n        this.temp.parentId = this.listQuery.parentId;\n        this.$nextTick(function () {\n          _this4.$refs['dataForm'].clearValidate();\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择上级菜单',\n          type: 'warning'\n        });\n      }\n    },\n    handleUpdate: function handleUpdate() {\n      var _this5 = this;\n\n      //更新弹窗调用\n      if (this.selectlistRow && this.selectlistRow.length == 1) {\n        this.temp = this.selectlistRow[0];\n        this.valueId = this.selectlistRow[0].icons;\n        this.dialogStatus = 'update';\n        this.dialogFormVisible = true;\n        this.$nextTick(function () {\n          _this5.$refs['dataForm'].clearValidate();\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    handleFilter: function handleFilter() {\n      //查询\n      this.getList();\n    },\n    handleResource: function handleResource() {\n      var _this6 = this;\n\n      this.listQueryZy.currentPage = 1;\n      selectEndpoints(this.listQueryZy).then(function (response) {\n        _this6.listUnrelation = response.data.list;\n        _this6.total1 = response.data.pages.count;\n      });\n    },\n    createData: function createData() {\n      var _this7 = this;\n\n      //新增\n      this.$refs['dataForm'].validate(function (valid) {\n        if (valid) {\n          addData(_this7.temp).then(function () {\n            _this7.getList();\n\n            _this7.getTree();\n\n            refreshMenu();\n            _this7.dialogFormVisible = false;\n\n            _this7.$message({\n              title: '成功',\n              message: '创建成功',\n              type: 'success',\n              duration: 2000\n            });\n          });\n        }\n      });\n    },\n    updateData: function updateData() {\n      var _this8 = this;\n\n      //更新\n      this.$refs['dataForm'].validate(function (valid) {\n        if (valid) {\n          // const tempData = Object.assign({}, this.temp)\n          // tempData.timestamp = +new Date(tempData.timestamp) // change Thu Nov 30 2017 16:41:05 GMT+0800 (CST) to 1512031311464\n          renewData(_this8.temp.catalogCode, _this8.temp).then(function () {\n            _this8.getList();\n\n            _this8.getTree();\n\n            _this8.dialogFormVisible = false;\n\n            _this8.$message({\n              title: '成功',\n              message: '更新成功',\n              type: 'success',\n              duration: 2000\n            });\n\n            refreshMenu(); // this.$router.go(0)\n          });\n        }\n      });\n    },\n    handleDelete: function handleDelete() {\n      var _this9 = this;\n\n      //删除\n      if (this.selectlistRow && this.selectlistRow.length == 1) {\n        this.$confirm('此操作将删除所选中数据, 是否继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          deleteData(_this9.selectlistRow[0].catalogCode).then(function () {\n            _this9.getList();\n          });\n\n          _this9.getTree();\n\n          refreshMenu();\n\n          _this9.$message({\n            type: 'success',\n            message: '删除成功!'\n          });\n        }).catch(function () {\n          _this9.$message({\n            type: 'info',\n            message: '已取消删除'\n          });\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    getListRelation: function getListRelation() {\n      var _this10 = this;\n\n      //查询关联的数据\n      this.listQuery2.catalogCode = this.selectlistRow[0].catalogCode;\n      selectEndpoints(this.listQuery2).then(function (response) {\n        _this10.listRelation = response.data.list;\n        _this10.total2 = response.data.pages.count;\n      });\n    },\n    getListUnelation: function getListUnelation() {\n      var _this11 = this;\n\n      //查询未关联资源列表\n      selectEndpoints(this.listQueryZy).then(function (response) {\n        _this11.listUnrelation = response.data.list;\n        _this11.total1 = response.data.pages.count;\n      });\n    },\n    handleAdd: function handleAdd() {\n      //资源关联弹窗\n      if (this.selectlistRow && this.selectlistRow.length == 1) {\n        this.dialogFormUser = true;\n\n        if (this.activeName2 == 'second') {\n          this.getListRelation();\n          this.activeName2 = 'first';\n        }\n\n        this.getListUnelation();\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    authority: function authority() {\n      var _this12 = this;\n\n      //授权\n      var fun = 'SAVE';\n\n      if (this.selectlistRowUser && this.selectlistRowUser.length > 0) {\n        var endpointCodes = [];\n\n        for (var index = 0; index < this.selectlistRowUser.length; index++) {\n          endpointCodes[index] = this.selectlistRowUser[index].endpointCode;\n        }\n\n        addRelation(this.selectlistRow[0].catalogCode, endpointCodes, fun).then(function () {\n          // this.getListUnelation()\n          _this12.$message({\n            title: '成功',\n            message: '授权成功',\n            type: 'success',\n            duration: 2000\n          });\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    //全部授权\n    authorityAll: function authorityAll() {\n      var _this13 = this;\n\n      var fun = 'SAVE';\n      var a = {\n        currentPage: 1,\n        pageSize: 3000,\n        page: true\n      };\n      selectEndpoints(a).then(function (response) {\n        _this13.allCodes = response.data.list.map(function (v) {\n          return v.endpointCode;\n        });\n      });\n      addRelation(this.selectlistRow[0].catalogCode, this.allCodes, fun).then(function () {\n        // this.getListUnelation()\n        _this13.$message({\n          title: '成功',\n          message: '全部授权成功',\n          type: 'success',\n          duration: 2000\n        });\n      });\n    },\n    unauthority: function unauthority() {\n      var _this14 = this;\n\n      //取消授权\n      var fun = 'REMOVE';\n\n      if (this.selectlistRowUser && this.selectlistRowUser.length > 0) {\n        var endpointCodes = [];\n\n        for (var index = 0; index < this.selectlistRowUser.length; index++) {\n          endpointCodes[index] = this.selectlistRowUser[index].endpointCode;\n        }\n\n        addRelation(this.selectlistRow[0].catalogCode, endpointCodes, fun).then(function () {\n          _this14.getListRelation();\n\n          _this14.$message({\n            title: '成功',\n            message: '取消授权成功',\n            type: 'success',\n            duration: 2000\n          });\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    // 获取表格选中时的数据\n    selectRow: function selectRow(val) {\n      if (val.length > 1) {\n        this.$refs.tb_a.clearSelection(); //清除其他行的选中\n\n        this.$refs.tb_a.toggleRowSelection(val[val.length - 1], 'selected'); //单击行绑定点击事件\n      } else if (val.length === 1) {\n        this.selectlistRow = val;\n      }\n    },\n    rowClick: function rowClick(val) {\n      this.$refs.tb_a.clearSelection(); //清除其他行的选中\n\n      this.$refs.tb_a.toggleRowSelection(val); //单击行绑定点击事件\n    },\n    selectRowUser: function selectRowUser(val) {\n      this.selectlistRowUser = val;\n    },\n    selectRowUser1: function selectRowUser1(val) {\n      this.selectlistRowUser1 = val;\n    },\n    handleNodeClick: function handleNodeClick(data) {\n      //点击树查询\n      this.listQuery.parentId = data.rowId;\n      this.getList();\n    },\n    //按钮权限添加\n    handleBtnAuthority: function handleBtnAuthority() {\n      this.btnAuthorityDialog = true;\n    }\n  }\n};",null]}