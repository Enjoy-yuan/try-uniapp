{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/contractManage/contractTemplate/contractEstablishment/content/contentB.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/contractManage/contractTemplate/contractEstablishment/content/contentB.vue","mtime":1596610933605},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.replace\";\nimport _toConsumableArray from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from \"@/api/project/srm/contractManage/contractEstablishment\";\nimport { DICT_CODE } from '@/utils/constant';\nimport caiGou from '@/components/Select/xtpt/caigou'; //下拉组件\n\nimport dialogGysxz from '@/components/Dialog/dialogsGysxz'; //供应商选择\n\nimport { mapState } from \"vuex\";\nimport pageSignA from \"../dialog/pageSignA\";\nimport pageSignB from \"../dialog/pageSignB\";\nimport pageSignC from \"../dialog/pageSignC\";\nimport pageSignD from \"../dialog/pageSignD\";\nimport addItem from \"../dialog/addItem\";\nimport templateSelect from \"../dialog/templateSelect\";\nimport partsList from '@/components/Dialog/partsList';\nexport default {\n  components: {\n    caiGou: caiGou,\n    dialogGysxz: dialogGysxz,\n    pageSignA: pageSignA,\n    pageSignB: pageSignB,\n    pageSignC: pageSignC,\n    pageSignD: pageSignD,\n    templateSelect: templateSelect,\n    addItem: addItem,\n    partsList: partsList\n  },\n  data: function data() {\n    return {\n      dataStatus: null,\n      editIndex: null,\n      DICT_CODE: DICT_CODE,\n      tabName: 'pageSignA',\n      temp: {\n        insideContractNo: undefined,\n        contractName: undefined,\n        orgCode: undefined,\n        outsideContractNo: undefined,\n        validTimeStart: undefined,\n        validTimeEnd: undefined,\n        contractType: undefined,\n        contractCategory: undefined,\n        contractAttribute: undefined,\n        years: undefined,\n        templateVersion: undefined,\n        description: undefined,\n        supplierCode: undefined,\n        supplierName: undefined\n      },\n      dialogStatus: '',\n      dialogVisibleItem: false,\n      status: '',\n      parentId: null,\n      rules: {\n        contractName: [{\n          required: true,\n          message: '合同名称不能为空',\n          trigger: 'blur'\n        }],\n        validTimeStart: [{\n          required: true,\n          message: '价格生效时间不能为空',\n          trigger: 'blur'\n        }],\n        validTimeEnd: [{\n          required: true,\n          message: '价格失效时间不能为空',\n          trigger: 'blur'\n        }],\n        supplierCode: [{\n          required: true,\n          message: '供应商编码不能为空',\n          trigger: 'blur'\n        }],\n        outsideContractNo: [{\n          required: true,\n          message: '合同编号不能为空',\n          trigger: 'blur'\n        }],\n        contractType: [{\n          required: true,\n          message: '合同类型不能为空',\n          trigger: 'blur'\n        }],\n        contractCategory: [{\n          required: true,\n          message: '合同类别不能为空',\n          trigger: 'blur'\n        }],\n        contractAttribute: [{\n          required: true,\n          message: '合同属性不能为空',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  computed: _objectSpread({}, mapState({\n    dt_srm_pdv: function dt_srm_pdv(state) {\n      return state.dict.dt_srm_pdv;\n    },\n    dt_srm_pdw: function dt_srm_pdw(state) {\n      return state.dict.dt_srm_pdw;\n    },\n    dt_srm_pdx: function dt_srm_pdx(state) {\n      return state.dict.dt_srm_pdx;\n    },\n    dt_srm_p0: function dt_srm_p0(state) {\n      return state.dict.dt_srm_p0;\n    },\n    dt_srm_pc9: function dt_srm_pc9(state) {\n      return state.dict.dt_srm_pc9;\n    }\n  })),\n  mounted: function mounted() {\n    this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pdv\", 'dt_srm_pdw', 'dt_srm_pdx', 'dt_srm_p0', 'dt_srm_pc9']);\n  },\n  methods: {\n    handleClose: function handleClose() {\n      this.$emit('changeState', 'contentA');\n    },\n    //获取采购组织名称\n    selectName: function selectName(val) {\n      this.temp.orgName = val;\n    },\n    initForm: function initForm(val, row) {\n      console.log(val, row);\n      this.dataStatus = val; //新增编辑状态\n\n      this.$refs['dataForm'].resetFields();\n      this.$refs['dataForm'].clearValidate();\n\n      if (val === 'update') {\n        this.temp = _objectSpread({}, row);\n        this.$refs.pageSignA.list = row.contractMaterielDTOS;\n        var listOne = [];\n        var listTwo = [];\n        var listThree = [];\n        row.contractItemDTOS.forEach(function (v) {\n          if (v.itemType == 'contract') {\n            listOne.push(v);\n          } else if (v.itemType == 'nomal') {\n            listTwo.push(v);\n          } else {\n            listThree.push(v);\n          }\n        });\n        this.$refs.pageSignB.list = listOne;\n        this.$refs.pageSignC.list = listTwo;\n        this.$refs.pageSignD.list = listThree;\n      } else if (val === 'create') {\n        this.$refs.pageSignA.list = [];\n        this.$refs.pageSignB.list = [];\n        this.$refs.pageSignC.list = [];\n        this.$refs.pageSignD.list = [];\n      }\n    },\n    //保存按钮单击事件\n    handleSave: function handleSave() {\n      var _this = this;\n\n      this.$refs.dataForm.validate(function (valid) {\n        if (valid) {\n          if (_this.dataStatus == 'create') {\n            var limitState = _this.$refs.pageSignA.list.every(function (v) {\n              return v.quantity;\n            });\n\n            if (limitState) {\n              var dto = {\n                contractItemDTOS: [],\n                contractMaterielDTOS: _this.$refs.pageSignA.list,\n                contractAttribute: _this.temp.contractAttribute,\n                contractCategory: _this.temp.contractCategory,\n                contractName: _this.temp.contractName,\n                contractType: _this.temp.contractType,\n                description: _this.temp.description,\n                orgCode: _this.temp.orgCode,\n                orgName: _this.temp.orgName,\n                outsideContractNo: _this.temp.outsideContractNo,\n                supplierCode: _this.temp.supplierCode,\n                supplierName: _this.temp.supplierName,\n                templateVersion: _this.temp.templateVersion,\n                validTimeEnd: _this.temp.validTimeEnd,\n                validTimeStart: _this.temp.validTimeStart,\n                years: _this.temp.years\n              };\n              console.log(_this.$refs.pageSignB.list, 'this.$refs.pageSignB.list');\n\n              _this.$refs.pageSignB.list.forEach(function (v) {\n                dto.contractItemDTOS.push(v);\n              });\n\n              _this.$refs.pageSignC.list.forEach(function (v) {\n                dto.contractItemDTOS.push(v);\n              });\n\n              _this.$refs.pageSignD.list.forEach(function (v) {\n                dto.contractItemDTOS.push(v);\n              });\n\n              console.log(dto, 'dto');\n              api.addRecord(dto).then(function () {\n                _this.$message({\n                  title: '成功',\n                  message: '新增成功',\n                  type: 'success',\n                  duration: 2000\n                });\n\n                _this.$emit('changeState', 'contentA');\n\n                _this.$emit('refresh');\n              });\n            } else {\n              _this.$message({\n                title: \"警告\",\n                message: \"请填写数量\",\n                type: \"warning\"\n              });\n            }\n          } else {\n            var _limitState = _this.$refs.pageSignA.list.every(function (v) {\n              return v.quantity;\n            });\n\n            if (_limitState) {\n              var _dto = {\n                contractItemDTOS: [],\n                contractMaterielDTOS: _this.$refs.pageSignA.list,\n                contractAttribute: _this.temp.contractAttribute,\n                contractCategory: _this.temp.contractCategory,\n                contractName: _this.temp.contractName,\n                contractType: _this.temp.contractType,\n                description: _this.temp.description,\n                orgCode: _this.temp.orgCode,\n                orgName: _this.temp.orgName,\n                outsideContractNo: _this.temp.outsideContractNo,\n                supplierCode: _this.temp.supplierCode,\n                supplierName: _this.temp.supplierName,\n                templateVersion: _this.temp.templateVersion,\n                validTimeEnd: _this.temp.validTimeEnd,\n                validTimeStart: _this.temp.validTimeStart,\n                years: _this.temp.years\n              };\n\n              _this.$refs.pageSignB.list.forEach(function (v) {\n                _dto.contractItemDTOS.push(v);\n              });\n\n              _this.$refs.pageSignC.list.forEach(function (v) {\n                _dto.contractItemDTOS.push(v);\n              });\n\n              _this.$refs.pageSignD.list.forEach(function (v) {\n                _dto.contractItemDTOS.push(v);\n              });\n\n              api.updateRecord(_this.temp.rowId, _dto).then(function () {\n                _this.$message({\n                  title: '成功',\n                  message: '编辑成功',\n                  type: 'success',\n                  duration: 2000\n                });\n\n                _this.$emit('changeState', 'contentA');\n\n                _this.$emit('refresh');\n              });\n            } else {\n              _this.$message({\n                title: \"警告\",\n                message: \"请填写数量\",\n                type: \"warning\"\n              });\n            }\n          }\n        } else {\n          return false;\n        }\n      });\n    },\n    //供应商\n    showGys: function showGys() {\n      this.$refs.refGys.dialogVisible = true;\n      this.$refs.refGys.getList();\n    },\n    //供应商确定\n    handleGysClick: function handleGysClick(val) {\n      this.$set(this.temp, 'supplierCode', val[0].supplierCode);\n      this.$set(this.temp, 'supplierName', val[0].supplierName);\n    },\n    //模板\n    showTemplate: function showTemplate() {\n      this.$refs.templateSelect.dialogVisible = true;\n    },\n    //模板确定\n    handeTemplate: function handeTemplate(val) {\n      // this.temp.template = val.versionNo\n      this.parentId = val.rowId;\n      this.$set(this.temp, 'templateVersion', val.versionNo);\n      this.$nextTick(function () {\n        this.$refs.pageSignB.getListData(val);\n        this.$refs.pageSignC.getListData(val);\n        this.$refs.pageSignD.getListData(val);\n      });\n    },\n    handleConfirm: function handleConfirm(val) {\n      var _this2 = this;\n\n      var options = [this.dt_srm_pc9];\n      val = this.$myFun.codeToName(val, options, ['priceType']);\n      this.$nextTick(function () {\n        _this2.$refs.pageSignA.list = JSON.parse(JSON.stringify(val));\n      });\n    },\n    //合同明细新增\n    contractItem: function contractItem(val, dataList) {\n      var _this3 = this;\n\n      if (this.temp.orgCode && this.temp.supplierCode && this.temp.validTimeStart && this.temp.validTimeEnd) {\n        this.$refs.partsList.dialogVisible = true;\n        this.$nextTick(function () {\n          _this3.$refs.partsList.listSelected = _toConsumableArray(dataList);\n\n          _this3.$refs.partsList.getList();\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请先选择组织,供应商,有效开始,有效结束\",\n          type: \"warning\"\n        });\n      }\n    },\n    //合同条款，一般性条款新增\n    createA: function createA(val) {\n      var _this4 = this;\n\n      this.status = val;\n      setTimeout(function () {\n        if (_this4.status != 'pageSignD') {\n          _this4.$refs.addItem.show = false;\n        } else {\n          _this4.$refs.addItem.show = true;\n        }\n      }, 1.5 * 100);\n      setTimeout(function () {\n        _this4.$refs.addItem.resetTemp();\n      }, 1.5 * 100);\n      this.dialogStatus = 'create';\n      this.dialogVisibleItem = true;\n    },\n    //合同条款，一般性条款新增确定\n    createDataItem: function createDataItem() {\n      if (this.status === 'pageSignB') {\n        var dto = {\n          content: this.removeTAG(this.$refs.addItem.temp.content),\n          orderNo: this.$refs.addItem.temp.orderNo,\n          itemType: 'contract',\n          project: '',\n          parentId: 1 // api.addRecordItem(this.parentId, dto).then(() => {\n          //     this.$message({\n          //         title: '成功',\n          //         message: '新增成功',\n          //         type: 'success',\n          //         duration: 2000\n          //     })\n\n        };\n        this.$refs.pageSignB.list.push(dto); // this.$set(this.$refs.pageSignB.list, this.editIndex, this.$refs.pageSignB.list[this.editIndex])\n\n        this.dialogVisibleItem = false; //     this.$refs.pageSignB.getList()\n        // })\n      } else if (this.status === 'pageSignC') {\n        var _dto2 = {\n          content: this.removeTAG(this.$refs.addItem.temp.content),\n          orderNo: this.$refs.addItem.temp.orderNo,\n          itemType: 'nomal',\n          project: '',\n          parentId: 1 // api.addRecordItem(this.parentId, dto).then(() => {\n          //     this.$message({\n          //         title: '成功',\n          //         message: '新增成功',\n          //         type: 'success',\n          //         duration: 2000\n          //     })\n\n        };\n        this.$refs.pageSignC.list.push(_dto2);\n        this.dialogVisibleItem = false; //     this.$refs.pageSignC.getList()\n        // })\n      }\n    },\n    //合同条款，一般性条款，其他事项编辑\n    updateA: function updateA(val, row, index) {\n      var _this5 = this;\n\n      this.status = val;\n      this.dialogStatus = 'update';\n      this.dialogVisibleItem = true;\n      setTimeout(function () {\n        if (_this5.status != 'pageSignD') {\n          _this5.$refs.addItem.show = false;\n        } else {\n          _this5.$refs.addItem.show = true;\n        }\n\n        _this5.$refs.addItem.temp = _objectSpread({}, row);\n        _this5.editIndex = index;\n        console.log(_this5.editIndex, ' this.editIndex');\n      }, 1.5 * 100);\n    },\n    //过滤标签\n    removeTAG: function removeTAG(str) {\n      return str.replace(/<[^>]+>/g, \"\");\n    },\n    //合同条款，一般性条款，其他事项编辑确定\n    updateDataItem: function updateDataItem() {\n      if (this.status === 'pageSignB') {\n        var dto = {\n          content: this.removeTAG(this.$refs.addItem.temp.content),\n          orderNo: this.$refs.addItem.temp.orderNo,\n          itemType: 'contract',\n          parentId: this.parentId,\n          project: ''\n        };\n        this.$refs.pageSignB.list[this.editIndex] = dto;\n        this.$set(this.$refs.pageSignB.list, this.editIndex, this.$refs.pageSignB.list[this.editIndex]); // this.$set(this.$refs.pageSignB.list, this.editIndex, this.$refs.pageSignB.list[this.editIndex])\n        // api.updateRecordItem(this.$refs.addItem.temp.rowId, dto).then(() => {\n        //     this.$message({\n        //         title: '成功',\n        //         message: '编辑成功',\n        //         type: 'success',\n        //         duration: 2000\n        //     })\n\n        this.dialogVisibleItem = false; // this.$refs.pageSignB.getList()\n        // })\n      } else if (this.status === 'pageSignC') {\n        var _dto3 = {\n          content: this.removeTAG(this.$refs.addItem.temp.content),\n          orderNo: this.$refs.addItem.temp.orderNo,\n          itemType: 'nomal',\n          parentId: this.parentId,\n          project: ''\n        };\n        this.$refs.pageSignC.list[this.editIndex] = _dto3;\n        this.$set(this.$refs.pageSignC.list, this.editIndex, this.$refs.pageSignC.list[this.editIndex]); // api.updateRecordItem(this.$refs.addItem.temp.rowId, dto).then(() => {\n        //     this.$message({\n        //         title: '成功',\n        //         message: '编辑成功',\n        //         type: 'success',\n        //         duration: 2000\n        //     })\n\n        this.dialogVisibleItem = false; //     this.$refs.pageSignC.getList()\n        // })\n      } else if (this.status === 'pageSignD') {\n        var _dto4 = {\n          content: this.removeTAG(this.$refs.addItem.temp.content),\n          orderNo: this.$refs.addItem.temp.orderNo,\n          itemType: 'other',\n          parentId: this.parentId,\n          project: this.$refs.addItem.temp.project,\n          rowId: this.$refs.addItem.temp.rowId\n        };\n        this.$refs.pageSignD.list[this.editIndex] = _dto4;\n        this.$set(this.$refs.pageSignD.list, this.editIndex, this.$refs.pageSignD.list[this.editIndex]);\n        console.log(this.$refs.pageSignD.list[this.editIndex], 'this.$refs.pageSignD.list[this.editIndex]'); // api.updateRecordItem(this.$refs.addItem.temp.rowId, dto).then(() => {\n        //     this.$message({\n        //         title: '成功',\n        //         message: '编辑成功',\n        //         type: 'success',\n        //         duration: 2000\n        //     })\n\n        this.dialogVisibleItem = false; // this.$refs.pageSignD.getList()\n        // })\n      }\n    }\n  }\n};",null]}