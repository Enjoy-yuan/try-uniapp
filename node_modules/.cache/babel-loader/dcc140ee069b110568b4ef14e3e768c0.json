{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/EI/inventoryPlanning/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/EI/inventoryPlanning/index.vue","mtime":1596610933372},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from '@/api/project/eas/el/inventoryPlanning';\nimport Pagination from '@/components/Pagination';\nimport employeesSelect from '@/components/Select/employeesSelect';\nimport eqmtSelect from \"../../../components/eqmtSelect\";\nimport deviceType from \"../../../components/deviceTypeSelect\";\nimport { DT_ORG_TYPE } from '@/utils/constant';\nimport { parseTime } from '@/utils';\nimport caiGou from '@/components/Select/xtpt/caigou'; //下拉组件\n\nimport { mapState } from 'vuex'; // 基本数据引入\n\nexport default {\n  name: 'inventoryPlanning',\n  components: {\n    Pagination: Pagination,\n    // inventoryPlanningSelect,\n    employeesSelect: employeesSelect,\n    deviceType: deviceType,\n    caiGou: caiGou,\n    eqmtSelect: eqmtSelect\n  },\n  data: function data() {\n    return {\n      theight: 0,\n      //表格高度\n      list: [],\n      list2: [],\n      organizations: [],\n      fromList: [],\n      DT_ORG_TYPE: DT_ORG_TYPE,\n      total: 0,\n      tableKey: [0, 1, 2],\n      //表格索引\n      dialogStatus: '',\n      dialogFormVisible: false,\n      fromDialogFormVisible: false,\n      dialogFormVisible2: false,\n      selectedRows: [],\n      //多选时选中的所有行\n      selectFromList: undefined,\n      //从表选中\n      dialogPrintVisible: false,\n      //打印\n      listQuery: {\n        organizationCode: undefined,\n        states: null,\n        startTime: undefined,\n        endTime: undefined,\n        //查询\n        currentPage: 1,\n        pageSize: 15\n      },\n      tmpState: null,\n      temp: {\n        deviceCodes: [],\n        contents: [],\n        checkName: undefined,\n        timeRange: undefined,\n        checkPlanTime: undefined,\n        checkPlanEndTime: undefined,\n        checker: undefined,\n        checkerName: undefined,\n        dept: undefined,\n        deptName: undefined,\n        deviceType: undefined,\n        remark: undefined,\n        organizationCode: undefined,\n        organizationName: undefined\n      },\n      // 盘点人model\n      tempVal: {\n        employeeName: undefined\n      },\n      tempFrom: {\n        assembleLine: undefined,\n        assembleQuantity: undefined,\n        bomId: undefined,\n        endTime: undefined,\n        manufactureLine: undefined,\n        materielCode: undefined,\n        startTime: undefined,\n        workStationCode: undefined,\n        timeRange: undefined\n      },\n      rules: {\n        checkName: [{\n          required: true,\n          message: this.$t('validate.required'),\n          trigger: 'blur'\n        }],\n        timeRange: [{\n          required: true,\n          message: this.$t('validate.required'),\n          trigger: 'blur'\n        }],\n        checker: [{\n          required: true,\n          message: this.$t('validate.required'),\n          trigger: 'blur'\n        }],\n        contents: [{\n          required: true,\n          message: this.$t('validate.required'),\n          trigger: 'blur'\n        }],\n        dept: [{\n          required: true,\n          message: this.$t('validate.required'),\n          trigger: 'blur'\n        }],\n        organizationCode: [{\n          required: true,\n          message: this.$t('validate.required'),\n          trigger: 'blur'\n        }]\n      },\n      formRules: {\n        materielCode: [{\n          required: true,\n          message: this.$t('validate.required'),\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created: function created() {\n    this.getList();\n    this.getOrganization();\n  },\n  computed: _objectSpread({}, mapState({\n    dt_check_plan_state: function dt_check_plan_state(state) {\n      return state.eamDict.dt_check_plan_state;\n    },\n    dt_check_content: function dt_check_content(state) {\n      return state.eamDict.dt_check_content;\n    },\n    dt_device_category: function dt_device_category(state) {\n      return state.eamDict.dt_device_category;\n    },\n    dt_yes_or_no: function dt_yes_or_no(state) {\n      return state.eamDict.dt_yes_or_no;\n    }\n  })),\n  watch: {\n    // 监听时间区间数组 写入到对应字段\n    'listQuery.timeRange': function listQueryTimeRange(value) {\n      if (value) {\n        this.listQuery.startTime = value[0];\n        this.listQuery.endTime = value[1];\n      } else {\n        this.listQuery.startTime = undefined;\n        this.listQuery.endTime = undefined;\n      }\n    },\n    'temp.timeRange': function tempTimeRange(value) {\n      if (!value) {\n        this.temp.checkPlanTime = undefined;\n        this.temp.checkPlanEndTime = undefined;\n        return false;\n      }\n\n      this.temp.checkPlanTime = value[0];\n      this.temp.checkPlanEndTime = value[1];\n    },\n    'temp.dept': function tempDept(val) {\n      var _this = this;\n\n      this.organizations.forEach(function (item) {\n        if (item.organizationCode == val) {\n          _this.temp.deptName = item.organizationName;\n        }\n      });\n    },\n    dt_check_plan_state: function dt_check_plan_state() {\n      if (this.list) {\n        var options = [this.dt_check_plan_state];\n        this.list = this.$myFun.srmCodeToName(this.list, options, ['state']);\n      }\n    },\n    tmpState: function tmpState(val) {\n      if (val) {\n        this.listQuery.states = val.join(',');\n      } else {\n        this.listQuery.states = undefined;\n      }\n    }\n  },\n  mounted: function mounted() {\n    var _this2 = this;\n\n    this.$store.dispatch('eamDict/getDicData', ['dt_check_plan_state', 'dt_check_content', 'dt_device_category', 'dt_yes_or_no']);\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this2.setTableHeight();\n    };\n  },\n  methods: {\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight() - 185;\n    },\n    //打开条码打印弹窗\n    handleBarcode: function handleBarcode() {\n      if (this.selectedRows.length == 1) {\n        this.dialogStatus = \"print\";\n        this.dialogPrintVisible = true;\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条数据',\n          type: 'warning'\n        });\n        return;\n      }\n    },\n    //打印执行\n    doReceiptPrint: function doReceiptPrint() {\n      this.$print(this.$refs.print);\n    },\n    getList: function getList() {\n      var _this3 = this;\n\n      //获取表格数据\n      api.queryRecord(this.listQuery).then(function (res) {\n        _this3.list = res.data.list;\n\n        if (_this3.dt_check_plan_state) {\n          var options = [_this3.dt_check_plan_state];\n          _this3.list = _this3.$myFun.srmCodeToName(_this3.list, options, ['state']);\n        }\n\n        _this3.total = res.data.pages.count;\n      });\n    },\n    getList2: function getList2() {\n      var _this4 = this;\n\n      //获取子表格数据\n      api.queryRecord2(this.selectedRows[0].checkOrderNumber, this.listQuery2).then(function (res) {\n        _this4.list2 = res.data;\n        _this4.fromList = res.data.checkDetail;\n        var options = [_this4.dt_check_plan_state, _this4.dt_yes_or_no];\n        _this4.fromList = _this4.$myFun.srmCodeToName(res.data.checkDetail, options, ['state', 'ifUpdate']);\n      });\n    },\n    getOrganization: function getOrganization() {\n      var _this5 = this;\n\n      //获取表格数据\n      api.organizations().then(function (res) {\n        _this5.organizations = res.data;\n      });\n    },\n    resetTemp: function resetTemp() {\n      this.temp = {\n        deviceCodes: [],\n        contents: [],\n        checkName: undefined,\n        timeRange: undefined,\n        checkPlanTime: undefined,\n        checkPlanEndTime: undefined,\n        checker: undefined,\n        checkerName: undefined,\n        dept: undefined,\n        deptName: undefined,\n        deviceType: undefined,\n        remark: undefined,\n        organizationCode: undefined,\n        organizationName: undefined\n      };\n      this.tempVal = {\n        employeeName: undefined\n      };\n    },\n    handleQuery: function handleQuery() {\n      //表格查询\n      this.listQuery.currentPage = 1;\n      this.getList();\n      this.fromList = [];\n    },\n    handleCreate: function handleCreate() {\n      var _this6 = this;\n\n      //新增按钮单击事件方法\n      this.resetTemp();\n      this.dialogStatus = 'create';\n      this.dialogFormVisible = true; // this.temp.deviceCode = []\n\n      setTimeout(function () {\n        _this6.$refs.deviceType.valueTitle = '';\n      }, 0);\n    },\n    //员工弹窗\n    handleChecker: function handleChecker() {\n      this.dialogFormVisible2 = true;\n    },\n    // 接收员工组件传值\n    getEmployee: function getEmployee(val) {\n      this.tempVal = val;\n    },\n    getDeviceType: function getDeviceType(val) {\n      if (val) {\n        this.temp.deviceType = val.typeCode;\n        this.temp.deviceCodes = [];\n      } else {\n        this.temp.deviceType = undefined;\n      }\n    },\n    handleOrganization: function handleOrganization(val) {\n      this.temp.organizationName = val;\n    },\n    // 接口对象赋值\n    handleEmployee: function handleEmployee() {\n      // if (this.tempVal.length) {\n      //     this.temp.checker = this.tempVal[\n      //         this.tempVal.length - 1\n      //     ].employeeCode\n      //     this.temp.checkerName = this.tempVal[\n      //         this.tempVal.length - 1\n      //     ].employeeName\n      // }\n      this.temp.checker = this.tempVal.employeeCode;\n      this.temp.checkerName = this.tempVal.employeeName;\n      this.dialogFormVisible2 = false;\n    },\n    create: function create() {\n      var _this7 = this;\n\n      //编辑确认\n      this.$refs['temp'].validate(function (valid) {\n        if (valid) {\n          if (!_this7.temp.deviceCodes.length) {\n            _this7.$message({\n              title: '警告',\n              message: '请添加设备',\n              type: 'warning'\n            });\n          } else {\n            var tmp = [];\n\n            _this7.temp.deviceCodes.forEach(function (item) {\n              tmp.push(item.deviceCode);\n            });\n\n            _this7.temp.deviceCodes = tmp;\n            api.createRecord(_this7.temp).then(function (res) {\n              if (res.status == 201) {\n                _this7.getList();\n\n                _this7.$message({\n                  title: '成功',\n                  message: '新增成功',\n                  type: 'success',\n                  duration: 2000\n                });\n\n                _this7.dialogFormVisible = false;\n              }\n            });\n          }\n        }\n      });\n    },\n    handleUpdate: function handleUpdate() {\n      var _this8 = this;\n\n      if (this.selectedRows.length != 1) {\n        this.$message({\n          title: '警告',\n          message: '请选择一条记录',\n          type: 'warning'\n        });\n        return false;\n      }\n\n      if (this.selectedRows[0].state == 'cps30') {\n        this.$message({\n          title: '警告',\n          message: '该计划已完成',\n          type: 'warning'\n        });\n        return false;\n      } //修改按钮单击事件方法\n\n\n      this.resetTemp();\n      this.dialogStatus = 'update';\n      this.dialogFormVisible = true; // 把selectedRows合并到temp,数据写入到表单\n\n      Object.assign(this.temp, this.selectedRows[0]);\n      this.tempVal.employeeName = this.selectedRows[0].checkerName;\n      this.temp.deviceCodes = this.list2.checkDetail;\n      this.temp.timeRange = [this.temp.checkPlanTime, this.temp.checkPlanEndTime];\n      setTimeout(function () {\n        var tmp = [];\n\n        _this8.list2.contents.forEach(function (item) {\n          tmp.push(item.content);\n        });\n\n        _this8.temp.contents = tmp;\n      }, 0);\n    },\n    update: function update() {\n      var _this9 = this;\n\n      //编辑确认\n      this.$refs['temp'].validate(function (valid) {\n        if (valid) {\n          if (!_this9.temp.deviceCodes.length) {\n            _this9.$message({\n              title: '警告',\n              message: '请添加设备',\n              type: 'warning'\n            });\n          } else {\n            var tmp = [];\n\n            _this9.temp.deviceCodes.forEach(function (item) {\n              tmp.push(item.deviceCode);\n            });\n\n            _this9.temp.deviceCodes = tmp;\n            api.patchRecord(_this9.temp).then(function (res) {\n              if (res.status == 201) {\n                _this9.getList();\n\n                _this9.$message({\n                  title: '成功',\n                  message: '修改成功',\n                  type: 'success',\n                  duration: 2000\n                });\n\n                _this9.dialogFormVisible = false;\n                _this9.selectedRows = [];\n                _this9.fromList = [];\n              }\n            });\n          }\n        }\n      });\n    },\n    handleDelete: function handleDelete() {\n      var _this10 = this;\n\n      if (this.selectedRows.length !== 0) {\n        this.$confirm('确认要删除该数据项吗?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          var tmp = [];\n\n          _this10.selectedRows.forEach(function (item) {\n            tmp.push(item.checkOrderNumber);\n          });\n\n          api.deleteRecord(tmp).then(function (res) {\n            if (res.status == 200) {\n              _this10.getList();\n\n              _this10.$message({\n                type: 'success',\n                message: '删除成功'\n              });\n\n              _this10.selectedRows = [];\n              _this10.fromList = [];\n            }\n          });\n        }).catch(function () {\n          _this10.$message({\n            type: 'info',\n            message: '已取消'\n          });\n        });\n      } else {\n        this.$message.warning('请勾选记录！');\n        return;\n      }\n    },\n    handlePublish: function handlePublish() {\n      var _this11 = this;\n\n      if (this.selectedRows.length !== 0) {\n        this.$confirm('确认要发布所有已选项吗?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          var tmp = [];\n\n          _this11.selectedRows.forEach(function (item) {\n            tmp.push(item.checkOrderNumber);\n          });\n\n          api.issueRecord({\n            checkOrderNumbers: tmp\n          }).then(function (res) {\n            if (res.status == 200) {\n              _this11.getList();\n\n              _this11.$message({\n                type: 'success',\n                message: '发布成功'\n              });\n\n              _this11.selectedRows = [];\n              _this11.fromList = [];\n            }\n          });\n        }).catch(function () {\n          _this11.$message({\n            type: 'info',\n            message: '已取消'\n          });\n        });\n      } else {\n        this.$message.warning('请勾选记录！');\n        return;\n      }\n    },\n    //打开工位弹窗\n    handleWorkStationCode: function handleWorkStationCode() {\n      this.workStationDialogVisible = true;\n    },\n    //工位父子传值\n    handleDblclickWorkStation: function handleDblclickWorkStation(row) {\n      this.workStationClass = row;\n    },\n    //获取工位\n    workStationUpdate: function workStationUpdate() {\n      if (this.workStationClass) {\n        this.temp.workStationCode = this.workStationClass.stationCode;\n        this.workStationDialogVisible = false;\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    handleClose: function handleClose() {\n      this.resetTemp();\n      this.$refs.temp.resetFields();\n      this.getList();\n    },\n    handleClose2: function handleClose2() {\n      this.dialogFormVisible2 = false;\n    },\n    resetFromTemp: function resetFromTemp() {\n      this.tempFrom = {\n        assembleLine: undefined,\n        assembleQuantity: undefined,\n        bomId: undefined,\n        endTime: undefined,\n        manufactureLine: undefined,\n        materielCode: undefined,\n        startTime: undefined,\n        workStationCode: undefined,\n        timeRange: undefined\n      };\n    },\n    //从表选择框选中\n    selectFromChange: function selectFromChange(val) {\n      this.selectFromList = val;\n\n      if (val.length > 1) {\n        this.$refs.tb2.clearSelection();\n        this.$refs.tb2.toggleRowSelection(val[val.length - 1]);\n      }\n\n      this.$refs.tb2.setCurrentRow(this.selectFromList[0]);\n    },\n    handleCreateFrom: function handleCreateFrom() {\n      var _this12 = this;\n\n      if (!this.temp.deviceType) {\n        this.$message({\n          title: '警告',\n          message: '请先选择设备类型',\n          type: 'warning'\n        });\n        return false;\n      }\n\n      this.resetFromTemp();\n      this.fromDialogFormVisible = true;\n      setTimeout(function () {\n        _this12.$refs.eqmtSelect.listQuery.typeCode = _this12.temp.deviceType;\n        _this12.$refs.eqmtSelect.$refs.deviceType.valueTitle = _this12.$refs.deviceType.valueTitle;\n\n        _this12.$refs.eqmtSelect.getList();\n      }, 0);\n    },\n    confirmDevice: function confirmDevice() {\n      this.temp.deviceCodes = this.temp.deviceCodes.concat(this.$refs.eqmtSelect.currentSelect);\n      this.fromDialogFormVisible = false;\n    },\n    cancelDevice: function cancelDevice() {\n      this.$refs.eqmtSelect.listQuery.page = 1;\n      this.$refs.eqmtSelect.currentSelect = [];\n      this.fromDialogFormVisible = false;\n    },\n    handleDeleteFrom: function handleDeleteFrom() {\n      var _this13 = this;\n\n      if (this.selectFromList.length == 0) {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n        return false;\n      }\n\n      this.temp.deviceCodes.forEach(function (item, index) {\n        if (item.deviceCode == _this13.selectFromList[0].deviceCode) {\n          _this13.temp.deviceCodes.splice(index, 1);\n\n          _this13.$forceUpdate();\n        }\n      });\n    },\n    rowClickFrom: function rowClickFrom(val) {\n      this.$refs.tb2.toggleRowSelection(val, 'selected'); //单击行绑定点击事件\n    },\n    // 获取表格选中时的数据\n    selectRow: function selectRow(val) {\n      this.$refs.tb.toggleRowSelection(val, 'selected');\n    },\n    rowClick: function rowClick(val) {\n      this.selectedRows = val;\n\n      if (val.length == 0) {\n        this.selectedRows = []; // this.list2 = []\n\n        return false;\n      }\n\n      if (val.length > 1) {\n        this.$refs.tb.clearSelection();\n        this.$refs.tb.toggleRowSelection(val[val.length - 1]);\n      }\n\n      this.$refs.tb.setCurrentRow(this.selectedRows[0]);\n\n      if (this.selectedRows.length) {\n        this.getList2();\n      }\n    },\n    // 全选\n    selectAll: function selectAll(val) {\n      var _this14 = this;\n\n      if (val.length == 0) {\n        this.selectedRows = [];\n        this.$refs.tb.clearSelection();\n        return false;\n      }\n\n      val.forEach(function (items, indexv) {\n        var isSelected = false;\n\n        _this14.selectedRows.forEach(function (item) {\n          if (item.checkOrderNumber === items.checkOrderNumber) {\n            isSelected = true;\n          }\n        });\n\n        if (!isSelected) {\n          _this14.selectedRows.push(val[indexv]);\n        }\n      });\n    },\n    handleDownload: function handleDownload() {\n      var _this15 = this;\n\n      this.downloadLoading = true;\n      import('@/vendor/Export2Excel').then(function (excel) {\n        var tHeader = ['状态', '盘点单号', '组织名称', '盘点名称', '计划盘点时间', '盘点人', '设备类型', '未盘数', '备注'];\n        var filterVal = ['stateName', 'checkOrderNumber', 'deptName', 'checkName', 'checkPlanTime', 'checkerName', 'deviceType', 'notCheckQuantity', 'remark'];\n\n        var data = _this15.formatJson(filterVal, _this15.list);\n\n        excel.export_json_to_excel({\n          header: tHeader,\n          data: data,\n          filename: 'table-list'\n        });\n        _this15.downloadLoading = false;\n      });\n    },\n    formatJson: function formatJson(filterVal, jsonData) {\n      return jsonData.map(function (v) {\n        return filterVal.map(function (j) {\n          if (j === 'timestamp') {\n            return parseTime(v[j]);\n          } else {\n            return v[j];\n          }\n        });\n      });\n    }\n  }\n};",null]}