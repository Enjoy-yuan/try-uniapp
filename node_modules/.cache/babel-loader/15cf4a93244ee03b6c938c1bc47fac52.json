{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/instorageProcess/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/instorageProcess/index.vue","mtime":1596610933331},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Pagination from \"@/components/Pagination\";\nimport orgSelect from \"@/components/Select/orgSelect.vue\";\nimport { DT_ORG_TYPE } from \"@/utils/constant\";\nimport { mapState } from \"vuex\";\nimport wlxzbyzsj from '@/components/Select/wlxzbyzsj'; //主数据物料信息模块\n\nimport * as api from \"@/api/data-base/instorageProcess\";\nexport default {\n  name: \"instorageProcess\",\n  components: {\n    Pagination: Pagination,\n    orgSelect: orgSelect,\n    wlxzbyzsj: wlxzbyzsj\n  },\n  data: function data() {\n    return {\n      list: null,\n      listSub: null,\n      total: 0,\n      totalSub: 0,\n      theight: 0,\n      tableKey: [0, 1],\n      //表格索引，虚拟dom渲染表格时使用\n      listQuery: {\n        page: true,\n        currentPage: 1,\n        pageSize: 10,\n        bomType: '',\n        orgCode: '',\n        materielCode: '',\n        state: '',\n        standardNum: ''\n      },\n      listQuerySub: {\n        page: true,\n        currentPage: 1,\n        pageSize: 10\n      },\n      AddMainlist: {\n        bomType: \"\",\n        effDateBegin: \"\",\n        effDateEnd: \"\",\n        materielCode: \"\",\n        materielName: \"\",\n        measuringUnit: \"\",\n        orgCode: \"\",\n        remarks: \"\",\n        specification: \"\",\n        standardNum: '',\n        bomDetailCreateDTOList: []\n      },\n      bomDetailCreateDTOList: [],\n      mdobj: {\n        assemblingNum: 0,\n        detaiType: \"\",\n        dismantlingNum: 0,\n        materielCode: \"\",\n        materielName: \"\",\n        measuringUnit: \"\",\n        routeType: \"\",\n        specification: \"\"\n      },\n      selectRows: [],\n      //主表选中数据\n      dialogStatus: \"\",\n      DT_ORG_TYPE: DT_ORG_TYPE,\n      DialogAddmain: false,\n      //新增弹框\n      wlxzQMDialog: false,\n      //物料选择弹框\n      wlxzAMSDialog: false,\n      wlxzAMDDialog: false,\n      rules: {\n        orgCode: [{\n          required: true,\n          message: '不能为空',\n          trigger: 'blur'\n        }],\n        bomType: [{\n          required: true,\n          message: '请选择',\n          trigger: 'blur'\n        }],\n        materielCode: [{\n          required: true,\n          message: '不能为空',\n          trigger: 'blur'\n        }]\n      },\n      isEdit: false\n    };\n  },\n  computed: _objectSpread({}, mapState({\n    dt_stores_bom_type: function dt_stores_bom_type(state) {\n      return state.dict.dt_stores_bom_type;\n    }\n  })),\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$store.dispatch(\"dict/getDicData\", [\"dt_stores_bom_type\"]);\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this.setTableHeight();\n    };\n  },\n  methods: {\n    getList: function getList() {\n      var _this2 = this;\n\n      //查询主表\n      if (!this.listQuery.orgCode) {\n        this.$message({\n          type: \"warning\",\n          message: \"请选择组织编码\"\n        });\n      } else if (!this.listQuery.bomType) {\n        this.$message({\n          type: \"warning\",\n          message: \"请选择BOM类型\"\n        });\n      } else {\n        api.queryRecords(this.listQuery.orgCode, this.listQuery.bomType, this.listQuery).then(function (res) {\n          _this2.list = res.data.list;\n        });\n      }\n    },\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight() - 185;\n    },\n    //获取从表\n    getSubList: function getSubList(val) {\n      var _this3 = this;\n\n      this.listQuerySub.versions = val.versions;\n      api.queryRecordsDetail(val.versions, this.listQuerySub).then(function (res) {\n        _this3.listSub = res.data.list;\n      });\n    },\n    handleQuery: function handleQuery() {\n      this.listQuery.currentPage = 1;\n      this.getList();\n    },\n    handleCreate: function handleCreate() {\n      //新增\n      this.isEdit = false;\n      this.resetAddList();\n      this.dialogStatus = 0;\n      this.DialogAddmain = true;\n    },\n    handleDelete: function handleDelete() {\n      var _this4 = this;\n\n      //删除\n      if (this.selectRows && this.selectRows.length !== 0) {\n        this.$confirm(\"此操作将永久删除该记录,是否继续?\", \"提示\", {\n          confirmButtonText: \"确定\",\n          cancelButtonText: \"取消\",\n          type: \"warning\"\n        }).then(function () {\n          var bomList = [];\n\n          _this4.selectRows.forEach(function (item) {\n            bomList.push(item.versions);\n          });\n\n          api.deleteRecords(bomList).then(function () {\n            _this4.getList();\n\n            _this4.listSub = [];\n\n            _this4.$message({\n              title: \"成功\",\n              message: \"删除成功\",\n              type: \"success\",\n              duration: 2000\n            });\n          });\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请选择一条信息\",\n          type: \"warning\",\n          duration: 2000\n        });\n      }\n    },\n    //修改\n    handleEdit: function handleEdit() {\n      var _this5 = this;\n\n      if (this.selectRows.length === 1) {\n        this.resetAddList();\n        this.dialogStatus = 1;\n        this.AddMainlist = this.selectRows[0];\n        api.queryRecordsDetail(this.selectRows[0].versions, {}).then(function (res) {\n          _this5.bomDetailCreateDTOList = res.data;\n          _this5.DialogAddmain = true;\n          _this5.isEdit = true;\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请选择一条信息\",\n          type: \"warning\",\n          duration: 2000\n        });\n      }\n    },\n    //发布\n    handlePublish: function handlePublish() {\n      var _this6 = this;\n\n      if (this.selectRows) {\n        this.$confirm(\"此操作将发布所选内容,是否继续?\", \"提示\", {\n          confirmButtonText: \"确定\",\n          cancelButtonText: \"取消\",\n          type: \"warning\"\n        }).then(function () {\n          var bomList = [];\n\n          _this6.selectRows.forEach(function (item) {\n            bomList.push(item.versions);\n          });\n\n          api.publishRecords(bomList).then(function () {\n            _this6.getList();\n\n            _this6.listSub = [];\n\n            _this6.$message({\n              title: \"成功\",\n              message: \"发布成功\",\n              type: \"success\",\n              duration: 2000\n            });\n          });\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请选择一条信息\",\n          type: \"warning\",\n          duration: 2000\n        });\n      }\n    },\n    //查询条件物料选择相关\n    showQMwlxz: function showQMwlxz() {\n      this.wlxzQMDialog = true;\n      this.$nextTick(function () {\n        this.$refs.wlxzQMRef.getList();\n      });\n    },\n    confirmQM: function confirmQM() {\n      //查询条件物料选中中弹窗确认按钮\n      if (this.$refs.wlxzQMRef.listSelected.length > 0) {\n        this.listQuery.materielCode = this.$refs.wlxzQMRef.listSelected[0].materielCode;\n        this.wlxzQMDialog = false;\n      } else {\n        this.listQuery.materielCode = null;\n        this.wlxzQMDialog = false;\n      }\n    },\n    //新增物料选择相关\n    showAMSwlxz: function showAMSwlxz() {\n      this.wlxzAMSDialog = true;\n      this.$nextTick(function () {\n        this.$refs.wlxzAMSRef.getList();\n      });\n    },\n    confirmAMS: function confirmAMS() {\n      //新增物料选中中弹窗确认按钮\n      if (this.$refs.wlxzAMSRef.listSelected.length > 0) {\n        this.AddMainlist.measuringUnit = this.$refs.wlxzAMSRef.listSelected[0].measuringUnit;\n        this.AddMainlist.materielName = this.$refs.wlxzAMSRef.listSelected[0].materielName;\n        this.AddMainlist.materielCode = this.$refs.wlxzAMSRef.listSelected[0].materielCode;\n        this.wlxzAMSDialog = false;\n      } else {\n        this.AddMainlist.measuringUnit = '';\n        this.AddMainlist.materielName = '';\n        this.AddMainlist.materielCode = '';\n        this.wlxzAMSDialog = false;\n      }\n    },\n    //新增物料详情相关\n    confirmAMD: function confirmAMD() {\n      //查询条件物料选中中弹窗确认按钮\n      if (this.$refs.wlxzAMDRef.listSelected.length > 0) {\n        this.bomDetailCreateDTOList = this.$refs.wlxzAMDRef.listSelected;\n        this.$set(this.AddMainlist, 'bomDetailCreateDTOList', this.AddMainlist.bomDetailCreateDTOList);\n        this.wlxzAMDDialog = false;\n      } else {\n        this.bomDetailCreateDTOList = [];\n        this.wlxzAMSDialog = false;\n      }\n    },\n    //新增弹框删除物料\n    deleteMateriel: function deleteMateriel() {\n      var _this7 = this;\n\n      this.selectwlRows.forEach(function (itenw) {\n        _this7.bomDetailCreateDTOList.forEach(function (item, index) {\n          if (itenw.materielCode === item.materielCode) {\n            _this7.bomDetailCreateDTOList.splice(index, 1);\n          }\n        });\n      });\n    },\n    //新增弹框添加物料\n    addMateriel: function addMateriel() {\n      var _this8 = this;\n\n      this.$refs.AddMainlist.validate(function (valid) {\n        if (valid) {\n          _this8.isEdit = true;\n          _this8.wlxzAMDDialog = !_this8.wlxzAMDDialog;\n\n          _this8.$nextTick(function () {\n            this.$refs.wlxzAMDRef.listSelected = this.bomDetailCreateDTOList;\n            this.$refs.wlxzAMDRef.getList();\n          });\n        }\n      });\n    },\n    mainRowClick: function mainRowClick(val) {\n      this.selectRows = val;\n\n      if (val.length !== 0) {\n        this.getSubList(val[val.length - 1]);\n      }\n    },\n    mainSelectChange: function mainSelectChange(val) {\n      this.selectRows = val;\n\n      if (val.length !== 0) {\n        this.getSubList(val[val.length - 1]);\n      }\n    },\n    // addRowClick(val){\n    //     this.selectwlRows = val;\n    //     this.$refs.detailtable.clearSelection()\n    //     this.$refs.detailtable.toggleRowSelection(val,'selected')\n    //     this.getSubList(val);\n    // },\n    addSelectChange: function addSelectChange(val) {\n      this.selectwlRows = val;\n    },\n    updateMainConfirm: function updateMainConfirm() {\n      var _this9 = this;\n\n      this.$refs.AddMainlist.validate(function (valid) {\n        if (valid) {\n          _this9.AddMainlist.bomDetailCreateDTOList = _this9.bomDetailCreateDTOList;\n          api.updateRecords(_this9.AddMainlist).then(function () {\n            _this9.DialogAddmain = false;\n            _this9.listSub = [];\n\n            _this9.getList();\n          });\n        }\n      });\n    },\n    addMainConfirm: function addMainConfirm() {\n      var _this10 = this;\n\n      this.$refs.AddMainlist.validate(function (valid) {\n        if (valid) {\n          _this10.AddMainlist.bomDetailCreateDTOList = _this10.bomDetailCreateDTOList;\n          api.createRecords(_this10.AddMainlist).then(function () {\n            _this10.getList();\n\n            _this10.listSub = [];\n            _this10.DialogAddmain = false;\n          });\n        }\n      });\n    },\n    resetAddList: function resetAddList() {\n      this.bomDetailCreateDTOList = [];\n      this.AddMainlist = {\n        bomType: \"\",\n        effDateBegin: \"\",\n        effDateEnd: \"\",\n        materielCode: \"\",\n        materielName: \"\",\n        measuringUnit: \"\",\n        orgCode: \"\",\n        remarks: \"\",\n        specification: \"\",\n        standardNum: '',\n        bomDetailCreateDTOList: []\n      };\n    },\n    handelRefresh: function handelRefresh() {\n      this.isEdit = false;\n      this.resetForm();\n      this.resetAddList();\n    },\n    resetForm: function resetForm() {\n      this.$refs['AddMainlist'].resetFields();\n    }\n  }\n};",null]}