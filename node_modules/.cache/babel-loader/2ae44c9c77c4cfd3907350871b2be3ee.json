{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/supplierRFQ/supplierRFQAnswer/tab/tabJGcost.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/supplierRFQ/supplierRFQAnswer/tab/tabJGcost.vue","mtime":1599136050910},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapState } from \"vuex\";\nimport { queryQuoteItem, createQuoteItem, updateQuoteItem, deleteQuoteItem, queryQuoteDetails } from \"@/api/project/srm/supplierSelect/supplierRFQ/supplierRFQAnswer\";\nexport default {\n  name: 'tabJGcost',\n  props: ['parentRowId', 'orgCode'],\n  data: function data() {\n    return {\n      tableData: [],\n      fentancost: null,\n      rules: {\n        partName: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        processName: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        deviceName: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        deviceType: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        processHour: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        operatorCount: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        processUnitPrice: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        ratedPower: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        powerUtilization: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        electricityTariff: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        deviceOriginalValue: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }],\n        deviceAllocationWork: [{\n          required: true,\n          message: '请填写',\n          trigger: 'blur'\n        }]\n      },\n      formData: {\n        partName: null,\n        processName: null,\n        deviceName: null,\n        deviceType: null,\n        processHour: null,\n        operatorCount: null,\n        processUnitPrice: null,\n        ratedPower: null,\n        wu1: null,\n        powerUtilization: null,\n        electricityTariff: null,\n        burningCharge: null,\n        deviceOriginalValue: null,\n        deviceAllocationWork: null,\n        deviceAllocation: null,\n        auxiliaryMaterialName: null,\n        specification: null,\n        factory: null,\n        unitPrice: null,\n        consumptionQuota: null,\n        subtotalCost: null,\n        rejectRate: null,\n        wasteLoss: null,\n        auxiliaryMaterialCost: null\n      },\n      formConfig: [{\n        type: 'commonInput',\n        required: true,\n        label: '部件名称',\n        prop: 'partName',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '工序名称',\n        prop: 'processName',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '设备名称',\n        prop: 'deviceName',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '设备型号',\n        prop: 'deviceType',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '工序工时',\n        prop: 'processHour',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '操作人数',\n        prop: 'operatorCount',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '工序单价',\n        prop: 'processUnitPrice',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '设备额定功率',\n        prop: 'ratedPower',\n        width: ''\n      }, //dict\n      {\n        type: 'commonInput',\n        label: '人工费',\n        disabled: true,\n        prop: 'wu1',\n        width: ''\n      }, //wu\n      {\n        type: 'commonInput',\n        required: true,\n        label: '功率使用率',\n        prop: 'powerUtilization',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '电费单价',\n        prop: 'electricityTariff',\n        width: ''\n      }, //dict\n      {\n        type: 'commonInput',\n        label: '燃动费',\n        disabled: true,\n        prop: 'burningCharge',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '设备原值',\n        prop: 'deviceOriginalValue',\n        width: ''\n      }, {\n        type: 'commonInput',\n        required: true,\n        label: '设备分摊工时',\n        prop: 'deviceAllocationWork',\n        width: ''\n      }, {\n        type: 'commonInput',\n        label: '设备分摊',\n        disabled: true,\n        prop: 'deviceAllocation',\n        width: ''\n      }, {\n        type: 'commonInput',\n        label: '辅材名称',\n        prop: 'auxiliaryMaterialName',\n        width: ''\n      }, {\n        type: 'commonInput',\n        label: '规格型号',\n        prop: 'specification',\n        width: ''\n      }, {\n        type: 'commonInput',\n        label: '生产厂',\n        prop: 'factory',\n        width: ''\n      }, {\n        type: 'commonInput',\n        label: '单价',\n        prop: 'unitPrice',\n        width: ''\n      }, {\n        type: 'commonInput',\n        label: '消耗定额',\n        prop: 'consumptionQuota',\n        width: ''\n      }, {\n        type: 'commonInput',\n        disabled: true,\n        label: '辅材费用',\n        prop: 'auxiliaryMaterialCost',\n        width: ''\n      }, {\n        type: 'commonInput',\n        disabled: true,\n        label: '费用小计',\n        prop: 'subtotalCost',\n        width: ''\n      }, {\n        type: 'commonInput',\n        label: '废品率',\n        prop: 'rejectRate',\n        width: ''\n      }, {\n        type: 'commonInput',\n        disabled: true,\n        label: '废品损失',\n        prop: 'wasteLoss',\n        width: ''\n      }],\n      tableConfig: [{\n        label: '部件名称',\n        prop: 'partName',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '工序名称',\n        prop: 'processName',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '设备名称',\n        prop: 'deviceName',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '设备型号',\n        prop: 'deviceType',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '工序工时(小时)',\n        prop: 'processHour',\n        align: 'center',\n        width: '150'\n      }, //D1\n      {\n        label: '操作人数',\n        prop: 'operatorCount',\n        align: 'center',\n        width: 'auto'\n      }, //D3\n      {\n        label: '工时单价(元/小时)',\n        prop: 'processUnitPrice',\n        align: 'center',\n        width: '150'\n      }, //D4\n      {\n        label: '人工费',\n        prop: 'wu1',\n        cal: 'D1*D3*D4',\n        calprop: 'processHour*operatorCount*processUnitPrice',\n        align: 'center',\n        width: 'auto'\n      }, //D2\n      {\n        label: '设备额定功率',\n        prop: 'ratedPower',\n        align: 'center',\n        width: '120'\n      }, //D6\n      {\n        label: '功率使用率',\n        prop: 'powerUtilization',\n        align: 'center',\n        width: 'auto'\n      }, //D7\n      {\n        label: '电费单价',\n        prop: 'electricityTariff',\n        align: 'center',\n        width: 'auto'\n      }, //d8\n      {\n        label: '燃动费',\n        prop: 'burningCharge',\n        cal: 'D6*D7*D8*D1',\n        calprop: 'processHour*ratedPower*powerUtilization*electricityTariff',\n        align: 'center',\n        width: 'auto'\n      }, //D5\n      {\n        label: '设备原值',\n        prop: 'deviceOriginalValue',\n        align: 'center',\n        width: 'auto'\n      }, //D10\n      {\n        label: '设备分摊工时费',\n        prop: 'deviceAllocationWork',\n        cal: 'D10*0.95/10/12/21.75/8/运行班次',\n        calprop: '',\n        align: 'center',\n        width: '150'\n      }, //D11 \n      {\n        label: '设备分摊',\n        cal: 'D11*D1',\n        prop: 'deviceAllocation',\n        align: 'center',\n        width: 'auto'\n      }, //D9\n      {\n        label: '辅材名称',\n        prop: 'auxiliaryMaterialName',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '生产厂',\n        prop: 'factory',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '规格型号',\n        prop: 'specification',\n        align: 'center',\n        width: 'auto'\n      }, {\n        label: '消耗定额',\n        prop: 'consumptionQuota',\n        align: 'center',\n        width: 'auto'\n      }, //D12\n      {\n        label: '单价',\n        prop: 'unitPrice',\n        align: 'center',\n        width: 'auto'\n      }, //D13\n      {\n        label: '辅料成本',\n        prop: 'auxiliaryMaterialCost',\n        cal: 'D12*D13',\n        align: 'center',\n        width: 'auto'\n      }, //D14 消耗定额D12*单据D13\n      {\n        label: '小计费用',\n        prop: 'subtotalCost',\n        cal: 'D=D2+D5+D9+D14',\n        align: 'center',\n        width: 'auto'\n      }, //D\n      {\n        label: '废品率',\n        prop: 'rejectRate',\n        align: 'center',\n        width: 'auto'\n      }, //D15\n      {\n        label: '废品损失',\n        prop: 'wasteLoss',\n        cal: 'D15*D',\n        align: 'center',\n        width: 'auto'\n      }]\n    };\n  },\n  watch: {\n    'formData.processHour': function formDataProcessHour() {\n      this.calculate('processHour', this.formData);\n    },\n    'formData.operatorCount': function formDataOperatorCount() {\n      this.calculate('operatorCount', this.formData);\n    },\n    'formData.processUnitPrice': function formDataProcessUnitPrice() {\n      this.calculate('processUnitPrice', this.formData);\n    },\n    'formData.ratedPower': function formDataRatedPower() {\n      this.calculate('ratedPower', this.formData);\n    },\n    'formData.powerUtilization': function formDataPowerUtilization() {\n      this.calculate('powerUtilization', this.formData);\n    },\n    'formData.electricityTariff': function formDataElectricityTariff() {\n      this.calculate('electricityTariff', this.formData);\n    },\n    'formData.burningCharge': function formDataBurningCharge() {\n      this.calculate('burningCharge', this.formData);\n    },\n    'formData.deviceAllocationWork': function formDataDeviceAllocationWork() {\n      this.calculate('deviceAllocationWork', this.formData);\n    },\n    'formData.consumptionQuota': function formDataConsumptionQuota() {\n      this.calculate('consumptionQuota', this.formData);\n    },\n    'formData.unitPrice': function formDataUnitPrice() {\n      this.calculate('unitPrice', this.formData);\n    },\n    'formData.wu1': function formDataWu1() {\n      this.calculate('wu1', this.formData);\n    },\n    'formData.deviceAllocation': function formDataDeviceAllocation() {\n      this.calculate('deviceAllocation', this.formData);\n    },\n    'formData.auxiliaryMaterialCost': function formDataAuxiliaryMaterialCost() {\n      this.calculate('auxiliaryMaterialCost', this.formData);\n    },\n    'formData.rejectRate': function formDataRejectRate() {\n      this.calculate('rejectRate', this.formData);\n    },\n    'formData.subtotalCost': function formDataSubtotalCost() {\n      this.calculate('subtotalCost', this.formData);\n    }\n  },\n  computed: _objectSpread({}, mapState({\n    dt_const: function dt_const(state) {\n      return state.srmBisSelect.dt_const;\n    }\n  })),\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$store.dispatch(\"srmBisSelect/getBisData\", [\"dt_cate_platformSeries\", \"dt_const\"]);\n\n    if (!this.orgCode) {\n      this.fentancost = 1;\n    } else {\n      this.dt_const.data.forEach(function (item) {\n        if (item.typeEncoding === 'PBE3' && item.purchaseOrg === _this.orgCode) {\n          _this.fentancost = item.constantValue;\n        }\n      });\n\n      if (!this.fentancost) {\n        this.fentancost = 1;\n      }\n    }\n\n    this.getItems();\n  },\n  methods: {\n    checkValue: function checkValue(val) {\n      if (isNaN(val) || val == Infinity) {\n        return undefined;\n      } else {\n        if (val.toString().indexOf('.') !== -1) {\n          val = parseFloat(val).toFixed(4);\n        }\n\n        return val;\n      }\n    },\n    calculate: function calculate(prop, row) {\n      var index = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n      switch (prop) {\n        case 'processHour':\n        case 'operatorCount':\n        case 'processUnitPrice':\n          {\n            if (!index) {\n              this.$set(this.formData, 'wu1', this.checkValue(row.processHour * row.operatorCount * row.processUnitPrice));\n            } else {\n              this.$set(this.tableData[index], 'wu1', this.checkValue(row.processHour * row.operatorCount * row.processUnitPrice));\n            }\n\n            break;\n          }\n\n        case 'ratedPower':\n        case 'powerUtilization':\n        case 'electricityTariff':\n          {\n            if (!index) {\n              this.$set(this.formData, 'burningCharge', this.checkValue(row.ratedPower * row.powerUtilization * row.electricityTariff));\n            } else {\n              this.$set(this.tableData[index], 'burningCharge', this.checkValue(row.ratedPower * row.powerUtilization * row.electricityTariff));\n            }\n\n            break;\n          }\n\n        case 'burningCharge':\n          {\n            if (!index) {\n              this.$set(this.formData, 'deviceAllocationWork', this.checkValue(row.ratedPower * 0.95 / 10 / 12 / 21.75 / 8 / this.fentancost));\n              this.$set(this.formData, 'subtotalCost', this.checkValue(row.wu1 + row.burningCharge + row.deviceAllocation + row.auxiliaryMaterialCost));\n            } else {\n              this.$set(this.tableData[index], 'deviceAllocationWork', this.checkValue(row.ratedPower * 0.95 / 10 / 12 / 21.75 / 8 / this.fentancost));\n              this.$set(this.tableData[index], 'subtotalCost', this.checkValue(row.wu1 + row.burningCharge + row.deviceAllocation + row.auxiliaryMaterialCost));\n            }\n\n            break;\n          }\n\n        case 'deviceAllocationWork':\n          {\n            if (!index) {\n              this.$set(this.formData, 'deviceAllocation', this.checkValue(row.processHour * row.deviceAllocationWork));\n            } else {\n              this.$set(this.tableData[index], 'deviceAllocation', this.checkValue(row.processHour * row.deviceAllocationWork));\n            }\n\n            break;\n          }\n\n        case 'consumptionQuota':\n        case 'unitPrice':\n          {\n            if (!index) {\n              this.$set(this.formData, 'auxiliaryMaterialCost', this.checkValue(row.consumptionQuota * row.unitPrice));\n            } else {\n              this.$set(this.tableData[index], 'auxiliaryMaterialCost', this.checkValue(row.consumptionQuota * row.unitPrice));\n            }\n\n            break;\n          }\n\n        case 'wu1':\n        case 'deviceAllocation':\n        case 'auxiliaryMaterialCost':\n          {\n            if (!index) {\n              this.$set(this.formData, 'subtotalCost', this.checkValue(row.wu1 + row.burningCharge + row.deviceAllocation + row.auxiliaryMaterialCost));\n            } else {\n              this.$set(this.tableData[index], 'subtotalCost', this.checkValue(row.wu1 + row.burningCharge + row.deviceAllocation + row.auxiliaryMaterialCost));\n            }\n\n            break;\n          }\n\n        case 'rejectRate':\n        case 'subtotalCost':\n          {\n            if (!index) {\n              this.$set(this.formData, 'wasteLoss', this.checkValue(row.rejectRate * row.subtotalCost));\n            } else {\n              this.$set(this.tableData[index], 'wasteLoss', this.checkValue(row.rejectRate * row.subtotalCost));\n            }\n\n            break;\n          }\n      }\n    },\n    getItems: function getItems() {\n      var _this2 = this;\n\n      if (this.parentRowId) {\n        queryQuoteDetails({\n          parentRowId: this.parentRowId,\n          method: 'PROCESSING_COST'\n        }).then(function (res) {\n          _this2.tableData = res.data;\n\n          _this2.tableData.forEach(function (item) {\n            item.wu1 = item.processHour * item.operatorCount * item.processUnitPrice;\n          });\n\n          _this2.calculateSum();\n        });\n      }\n    },\n    calculateSum: function calculateSum() {\n      var wu1s = 0;\n      var burningCharges = 0;\n      var deviceAllocations = 0;\n      this.tableData.forEach(function (item) {\n        wu1s += item.wu1;\n        burningCharges += item.burningCharge;\n        deviceAllocations += item.deviceAllocation;\n      });\n      var dataSum = {\n        key: 'sum',\n        partName: '合计',\n        wu1: wu1s,\n        burningCharge: burningCharges,\n        deviceAllocation: deviceAllocations\n      };\n      this.tableData.push(dataSum);\n    },\n    handleUpdate: function handleUpdate(row) {\n      var _this3 = this;\n\n      queryQuoteItem({\n        rowId: row.rowId,\n        method: 'PROCESSING_COST'\n      }).then(function (res) {\n        _this3.formData = res.data;\n      });\n    },\n    handleDelete: function handleDelete(row) {\n      var _this4 = this;\n\n      this.$confirm('确认删除吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        deleteQuoteItem({\n          parentRowId: _this4.parentRowId,\n          rowId: row.rowId,\n          method: 'PROCESSING_COST'\n        }).then(function () {\n          _this4.getItems();\n\n          _this4.$emit('getTotalQuotation');\n        });\n      }).catch(function () {\n        _this4.$message({\n          type: 'info',\n          message: '已取消'\n        });\n      });\n    },\n    resetForm: function resetForm() {\n      for (var par in this.formData) {\n        if (par !== 'parentRowId') {\n          this.$set(this.formData, par, null);\n        }\n      }\n\n      this.$refs['refForm'].resetFields();\n      this.$refs['refForm'].clearValidate();\n    },\n    handleConfirm: function handleConfirm() {\n      var _this5 = this;\n\n      this.$refs.refForm.validate(function (valid) {\n        if (valid) {\n          _this5.$confirm('确认保存吗?', '提示', {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }).then(function () {\n            //PROCESSING_COST 加工费用DTO processingCostDTO\n            _this5.formData.parentRowId = _this5.parentRowId;\n\n            if (_this5.formData.rowId) {\n              var cdata = {\n                processingCostDTO: _this5.formData,\n                method: \"PROCESSING_COST\"\n              };\n              updateQuoteItem(_this5.formData.rowId, cdata).then(function () {\n                _this5.getItems();\n\n                _this5.$emit('getTotalQuotation');\n\n                _this5.$message({\n                  type: 'success',\n                  message: '编辑成功'\n                });\n\n                _this5.resetForm();\n              });\n            } else {\n              var _cdata = {\n                processingCostDTO: _this5.formData,\n                method: \"PROCESSING_COST\"\n              };\n              createQuoteItem(_cdata).then(function () {\n                _this5.getItems();\n\n                _this5.$emit('getTotalQuotation');\n\n                _this5.resetForm();\n\n                _this5.$message({\n                  type: 'success',\n                  message: '新增成功'\n                });\n              });\n            }\n          }).catch(function () {\n            _this5.$message({\n              type: 'info',\n              message: '已取消'\n            });\n          });\n        }\n      });\n    }\n  }\n};",null]}