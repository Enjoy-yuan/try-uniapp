{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/routeQuery/importFile.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/routeQuery/importFile.vue","mtime":1603420637361},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as importApi from '@/api/import/index';\nimport Pagination from '@/components/Pagination';\nexport default {\n  name: 'routeQueryImport',\n  components: {\n    Pagination: Pagination\n  },\n  props: ['modalNo'],\n  //模板号\n  data: function data() {\n    return {\n      listData: {\n        title: [],\n        data: []\n      },\n      // 页面表格数据\n      listQuery: null,\n      // 下载模板文件名称\n      excelName: '',\n      modelDetailparI: {\n        excelCode: this.modalNo,\n        currentPage: 0,\n        pageSize: 10\n      },\n      modelDetailpar: {\n        excelCode: this.modalNo,\n        timestamp: null,\n        currentPage: 0,\n        pageSize: 10\n      },\n      total: 0,\n      fileList: [],\n      files: null,\n      uploadurl: ''\n    };\n  },\n  mounted: function mounted() {},\n  computed: {\n    myHeader: function myHeader() {\n      return {\n        authToken: window.sessionStorage.getItem('authToken')\n      };\n    }\n  },\n  methods: {\n    // 查询导入的临时数据\n    getUploadData: function getUploadData() {\n      var _this = this;\n\n      var noError = true;\n      this.$set(this.modelDetailpar, 'timestamp', new Date().getTime());\n      importApi.srmLXQueryTempDetail(this.modelDetailpar).then(function (res) {\n        res = res.data;\n        _this.listData.data = [];\n        res.list.forEach(function (itemd) {\n          _this.listData.data.push(itemd);\n\n          _this.total = res.pages.count;\n\n          if (itemd.errorMsg && noError) {\n            noError = false;\n          }\n        });\n\n        if (noError) {\n          _this.$message({\n            message: '上传成功',\n            type: 'success'\n          });\n        } else {\n          _this.$message.error('上传文件内容有误，见表格最后一行，请导出修改正确后重新进行导入操作');\n        }\n      });\n    },\n    // 查询excel模板列表明细\n    getList: function getList() {\n      var _this2 = this;\n\n      importApi.srmLXQueryModelDetail(this.modelDetailparI).then(function (res) {\n        res = res.data;\n        res.list.forEach(function (item) {\n          _this2.listData.title.push(item);\n        });\n      });\n    },\n    fileExceed: function fileExceed() {\n      this.$message.error('一次只能上传一个文件');\n    },\n    beforeUpload: function beforeUpload(file) {\n      this.files = file;\n      var extension = file.name.split('.')[1] === 'xls';\n      var extension2 = file.name.split('.')[1] === 'xlsx';\n      var isLt2M = file.size / 1024 / 1024 < 5;\n\n      if (!extension && !extension2) {\n        this.$message.warning('上传模板只能是 xls、xlsx格式!');\n        return;\n      }\n\n      if (!isLt2M) {\n        this.$message.warning('上传模板大小不能超过 5MB!');\n        return;\n      }\n\n      this.fileName = file.name;\n      return false; // 返回false不会自动上传\n    },\n    submitUpload: function submitUpload() {\n      var _this3 = this;\n\n      this.modelDetailpar.timestamp = new Date().getTime();\n\n      if (!this.fileList[0]) {\n        this.$message.warning('请选择要上传的文件！');\n        return false;\n      }\n\n      var fileFormData = new FormData();\n      fileFormData.append('file', this.fileList[0]); //filename是键，file是值，就是要传的文件，test.zip是要传的文件名\n\n      importApi.srmLXUploadExcel(this.modalNo, this.fileList[0], {\n        timestamp: this.modelDetailpar.timestamp\n      }).then(function (res) {\n        if (res.status === 200) {\n          _this3.$message.success('上传成功');\n        }\n\n        _this3.listData.title.push({\n          fieldCode: \"errorMsg\",\n          fieldName: \"错误信息\"\n        });\n\n        _this3.getUploadData();\n      });\n    },\n    // 自定义上传\n    uploadFile: function uploadFile(item) {\n      var _this4 = this;\n\n      this.modelDetailpar.timestamp = new Date().getTime();\n      var form = new FormData();\n      form.append('file', item.file);\n      var fileFormData = new FormData();\n      fileFormData.append('file', this.fileList[0]);\n      importApi.srmLXUploadExcel(this.modalNo, fileFormData, {\n        timestamp: this.modelDetailpar.timestamp\n      }).then(function (res) {\n        if (res.status === 200) {\n          _this4.$message.success('上传成功');\n        }\n\n        _this4.listData.title.push({\n          fieldCode: \"errorMsg\",\n          fieldName: \"错误信息\"\n        });\n\n        _this4.getUploadData();\n      });\n    },\n    handleRemove: function handleRemove(file, fileList) {\n      this.fileList = fileList;\n    },\n    handleChangeFile: function handleChangeFile(file, fileList) {\n      this.fileList = fileList;\n    },\n    //模板下载\n    handleDownload: function handleDownload() {\n      var _this5 = this;\n\n      importApi.srmLXDownloadModal(this.modalNo).then(function (res) {\n        _this5.download(res.data, _this5.excelName);\n      });\n    },\n    // 下载文件\n    download: function download(data, filename) {\n      if (!data) {\n        return;\n      }\n\n      var url = window.URL.createObjectURL(new Blob([data]));\n      var link = document.createElement('a');\n      link.style.display = 'none';\n      link.href = url;\n      link.setAttribute('download', filename);\n      document.body.appendChild(link);\n      link.click();\n    },\n    //excel文件导出\n    handleExport: function handleExport() {\n      var _this6 = this;\n\n      this.$set(this.listQuery, 'purchaseCode', this.listQuery.orgCode);\n      importApi.srmLXDownloadExcel(this.modalNo, this.listQuery).then(function (res) {\n        var filename = decodeURI(res.headers['content-disposition'].split(';')[1].split('=')[1]) || 'excel.xlsx';\n\n        _this6.download(res.data, filename);\n      });\n    }\n  }\n};",null]}