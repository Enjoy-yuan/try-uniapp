{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/materialScrap/scrap/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/materialScrap/scrap/index.vue","mtime":1596610934132},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.function.name\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from '@/api/project/wms/materialScrap/scrapApplication';\nimport * as scrap from '@/api/project/wms/materialScrap/scrap';\nimport { mapState } from 'vuex';\nimport Pagination from '@/components/Pagination'; // 分页组件\n\nimport warehouseSelect from '@/components/Select/warehouse-select.vue'; //下拉组件\n\nimport AuthoType from '@/components/Select/AuthoType.vue'; //权限类型下拉组件\n\nexport default {\n  name: \"scrap\",\n  components: {\n    Pagination: Pagination,\n    warehouseSelect: warehouseSelect,\n    AuthoType: AuthoType\n  },\n  data: function data() {\n    return {\n      total_a: 0,\n      total_a_1: 0,\n      total_b_1: 0,\n      list_a: [],\n      list_a_1: [],\n      list_b: [],\n      list_b_1: [],\n      theight: 0,\n      lheight: 0,\n      rheight: 0,\n      activeName2: 'first',\n      listQuery_a: {\n        // state: 'scrap20',\n        currentPage: 1,\n        pageSize: 10,\n        businessType: '0550' //报废业务类型\n\n      },\n      listQuery_a_1: {},\n      listQuery_b: {\n        currentPage: 1,\n        businessType: '0550',\n        //报废业务类型\n        pageSize: 1000\n      },\n      listQuery_b_1: {\n        currentPage: 1,\n        pageSize: 10,\n        businessType: '0550' //报废业务类型\n\n      },\n      saveDate: this.timeFormat() //记账日期\n\n    };\n  },\n  computed: _objectSpread({}, mapState({\n    dt_org_code_factory: function dt_org_code_factory(state) {\n      return state.businessComponent.dt_org_code_factory;\n    },\n    dt_materiel_transfer_type_bf: function dt_materiel_transfer_type_bf(state) {\n      return state.businessComponent.dt_materiel_transfer_type_bf;\n    }\n  }), {\n    dt_type: function dt_type() {\n      return this.dt_materiel_transfer_type_bf.options;\n    }\n  }),\n  mounted: function mounted() {\n    this.setTableHeight();\n    this.$store.dispatch('businessComponent/getBusinessComponentData', ['dt_org_code_factory', 'dt_materiel_transfer_type_bf']);\n  },\n  methods: {\n    handleTabClick: function handleTabClick(tab) {\n      //选项卡的切换\n      if (tab.name == \"first\") {// this.getList_a()\n      } else {\n        this.getList_b();\n      }\n    },\n    timeFormat: function timeFormat() {\n      var d = new Date();\n      var year = d.getFullYear(); //年  \n\n      var month = d.getMonth() + 1; //月  \n\n      var day = d.getDate(); //日  \n\n      var clock = year + \"-\";\n      if (month < 10) clock += \"0\";\n      clock += month + \"-\";\n      if (day < 10) clock += \"0\";\n      clock += day + \" \";\n      return clock;\n    },\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight() - 110;\n      this.lheight = this.$myFun.getSingleTbHeight() + 85;\n      this.rheight = this.$myFun.getSingleTbHeight() - 60;\n    },\n    getList_a: function getList_a() {\n      var _this = this;\n\n      api.getData_a(this.listQuery_a).then(function (res) {\n        _this.list_a = res.data.list;\n        _this.total_a = res.data.pages.count;\n\n        _this.$nextTick(function () {\n          this.checked();\n        });\n      });\n    },\n    checked: function checked() {\n      this.$refs.tb_a.toggleRowSelection(this.list_a[0], true); //官网方法，重点\n    },\n    isIntegerNotMust: function isIntegerNotMust(event) {\n      //验证正整数\n      var value = event.target.value;\n\n      if (!/^\\+?[1-9][0-9]*$/.test(value)) {\n        this.$message({\n          title: \"警告\",\n          message: \"只能正整数\",\n          type: \"warning\"\n        });\n        event.target.value = '';\n      }\n    },\n    getList_a_1: function getList_a_1() {\n      var _this2 = this;\n\n      //报废明细\n      this.listQuery_b.scrapOrderCode = this.selectListRow_a.scrapOrderCode;\n      api.getData_a_1(this.listQuery_b).then(function (res) {\n        _this2.list_a_1 = res.data.list.map(function (v) {\n          v.outStockNum1 = v.outStockNum;\n          return v;\n        });\n        _this2.total_a_1 = res.data.pages.count;\n      });\n    },\n    getList_b: function getList_b() {\n      var _this3 = this;\n\n      //报废凭证\n      scrap.getData_a(this.listQuery_b).then(function (res) {\n        _this3.list_b = res.data.list;\n      });\n    },\n    getList_b_1: function getList_b_1() {},\n    selectRow_a: function selectRow_a(val) {\n      if (val.length > 1) {\n        this.$refs.tb_a.clearSelection(); //清除其他行的选中\n\n        this.$refs.tb_a.toggleRowSelection(val[val.length - 1], 'selected'); //单击行绑定点击事件\n      } else if (val.length === 1) {\n        this.selectListRow_a = val[val.length - 1];\n        this.getList_a_1();\n      }\n    },\n    selectRow_a_1: function selectRow_a_1(val) {\n      this.selectListRow_a_1 = val;\n    },\n    selectRow_b: function selectRow_b() {},\n    selectRow_b_1: function selectRow_b_1() {},\n    clickRow_a: function clickRow_a(val) {\n      this.$refs.tb_a.clearSelection(); //清除其他行的选中\n\n      this.$refs.tb_a.toggleRowSelection(val); //单击行绑定点击事件\n    },\n    clickRow_a_1: function clickRow_a_1() {},\n    clickRow_b: function clickRow_b(val) {\n      var _this4 = this;\n\n      this.selectListRow_b = val;\n      this.listQuery_b_1.outOrderNumber = this.selectListRow_b.outOrderNumber;\n      scrap.getData_a_1(this.listQuery_b_1).then(function (res) {\n        _this4.list_b_1 = res.data.list;\n        _this4.total_b_1 = res.data.pages.count;\n      });\n    },\n    handleSave: function handleSave() {\n      var _this5 = this;\n\n      //保存\n      if (this.saveDate) {\n        this.dto = this.selectListRow_a;\n        this.dto.accountDate = this.saveDate;\n        this.dto.sourceOrderCode = this.selectListRow_a.scrapOrderCode;\n        this.dto.toOrgCode = this.selectListRow_a.orgCode;\n        this.dto.outOrderPlans = this.list_a_1.map(function (v) {\n          v.sourceDetailNo = v.rowNo;\n          v.outStockNum = v.StockNum || 1;\n          v.toWareAreaCode = \"*\";\n          v.toWareLocationCode = \"*\";\n          return v;\n        });\n        scrap.creatData_a(this.dto).then(function () {\n          _this5.$message({\n            title: '成功',\n            message: '保存成功',\n            type: 'success'\n          });\n\n          _this5.getList_a_1();\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择记账日期',\n          type: 'warning'\n        });\n      }\n    },\n    change: function change() {\n      var _this6 = this;\n\n      this.list_a_1.map(function (item, index) {\n        _this6.$set(_this6.list_a_1, index, _this6.list_a_1[index]);\n      });\n    },\n    handleCopy: function handleCopy() {\n      var _this7 = this;\n\n      //数量复制\n      if (this.selectListRow_a_1 && this.selectListRow_a_1.length > 0) {\n        this.list_a_1.map(function (item, index) {\n          _this7.selectListRow_a_1.forEach(function (items) {\n            if (items.materielCode === item.materielCode) {\n              _this7.list_a_1[index].StockNum = item.scrapNumber - item.outStockNum;\n\n              _this7.$set(_this7.list_a_1, index, _this7.list_a_1[index]);\n            }\n          });\n        });\n      } else {\n        this.$message({\n          title: \"警告\",\n          message: \"请选择一条信息\",\n          type: \"warning\"\n        });\n      }\n    },\n    exportData: function exportData() {\n      var _this8 = this;\n\n      //导出\n      this.downloadLoading = true;\n      import('@/vendor/Export2Excel').then(function (excel) {\n        var tHeader = ['打印次数', '凭证号', '业务类型', '物料编码', '物料名称', '数量', '组织编码', '仓库编码', '区位', '储位', '库位', '记账日期', '申请单号', '行号', '创建日期', '记账人'];\n        var filterVal = ['printNumber', 'outOrderNumber', 'businessTypeName', 'materielCode', 'materielName', 'outStockNum', 'orgCode', 'warehouseCode', 'wareAreaCode', 'wareLocationCode', 'wareLocationCode', 'accountDate', 'sourceOrderCode', 'rowNo', 'createTime', 'creator'];\n\n        var data = _this8.formatJson(filterVal, _this8.list_b_1);\n\n        excel.export_json_to_excel({\n          header: tHeader,\n          data: data,\n          filename: 'table-list'\n        });\n        _this8.downloadLoading = false;\n      });\n    },\n    formatJson: function formatJson(filterVal, jsonData) {\n      return jsonData.map(function (v) {\n        return filterVal.map(function (j) {\n          if (j === 'timestamp') {\n            return;\n          } else {\n            return v[j];\n          }\n        });\n      });\n    },\n    setdefault: function setdefault(val, i) {\n      if (i === 1) {\n        this.$set(this.listQuery_a, 'orgCode', val);\n      } else if (i === 3) {\n        this.$set(this.listQuery_a, 'warehouseCode', val); // this.getList_a();\n      }\n    },\n    //打印页面内容\n    warehousePrint: function warehousePrint() {\n      var wpt = document.getElementById('table-content');\n      var newContent = wpt.innerHTML;\n      var oldContent = document.body.innerHTML;\n      document.body.innerHTML = newContent;\n      window.print(); //打印方法\n\n      window.localtion.reload();\n      document.body.innerHTML = oldContent;\n    }\n  }\n};",null]}