{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/EI/inventoryMain/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/EI/inventoryMain/index.vue","mtime":1596610933369},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from '@/api/project/eas/el/inventoryPlanning';\nimport { DT_ORG_TYPE } from '@/utils/constant';\nimport caiGou from '@/components/Select/xtpt/caigou'; //下拉组件\n\nimport Pagination from '@/components/Pagination';\nimport { mapState } from 'vuex'; // 基本数据引入\n\nimport { getName } from '@/utils/auth';\nexport default {\n  name: 'inventoryMain',\n  components: {\n    Pagination: Pagination,\n    caiGou: caiGou\n  },\n  data: function data() {\n    return {\n      activeName: 'stayPlate',\n      checkList: [],\n      theight: 0,\n      //表格高度\n      list: [],\n      list2: [],\n      fromList: [],\n      total: 0,\n      tableKey: [0, 1],\n      //表格索引\n      tmpState: ['cps20', 'cps30'],\n      listQuery: {\n        organizationCode: undefined,\n        states: 'cps20,cps30',\n        checker: getName(),\n        startTime: undefined,\n        endTime: undefined,\n        //查询\n        currentPage: 1,\n        pageSize: 15\n      },\n      listQuery1: {\n        //从表查询\n        currentPage: 1,\n        pageSize: 15\n      },\n      temp: {// bomId: undefined,\n      },\n      tempFrom: {},\n      notDetail: true,\n      DT_ORG_TYPE: DT_ORG_TYPE,\n      dialogStatus: '',\n      dialogFormVisible: false,\n      fromDialogStatus: '',\n      fromDialogFormVisible: false,\n      currentSelectedRow: null,\n      //当前选中的行\n      selectedRows: null,\n      //多选时选中的所有行\n      selectFromList: null,\n      //从表选中\n      addressData: [],\n      workCenterData: [],\n      supplierData: [],\n      manufacturerData: []\n    };\n  },\n  created: function created() {\n    this.getList();\n  },\n  computed: _objectSpread({}, mapState({\n    dt_check_plan_state: function dt_check_plan_state(state) {\n      return state.eamDict.dt_check_plan_state;\n    },\n    dt_check_content: function dt_check_content(state) {\n      return state.eamDict.dt_check_content;\n    },\n    dt_device_state: function dt_device_state(state) {\n      return state.eamDict.dt_device_state;\n    }\n  })),\n  watch: {\n    // 监听时间区间数组 写入到对应字段\n    'temp.timeRange': function tempTimeRange(value) {\n      if (value) {\n        this.temp.startDate = value[0];\n        this.temp.endDate = value[1];\n      }\n    },\n    'tempFrom.timeRange': function tempFromTimeRange(value) {\n      if (value) {\n        this.tempFrom.startDate = value[0];\n        this.tempFrom.endDate = value[1];\n      }\n    },\n    'tempFrom.useDept': function tempFromUseDept() {\n      this.getStation();\n    },\n    tmpState: function tmpState(val) {\n      if (val) {\n        this.listQuery.states = val.join(',');\n      } else {\n        this.listQuery.states = undefined;\n      }\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$store.dispatch('eamDict/getDicData', ['dt_check_plan_state', 'dt_check_content', 'dt_device_state']);\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this.setTableHeight();\n    };\n\n    this.getStation();\n    this.contentPosition();\n  },\n  methods: {\n    contentPosition: function contentPosition() {\n      var _this2 = this;\n\n      setTimeout(function () {\n        _this2.dt_check_content.forEach(function (item, index) {\n          if (item.dictItemKey == 'useDept') {\n            _this2.dt_check_content.splice(index, 1);\n\n            _this2.dt_check_content.splice(0, 0, item);\n          }\n        });\n\n        _this2.dt_check_content.forEach(function (item, index) {\n          if (item.dictItemKey == 'address') {\n            _this2.dt_check_content.splice(index, 1);\n\n            _this2.dt_check_content.splice(1, 0, item);\n          }\n        });\n      }, 1000);\n    },\n    getStation: function getStation() {\n      var _this3 = this;\n\n      if (this.tempFrom.useDept) {\n        api.getStationList({\n          workCenterCode: this.tempFrom.useDept\n        }).then(function (res) {\n          _this3.addressData = res.data;\n\n          if (_this3.addressData.length == 0) {\n            _this3.$message({\n              title: '警告',\n              message: '当前产线下暂无工位',\n              type: 'warning',\n              duration: 1000\n            });\n          }\n        });\n      }\n\n      api.getWorkCenter().then(function (res) {\n        _this3.workCenterData = res.data;\n      });\n      api.getSuppliers({\n        currentPage: 1,\n        pageSize: 1000\n      }).then(function (res) {\n        _this3.supplierData = res.data.list;\n      });\n      api.getManufacturers({\n        currentPage: 1,\n        pageSize: 1000\n      }).then(function (res) {\n        _this3.manufacturerData = res.data.list;\n      });\n    },\n    useDeptChange: function useDeptChange() {},\n    inventory: function inventory(row) {\n      var _this4 = this;\n\n      this.tempFrom = {};\n      setTimeout(function () {\n        _this4.getList2(1, row);\n      }, 0);\n    },\n    inventoryDetail: function inventoryDetail(row) {\n      var tmp = Object.assign(this.temp, row);\n      this.tempFrom = Object.assign({}, tmp);\n    },\n    inventoryDetail2: function inventoryDetail2(row) {\n      this.fromDialogFormVisible = true;\n      var tmp = Object.assign(this.temp, row);\n      this.tempFrom = Object.assign({}, tmp);\n    },\n    inventoryCheck: function inventoryCheck() {\n      var _this5 = this;\n\n      if (JSON.stringify(this.tempFrom) == '{}') {\n        this.$message({\n          title: '警告',\n          message: '请选择设备',\n          type: 'warning'\n        });\n        return false;\n      }\n\n      var tmp = this.tempFrom;\n      this.tempFrom = {\n        checkOrderNumber: this.list2.checkOrderNumber,\n        deviceDTO: tmp,\n        ifUpdate: 'Y',\n        remark: this.list2.remark,\n        rowId: this.list2.rowId\n      };\n      api.inventoryCheck(this.tempFrom).then(function (res) {\n        if (res.status == 201) {\n          _this5.$message({\n            title: '成功',\n            message: '盘点成功',\n            type: 'success',\n            duration: 2000\n          });\n\n          _this5.fromDialogFormVisible = false;\n          _this5.tempFrom = {};\n\n          _this5.freshEqmt();\n        }\n      });\n    },\n    detail: function detail(row) {\n      var _this6 = this;\n\n      api.inventoryDetail(row.deviceCode).then(function (res) {\n        _this6.tempFrom = res.data;\n      });\n    },\n    freshEqmt: function freshEqmt() {\n      var _this7 = this;\n\n      api.queryRecord2(this.temp.checkOrderNumber, this.listQuery2).then(function (res) {\n        _this7.fromList = res.data.checkDetail;\n      });\n    },\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight() - 185;\n    },\n    tabClick: function tabClick(tab) {\n      this.tempFrom = {};\n\n      if (tab.paneName == 'stayPlate') {\n        this.notDetail = true;\n      } else {\n        this.notDetail = false;\n      }\n    },\n    getList: function getList() {\n      var _this8 = this;\n\n      //获取表格数据\n      api.queryRecord(this.listQuery).then(function (res) {\n        _this8.list = res.data.list;\n        _this8.total = res.data.pages.count;\n      });\n    },\n    getList2: function getList2(num, value) {\n      var _this9 = this;\n\n      //获取子表格数据\n      api.queryRecord2(value.checkOrderNumber, this.listQuery2).then(function (res) {\n        _this9.list2 = res.data;\n        _this9.fromList = res.data.checkDetail;\n        _this9.temp = res.data;\n        var tmp = [];\n\n        _this9.temp.contents.forEach(function (item) {\n          tmp.push(item.content);\n        });\n\n        _this9.dt_check_content.forEach(function (item2, index) {\n          _this9.dt_check_content[index].check = false;\n\n          _this9.temp.contents.forEach(function (item) {\n            if (item2.dictItemKey == item.content) {\n              _this9.dt_check_content[index].check = true;\n              return false;\n            }\n          });\n        });\n\n        _this9.temp.contents = tmp;\n\n        if (num == 1) {\n          setTimeout(function () {\n            _this9.dialogFormVisible = true;\n          }, 100);\n        }\n      });\n    },\n    resetTemp: function resetTemp() {\n      this.temp = {};\n    },\n    handleQuery: function handleQuery() {\n      //表格查询\n      this.listQuery.currentPage = 1;\n      this.getList();\n      this.fromList = [];\n    },\n    confirm: function confirm() {},\n    // 获取表格选中时的数据\n    selectRow: function selectRow(val) {\n      this.$refs.tb.toggleRowSelection(val, 'selected');\n    },\n    rowClick: function rowClick(val) {\n      this.selectedRows = val;\n\n      if (val.length == 0) {\n        this.selectedRows = []; // this.list2 = []\n\n        return false;\n      }\n\n      if (val.length > 1) {\n        this.$refs.tb.clearSelection();\n        this.$refs.tb.toggleRowSelection(val[val.length - 1]);\n      }\n\n      this.$refs.tb.setCurrentRow(this.selectedRows[0]);\n\n      if (this.selectedRows.length) {\n        this.getList2(0, val[0]);\n      }\n    },\n    // 全选\n    selectAll: function selectAll(val) {\n      var _this10 = this;\n\n      if (val.length == 0) {\n        this.selectedRows = [];\n        this.$refs.tb.clearSelection();\n        return false;\n      }\n\n      val.forEach(function (items, indexv) {\n        var isSelected = false;\n\n        _this10.selectedRows.forEach(function (item) {\n          if (item.checkOrderNumber === items.checkOrderNumber) {\n            isSelected = true;\n          }\n        });\n\n        if (!isSelected) {\n          _this10.selectedRows.push(val[indexv]);\n        }\n      });\n    },\n    closeMain: function closeMain() {\n      this.$refs.tb.clearSelection();\n    }\n  }\n};",null]}