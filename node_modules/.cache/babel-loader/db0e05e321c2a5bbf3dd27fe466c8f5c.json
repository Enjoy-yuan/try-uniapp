{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/actuarialPrice/actuarialDetailCost/formation.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/actuarialPrice/actuarialDetailCost/formation.vue","mtime":1599136050804},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { queryRecords } from \"@/api/project/srm/supplierSelection/constantParameters\";\nimport * as api from \"@/api/project/srm/priceManage/actuarialDetailCost\";\nimport { DICT_CODE } from '@/utils/constant';\nimport tabQuote from \"./tab/tabQuote\";\nimport tabYCLcost from \"./tab/tabYCLcost\";\nimport tabWGcost from \"./tab/tabWGcost\";\nimport tabZYcost from \"./tab/tabZYcost\";\nimport tabJGcost from \"./tab/tabJGcost\";\nimport tabBZcost from \"./tab/tabBZcost\";\nimport tabWLcost from \"./tab/tabWLcost\";\nimport dialogQuoteInfo from \"./dialog/dialogQuoteInfo\"; //参照报价新增\n\nimport dialogActuarial from \"./dialog/dialogActuarial\"; //参照精算新增\n\nimport dialogPreview from \"./dialog/dialogPreview\"; //参照精算新增\n\nexport default {\n  name: 'formation',\n  components: {\n    tabQuote: tabQuote,\n    tabYCLcost: tabYCLcost,\n    tabWGcost: tabWGcost,\n    tabZYcost: tabZYcost,\n    tabJGcost: tabJGcost,\n    tabBZcost: tabBZcost,\n    tabWLcost: tabWLcost,\n    dialogQuoteInfo: dialogQuoteInfo,\n    dialogActuarial: dialogActuarial,\n    dialogPreview: dialogPreview\n  },\n  data: function data() {\n    // let compareDate = (rule, value, callback) => {\n    //     if (value > this.formData.prop9) {\n    //         return callback(new Error('生效时间不能大于失效时间'))\n    //     } else {\n    //         callback()\n    //     }\n    // }\n    return {\n      getwasteLoss: null,\n      getprofit: null,\n      buttonStatus: true,\n      //新增可编辑，编辑时置灰\n      tabQuoteList: [],\n      tabYCLcostList: [],\n      //原材料\n      tabWGcostList: [],\n      //外协采购\n      tabZYcostList: [],\n      //专业工装费用\n      tabJGcostList: [],\n      //加工费用\n      tabBZcostList: [],\n      //包装费用\n      tabWLcostList: [],\n      //物流费用\n      status: null,\n      actuarialSubtotalCost: null,\n      WasteLoss: null,\n      formationState: 'add',\n      tabName: 'tabQuote',\n      DICT_CODE: DICT_CODE,\n      formData: {\n        actuarialPrice: undefined,\n        currency: undefined,\n        rowId: undefined,\n        mapNo: undefined,\n        specialDistinction: null,\n        materielName: null,\n        materielClassName: null,\n        supplierCode: null,\n        supplierName: null,\n        quotedDate: null,\n        taxFreePrice: null,\n        targetprice: null,\n        realPrice: null,\n        priceAnalysis: null,\n        validTimeStart: null,\n        validTimeEnd: null,\n        prop12: null,\n        prop13: null\n      },\n      rules: {// prop1: [\n        //     { required: true, message: '请填写', trigger: 'blur' }\n        // ],\n        // prop8: [\n        //     { required: true, message: '请选择', trigger: 'blur' },\n        //     { validator: compareDate, trigger: 'blur' }\n        // ]\n      },\n      oprateBtnConfig: [{\n        id: 0,\n        class: 'filter-item',\n        icon: 'el-icon-close',\n        clickMethod: 'handleCancel',\n        name: '取消'\n      }, {\n        id: 1,\n        class: 'filter-item ml_5',\n        icon: 'el-icon-check',\n        clickMethod: 'handleSave',\n        name: '保存'\n      }, {\n        id: 2,\n        class: 'filter-item ml_5',\n        icon: 'el-icon-plus',\n        clickMethod: 'handleBJRef',\n        name: '参照报价新增',\n        status: true\n      }, {\n        id: 3,\n        class: 'filter-item ml_5',\n        icon: 'el-icon-plus',\n        clickMethod: 'handleJSRef',\n        name: '参照精算新增',\n        status: true\n      }],\n      formConfig: [{\n        type: 'commonInput',\n        status: true,\n        label: '零件图号',\n        prop: 'mapNo',\n        width: ''\n      }, {\n        type: 'commonInput',\n        status: true,\n        label: '特殊区分',\n        prop: 'specialDistinction',\n        width: ''\n      }, {\n        type: 'commonInput',\n        status: true,\n        label: '零件名称',\n        prop: 'materielName',\n        width: ''\n      }, {\n        type: 'commonInput',\n        status: true,\n        label: '物料分类',\n        prop: 'materielClassName',\n        width: ''\n      }, {\n        type: 'commonInput',\n        status: true,\n        label: '供应商编码',\n        prop: 'supplierCode',\n        width: ''\n      }, {\n        type: 'commonInput',\n        status: true,\n        label: '供应商名称',\n        prop: 'supplierName',\n        width: ''\n      }, {\n        type: 'commonInput',\n        status: true,\n        label: '报价时间',\n        prop: 'quotedDate',\n        width: ''\n      }, {\n        type: 'date',\n        status: false,\n        label: '价格生效时间',\n        prop: 'validTimeStart',\n        width: ''\n      }, {\n        type: 'date',\n        status: false,\n        label: '价格失效时间',\n        prop: 'validTimeEnd',\n        width: ''\n      }, {\n        type: 'commonInput',\n        status: true,\n        label: '报价',\n        prop: 'taxFreePrice',\n        width: ''\n      }, {\n        type: 'commonInput',\n        status: true,\n        label: '目标价(元)',\n        prop: 'targetprice',\n        width: ''\n      }, {\n        type: 'commonInput',\n        status: true,\n        label: '精算价格(元)',\n        prop: 'actuarialPrice',\n        width: ''\n      }, {\n        type: 'textarea',\n        label: '价格分析',\n        prop: 'priceAnalysis',\n        width: '800px',\n        rows: \"2\"\n      }],\n      tabConfig: [{\n        label: '报价表',\n        name: 'tabQuote',\n        prop: 'tabQuote'\n      }, {\n        label: '原材料费用',\n        name: 'tabYCLcost',\n        prop: 'tabYCLcost'\n      }, {\n        label: '外购/协费用',\n        name: 'tabWGcost',\n        prop: 'tabWGcost'\n      }, {\n        label: '专用工装费用',\n        name: 'tabZYcost',\n        prop: 'tabZYcost'\n      }, {\n        label: '加工费用',\n        name: 'tabJGcost',\n        prop: 'tabJGcost'\n      }, {\n        label: '包装费用',\n        name: 'tabBZcost',\n        prop: 'tabBZcost'\n      }, {\n        label: '物流费用',\n        name: 'tabWLcost',\n        prop: 'tabWLcost'\n      }],\n      dialogConfig: [{\n        title: '报价信息查询',\n        unMutiple: true\n      }, {\n        title: '精算信息查询',\n        unMutiple: true\n      }, {\n        title: '预览'\n      }]\n    };\n  },\n  created: function created() {},\n  mounted: function mounted() {},\n  watch: {},\n  methods: {\n    //操作按钮事件\n    oprateClick: function oprateClick(id) {\n      switch (id) {\n        case 0:\n          {\n            this.$emit('changeState', 'list');\n            break;\n          }\n\n        case 1:\n          {\n            this.handleSave();\n            break;\n          }\n\n        case 2:\n          {\n            this.handleBJRef();\n            break;\n          }\n\n        case 3:\n          {\n            this.handleJSRef();\n            break;\n          }\n      }\n    },\n    getReal: function getReal(val) {\n      this.$set(this.formData, 'actuarialPrice', val); // this.$set(this.formData, 'actuarialPrice', this.formData.actuarialPrice)\n      // console.log(val, this.formData.actuarialPrice, '99')\n    },\n    getLossData: function getLossData(val) {\n      this.getwasteLoss = val;\n    },\n    getProfit: function getProfit(val) {\n      this.getprofit = val;\n    },\n    handleSave: function handleSave() {\n      var _this = this;\n\n      this.$refs.formData.validate(function (valid) {\n        if (valid) {\n          _this.$confirm('确认保存吗?', '提示', {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }).then(function () {\n            var dto = {\n              totalQuotations: _this.$refs.tabQuoteRef[0].tableData.map(function (v) {\n                if (v.totalType == '精算') {\n                  v.realPrice = parseFloat(_this.formData.actuarialPrice);\n                  v.profit = parseFloat(_this.$refs.tabQuoteRef[0].getProfit());\n                  v.wasteLoss = parseFloat(_this.$refs.tabQuoteRef[0].getwasteLossData());\n                }\n\n                return v;\n              }),\n              //报价表\n              actuarialRawMaterialDTOS: _this.$refs.tabYCLcostRef[0].tableData.filter(function (v) {\n                return v.subpartName !== '总计';\n              }),\n              //原材料\n              actuarialOutsourcingDTOS: _this.$refs.tabWGcostRef[0].tableData.filter(function (v) {\n                return v.subpartName !== '总计';\n              }),\n              //外协采购\n              actuarialToolingDTOS: _this.$refs.tabZYcostRef[0].tableData.filter(function (v) {\n                return v.partName !== '总计';\n              }),\n              //专用工装费用\n              actuarialProcessingDTOS: _this.$refs.tabJGcostRef[0].tableData.filter(function (v) {\n                return v.partName !== '总计';\n              }),\n              //加工费用\n              actuarialPackingDTOS: _this.$refs.tabBZcostRef[0].tableData.filter(function (v) {\n                return v.packingTypeCN !== '总计';\n              }),\n              //包装费用\n              actuarialLogisticsDTOS: _this.$refs.tabWLcostRef[0].tableData.filter(function (v) {\n                return v.transportTypeCN !== '总计';\n              }),\n              //物流费用\n              mapNo: _this.formData.mapNo,\n              specialDistinction: _this.formData.specialDistinction,\n              materielName: _this.formData.materielName,\n              materielClassName: _this.formData.materielClassName,\n              supplierCode: _this.formData.supplierCode,\n              supplierName: _this.formData.supplierName,\n              quotedDate: _this.formData.quotedDate,\n              supplierQuote: _this.formData.taxFreePrice,\n              targetprice: _this.formData.targetprice,\n              actuarialPrice: _this.formData.actuarialPrice,\n              orgCode: _this.formData.orgCode,\n              materielCode: _this.formData.materielCode,\n              orgName: _this.formData.orgName,\n              quotationNo: _this.formData.quotationNo,\n              priceAnalysis: _this.formData.priceAnalysis,\n              currency: _this.formData.currency,\n              validTimeStart: _this.formData.validTimeStart,\n              validTimeEnd: _this.formData.validTimeEnd\n            };\n            console.log(dto, 'khg');\n\n            if (_this.status == 'add') {\n              api.createRecords(dto).then(function () {\n                _this.$message({\n                  title: '成功',\n                  message: '新增成功',\n                  type: 'success',\n                  duration: 2000\n                });\n\n                _this.$emit('changeState', 'list');\n\n                _this.$emit('refresh');\n              });\n            } else {\n              console.log('编辑');\n              api.updateRecords(_this.formData.rowId, dto).then(function () {\n                _this.$message({\n                  title: '成功',\n                  message: '编辑成功',\n                  type: 'success',\n                  duration: 2000\n                });\n\n                _this.$emit('changeState', 'list');\n\n                _this.$emit('refresh');\n              });\n            }\n          }).catch(function () {\n            _this.$message({\n              type: 'info',\n              message: '已取消'\n            });\n          });\n        }\n      });\n    },\n    handleBJRef: function handleBJRef() {\n      this.$refs.refDqi.dialogVisible = true;\n      this.$refs.refDqi.getList();\n    },\n    handleJSRef: function handleJSRef() {\n      this.$refs.refAct.dialogVisible = true;\n      this.$refs.refAct.getList();\n    },\n    initForm: function initForm(type, row) {\n      this.status = type;\n      this.$refs['formData'].resetFields();\n      this.$refs['formData'].clearValidate();\n\n      if (type === 'add') {\n        // this.$refs.tabQuoteRef[0].type = 'add'\n        this.$refs.tabQuoteRef[0].initData('add');\n        this.$refs.tabYCLcostRef[0].initData('add');\n        this.$refs.tabWGcostRef[0].initData('add');\n        this.$refs.tabZYcostRef[0].initData('add');\n        this.$refs.tabJGcostRef[0].initData('add');\n        this.$refs.tabBZcostRef[0].initData('add');\n        this.$refs.tabWLcostRef[0].initData('add');\n        this.oprateBtnConfig[2].status = false; //按钮可编辑\n\n        this.oprateBtnConfig[3].status = false;\n        this.oprateBtnConfig[1].name = '保存新增精算';\n        this.$set(this.formData, 'tableDetails', []);\n      } else {\n        console.log('编辑初始化表格', row);\n        this.$refs.tabQuoteRef[0].initData('edit');\n        this.$refs.tabYCLcostRef[0].initData('edit');\n        this.$refs.tabWGcostRef[0].initData('edit');\n        this.$refs.tabZYcostRef[0].initData('edit');\n        this.$refs.tabJGcostRef[0].initData('edit');\n        this.$refs.tabBZcostRef[0].initData('edit');\n        this.$refs.tabWLcostRef[0].initData('edit');\n        this.oprateBtnConfig[2].status = true; //按钮不可编辑\n\n        this.oprateBtnConfig[3].status = true;\n        this.oprateBtnConfig[1].name = '保存编辑精算';\n\n        for (var key in this.formData) {\n          for (var par in row) {\n            if (key === par) {\n              this.$set(this.formData, key, JSON.parse(JSON.stringify(row[key])));\n            }\n          }\n        }\n\n        this.formData.materielCode = row.materielCode;\n        this.formData.taxFreePrice = row.supplierQuote;\n        this.formData.orgCode = row.orgCode;\n        this.formData.orgName = row.orgName;\n        this.formData.quotationNo = row.quotationNo;\n        this.formData.actuarialPrice = row.actuarialPrice;\n        this.$set(this.formData, 'priceAnalysis', row.priceAnalysis);\n        this.tabQuoteList = row.totalQuotations;\n        this.tabYCLcostList = row.actuarialRawMaterialDTOS; //原材料\n\n        this.tabYCLcostList = row.actuarialRawMaterialDTOS; //原材料\n\n        this.tabWGcostList = row.actuarialOutsourcingDTOS; //外协采购\n\n        this.tabZYcostList = row.actuarialToolingDTOS; //工装费用\n        // this.tabJGcostList = row.actuarialProcessingDTOS //加工费用\n\n        this.tabJGcostList = row.actuarialProcessingDTOS; //加工费用\n\n        this.tabBZcostList = row.actuarialPackingDTOS; //包装费用\n\n        this.tabWLcostList = row.actuarialLogisticsDTOS; //包装费用\n      }\n    },\n    confirmDqi: function confirmDqi(qiData) {\n      var _this2 = this;\n\n      qiData = JSON.parse(JSON.stringify(qiData));\n      this.$refs.tabQuoteRef[0].initData('add');\n      this.$refs.tabYCLcostRef[0].initData('add');\n      this.$refs.tabWGcostRef[0].initData('add');\n      this.$refs.tabZYcostRef[0].initData('add');\n      this.$refs.tabJGcostRef[0].initData('add');\n      this.$refs.tabBZcostRef[0].initData('add');\n      this.$refs.tabWLcostRef[0].initData('add');\n      var dto = {\n        purchaseOrg: qiData[0].orgCode,\n        typeEncoding: 'PBE3',\n        currentPage: 1,\n        pageSize: 10\n      };\n      queryRecords(dto).then(function (res) {\n        qiData[0].processingCostDTOS.map(function (v) {\n          v.constantValue = res.data.list[0].constantValue;\n          return v;\n        });\n        _this2.formData = qiData[0];\n        console.log(_this2.formData, ' this.formData'); // this.$refs.tabQuoteRef[0].getList(qiData)\n\n        _this2.tabQuoteList = [qiData[0].totalQuotation];\n        _this2.tabYCLcostList = qiData[0].rawMaterialCostDTOS; //原材料\n\n        _this2.tabWGcostList = qiData[0].outsourcingCostDTOS; //外协外购\n\n        _this2.tabZYcostList = qiData[0].toolingCostDTOS; //工装费用\n\n        _this2.tabJGcostList = qiData[0].processingCostDTOS; //加工费用\n\n        _this2.tabBZcostList = qiData[0].packingCostDTOS; //包装费用\n\n        _this2.tabWLcostList = qiData[0].logisticsCostDTOS; //物流费用\n      });\n    },\n    confirmAct: function confirmAct(actData) {\n      var _this3 = this;\n\n      actData = JSON.parse(JSON.stringify(actData));\n      this.$refs.tabQuoteRef[0].initData('edit');\n      this.$refs.tabYCLcostRef[0].initData('edit');\n      this.$refs.tabWGcostRef[0].initData('edit');\n      this.$refs.tabZYcostRef[0].initData('edit');\n      this.$refs.tabJGcostRef[0].initData('edit');\n      this.$refs.tabBZcostRef[0].initData('edit');\n      this.$refs.tabWLcostRef[0].initData('edit');\n      actData = actData.map(function (v) {\n        v.rawMaterialCostDTOS = v.actuarialRawMaterialDTOS;\n        v.outsourcingCostDTOS = v.actuarialOutsourcingDTOS;\n        v.toolingCostDTOS = v.actuarialToolingDTOS;\n        v.processingCostDTOS = v.actuarialProcessingDTOS;\n        v.packingCostDTOS = v.actuarialPackingDTOS;\n        v.logisticsCostDTOS = v.actuarialLogisticsDTOS;\n        return v;\n      });\n      var dto = {\n        purchaseOrg: actData[0].orgCode,\n        typeEncoding: 'PBE3',\n        currentPage: 1,\n        pageSize: 10\n      };\n      queryRecords(dto).then(function (res) {\n        actData[0].processingCostDTOS.map(function (v) {\n          v.constantValue = res.data.list[0].constantValue;\n          return v;\n        });\n        _this3.formData = actData[0];\n        _this3.formData.taxFreePrice = actData[0].supplierQuote; // this.$refs.tabQuoteRef[0].getList(actData)\n\n        _this3.tabQuoteList = actData[0].totalQuotations;\n        _this3.tabYCLcostList = actData[0].rawMaterialCostDTOS; //原材料\n\n        _this3.tabWGcostList = actData[0].outsourcingCostDTOS; //外协外购\n\n        _this3.tabZYcostList = actData[0].toolingCostDTOS; //工装费用\n\n        _this3.tabJGcostList = actData[0].processingCostDTOS; //加工费用\n\n        _this3.tabBZcostList = actData[0].packingCostDTOS; //包装费用\n\n        _this3.tabWLcostList = actData[0].logisticsCostDTOS; //物流费用\n      });\n    },\n    //预览\n    handlePreview: function handlePreview(type, data) {\n      console.log(type, data);\n      this.$refs.refPre.dialogVisible = true;\n    }\n  }\n};",null]}