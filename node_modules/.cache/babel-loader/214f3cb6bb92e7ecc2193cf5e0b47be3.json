{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/ESC/definePointInspectionPlan/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/ESC/definePointInspectionPlan/index.vue","mtime":1596610933408},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from '@/api/project/eas/ESC/definePointInspectionPlan';\nimport { queryTeamEmployee } from '@/api/project/eas/database/groups';\nimport Pagination from '@/components/Pagination';\nimport teamSelect from \"../../components/teamSelect\";\nimport caiGou from '@/components/Select/caigou';\nimport { mapState } from 'vuex';\nimport tab1 from \"./tab1\";\nimport tab2 from \"./tab2\";\nimport tab3 from \"./tab3\";\nexport default {\n  name: 'definePointInspectionPlan',\n  components: {\n    Pagination: Pagination,\n    tab1: tab1,\n    tab2: tab2,\n    tab3: tab3,\n    teamSelect: teamSelect,\n    caiGou: caiGou\n  },\n  data: function data() {\n    return {\n      list: [],\n      materiaList: [],\n      teamWorker: [],\n      dialogStatus: '',\n      dialogFormVisible: false,\n      dialogVisible2: false,\n      total: 0,\n      theight: 0,\n      //表格高度\n      listQuery: {\n        currentPage: 1,\n        pageSize: 10,\n        rollCycleUtil: undefined,\n        executor: undefined,\n        inspectionPlanName: undefined\n      },\n      tabName: 'jhzxjl',\n      tabConfig: [{\n        label: '计划执行记录',\n        name: 'jhzxjl',\n        prop: 'jhzxjl'\n      }, {\n        label: '跳过时间',\n        name: 'tgsj',\n        prop: 'tgsj'\n      }, {\n        label: '点巡检设备',\n        name: 'dxjsb',\n        prop: 'dxjsb'\n      }],\n      tableKey: [0],\n      temp: {\n        inspectionPlanName: undefined,\n        teamCode: undefined,\n        executor: undefined,\n        rollCycle: undefined,\n        rollCycleUtil: undefined,\n        executorRange: undefined,\n        executorRangeUtil: undefined,\n        nextInspectionTime: undefined,\n        remindTime: undefined,\n        remindTimeUtil: undefined,\n        isEnable: undefined,\n        remark: undefined\n      },\n      // 盘点人model\n      tempVal: {\n        employeeName: undefined\n      },\n      tempRules: {\n        orgCode: [{\n          required: true,\n          message: '组织编码不能为空',\n          trigger: 'blur'\n        }],\n        inspectionPlanName: [{\n          required: true,\n          message: '计划名称不能为空',\n          trigger: 'blur'\n        }],\n        teamCode: [{\n          required: true,\n          message: '班组不能为空',\n          trigger: 'blur'\n        }],\n        executor: [{\n          required: true,\n          message: '执行人不能为空',\n          trigger: 'blur'\n        }],\n        rollCycle: [{\n          required: true,\n          message: '滚动周期不能为空',\n          trigger: 'blur'\n        }],\n        rollCycleUtil: [{\n          required: true,\n          message: '滚动周期不能为空',\n          trigger: 'blur'\n        }],\n        executorRange: [{\n          required: true,\n          message: '执行范围不能为空',\n          trigger: 'blur'\n        }],\n        executorRangeUtil: [{\n          required: true,\n          message: '执行范围不能为空',\n          trigger: 'blur'\n        }],\n        nextInspectionTime: [{\n          required: true,\n          message: '下次时间不能为空',\n          trigger: 'blur'\n        }],\n        isEnable: [{\n          required: true,\n          message: '状态不能为空',\n          trigger: 'blur'\n        }],\n        remindTime: [{\n          required: true,\n          message: '提醒时间不能为空',\n          trigger: 'blur'\n        }],\n        remindTimeUtil: [{\n          required: true,\n          message: '提醒时间不能为空',\n          trigger: 'blur'\n        }]\n      },\n      selectlistRow: []\n    };\n  },\n  watch: {\n    'temp.orgCode': function tempOrgCode(val, val2) {\n      var _this = this;\n\n      if (val2) {\n        this.temp.teamCode = undefined;\n        this.$refs.teamSelect.itemKey = '';\n        this.temp.teamCode = '';\n      }\n\n      setTimeout(function () {\n        if (val) {\n          // 班组组件传入orgCode即可过滤成只包含当前组织的班组\n          _this.$refs.teamSelect.getOptions(val);\n        } else {\n          _this.$refs.teamSelect.getOptions();\n        }\n      }, 0);\n    },\n    'temp.teamCode': function tempTeamCode(val) {\n      if (val) {\n        this.getTeamWorker(val);\n      } else {\n        this.temp.executor = undefined;\n      }\n    },\n    'temp.executor': function tempExecutor(val) {\n      if (val && this.dialogStatus == 'create') {\n        this.temp.executorName = this.teamWorker.filter(function (item) {\n          return item.employeeCode == val;\n        })[0].employeeName;\n      } else {\n        this.temp.executorName = '';\n      }\n    }\n  },\n  filters: {\n    splitState: function splitState(e) {\n      if (e === '1') {\n        return '是';\n      } else {\n        return '否';\n      }\n    }\n  },\n  computed: _objectSpread({}, mapState({\n    dt_inspection_plan_cycle: function dt_inspection_plan_cycle(state) {\n      return state.eamDict.dt_inspection_plan_cycle;\n    },\n    dt_inspection_plan_remind: function dt_inspection_plan_remind(state) {\n      return state.eamDict.dt_inspection_plan_remind;\n    }\n  })),\n  mounted: function mounted() {\n    var _this2 = this;\n\n    this.setTableHeight(); //表格高度自适应\n\n    window.onresize = function () {\n      _this2.setTableHeight();\n    };\n\n    this.getList();\n    this.$store.dispatch('eamDict/getDicData', ['dt_inspection_plan_cycle', 'dt_inspection_plan_remind']);\n  },\n  methods: {\n    getList: function getList() {\n      var _this3 = this;\n\n      api.queryRecords(this.listQuery).then(function (res) {\n        _this3.list = res.data.list;\n        _this3.total = res.data.pages.count;\n\n        if (_this3.list.length) {\n          _this3.$nextTick(function () {\n            // 默认选中第一行\n            _this3.$refs.mainList.toggleRowSelection(_this3.list[0], true);\n\n            _this3.getListSub();\n          });\n        }\n      });\n    },\n    getTeamWorker: function getTeamWorker(teamCode) {\n      var _this4 = this;\n\n      queryTeamEmployee(teamCode, {\n        currentPage: 1,\n        pageSize: 1000\n      }).then(function (res) {\n        _this4.teamWorker = res.data.list;\n      });\n    },\n    getListSub: function getListSub() {\n      switch (this.tabName) {\n        case 'jhzxjl':\n          this.$refs.tab1[0].getList();\n          break;\n\n        case 'tgsj':\n          this.$refs.tab2[0].getList();\n          break;\n\n        case 'dxjsb':\n          this.$refs.tab3[0].getList();\n          break;\n      }\n    },\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.theight = this.$myFun.getSingleTbHeight() - 185;\n    },\n    handleQuery: function handleQuery() {\n      //查询\n      this.listQuery.currentPage = 1;\n      this.getList();\n    },\n    handleCreate: function handleCreate() {\n      this.resetTemp(); //新增按钮单击事件方法\n\n      this.dialogStatus = 'create';\n      this.dialogFormVisible = true;\n    },\n    create: function create() {\n      var _this5 = this;\n\n      this.$refs['temp'].validate(function (valid) {\n        if (valid) {\n          api.addRecords(_this5.temp).then(function (res) {\n            if (res.status == 201) {\n              _this5.$message({\n                title: '成功',\n                message: '新增成功',\n                type: 'success',\n                duration: 2000\n              });\n\n              _this5.getList();\n\n              _this5.dialogFormVisible = false;\n            }\n          });\n        }\n      });\n    },\n    handleUpdate: function handleUpdate() {\n      var _this6 = this;\n\n      this.resetTemp();\n\n      if (this.selectlistRow.length) {\n        this.temp = this.selectlistRow[0];\n        this.tempVal.employeeName = this.selectlistRow[0].executorName;\n        this.dialogStatus = 'update';\n        this.dialogFormVisible = true;\n        setTimeout(function () {\n          _this6.$refs.teamSelect.itemKey = _this6.selectlistRow[0].teamCode;\n        }, 0);\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    handleUpdate2: function handleUpdate2() {\n      if (this.selectlistRow.length) {\n        this.temp = this.selectlistRow[0];\n        this.tempVal.employeeName = this.selectlistRow[0].executorName;\n        this.dialogVisible2 = true;\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    update: function update() {\n      var _this7 = this;\n\n      this.$refs['temp'].validate(function (valid) {\n        if (valid) {\n          api.patchRecords(_this7.temp.inspectionPlanCode, _this7.temp).then(function (res) {\n            if (res.status == 201) {\n              _this7.$message({\n                title: '成功',\n                message: '修改成功',\n                type: 'success',\n                duration: 2000\n              });\n\n              _this7.getList();\n\n              _this7.dialogFormVisible = false;\n              _this7.dialogVisible2 = false;\n            }\n          });\n        }\n      });\n    },\n    handleDelete: function handleDelete() {\n      var _this8 = this;\n\n      //删除列表\n      if (this.selectlistRow.length) {\n        this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          api.deleteRecords(_this8.selectlistRow[0].inspectionPlanCode).then(function () {\n            _this8.getList(), _this8.$message({\n              title: '成功',\n              message: '删除成功',\n              type: 'success',\n              duration: 2000\n            });\n          });\n        }).catch(function () {\n          _this8.$message({\n            type: 'info',\n            message: '已取消删除'\n          });\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    handleState: function handleState(num) {\n      var _this9 = this;\n\n      //删除列表\n      if (this.selectlistRow.length) {\n        api.changeRecords(this.selectlistRow[0].inspectionPlanCode, num).then(function () {\n          _this9.getList(), _this9.$message({\n            title: '成功',\n            message: num == 'YES' ? '启用成功' : '已停用',\n            type: 'success',\n            duration: 2000\n          });\n        });\n      } else {\n        this.$message({\n          title: '警告',\n          message: '请选择一条信息',\n          type: 'warning'\n        });\n      }\n    },\n    handleBarcode: function handleBarcode() {},\n    handleClick: function handleClick() {\n      if (this.selectlistRow.length) {\n        this.getListSub();\n      }\n    },\n    // 获取表格选中时的数据\n    selectRow: function selectRow(val) {\n      this.selectlistRow = val;\n\n      if (val.length == 0) {\n        this.selectlistRow = [];\n        this.$refs.tab3[0].list = [];\n        return false;\n      }\n\n      if (val.length > 1) {\n        this.$refs.mainList.clearSelection();\n        this.$refs.mainList.toggleRowSelection(val[val.length - 1]);\n      }\n\n      this.$refs.mainList.setCurrentRow(this.selectlistRow[0]);\n\n      if (this.selectlistRow.length) {\n        this.getListSub();\n      }\n    },\n    //主表行点击\n    showSubTable: function showSubTable(val) {\n      this.$refs.mainList.toggleRowSelection(val, 'selected');\n    },\n    resetTemp: function resetTemp() {\n      this.temp = {\n        inspectionPlanName: undefined,\n        teamCode: undefined,\n        executor: undefined,\n        rollCycle: undefined,\n        rollCycleUtil: undefined,\n        executorRange: undefined,\n        executorRangeUtil: undefined,\n        nextInspectionTime: undefined,\n        remindTime: undefined,\n        remindTimeUtil: undefined,\n        isEnable: undefined,\n        remark: undefined\n      };\n      this.tempVal = {\n        employeeName: undefined\n      };\n    }\n  }\n};",null]}