{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/knProcessing/jhknProcessing/content/contentRegister.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/knProcessing/jhknProcessing/content/contentRegister.vue","mtime":1596610934125},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.split\";\nimport _objectSpread from \"/Users/yuan/Documents/\\u5927\\u5510\\u5E7F\\u7535/dt-web/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as api from \"@/api/project/wms/knProcessing/knjgplan\"; // import wlxz from '@/components/Select/wlxz'//物料信息模块\n\nimport { mapState } from 'vuex';\nimport AuthoType from '@/components/Select/AuthoType.vue'; //权限类型下拉组件\n\nexport default {\n  name: \"contentRegister\",\n  components: {\n    AuthoType: AuthoType\n  },\n  data: function data() {\n    return {\n      rheight: 0,\n      list: null,\n      listSub: null,\n      executionStatusArr: ['0', '1'],\n      listQuery: {\n        orgCode: undefined,\n        warehouseCode: undefined,\n        dicType: undefined,\n        accountDate: this.timeFormat(),\n        planNo: undefined,\n        planDate: undefined,\n        executionStatus: undefined\n      },\n      totalsub: 0,\n      total: 0,\n      curRow: null,\n      selectRows: [],\n      wlxzDialogFormVisible: false,\n      wlxzRows: [],\n      rules: {\n        orgCode: [{\n          required: true,\n          message: ' ',\n          trigger: 'blur'\n        }],\n        warehouseCode: [{\n          required: true,\n          message: ' ',\n          trigger: 'blur'\n        }],\n        dicType: [{\n          required: true,\n          message: ' ',\n          trigger: 'blur'\n        }],\n        accountDate: [{\n          required: true,\n          message: ' ',\n          trigger: 'blur'\n        }]\n      },\n      defaultStockType: undefined,\n      defaultStockStatus: undefined,\n      defaultStockTypeSub: undefined,\n      defaultStockStatusSub: undefined,\n      areaList: null,\n      locatorList: [],\n      locatorListD: [],\n      saveData: {},\n      //保存的数据\n      businessTypeList: [],\n      configBusiness: {\n        db: '0908',\n        cz: '0902',\n        zz: '0901'\n      },\n      isEdit: false,\n      isSaveEdit: false\n    };\n  },\n  computed: _objectSpread({}, mapState({\n    dt_stock_type: function dt_stock_type(state) {\n      return state.dict.dt_stock_type;\n    },\n    dt_stock_status: function dt_stock_status(state) {\n      return state.dict.dt_stock_status;\n    }\n  })),\n  mounted: function mounted() {\n    this.setTableHeight();\n    this.$store.dispatch('dict/getDicData', ['dt_stock_type', 'dt_stock_status']);\n  },\n  methods: {\n    //表格高度计算\n    setTableHeight: function setTableHeight() {\n      this.rheight = this.$myFun.getSingleTbHeight() - 110;\n    },\n    timeFormat: function timeFormat() {\n      var d = new Date();\n      var year = d.getFullYear(); //年  \n\n      var month = d.getMonth() + 1; //月  \n\n      var day = d.getDate(); //日  \n\n      var clock = year + \"-\";\n      if (month < 10) clock += \"0\";\n      clock += month + \"-\";\n      if (day < 10) clock += \"0\";\n      clock += day + \" \";\n      return clock;\n    },\n    getList: function getList() {\n      var _this = this;\n\n      var queryData = {\n        page: true,\n        currentPage: 1,\n        pageSize: 10,\n        method: 'executions',\n        orgCode: this.listQuery.orgCode,\n        warehouseCode: this.listQuery.warehouseCode,\n        dicType: this.listQuery.dicType,\n        planNo: this.listQuery.planNo,\n        planDate: this.listQuery.planDate,\n        executionStatus: this.executionStatusArr.join(','),\n        state: 1\n      };\n      this.listSub = [];\n      api.queryRecordsDetail(queryData).then(function (res) {\n        _this.list = res.data.list;\n        _this.total = res.data.pages.count;\n        api.getArea(_this.listQuery.warehouseCode).then(function (resa) {\n          _this.areaList = resa.data;\n\n          _this.setDefaultTable();\n        });\n      });\n    },\n    getSubList: function getSubList(val) {\n      var _this2 = this;\n\n      var versions = val.versions;\n      api.getKlDetail(versions).then(function (res) {\n        _this2.listSub = res.data;\n\n        _this2.setDefaultSub();\n\n        _this2.calculateNum(_this2.selectRows.quantity);\n      });\n    },\n    //主表勾选框选中\n    selectRow: function selectRow(val) {\n      console.log(val, 'val');\n      this.selectRows = val[val.length - 1];\n\n      if (val.length > 1) {\n        this.$refs.tbmain.clearSelection();\n        this.$refs.tbmain.toggleRowSelection(val[val.length - 1], 'selected');\n      }\n\n      if (val.length !== 0) {\n        this.getSubList(val[val.length - 1]);\n      }\n    },\n    rowClick: function rowClick(row) {\n      // this.curRow = row\n      this.$refs.tbmain.toggleRowSelection(row, true);\n    },\n    setdefault: function setdefault(val, i) {\n      if (i === 1) {\n        this.listQuery.orgCode = val;\n      } else if (i === 3) {\n        this.listQuery.warehouseCode = val;\n      }\n    },\n    getLocatorList: function getLocatorList(warehouseCode, areaCode, i) {\n      var _this3 = this;\n\n      api.getLocator(warehouseCode, areaCode).then(function (res) {\n        _this3.$set(_this3.locatorList, i, res.data);\n\n        _this3.list[i].wareLocationCode = _this3.locatorList[i][0].locationCode;\n\n        _this3.$set(_this3.list, i, _this3.list[i]);\n      });\n    },\n    getLocatorListD: function getLocatorListD(warehouseCode, areaCode, i) {\n      var _this4 = this;\n\n      api.getLocator(warehouseCode, areaCode).then(function (res) {\n        _this4.$set(_this4.locatorListD, i, res.data);\n\n        _this4.listSub[i].wareLocationCode = _this4.locatorListD[i][0].locationCode;\n\n        _this4.$set(_this4.listSub, i, _this4.listSub[i]);\n      });\n    },\n    changeAreaSel: function changeAreaSel(areaCode, i) {\n      this.getLocatorList(this.listQuery.warehouseCode, areaCode, i);\n    },\n    changeAreaSelD: function changeAreaSelD(areaCode, i) {\n      this.getLocatorListD(this.listQuery.warehouseCode, areaCode, i);\n    },\n    //查询\n    handleQuery: function handleQuery() {\n      var _this5 = this;\n\n      if (!this.listQuery.orgCode || !this.listQuery.warehouseCode || !this.listQuery.dicType) {\n        this.$message({\n          title: this.$t(\"message.warning\"),\n          message: '请先选择组织编码,仓库编码及业务类型再搜索',\n          type: \"warning\"\n        });\n      } else {\n        api.queryStock(this.listQuery.dicType).then(function (res) {\n          _this5.defaultStockType = res.data.list[0].fetchStockType.split(\",\")[0];\n          _this5.defaultStockStatus = res.data.list[0].fetchStockStat.split(\",\")[0];\n\n          if (res.data.list[0].completedLink) {\n            api.queryStock(res.data.list[0].completedLink).then(function (resa) {\n              _this5.defaultStockTypeSub = resa.data.list[0].fetchStockType.split(\",\")[0];\n              _this5.defaultStockStatusSub = resa.data.list[0].fetchStockStat.split(\",\")[0];\n              _this5.isEdit = true;\n\n              _this5.getList();\n            });\n          } else {\n            _this5.defaultStockTypeSub = _this5.defaultStockType;\n            _this5.defaultStockStatusSub = _this5.defaultStockStatus;\n            _this5.isEdit = true;\n\n            _this5.getList();\n          }\n        });\n      }\n    },\n    //保存\n    handleSave: function handleSave() {\n      var _this6 = this;\n\n      if (this.selectRows) {\n        if (this.selectRows.length === 0) {\n          this.$message({\n            title: this.$t(\"message.warning\"),\n            message: '请先选择一条主数据',\n            type: \"warning\"\n          });\n        } else {\n          var saveable = true;\n          this.list.forEach(function (item) {\n            if (item.quantity > item.unexecutedNum) {\n              saveable = false;\n            }\n          });\n\n          if (!saveable) {\n            this.$message({\n              title: this.$t(\"message.warning\"),\n              message: '本次完工不能大于待完工，请检查后再保存',\n              type: \"warning\"\n            });\n          } else if (!this.listQuery.accountDate) {\n            this.$message({\n              title: this.$t(\"message.warning\"),\n              message: '记账日期不能为空',\n              type: \"warning\"\n            });\n          } else {\n            this.$refs.listQuery.validate(function (valid) {\n              if (valid) {\n                var saveData = {\n                  orgCode: '',\n                  warehouseCode: '',\n                  dicType: '',\n                  relationDicType: '',\n                  accountDate: '',\n                  processingAssemblyDTO: {},\n                  assemblyDetailDTOSs: [],\n                  planNo: _this6.selectRows.planNo,\n                  planRowNo: _this6.selectRows.rowNo\n                };\n\n                for (var key in _this6.listQuery) {\n                  if (key === 'orgCode' || key === 'warehouseCode' || key === 'dicType' || key === 'relationDicType' || key === 'accountDate') {\n                    saveData[key] = _this6.listQuery[key];\n                  }\n                }\n\n                for (var _key in _this6.selectRows) {\n                  if (_key === 'materielCode' || _key === 'materielName' || _key === 'measuringUnit' || _key === 'quantity' || _key === 'stockState' || _key === 'stockType' || _key === 'wareAreaCode' || _key === 'wareLocationCode') {\n                    saveData.processingAssemblyDTO[_key] = _this6.selectRows[_key];\n                  }\n\n                  if (_key === 'stockStateArr') {\n                    saveData.processingAssemblyDTO['stockState'] = _this6.selectRows.stockStateArr.join(',');\n                  }\n\n                  if (_key === 'stockTypeArr') {\n                    saveData.assemblyDetailDTOSs['stockType'] = _this6.selectRows.stockTypeArr.join(',');\n                  }\n                }\n\n                if (_this6.listSub) {\n                  _this6.listSub.forEach(function (item, index) {\n                    saveData.assemblyDetailDTOSs.push({});\n\n                    for (var _key2 in item) {\n                      if (_key2 === 'materielCode' || _key2 === 'materielName' || _key2 === 'measuringUnit' || _key2 === 'quantity' || _key2 === 'stockState' || _key2 === 'stockType' || _key2 === 'wareAreaCode' || _key2 === 'wareLocationCode') {\n                        saveData.assemblyDetailDTOSs[index][_key2] = item[_key2];\n                      }\n\n                      if (_key2 === 'stockStateArr') {\n                        saveData.assemblyDetailDTOSs[index]['stockState'] = item.stockStateArr.join(',');\n                      }\n\n                      if (_key2 === 'stockTypeArr') {\n                        saveData.assemblyDetailDTOSs[index]['stockType'] = item.stockTypeArr.join(',');\n                      }\n                    }\n                  });\n\n                  _this6.$confirm('确认保存吗?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                  }).then(function () {\n                    _this6.isSaveEdit = true;\n                    api.createProof(saveData).then(function () {\n                      _this6.$message({\n                        type: 'success',\n                        message: '保存成功'\n                      });\n                    });\n                  });\n                } else {\n                  _this6.$message({\n                    title: _this6.$t(\"message.warning\"),\n                    message: '请先选择有计划号的加工数据',\n                    type: \"warning\"\n                  });\n                }\n              } else {\n                _this6.$message({\n                  title: _this6.$t(\"message.warning\"),\n                  message: '请先填写及选择必填项',\n                  type: \"warning\"\n                });\n              }\n            });\n          }\n        }\n      } else {\n        this.$message({\n          title: this.$t(\"message.warning\"),\n          message: '请先选择一条主数据',\n          type: \"warning\"\n        });\n      }\n    },\n    //业务类型相关值操作\n    setdicTypeRelated: function setdicTypeRelated(val) {\n      var _this7 = this;\n\n      this.businessTypeList.options.forEach(function (item) {\n        if (item.wareRuleCode === val) {\n          _this7.listQuery.relationDicType = item.completedLink;\n\n          if (_this7.listQuery.dicType === _this7.configBusiness.cz) {\n            _this7.listQuery.stockState = item.fetchStockStat;\n            _this7.listQuery.stockType = item.fetchStockType;\n          } else {\n            _this7.listQuery.stockState = item.storeStockStat;\n            _this7.listQuery.stockType = item.storeStockType;\n          }\n        }\n      });\n    },\n    //刷新\n    handleRefresh: function handleRefresh() {\n      this.isEdit = false;\n      this.isSaveEdit = false;\n      this.list = [];\n      this.listSub = [];\n    },\n    calculateNum: function calculateNum(quantity) {\n      var _this8 = this;\n\n      if (quantity) {\n        if (this.listQuery.dicType === this.configBusiness.zz) {\n          this.listSub.map(function (item, index) {\n            _this8.$set(_this8.listSub[index], 'quantity', parseFloat(item.assemblingNum) * parseFloat(quantity));\n          });\n        }\n\n        if (this.listQuery.dicType === this.configBusiness.cz) {\n          this.listSub.map(function (item, index) {\n            _this8.$set(_this8.listSub[index], 'quantity', parseFloat(item.dismantlingNum) * parseFloat(quantity));\n          });\n        }\n      }\n    },\n    setDefaultTable: function setDefaultTable() {\n      var _this9 = this;\n\n      this.list.forEach(function (item, index) {\n        if (_this9.listQuery.dicType === _this9.configBusiness.cz) {\n          _this9.$set(_this9.list[index], 'stockTypeArr', [_this9.defaultStockType]);\n\n          _this9.$set(_this9.list[index], 'stockStateArr', [_this9.defaultStockStatus]);\n        } else {\n          _this9.$set(_this9.list[index], 'stockType', _this9.defaultStockType);\n\n          _this9.$set(_this9.list[index], 'stockState', _this9.defaultStockStatus);\n        }\n\n        _this9.list[index].wareAreaCode = _this9.areaList[0].areaCode;\n\n        _this9.changeAreaSel(_this9.areaList[0].areaCode, index);\n      });\n    },\n    setDefaultSub: function setDefaultSub() {\n      var _this10 = this;\n\n      this.listSub.forEach(function (item, index) {\n        if (_this10.listQuery.dicType === _this10.configBusiness.cz) {\n          _this10.$set(_this10.listSub[index], 'stockTypeArr', [_this10.defaultStockTypeSub]);\n\n          _this10.$set(_this10.listSub[index], 'stockStateArr', [_this10.defaultStockStatusSub]);\n        } else {\n          _this10.$set(_this10.listSub[index], 'stockType', _this10.defaultStockTypeSub);\n\n          _this10.$set(_this10.listSub[index], 'stockState', _this10.defaultStockStatusSub);\n        }\n\n        _this10.listSub[index].wareAreaCode = _this10.areaList[0].areaCode;\n\n        _this10.changeAreaSelD(_this10.areaList[0].areaCode, index);\n      });\n    }\n  }\n};",null]}