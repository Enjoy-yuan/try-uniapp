{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js!/Users/yuan/Documents/大唐广电/dt-web/node_modules/eslint-loader/index.js??ref--13-0!/Users/yuan/Documents/大唐广电/dt-web/src/utils/checkToken.js","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/utils/checkToken.js","mtime":1597749597493},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.constructor\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport { setToken, getName, getPassWord, getTokenTime, setTokenTime, removeTokenTime, removeToken } from '@/utils/auth'; // getToken from cookie\n\nimport { getTokenId } from '@/api/login';\nexport function checkToken() {\n  var expire = getTokenTime();\n  expire = expire.replace(new RegExp('-', 'gm'), '/');\n  expire = new Date(expire).getTime(); //得到毫秒数\n\n  var nowData = new Date().getTime(); //当前时间转化为分钟\n\n  var duringTime = (expire - nowData) / 1000 / 60; //token剩余时间间隔 5min\n\n  if (duringTime > 0 && duringTime < 10) {\n    var auth = {\n      auth: {\n        identity: {\n          methods: ['password'],\n          password: {\n            user: {\n              name: getName(),\n              password: getPassWord()\n            }\n          }\n        }\n      }\n    };\n    return new Promise(function (resolve, reject) {\n      getTokenId(auth).then(function (res) {\n        //获取刷新token\n        var userToken = {\n          auth: {\n            identity: {\n              methods: ['token'],\n              token: {\n                id: res.headers['x-subject-token']\n              }\n            }\n          }\n        };\n        getTokenId(userToken).then(function (response) {\n          //获取访问token\n          setTokenTime(response.data.token.expireAt);\n          setToken(response.headers['x-subject-token']);\n          resolve();\n        });\n      }).catch(function (error) {\n        console.log('错误在checkToken里面'); // next(`/login?redirect=${to.path}`) // 否则全部重定向到登录页\n\n        reject(error);\n      });\n    });\n  } else {\n    if (duringTime < 0) {\n      removeTokenTime();\n      removeToken();\n      return false;\n    } else {\n      return true;\n    }\n  }\n}",null]}