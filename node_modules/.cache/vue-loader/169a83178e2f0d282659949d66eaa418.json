{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/database/deviceType/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/database/deviceType/index.vue","mtime":1596610933477},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Pagination from '@/components/Pagination' // Secondary package based on el-pagination\nimport * as api from '@/api/project/eas/database/eqmt'\n\nexport default {\n    name: 'eqmt',\n    components: { Pagination },\n    data () {\n        return {\n            tableKey: 0,\n            defaultProps: {\n                rowId: 'rowId', // 父级唯一标识\n                children: 'children',\n                label: 'typeName'\n            },\n            contentStyleObj: {\n                height: null\n            },\n            list: [],\n            list2: [],\n            treeData: [],\n            theight: 0, //表格高度\n            total: 0,\n            total1: 0,\n            listLoading: true,\n            listQuery: {\n                currentPage: 1,\n                pageSize: 10,\n                typeCode: undefined,\n                typeName: undefined\n            },\n            temp: {\n                typeName: undefined,\n                typeCode: undefined,\n                superiorCode: undefined,\n                remark: undefined\n            },\n            temp2: {\n                partName: undefined,\n                rowId: undefined\n            },\n            dialogStatus: '',\n            dialogStatus2: '',\n            dialogFormVisible: false,\n            partStatus: 'create',\n            selectlistRow: [],\n            partName: undefined\n        }\n    },\n    created () {\n        this.getList()\n        this.getTree()\n        this.getHeight()\n    },\n    mounted () {\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n            this.setTreeHeight()\n        }\n        this.getList()\n        this.setTreeHeight()\n    },\n    methods: {\n        getHeight () {\n            //自适应高度\n            this.contentStyleObj.height =\n                document.body.scrollHeight - 110 + 'px'\n        },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() / 2.2\n        },\n        //树高度设置\n        setTreeHeight () {\n            this.contentStyleObj.height = this.$myFun.getTreehHeight()\n        },\n        destroyed () {\n            //自适应窗体大小\n            window.removeEventListener('resize', this.getHeight)\n        },\n        resetTemp () {\n            this.temp = {\n                typeName: undefined,\n                typeCode: undefined,\n                superiorCode: undefined,\n                remark: undefined\n            }\n        },\n        getList () {\n            //获取数据\n            api.queryRecords(this.listQuery).then(res => {\n                this.list = res.data.list.filter(\n                    item => item.typeName != '设备类型'\n                )\n                this.total = res.data.pages.count\n                if (this.list.length) {\n                    this.$nextTick(() => {\n                        this.$refs.tb_a.toggleRowSelection(this.list[0])\n                    })\n                } else {\n                    this.list2 = []\n                }\n                // this.list2 = []\n            })\n        },\n        getList2 () {\n            //获取数据\n            api.queryRecords2(this.selectlistRow[0].typeCode).then(res => {\n                this.list2 = res.data\n            })\n        },\n        getTree () {\n            //获取树数据\n            api.queryRecords().then(res => {\n                this.treeData = this.$myFun.buildTree(\n                    res.data,\n                    'typeCode',\n                    'superiorCode'\n                )\n                setTimeout(() => {\n                    this.listLoading = false\n                }, 1.5 * 100)\n            })\n        },\n        handleEdit () {\n            //更新弹窗调用\n            if (this.selectlistRow.length) {\n                this.temp = this.selectlistRow[0] // copy obj\n                this.dialogStatus = 'update'\n                this.dialogFormVisible = true\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n            }\n        },\n        handleCreate () {\n            //新增弹窗调用\n            if (this.listQuery.superiorCode) {\n                this.resetTemp()\n                this.temp.superiorCode = this.listQuery.superiorCode\n                this.dialogStatus = 'create'\n                this.dialogFormVisible = true\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择左侧上级菜单',\n                    type: 'warning'\n                })\n            }\n        },\n        handleCreateFrom () {\n            //新增部件弹窗调用\n            if (!this.selectlistRow.length) {\n                this.$message({\n                    title: '警告',\n                    message: '请选择设备类型',\n                    type: 'warning'\n                })\n                return false\n            }\n            if (!this.temp2.partName) {\n                this.$message({\n                    title: '警告',\n                    message: '请输入部位名称',\n                    type: 'warning'\n                })\n                return false\n            }\n            api.addRecords2({\n                partName: this.temp2.partName,\n                typeCode: this.selectlistRow[0].typeCode\n            }).then(res => {\n                if (res.status == 201) {\n                    this.getList2()\n                    this.dialogFormVisible2 = false\n                    this.$message({\n                        title: '成功',\n                        message: '添加成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n                    this.temp2.partName = undefined\n                }\n            })\n        },\n        createFrom () {\n            api.addRecords(this.temp).then(res => {\n                if (res.status == 201) {\n                    this.getList()\n                    this.getTree()\n                    this.dialogFormVisible = false\n                    this.$message({\n                        title: '成功',\n                        message: '新增成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n                }\n            })\n        },\n        handleEditRow (scope) {\n            this.partStatus = 'update'\n            this.dialogFormVisible2 = true\n            this.temp2 = scope.row\n        },\n        editForm () {\n            api.patchRecords(this.temp).then(res => {\n                if (res.status == 201) {\n                    this.getList()\n                    this.getTree()\n                    this.dialogFormVisible = false\n                    this.$message({\n                        title: '成功',\n                        message: '修改成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n                }\n            })\n        },\n        editForm2 () {\n            api.patchRecords2(this.temp2).then(res => {\n                if (res.status == 201) {\n                    this.temp2.partName = undefined\n                    this.partStatus = 'create'\n                    this.dialogFormVisible2 = false\n                    this.$message({\n                        title: '成功',\n                        message: '修改成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n                    this.getList2()\n                }\n            })\n        },\n        cancelEdit () {\n            this.temp2.partName = undefined\n            this.partStatus = 'create'\n            this.getList2()\n        },\n        handleDelete () {\n            api.deleteRecords(this.selectlistRow[0].typeCode).then(res => {\n                if (res.status == 204) {\n                    this.getList()\n                    this.getTree()\n                    this.dialogFormVisible = false\n                    this.$message({\n                        title: '成功',\n                        message: '删除成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n                }\n            })\n        },\n        handleFilter () {\n            this.listQuery.superiorCode = undefined\n            this.listQuery.currentPage = 1\n            //查询\n            this.getList()\n        },\n        handleCreateRow () {\n            if (!this.selectlistRow.length) {\n                this.$message({\n                    title: '警告',\n                    message: '请选择设备',\n                    type: 'warning'\n                })\n                return false\n            }\n            api.addRecords2({\n                partName: this.temp2.partName,\n                typeCode: this.selectlistRow[0].typeCode\n            }).then(res => {\n                if (res.status == 201) {\n                    this.getList2()\n                    this.dialogFormVisible2 = false\n                    this.$message({\n                        title: '成功',\n                        message: '添加成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n                }\n            })\n        },\n        handleDeleteRow (row) {\n            this.$confirm('是否对' + row.partName + '部位进行删除?', '提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning'\n            })\n                .then(() => {\n                    //删除\n                    api.deleteRecords2(row.rowId).then(res => {\n                        if (res.status == 204) {\n                            this.getList2()\n                            this.dialogFormVisible = false\n                            this.$message({\n                                title: '成功',\n                                message: '删除成功',\n                                type: 'success',\n                                duration: 2000\n                            })\n                        }\n                    })\n                })\n                .catch(() => {\n                    this.$message({\n                        type: 'info',\n                        message: '已取消'\n                    })\n                })\n        },\n        // 获取表格选中时的数据\n        selectRow (val) {\n            this.$refs.tb_a.toggleRowSelection(val, 'selected')\n        },\n        rowClick (val) {\n            this.selectlistRow = val\n            if (val.length == 0) {\n                this.selectlistRow = []\n                // this.list2 = []\n                return false\n            }\n            if (val.length > 1) {\n                this.$refs.tb_a.clearSelection()\n                this.$refs.tb_a.toggleRowSelection(val[val.length - 1])\n            }\n            this.$refs.tb_a.setCurrentRow(this.selectlistRow[0])\n            if (this.selectlistRow.length) {\n                this.getList2()\n            }\n        },\n        handleNodeClick (data) {\n            //点击树查询\n            this.listQuery.superiorCode = data.typeCode\n            // this.listQuery.typeCode = data.typeCode\n            this.getList()\n        }\n    }\n}\n",null]}