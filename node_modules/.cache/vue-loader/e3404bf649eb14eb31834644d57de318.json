{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierManagement/supplierChange/supplierChangeNotice/dialog/addMain.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierManagement/supplierChange/supplierChangeNotice/dialog/addMain.vue","mtime":1596610933953},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/project/srm/supplierManage/supplierChangeNotice'\nimport * as api2 from \"@/api/project/srm/supplierManagement/supplierRegister\"\nimport { queryRecords, queryRecordItem } from '@/api/project/srm/supplierManage/supplierConfigure'\nimport platSupplier from \"@/components/Select/platSupplier\" // 分页组件\nimport { mapState } from 'vuex'\nimport throttle from 'lodash/throttle'\n\nexport default {\n    components: { platSupplier },\n    data () {\n        return {\n            temp: {\n                supplierCode: undefined\n            },\n            items: {},\n            changeType: [],\n            attributeList: [],\n            tableKey: 0,\n            list: [],\n            supplierList: [],\n            value1: \"\",\n            value2: \"\",\n            dialogStatus: \"\",\n            queryState: ['PAR1', 'PAR2'],\n            dialogVisible: false,\n            dialogVisiblesx: false,\n            dialogVisibleSupplier: false,\n            edlist: [],\n            changeConfigId: null,\n            changeOrderNo: null,\n            rowId: null,\n            showForm: false,//表单数据是否可编辑\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_par: state => state.dict.dt_srm_par,\n\n        })\n    },\n    mounted () {\n        this.$store.dispatch('dict/getDicData', ['dt_srm_par'])\n    },\n    methods: {\n        handleCreate () {\n            if (this.temp.changeTypeCode && this.temp.supplierCode && this.temp.supplierName && this.temp.reason) {\n                if (this.temp.changeOrderNo === undefined) {\n                    api.addRecord(this.temp).then(res => {\n                        console.log(res, 'pp')\n                        this.temp = res.data\n                        this.changeConfigId = res.data.changeConfigId\n                        this.changeOrderNo = res.data.changeOrderNo\n                        this.$message({\n                            title: '成功',\n                            message: '新增成功',\n                            type: 'success',\n                            duration: 2000\n                        })\n                        this.$emit('refresh')\n\n                    })\n                } else if (this.temp.changeOrderNo !== undefined) {\n                    this.resetItems()\n                    this.dialogVisiblesx = true\n                    console.log(this.changeConfigId, 'ppppp')\n                    queryRecordItem(this.changeConfigId).then(res => {\n                        this.attributeList = res.data\n                    })\n                    let a = {\n                        currentPage: 1,\n                        pageSize: 10,\n                        platformState: 'PA1P',\n                        supplierCode: this.temp.supplierCode\n                    }\n                    api2.queryRecords(a).then(res => {\n                        res = res.data\n                        this.supplierList = res.list\n                    })\n                }\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择变更类型,供应商编码,供应商名称,变更原因',\n                    type: 'warning',\n                    duration: 2000\n                })\n            }\n\n        },\n        dataType () {\n            let type = this.temp.changeTypeCode\n            if (type) {\n                this.edlist = this.changeType.filter(item => {\n                    return item.type === type\n                })\n            }\n            this.temp.changeTypeName = this.edlist[0].represent\n            this.temp.changeConfigId = this.edlist[0].rowId\n            this.temp.changeMode = this.edlist[0].changeMode\n            if (this.edlist[0].changeMode == \"PAR2\") {\n                this.temp.processNumber = this.edlist[0].processNumber\n                // this.temp.changeMode = this.edlist[0].changeMode\n            } else {\n                delete this.temp.processNumber\n            }\n        },\n        getType () {\n            let a = {\n                state: 'P002',\n                changeMode: this.queryState.join(\",\")\n            }\n            queryRecords(a).then(res => {\n                this.changeType = res.data\n            })\n        },\n        getItemList () {\n            let a = {\n                changeOrderNo: this.changeOrderNo\n            }\n            api.queryRecordsItems(a).then(res => {\n                this.list = res.data\n            })\n        },\n\n        getFieldName () {\n            let getFieldName = this.attributeList.filter(item => {\n                return item.fieldCode === this.items.changeField\n            })\n            this.items.changeFieldName = getFieldName[0].fieldName\n            this.supplierList.forEach(val => {\n                for (let key in val) {\n                    getFieldName.forEach(item => {\n                        if (item.fieldCode === key) {\n                            this.items.beforeChange = val[key]\n                        }\n                    })\n                }\n            })\n\n        },\n        handleSupplier () {\n            // this.dialogVisibleSupplier = true\n            this.dialogVisibleSupplier = true\n        },\n        handleDelete (index, val) {\n            api.deleteRecordItems(this.changeOrderNo, val.rowId).then(() => {\n                this.$message({\n                    title: '成功',\n                    message: '删除成功',\n                    type: 'success',\n                    duration: 2000\n                })\n                this.getItemList()\n            })\n        },\n        addConfirm: throttle(function () {\n            api.addRecord(this.temp).then(() => {\n                this.$message({\n                    title: '成功',\n                    message: '新增成功',\n                    type: 'success',\n                    duration: 2000\n                })\n                this.dialogVisible = false\n                this.$emit('refresh')\n\n            })\n        }, 2000,\n            {\n                leading: true,\n                trailing: false\n            }\n        ),\n        updateConfirm: throttle(function () {\n            api.updateRecord(this.rowId, this.temp).then(() => {\n                this.$message({\n                    title: '成功',\n                    message: '编辑成功',\n                    type: 'success',\n                    duration: 2000\n                })\n                this.dialogVisible = false\n                this.$emit('refresh')\n            })\n        }, 2000,\n            {\n                leading: true,\n                trailing: false\n            }\n        ),\n        saveAttribute: throttle(function () {\n            this.items.changeOrderNo = this.changeOrderNo\n            api.addRecordItems(this.changeOrderNo, this.items).then(() => {\n                this.$message({\n                    title: '成功',\n                    message: '新增成功',\n                    type: 'success',\n                    duration: 2000\n                })\n                this.dialogVisiblesx = false\n                this.getItemList()\n            })\n        }, 2000,\n            {\n                leading: true,\n                trailing: false\n            }\n        ),\n        confirm () {\n            if (this.$refs.platSupplier.listSelected.length > 0) {\n                this.temp.supplierCode = this.$refs.platSupplier.listSelected[0].supplierCode\n                this.temp.supplierName = this.$refs.platSupplier.listSelected[0].supplierName\n                this.temp.contactAddress = this.$refs.platSupplier.listSelected[0].contactAddress\n                this.temp.contacts = this.$refs.platSupplier.listSelected[0].contacts\n                this.temp.legalPerson = this.$refs.platSupplier.listSelected[0].legalPerson\n                this.temp.mainFactory = this.$refs.platSupplier.listSelected[0].mainFactory\n                this.temp.purchaseOrg = this.$refs.platSupplier.listSelected[0].purchaseOrg\n                this.temp.purchaser = this.$refs.platSupplier.listSelected[0].purchaser\n                this.temp.supplierId = this.$refs.platSupplier.listSelected[0].rowId\n                this.temp.supplierShortName = this.$refs.platSupplier.listSelected[0].supplierShortName\n                this.temp.telephone = this.$refs.platSupplier.listSelected[0].telephone\n                this.dialogVisibleSupplier = false\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning',\n                    duration: 2000\n                })\n            }\n        },\n        resetTemp () {\n            this.temp = {\n                changeOrderNo: undefined,\n                changeTypeCode: undefined,\n                supplierCode: undefined,\n                supplierName: undefined,\n                reason: undefined,\n                remark: undefined,\n            }\n        },\n        resetItems () {\n            this.items = {\n                changeField: undefined,\n                beforeChange: undefined,\n                afterChange: undefined\n            }\n        }\n    }\n}\n",null]}