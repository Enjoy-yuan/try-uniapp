{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/barCodeRules/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/barCodeRules/index.vue","mtime":1596610933321},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/data-base/bar_code_rules'\nimport Pagination from '@/components/Pagination'\nimport AuthoType from '@/components/Select/AuthoType.vue' //权限类型下拉组件\nimport { DICT_CODE } from '@/utils/constant'\nimport dialogAddMain from './dialog/dialogAddMain'\nimport { mapState } from 'vuex'\n\nexport default {\n    name: 'barCodeRules',\n    components: { Pagination, dialogAddMain, AuthoType },\n    data () {\n        return {\n            total: 0,\n            listMain: [],\n            theight: 0, //表格高度\n            tableKey: 0, //表格索引\n            listMainQuery: {\n                rowId: '',\n                ruleDescribe: '',\n                ruleType: '',\n                arrivalCompany: null,\n                currentPage: 0,\n                pageSize: 15\n            },\n            editQuery: {\n                barcodeRuleId: '',\n                currentPage: 0,\n                pageSize: 10\n            },\n            selectMainRow: '',\n            DICT_CODE: DICT_CODE\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_rules_type: state => state.dict.dt_rules_type\n        })\n    },\n    mounted () {\n        this.$store.dispatch('dict/getDicData', ['dt_rules_type'])\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.getMainList()\n    },\n    methods: {\n        //查询\n        handleQuery () {\n            this.getMainList()\n        },\n        //获取主表数据\n        getMainList () {\n            api.queryRecords(this.listMainQuery).then(res => {\n                this.listMain = res.data.list\n                this.total = res.data.pages.count\n            })\n        },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight()\n        },\n        //主表行选择变化\n        mainSelectChange (val) {\n            this.selectMainRow = val\n        },\n        //主表新增\n        addMain () {\n            this.$nextTick(() => {\n                this.resetAddData()\n                this.$refs.addMainDialog.dialogFormVisible = true\n                this.$refs.addMainDialog.dialogStatus = 0\n            })\n        },\n        //清空表单\n        resetAddData () {\n            this.$refs.addMainDialog.AddMainlist = {\n                ruleDescribe: '',\n                ruleType: '',\n                barcodeRuleDetails: [] //所有的内容\n            }\n            this.$refs.addMainDialog.lastBarcodeRuleDetails = []\n            this.$refs.addMainDialog.barcodeRuleDetails = []\n            this.$refs.addMainDialog.rowId = ''\n        },\n        //主表修改\n        updateMain () {\n            if (this.selectMainRow && this.selectMainRow.length == 1) {\n                this.editQuery.barcodeRuleId = this.selectMainRow[0].rowId\n                api.getRowDetail(this.editQuery).then(res => {\n                    this.$refs.addMainDialog.dialogStatus = 1\n                    this.$refs.addMainDialog.AddMainlist = this.selectMainRow[0]\n                    this.$refs.addMainDialog.lastBarcodeRuleDetails =\n                        res.data.list\n                    this.$refs.addMainDialog.barcodeRuleDetails = res.data.list\n                    this.$refs.addMainDialog.rowId = this.selectMainRow[0].rowId\n                    this.$refs.addMainDialog.dialogFormVisible = true\n                })\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n            }\n        },\n        //主表删除\n        deleteMain () {\n            if (this.selectMainRow.length === 1) {\n                this.$confirm('确认要删除该条码规则吗?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                })\n                    .then(() => {\n                        api.deleteRules(\n                            this.selectMainRow[0].rowId,\n                            this.selectMainRow[0].ruleType\n                        ).then(() => {\n                            this.getMainList()\n                            this.$message({\n                                type: 'success',\n                                message: '删除成功'\n                            })\n                        })\n                    })\n                    .catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消'\n                        })\n                    })\n            } else {\n                this.$message.warning('请勾选一条记录！')\n                return\n            }\n        }\n    }\n}\n",null]}