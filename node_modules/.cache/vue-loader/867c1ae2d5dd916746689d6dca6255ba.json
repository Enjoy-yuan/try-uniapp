{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/tab/tabYCLcost.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/tab/tabYCLcost.vue","mtime":1599136050832},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { queryQuoteItem, createQuoteItem, updateQuoteItem, deleteQuoteItem, queryQuoteDetails } from \"@/api/project/srm/supplierSelect/supplierRFQ/supplierRFQAnswer\"\n\nexport default {\n    props: ['parentRowId'],\n    name: 'tabYCLcost',\n    data () {\n        return {\n            tableData: [],\n            rules: {\n                subpartName: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                subpartCode: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                materialName: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                factory: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                specification: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                unitPrice: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                consumptionQuota: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                netWeight: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                recoveredUnitPrice: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                rejectRate: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ]\n            },\n            formData: {\n                parentRowId: null,\n                subpartName: null,\n                subpartCode: null,\n                materialName: null,\n                factory: null,\n                specification: null,\n                materielClass: null,\n                unitPrice: null,\n                consumptionQuota: null,\n                subtotalCost: null,\n                netWeight: null,\n                recoveredUnitPrice: null,\n                recyclableWeight: null,\n                recoveryValue: null,\n                rejectRate: null,\n                wasteLoss: null\n            },\n            formConfig: [\n                { type: 'commonInput', required: true, label: '子件名称', prop: 'subpartName', width: '' },\n                { type: 'commonInput', required: true, label: '子件编码', prop: 'subpartCode', width: '' },\n                { type: 'commonInput', required: true, label: '材料名/牌号', prop: 'materialName', width: '' },\n                { type: 'commonInput', required: true, label: '生产厂', prop: 'factory', width: '' },\n                { type: 'commonInput', required: true, label: '规格型号', prop: 'specification', width: '' },\n                { type: 'commonInput', label: '计量单位', prop: 'measurement', width: '' },\n                { type: 'commonInput', inputType: 'number', required: true, label: '单价', prop: 'unitPrice', width: '' },//A1\n                { type: 'commonInput', inputType: 'number', required: true, label: '消耗定额', prop: 'consumptionQuota', width: '' },//A2\n                { type: 'commonInput', calculate: 'item.unitPrice*item.consumptionQuota', inputType: 'number', disabled: true, label: '费用小计', prop: 'subtotalCost', width: '' },// A1*A2\n                { type: 'commonInput', inputType: 'number', required: true, label: '净重', prop: 'netWeight', width: '' },// A3\n                { type: 'commonInput', inputType: 'number', required: true, label: '回收单价', prop: 'recoveredUnitPrice', width: '' },// A5\n                { type: 'commonInput', inputType: 'number', disabled: true, label: '可回收重量', prop: 'recyclableWeight', width: '' },// A4  (A2-A3)*0.98\n                { type: 'commonInput', inputType: 'number', disabled: true, label: '回收价值', prop: 'recoveryValue', width: '' },// A6=A4*A5\n                { type: 'commonInput', inputType: 'number', required: true, label: '废品率', prop: 'rejectRate', width: '' },// A7\n                { type: 'commonInput', inputType: 'number', disabled: true, label: '废品损失', prop: 'wasteLoss', width: '' }//A8 = A1*A3*A7\n            ],\n            tableConfig: [\n                // { label: '序号', prop: 'prop1', align: 'center', width: 'auto' },\n                { label: '子件名称', prop: 'subpartName', align: 'center', width: 'auto' },\n                { label: '子件编码', prop: 'subpartCode', align: 'center', width: 'auto' },\n                { label: '材料名/牌号', prop: 'materialName', align: 'center', width: '120' },\n                { label: '生产厂', prop: 'factory', align: 'center', width: 'auto' },\n                { label: '规格型号', prop: 'specification', align: 'center', width: 'auto' },\n                { label: '单价', prop: 'unitPrice', align: 'center', width: 'auto' },\n                { label: '消耗定额', prop: 'consumptionQuota', align: 'center', width: 'auto' },\n                { label: '计量单位', prop: 'measurement', align: 'center', width: 'auto' },\n                { label: '费用小计', prop: 'subtotalCost', align: 'center', width: 'auto' },\n                { label: '净重', prop: 'netWeight', align: 'center', width: 'auto' },\n                { label: '可回收重量', prop: 'recyclableWeight', align: 'center', width: '120' },\n                { label: '回收单价', prop: 'recoveredUnitPrice', align: 'center', width: 'auto' },\n                { label: '回收价值', prop: 'recoveryValue', align: 'center', width: 'auto' },\n                { label: '废品率(%)', prop: 'rejectRate', align: 'center', width: 'auto' },\n                { label: '废品损失', prop: 'wasteLoss', align: 'center', width: 'auto' }\n            ]\n        }\n    },\n    watch: {\n        'formData.unitPrice' (val) {\n            this.$set(this.formData, 'subtotalCost', (val * this.formData.consumptionQuota).toFixed(4))\n            this.$set(this.formData, 'wasteLoss', (this.formData.rejectRate * this.formData.netWeight * val / 100).toFixed(4))\n        },\n        'formData.consumptionQuota' (val) {\n            this.$set(this.formData, 'subtotalCost', (val * this.formData.unitPrice).toFixed(4))\n            this.$set(this.formData, 'recyclableWeight', ((val - this.formData.netWeight) * 0.98).toFixed(4))\n        },\n        'formData.netWeight' (val) {\n            this.$set(this.formData, 'recyclableWeight', ((this.formData.consumptionQuota - val) * 0.98).toFixed(4))\n            this.$set(this.formData, 'wasteLoss', (this.formData.rejectRate * this.formData.unitPrice * val / 100).toFixed(4))\n        },\n        'formData.recyclableWeight' (val) {\n            this.$set(this.formData, 'recoveryValue', (this.formData.recoveredUnitPrice * val).toFixed(4))\n        },\n        'formData.recoveredUnitPrice' (val) {\n            this.$set(this.formData, 'recoveryValue', (this.formData.recyclableWeight * val).toFixed(4))\n        },\n        'formData.rejectRate' (val) {\n            this.$set(this.formData, 'wasteLoss', (this.formData.unitPrice * this.formData.netWeight * val / 100).toFixed(4))\n        }\n    },\n    mounted () {\n        this.getItems()\n    },\n    methods: {\n        getItems () {\n            if (this.parentRowId) {\n                queryQuoteDetails({ parentRowId: this.parentRowId, method: 'RAW_MATERIAL_COST' }).then(res => {\n                    this.tableData = res.data\n                    this.calculateSum()\n                })\n            }\n        },\n        calculateSum () {\n            let subtotalCosts = 0\n            let recoveryValues = 0\n            let wasteLosses = 0\n\n            this.tableData.forEach(item => {\n                subtotalCosts += item.subtotalCost\n                recoveryValues += item.recoveryValue\n                wasteLosses += item.wasteLoss\n            })\n\n            let dataSum = { key: 'sum', subpartName: '合计', subtotalCost: subtotalCosts, recoveryValue: recoveryValues, wasteLoss: wasteLosses }\n            this.tableData.push(dataSum)\n        },\n        handleUpdate (row) {\n            queryQuoteItem({ rowId: row.rowId, method: 'RAW_MATERIAL_COST' }).then(res => {\n                this.formData = res.data\n            })\n        },\n        handleDelete (row) {\n            this.$confirm('确认删除吗?', '提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning'\n            }).then(() => {\n                deleteQuoteItem({ parentRowId: this.parentRowId, rowId: row.rowId, method: 'RAW_MATERIAL_COST' }).then(() => {\n                    this.getItems()\n                    this.$emit('getTotalQuotation')\n                })\n            }).catch(() => {\n                this.$message({\n                    type: 'info',\n                    message: '已取消'\n                })\n            })\n        },\n        resetForm () {\n            for (let par in this.formData) {\n                if (par !== 'parentRowId') {\n                    this.$set(this.formData, par, null)\n                }\n            }\n            this.$refs['refForm'].resetFields()\n            this.$refs['refForm'].clearValidate()\n        },\n        handleConfirm () {\n            this.$refs.refForm.validate((valid) => {\n                if (valid) {\n                    this.$confirm('确认保存吗?', '提示', {\n                        confirmButtonText: '确定',\n                        cancelButtonText: '取消',\n                        type: 'warning'\n                    }).then(() => {\n                        //rawMaterialCostDTO\n                        this.formData.parentRowId = this.parentRowId\n                        if (this.formData.rowId) {\n                            let cdata = {\n                                rawMaterialCostDTO: this.formData,\n                                method: \"RAW_MATERIAL_COST\"\n                            }\n                            updateQuoteItem(this.formData.rowId, cdata).then(() => {\n                                this.getItems()\n                                this.$emit('getTotalQuotation')\n                                this.$message({\n                                    type: 'success',\n                                    message: '保存成功'\n                                })\n                                this.resetForm()\n                            })\n                        } else {\n                            let cdata = {\n                                rawMaterialCostDTO: this.formData,\n                                method: \"RAW_MATERIAL_COST\"\n                            }\n                            createQuoteItem(cdata).then(() => {\n                                this.getItems()\n                                this.$emit('getTotalQuotation')\n                                this.resetForm()\n                                this.$message({\n                                    type: 'success',\n                                    message: '新增成功'\n                                })\n                            })\n                        }\n                    }).catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消'\n                        })\n                    })\n                }\n            })\n        }\n    }\n}\n",null]}