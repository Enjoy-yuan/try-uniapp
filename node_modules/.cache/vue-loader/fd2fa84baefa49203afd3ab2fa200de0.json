{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentRental/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentRental/index.vue","mtime":1596610933379},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/project/eas/el/equipmentRental'\nimport caiGou from '@/components/Select/xtpt/caigou'\nimport khxz from \"@/components/Select/khxz\"\nimport personSelect from \"@/components/Select/personSelect.vue\"\nimport { DT_ORG_TYPE } from '@/utils/constant'\nimport Pagination from '@/components/Pagination'\nimport { mapState } from 'vuex'\nimport addApplication from \"./addApplication\"\nimport { getRealName, getName } from '@/utils/auth'\nimport workCenterSelect from \"@/components/Select/work-center-select.vue\" //下拉组件\n\nexport default {\n    name: 'bom',\n    components: { Pagination, caiGou, khxz, personSelect, addApplication, workCenterSelect },\n    data () {\n        return {\n            theight: 0, //表格高度\n            materielData: [],\n            list: [],\n            fromList: [],\n            value: '',\n            total: 0,\n            total1: 0,\n            tableKey: [0, 1], //表格索引\n            listQuery: {\n\n                //查询\n                currentPage: 1,\n                pageSize: 15,\n                applicant: getRealName(),\n            },\n            tempTime: {\n                planReturnTime: undefined\n            },\n            tempLease: {\n                leaseTime: this.currentTime(),\n                leaseConfirm: undefined,\n                leaseConfirmName: undefined,\n                deviceCode: undefined,\n                method: undefined\n            },\n            tempReturn: {\n                state: undefined,\n                leaseReturnTime: undefined,\n                useDept: undefined,\n                address: undefined,\n                returnConfirm: undefined,\n                returnConfirmName: undefined,\n                deviceCode: undefined,\n                leaseAmount: undefined,\n                method: undefined\n\n            },\n            dto: {\n                applicant: getRealName(),\n                applicantName: getName(),\n                customerCode: undefined,\n                deposit: undefined,\n                deviceLeaseDetails: [],\n                leaseAmount: undefined,\n                leaseType: undefined,\n                orgCode: undefined,\n                orgName: undefined,\n                planLeaseTime: undefined,\n                planReturnTime: undefined,\n                remark: undefined,\n                renter: undefined,\n                useAddress: undefined,\n                useDescription: undefined\n            },\n            gw: [],\n            returnOrg: undefined,\n            selectlistRow: [],\n            method: undefined,\n            parentsRows: undefined,\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            confirmDialogStatus: '',\n            confirmDialogFormVisible: false,\n            khxzDialogFormVisible: false,\n            timeDialogFormVisible: false,\n            personnelDialogFormVisible: false,\n            dialogStatus: '',\n            dialogFormVisible: false,\n            LeaseDialogFormVisible: false,\n            ReturnDialogFormVisible: false,\n            selectFromList: [], //从表选中\n            rules: {\n                bomType: [\n                    {\n                        required: true,\n                        message: this.$t('validate.required'),\n                        trigger: 'blur'\n                    }\n                ],\n\n            },\n            formRules: {\n                materielCode: [\n                    {\n                        required: true,\n                        message: this.$t('validate.required'),\n                        trigger: 'blur'\n                    }\n                ]\n            }\n        }\n    },\n    computed: {\n        // 过滤器下拉框item数据\n        ...mapState({\n            dt_lease_type: state => state.eamDict.dt_lease_type,\n            dt_lease_state: state => state.eamDict.dt_lease_state,\n            dt_device_state: state => state.eamDict.dt_device_state\n        })\n    },\n    mounted () {\n        let p = new Promise((resolve) => {\n            resolve(\n                this.$store.dispatch('eamDict/getDicData', [\n                    'dt_lease_type',\n                    'dt_lease_state',\n                    'dt_device_state'\n                ])\n            )\n        })\n        Promise.all([p]).then(() => {\n            this.getList()\n        })\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n    },\n    methods: {\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 185\n        },\n        //默认勾线第一行\n        checked () {\n            this.$refs.mainList.toggleRowSelection(this.list[0], true)\n        },\n        currentTime () {\n            var date = new Date()\n            var seperator1 = \"-\"\n            var year = date.getFullYear()\n            var month = date.getMonth() + 1\n            var strDate = date.getDate()\n            var hour = new Date().getHours()\n            var minute = new Date().getMinutes()\n            var second = new Date().getSeconds()\n            if (month >= 1 && month <= 9) {\n                month = \"0\" + month\n            }\n            if (strDate >= 0 && strDate <= 9) {\n                strDate = \"0\" + strDate\n            }\n            if (minute >= 1 && minute <= 9) {\n                minute = \"0\" + minute\n            }\n            if (second >= 0 && second <= 9) {\n                second = \"0\" + second\n            }\n            var currentdate = year + seperator1 + month + seperator1 + strDate + ' ' + hour + \":\" + minute + \":\" + second\n            return currentdate\n        },\n        getList () {\n            //获取表格数据\n            api.queryRecords(this.listQuery).then(res => {\n                this.list = res.data.list\n                let options = [this.dt_lease_type, this.dt_lease_state]\n                this.list = this.$myFun.srmCodeToName(\n                    res.data.list,\n                    options,\n                    ['leaseType', 'state']\n                )\n                this.total = res.data.pages.count\n                this.$nextTick(function () {\n                    this.checked()\n                })\n            })\n        },\n        getSubList () {\n            if (this.selectlistRow) {\n                api.queryDetails(this.selectlistRow.leaseOrderCode).then(res => {\n                    this.fromList = res.data\n                })\n            }\n        },\n        //打开租借单位弹窗\n        handleClickgysxz () {\n            this.khxzDialogFormVisible = true\n        },\n        //租借父子传值\n        handleDblclickgysxz (row) {\n            this.parentsRows = row\n\n        },\n        khxzUpdate () {\n            this.listQuery.customerCode = this.parentsRows[0].customerCode\n            this.khxzDialogFormVisible = false\n        },\n        //打开申请人弹窗\n        handlegPersonnel () {\n            this.personnelDialogFormVisible = true\n\n        },\n        //申请人父子传值\n        purchasingPersonnels (row) {\n            this.personRow = row\n        },\n        personUpdate () {\n            this.listQuery.applicant = this.personRow[0].employeeCode\n            this.personnelDialogFormVisible = false\n        },\n        // 获取表格选中时的数据\n        selectRow (val) {\n            this.selectlistRow = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.mainList.clearSelection()\n                this.$refs.mainList.toggleRowSelection(val.pop())\n            }\n            this.$refs.mainList.setCurrentRow(this.selectlistRow)\n            if (this.selectlistRow) {\n                this.getSubList()\n            }\n        },\n        //主表行点击\n        showSubTable (val) {\n            this.$refs.mainList.clearSelection()\n            this.$refs.mainList.toggleRowSelection(val)\n        },\n\n        handleQuery () {\n            //表格查询\n\n            this.listQuery.currentPage = 1\n            this.getList()\n            this.fromList = undefined\n        },\n        handleCreate () {\n            //新增按钮单击事件方法\n            setTimeout(() => {\n                this.$refs.refChild.resetTemp()\n            }, 1000)\n            this.dialogStatus = 'create'\n            this.dialogFormVisible = true\n        },\n        create () {\n            if (this.$refs['refChild'].validateForm()) {\n                if (this.$refs.refChild.listQuery.leaseType == 'lease_type_lend') {\n                    this.dto.deviceLeaseDetails = this.$refs.refChild.list\n                } else if (this.$refs.refChild.listQuery.leaseType == 'lease_type_lease') {\n                    this.dto.deviceLeaseDetails = this.$refs.refChild.subList\n                }\n                if (!this.dto.deviceLeaseDetails.length) {\n                    this.$message({\n                        title: '警告',\n                        message: '设备租借单明细不能为空',\n                        type: 'warning'\n                    })\n                    return\n                }\n                //新增确认\n                this.dto = {\n                    applicant: this.$refs.refChild.listQuery.applicant,\n                    applicantName: this.$refs.refChild.listQuery.applicantName,\n                    customerCode: this.$refs.refChild.listQuery.customerCode,\n                    deposit: this.$refs.refChild.listQuery.deposit,\n                    leaseAmount: this.$refs.refChild.listQuery.leaseAmount,\n                    leaseType: this.$refs.refChild.listQuery.leaseType,\n                    orgCode: this.$refs.refChild.listQuery.orgCode,\n                    planLeaseTime: this.$refs.refChild.listQuery.planLeaseTime,\n                    planReturnTime: this.$refs.refChild.listQuery.planReturnTime,\n                    remark: this.$refs.refChild.listQuery.remark,\n                    renter: this.$refs.refChild.listQuery.renter,\n                    useAddress: this.$refs.refChild.listQuery.useAddress,\n                    useDescription: this.$refs.refChild.listQuery.useDescription\n                }\n\n\n                api.addRecords(this.dto).then(() => {\n                    this.dialogFormVisible = false\n                    this.getSubList()\n                    this.getList()\n                    this.$message({\n                        title: '成功',\n                        message: '新增成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n                })\n            }\n\n        },\n        handleUpdate () {\n            //编辑按钮单击事件方法\n            if (this.selectlistRow) {\n                api.queryOne(this.selectlistRow.leaseOrderCode).then(res => {\n                    this.dialogStatus = 'update'\n                    this.dialogFormVisible = true\n                    this.$nextTick(() => {\n                        this.$refs.refChild.init(res.data)\n                    })\n\n                })\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n            }\n        },\n        update () {\n            //编辑确认\n            if (this.$refs['refChild'].validateForm()) {\n                this.dto.deviceLeaseDetails = this.$refs.refChild.list\n                if (!this.dto.deviceLeaseDetails.length) {\n                    this.$message({\n                        title: '警告',\n                        message: '设备租借单明细不能为空',\n                        type: 'warning'\n                    })\n                    return\n                }\n                this.dto = {\n                    applicant: this.$refs.refChild.listQuery.applicant,\n                    applicantName: this.$refs.refChild.listQuery.applicantName,\n                    customerCode: this.$refs.refChild.listQuery.customerCode,\n                    deposit: this.$refs.refChild.listQuery.deposit,\n                    leaseAmount: this.$refs.refChild.listQuery.leaseAmount,\n                    leaseType: this.$refs.refChild.listQuery.leaseType,\n                    orgCode: this.$refs.refChild.listQuery.orgCode,\n                    orgName: this.$refs.refChild.listQuery.orgName,\n                    planLeaseTime: this.$refs.refChild.listQuery.planLeaseTime,\n                    planReturnTime: this.$refs.refChild.listQuery.planReturnTime,\n                    remark: this.$refs.refChild.listQuery.remark,\n                    renter: this.$refs.refChild.listQuery.renter,\n                    useAddress: this.$refs.refChild.listQuery.useAddress,\n                    useDescription: this.$refs.refChild.listQuery.useDescription\n                },\n\n                    api.updateRecords(this.selectlistRow.leaseOrderCode, this.dto).then(() => {\n                        this.getSubList()\n                        this.getList()\n                        this.dialogFormVisible = false\n                        this.$message({\n                            title: '成功',\n                            message: '更新成功',\n                            type: 'success',\n                            duration: 2000\n                        })\n                    })\n            }\n        },\n        handleDelete () {\n            //删除按钮单击事件方法\n            if (this.selectlistRow) {\n                this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                })\n                    .then(() => {\n                        api.deleteRecords([this.selectlistRow.leaseOrderCode]).then(() => {\n                            // 清空 bom item\n                            this.getList(),\n                                this.$message({\n                                    title: '成功',\n                                    message: '删除成功',\n                                    type: 'success',\n                                    duration: 2000\n                                })\n                        })\n                    })\n                    .catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消删除'\n                        })\n                    })\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n            }\n        },\n        handlePublish () {\n            //发布\n            if (this.selectlistRow) {\n                if (this.selectlistRow.state == 'lease10') {\n                    this.method = 'SUBMIT'\n                } else if (this.selectlistRow.state == 'lease20') {\n                    this.method = 'REVIEW'\n                } else if (this.selectlistRow.state == 'lease30') {\n                    this.method = 'REJECT'\n                }\n                api.publishRecords(this.selectlistRow.leaseOrderCode, this.method).then(() => {\n                    this.getList(),\n                        this.$message({\n                            title: '成功',\n                            message: '发布成功',\n                            type: 'success',\n                            duration: 2000\n                        })\n                })\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n            }\n        },\n        resetTimeTemp () {\n            this.tempTime = {\n                planReturnTime: undefined\n            }\n        },\n        handleInvalid () {\n            //修改还回时间\n            if (this.selectlistRow) {\n                this.resetTimeTemp()\n                this.timeDialogFormVisible = true\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n            }\n        },\n        timeUpdate () {\n            //还回时间确认\n            api.timeRecords(this.selectlistRow.leaseOrderCode, this.tempTime.planReturnTime).then(() => {\n                this.getList(),\n                    this.timeDialogFormVisible = false\n                this.$message({\n                    title: '成功',\n                    message: '修改还回时间成功',\n                    type: 'success',\n                    duration: 2000\n                })\n            })\n        },\n        //副表点击\n        selectFromChange (val) {\n            this.selectFromList = val\n        },\n        resetTempLease () {\n            this.tempLease = {\n                leaseTime: this.currentTime(),\n                leaseConfirm: getRealName(),\n                leaseConfirmName: getName(),\n                method: undefined\n            }\n        },\n        handleCreateFrom () {\n            // 租借出弹窗\n            if (this.selectFromList && this.selectFromList.length == 1) {\n                if (this.selectFromList[0].state == \"lease_detail40\") {\n                    this.resetTempLease()\n                    this.$set(this.tempLease, 'leaseTime', this.currentTime())\n                    this.LeaseDialogFormVisible = true\n                } else {\n                    this.$message({\n                        title: '警告',\n                        message: '只针对发布状态租借出',\n                        type: 'warning'\n                    })\n                }\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n            }\n        },\n        handleLease () {\n            //经办人\n            this.confirmDialogStatus = 'confirmCreate'\n            this.confirmDialogFormVisible = true\n        },\n        confirmPersonnels (row) {\n            this.confirmRow = row\n        },\n        confirmCreate () {\n            //借出经办人确认\n            this.confirmDialogFormVisible = false\n            this.tempLease.leaseConfirm = this.confirmRow[0].employeeCode\n            this.tempLease.leaseConfirmName = this.confirmRow[0].employeeName\n            this.tempLease.method = 'LEASE'\n            this.tempLease.deviceCode = this.selectFromList[0].deviceCode\n        },\n        updateLease () {\n            // 租借出确认\n            api.detailsRecords(this.selectlistRow.leaseOrderCode, this.selectFromList[0].rowNo, this.tempLease)\n                .then(() => {\n                    this.getSubList()\n                    this.LeaseDialogFormVisible = false\n                    this.$message({\n                        title: '成功',\n                        message: '租借出成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n                })\n\n        },\n        getAddress () {\n            this.cxgw()\n        },\n        //查询工位\n        cxgw () {\n            api.queryRecordsgw(this.tempReturn.useDept).then(response => {\n                response = response.data\n                this.gw = response\n            })\n        },\n        resetTempReturn () {\n            this.tempReturn = {\n                state: undefined,\n                leaseReturnTime: undefined,\n                useDept: undefined,\n                address: undefined,\n                returnConfirm: getRealName(),\n                returnConfirmName: getName(),\n                method: undefined\n            }\n\n        },\n        handleUpdateFrom () {\n            // 租借还弹窗\n            if (this.selectFromList && this.selectFromList.length == 1) {\n                if (this.selectFromList[0].state == \"lease_detail50\") {\n                    this.returnOrg = this.selectlistRow.orgCode\n                    this.cxgw()\n                    this.resetTempReturn()\n                    this.$set(this.tempReturn, 'leaseReturnTime', this.currentTime())\n                    this.ReturnDialogFormVisible = true\n                } else {\n                    this.$message({\n                        title: '警告',\n                        message: '只针对借出状态租借还',\n                        type: 'warning'\n                    })\n                }\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n            }\n        },\n        returnPersonnel () {\n            this.confirmDialogStatus = 'confirmUpdate'\n            this.confirmDialogFormVisible = true\n        },\n        confirmUpdate () {\n            //借还经办人确认\n            this.confirmDialogFormVisible = false\n            this.tempReturn.returnConfirm = this.confirmRow[0].employeeCode\n            this.tempReturn.returnConfirmName = this.confirmRow[0].employeeName\n            this.tempReturn.method = 'RETURN'\n            this.tempReturn.deviceCode = this.selectFromList[0].deviceCode\n            this.tempReturn.leaseAmount = this.selectFromList[0].leaseAmount\n        },\n        updateReturn () {\n            api.detailsRecords(this.selectFromList[0].leaseOrderCode, this.selectFromList[0].rowNo, this.tempReturn)\n                .then(() => {\n                    this.getSubList()\n                    this.ReturnDialogFormVisible = false\n                    this.$message({\n                        title: '成功',\n                        message: '租借还成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n                })\n        },\n        rowClickFrom (val) {\n            this.$refs.tb2.toggleRowSelection(val, 'selected') //单击行绑定点击事件\n        }\n    }\n}\n",null]}