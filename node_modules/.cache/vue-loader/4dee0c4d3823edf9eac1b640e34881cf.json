{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierManagement/supplierAccess/platformInProposal/dialog/dialogAdd.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierManagement/supplierAccess/platformInProposal/dialog/dialogAdd.vue","mtime":1596610933933},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// import { createRecords, updateRecords } from \"@/api/productionMaterial/hand_pull_material\";\nimport { DICT_CODE } from '@/utils/constant'\nimport caiGou from '@/components/Select/xtpt/caigou'//下拉组件\nimport dialogGysxz from '@/components/Dialog/dialogsGysxz'//供应商选择\nimport { mapState, mapGetters } from \"vuex\"\nimport dialogPersonSelect from '@/components/Dialog/dialogPersonSelect.vue'//选择人\nimport dialogMaterielCategory from '@/components/Dialog/dialogMaterielCategory'//物料分类选择\n\n\n\nexport default {\n    name: 'dialogAdd',\n    components: { caiGou, dialogGysxz, dialogPersonSelect, dialogMaterielCategory },\n    props: ['unMutiple', 'title', 'curdialogStatus'],\n    data () {\n        return {\n            DICT_CODE: DICT_CODE,\n            isEdit: true,\n            iscgEdit: false,//采购是否可编辑\n            formData: {\n                orgCode: null,\n                orgName: null,\n                proposalNo: null,\n                materielClass: null,\n                materielClassName: null,\n                platformSeries: null,\n                position: null,\n                creator: null,\n                creatorName: null,\n                remark: null,\n                mainFactory: null,\n                proposalItemDTOs: []\n            },\n            // proposalItemDTOs: [],\n            listSelected: null,//已选项\n            selectRowData: null,\n            dialogVisible: false,\n            rules: {\n                orgCode: [\n                    { required: true, message: '请选择', trigger: 'blur' }\n                ],\n                materielClassName: [\n                    { required: true, message: '请选择', trigger: 'blur' }\n                ],\n                remark: [\n                    { max: 128, message: '长度应小于128个字符', trigger: 'blur' }\n                ]\n            },\n            oprateBtnConfig: [\n                { id: 0, class: 'filter-item', icon: 'el-icon-plus', clickMethod: 'showGys', name: '新增' },\n                { id: 1, class: 'filter-item ml_5', icon: 'el-icon-plus', clickMethod: 'handleRefresh', name: '刷新' },\n            ],\n            formConfig: [\n                { type: 'commonInput', label: '提案号', prop: 'proposalNo', width: '' },\n                { type: 'selectcaiGou', label: '采购组织', prop: 'orgCode', width: '', copmNum: 0 },\n                { type: 'inputBtnMC', label: '物料分类', prop: 'materielClassName', width: '' },\n                { type: 'srmBisSelect', dType: 'dt_cate_platformSeries', label: '平台系列', prop: 'platformSeries', key: 'code', value: 'name', width: '' },\n                { type: 'dictSelect', dType: 'dt_srm_pad', label: '定位', prop: 'position', width: '' },\n                { type: 'inputBtnPerson', label: '申请人', propCode: 'creator', propName: 'creatorName', prop: 'creatorName', width: '' },\n                { type: 'textarea', label: '备注', prop: 'remark', width: '800px', rows: \"2\" }\n            ],\n            tableConfig: [\n                { label: '供应商编码', prop: 'supplierCode', align: 'center', width: '100' },\n                { label: '供应商名称', prop: 'supplierName', align: 'center', width: '180' },\n                { label: '资质类型', prop: 'qualificationType', align: 'center', width: '120' },\n                { label: '注册地址', prop: 'registeredAddress', align: 'center', width: '180' },\n                { type: 'commonInput', label: '配套主机厂', prop: 'mainFactory', align: 'center', width: '180' },\n                { label: '工厂地址', prop: 'contactAddress', align: 'center', width: '140' },\n                { type: 'commonInput', label: '建议理由', prop: 'remark', width: '180' },\n                { type: 'dictSelect', dType: 'dt_srm_pa5', label: '供应商定位', prop: 'position', width: '100' },\n\n            ],\n            dialogConfig: [\n                { title: '供应商信息', isRequired: false, unMutiple: false },\n                { title: '申请人选择', unMutiple: true, propCode: 'creator', propName: 'creatorName' },\n                { title: '选择物料分类信息', isRequired: false, unMutiple: true }\n            ]\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_pa5: state => state.dict.dt_srm_pa5,//供应商定位 合作层次\n            dt_srm_pad: state => state.dict.dt_srm_pad,//平台定位\n            dt_cate_platformSeries: state => state.srmBisSelect.dt_cate_platformSeries,//平台系列\n            dt_srm_pae: state => state.dict.dt_srm_pae//资质类型\n        }),\n        ...mapGetters([\n            'domainCodeName',\n            'DomainCode'\n        ])\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pa5\", \"dt_srm_pad\", \"dt_srm_pae\"])\n        this.$store.dispatch(\"srmBisSelect/getBisData\", [\"dt_cate_platformSeries\"])\n    },\n    watch: {\n        'rangeDate' (value) {\n            if (value) {\n                this.listQuery.startDate = value[0]\n                this.listQuery.endDate = value[1]\n            }\n        },\n    },\n    methods: {\n        oprateClick (id) {\n            switch (id) {\n                case 0: {\n                    this.showGys()\n                    break\n                }\n                case 1: {\n                    this.handleRefresh()\n                    break\n                }\n            }\n        },\n        handleRefresh () {\n            this.iscgEdit = false\n            this.isEdit = true\n            this.$set(this.formData, 'proposalItemDTOs', [])\n        },\n        handleConfirm () {\n            this.$refs.refForm.validate((valid) => {\n                if (valid) {\n                    this.$confirm('确认保存吗?', '提示', {\n                        confirmButtonText: '确定',\n                        cancelButtonText: '取消',\n                        type: 'warning'\n                    }).then(() => {\n                        if (this.curdialogStatus === 'edit') {\n                            let cdata = {\n                                method: \"UPDATE\",\n                                proposalDTO: this.formData\n                            }\n                            this.$emit('handleDialogClick', cdata)\n                        } else if (this.curdialogStatus === 'add') {\n                            this.$emit('handleDialogClick', this.formData)\n                        }\n                        this.dialogVisible = false\n                    }).catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消'\n                        })\n                    })\n                }\n            })\n        },\n        //表格操作删除\n        handleDelete (index, row) {\n            this.$confirm('确认要删除该数据项吗?', '提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning'\n            }).then(() => {\n                this.formData.proposalItemDTOs = this.formData.proposalItemDTOs.filter(item => {\n                    let isD = true\n                    if (row.rowId === item.rowId) {\n                        isD = false\n                    }\n                    return isD\n                })\n\n                this.$message({\n                    type: 'success',\n                    message: '删除成功'\n                })\n            }).catch(() => {\n                this.$message({\n                    type: 'info',\n                    message: '已取消'\n                })\n            })\n        },\n        initForm (type, row) {\n            if (type === 'add') {\n                this.isEdit = true\n                this.$nextTick(() => {\n                    this.$refs['refForm'].resetFields()\n                    this.$refs['refForm'].clearValidate()\n                    this.$set(this.formData, 'proposalItemDTOs', [])\n                    this.$set(this.formData, 'creator', this.domainCode)\n                    this.$set(this.formData, 'creatorName', this.domainCodeName)\n                    for (let key in this.formData) {\n                        for (let par in row) {\n                            if (key === par) {\n                                this.$set(this.formData, key, row[key])\n                            }\n                        }\n                    }\n                })\n            } else {\n                this.isEdit = false\n                for (let key in this.formData) {\n                    for (let par in row) {\n                        if (key === par) {\n                            if (row[key]) {\n                                this.$set(this.formData, key, row[key])\n                            }\n                        }\n                    }\n                }\n                // this.$set(this.formData, 'proposalItemDTOs', item)\n            }\n        },\n        showGys () {\n            if (this.formData.materielClass) {\n                this.$refs.refGys.valueType = 'row'\n                this.$refs.refGys.checkProp = ['supplierName', 'supplierName']\n                this.$refs.refGys.listQuery.isExist = 0\n                this.$refs.refGys.listQuery.materielClass = this.formData.materielClass\n                this.$refs.refGys.listQuery.materielClassName = this.formData.materielClassName\n                this.$refs.refGys.listSelected = JSON.parse(JSON.stringify(this.formData.proposalItemDTOs))\n                this.$refs.refGys.getList()\n                this.$refs.refGys.dialogVisible = true\n            } else {\n                this.$message({\n                    type: 'warning',\n                    message: '请先选择物料分类'\n                })\n            }\n        },\n        //供应商确认\n        handleGysClick (gysRows) {\n            if (gysRows) {\n                this.isEdit = false\n                gysRows.map((item) => {\n                    item.supplierRowId = item.rowId\n                })\n                let temp = JSON.parse(JSON.stringify(this.formData.proposalItemDTOs))\n                this.$set(this.formData, 'proposalItemDTOs', gysRows)\n                this.formData.proposalItemDTOs.forEach((item, index) => {\n                    let changet = true\n                    temp.forEach((titem) => {\n                        if (titem.supplierRowId === item.supplierRowId) {\n                            changet = false\n                            this.$set(this.formData.proposalItemDTOs[index], 'qualificationType', titem.qualificationType)\n                        }\n                    })\n                    if (changet) {\n                        if (item.platformState === 'PA1P') {\n                            this.$set(this.formData.proposalItemDTOs[index], 'qualificationType', 'PAE0')\n                        } else if (item.platformState === 'PA1Q') {\n                            this.$set(this.formData.proposalItemDTOs[index], 'qualificationType', 'PAE1')\n                        }\n                    }\n\n                })\n            } else {\n                this.$set(this.formData, 'proposalItemDTOs', [])\n            }\n        },\n        setOrgName (name) {\n            this.formData.orgName = name\n        },\n        showPerson () {\n            this.$refs.refPerson.dialogVisible = true\n        },\n        personConfirm (pdata, propCode, propName) {\n            this.$set(this.formData, propCode, pdata[0].employeeCode)\n            this.$set(this.formData, propName, pdata[0].employeeName)\n        },\n        showMC () {\n            if (this.formData.orgCode) {\n                this.$refs.refMC.listQuery.orgCode = this.formData.orgCode\n                this.$refs.refMC.selectedRows = []\n                this.$refs.refMC.handleQuery()\n                this.$refs.refMC.dialogVisible = true\n            } else {\n                this.$message({ type: 'warning', message: '请先选择采购组织' })\n            }\n\n        },\n        handleConfirmMC (mdata) {\n            this.$set(this.formData, 'materielClass', mdata[0].classCode)\n            this.$set(this.formData, 'materielClassName', mdata[0].className)\n        }\n    }\n}\n",null]}