{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/contractManage/supplierPerformance/dailyEvaluation/evaluationFormat/dialog/dialogDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/contractManage/supplierPerformance/dailyEvaluation/evaluationFormat/dialog/dialogDetail.vue","mtime":1598232746048},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapState } from \"vuex\"\n\n\nexport default {\n    name: 'dialogDetail',\n    props: ['unMutiple', 'title', 'curdialogStatus'],\n    data () {\n        return {\n            isMajor: false,//是否重大决策\n            formData: {\n                rowId: null,\n                evaluationNo: null,\n                supplierCode: null,\n                supplierName: null,\n                evaluationType: null,\n                evaluationStage: null,\n                evaluationItem: null,\n                category: null,\n                evaluationYear: null,\n                score: null,\n                grade: null,\n                remark: null\n            },\n            spanArr: [],\n            listSelected: null,//已选项\n            selectRowData: null,\n            dialogVisible: false,\n            formConfig: [\n                { type: 'commonInput', label: '评价单号', prop: 'evaluationNo', width: '' },\n                { type: 'inputBtnGys', label: '供应商', prop: 'supplierName', width: '' },\n                { type: 'dictSelect', dType: 'dt_srm_pak', label: '评价类型', prop: 'evaluationType', width: '' },\n                { type: 'dictSelect', dType: 'dt_srm_pb4', label: '评价项', prop: 'evaluationItem', width: '' },\n                { type: 'commonInput', label: '得分', prop: 'score', width: '' },\n                { type: 'srmBisSelect', dType: 'dt_cate_grade', label: '综合等级', prop: 'grade', width: '', key: 'code', value: 'name' },\n                { type: 'textarea', label: '评语', prop: 'remark', width: '800px', rows: \"2\" }\n            ],\n            tableConfig: [\n                { label: '评价项目', prop: 'parentDetailName', align: 'left', width: '180' },\n                { label: '评价明细', prop: 'detail', align: 'left', width: '330' },\n                { label: '分制', prop: 'divideScore', align: 'center', width: 'auto' },\n                { label: '权重', prop: 'weight', align: 'center', width: 'auto' },\n                { label: '评分方式', prop: 'methodCN', align: 'center', width: 'auto' },\n                { label: '打分', prop: 'score', align: 'center', type: 'commonInput', width: 'auto' },\n                { label: '得分', prop: 'realScore', align: 'center', width: 'auto' },\n                { label: '备注', prop: 'remark', align: 'center', width: 'auto' }\n            ],\n            tableData: [],\n        }\n    },\n    created () {\n\n    },\n    computed: {\n        ...mapState({\n            dt_srm_pb4: state => state.dict.dt_srm_pb4,//评价项\n            dt_srm_pak: state => state.dict.dt_srm_pak,//评价类型\n            dt_srm_pb5: state => state.dict.dt_srm_pb5,//评分方式\n            dt_cate_grade: state => state.srmBisSelect.dt_cate_grade//综合评价等级\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pb4\", \"dt_srm_pak\", \"dt_srm_pb5\"])\n        this.$store.dispatch(\"srmBisSelect/getBisData\", [\"dt_cate_grade\"])\n    },\n    methods: {\n        getSpanArr (data) {\n            data.sort(this.compareObj(\"parentDetailName\"))\n            for (var i = 0; i < data.length; i++) {\n                if (i === 0) {\n                    this.spanArr.push(1)\n                    this.pos = 0\n                } else {\n                    // 判断当前元素与上一个元素是否相同\n                    if (data[i].parentDetailName === data[i - 1].parentDetailName) {\n                        this.spanArr[this.pos] += 1\n                        this.spanArr.push(0)\n                    } else {\n                        this.spanArr.push(1)\n                        this.pos = i\n                    }\n                }\n            }\n        },\n        compareObj (prop) {\n            return function (obj1, obj2) {\n                let val1 = obj1[prop]\n                let val2 = obj2[prop]\n                if (val1 < val2) {\n                    return -1\n                } else if (val1 > val2) {\n                    return 1\n                } else {\n                    return 0\n                }\n            }\n        },\n        objectSpanMethod ({ rowIndex, columnIndex }) {\n            if (columnIndex === 1) {\n                const _row = this.spanArr[rowIndex]\n                const _col = _row > 0 ? 1 : 0\n                return {\n                    rowspan: _row,\n                    colspan: _col\n                }\n            }\n        },\n        //计算得分\n        caculateScore () {\n            let score = 0\n            this.tableData.forEach(item => {\n                console.log(item.score)\n                if (item.score) {\n                    score += parseInt(item.score) * parseInt(item.weight) / 100\n                }\n            })\n            this.$set(this.formData, 'score', score)\n        },\n        initForm (row) {\n            let options = [this.dt_srm_pb5]\n            row.evaluationDetailDTOs = this.$myFun.codeToName(row.evaluationDetailDTOs, options, ['method'])\n            this.tableData = []\n            this.spanArr = []\n            for (let key in this.formData) {\n                for (let par in row) {\n                    if (key === par) {\n                        this.$set(this.formData, key, row[key])\n                    }\n                }\n            }\n            row.evaluationDetailDTOs.forEach(item => {\n                if (item.method === 'PB52') {\n                    if (item.score === 1) {\n                        item.score = true\n                    } else {\n                        item.score = false\n                    }\n                }\n            })\n            this.tableData = row.evaluationDetailDTOs\n            this.getSpanArr(this.tableData)\n            this.caculateScore()\n        }\n    }\n}\n",null]}