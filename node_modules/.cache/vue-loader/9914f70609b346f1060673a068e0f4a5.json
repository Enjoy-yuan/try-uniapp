{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/IOT/IOT/myProject/EMTabs/mainInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/IOT/IOT/myProject/EMTabs/mainInfo.vue","mtime":1596611178218},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport listCar from '../../../components/listCar'\nimport * as api from \"@/api/project/iot/IOT/em\"\nimport { mapState } from 'vuex'\nimport throttle from 'lodash/throttle'\nexport default {\n    name: \"mainInfo\",\n    props: ['code', 'row', 'manufacturersList'],\n    data () {\n        return {\n            form: {\n                deviceCode: undefined,\n                deviceName: undefined,\n                brand: undefined,\n                typeCode: undefined,\n                manufacturersCode: undefined,\n                modelNumber: undefined,\n                leaveFactoryDate: undefined,\n                remark: undefined,\n            },\n            temp: {\n                deviceCode: undefined,\n                deviceName: undefined,\n                brand: undefined,\n                typeCode: undefined,\n                manufacturersCode: undefined,\n                modelNumber: undefined,\n                leaveFactoryDate: undefined,\n                remark: undefined,\n            },\n            namePlate: null,\n            namePlateFrom: {\n                data: null\n            },\n            dialogFormVisible: false,\n            dialogFormVisibleName: false,\n            rules: {\n                typeCode: [\n                    {\n                        required: true,\n                        message: '请选择设备类型',\n                        trigger: 'change'\n                    }\n                ],\n                deviceCode: [\n                    {\n                        required: true,\n                        message: '设备编码不能为空',\n                        trigger: 'blur'\n                    },\n                    {\n                        pattern: /^[a-zA-Z0-9]{0,32}$/,\n                        message: '由大写字母、数字组成，长度为32',\n                        trigger: 'blur'\n                    }\n                ],\n                deviceName: [\n                    {\n                        required: true,\n                        message: '设备名称不能为空',\n                        trigger: 'blur'\n                    },\n                    { max: 100, message: '长度不能超过100', trigger: 'blur' },\n                    {\n                        pattern: /^[a-zA-Z0-9#\\u4e00-\\u9fa5]+$/,\n                        message: '支持大小写中英文及#符号',\n                        trigger: 'blur'\n                    }\n                ],\n                manufacturersCode: [\n                    {\n                        message: '请选择设备厂商',\n                        trigger: 'change'\n                    }\n                ],\n                leaveFactoryDate: [\n                    {\n                        message: '请选择生产日期',\n                        trigger: ['change', 'blur']\n                    }\n                ],\n                brand: [\n                    {\n                        message: '请选择设备品牌',\n                        trigger: ['change', 'blur']\n                    }\n                ],\n                modelNumber: [\n                    {\n                        message: '请选择设备品牌',\n                        trigger: ['change', 'blur']\n                    }\n                ]\n            }\n        }\n    },\n    components: { listCar },\n    computed: {\n        ...mapState({\n            // code: state => state.goPage.code,\n            // subCode: state => state.goPage.subCode,\n            iot_nameplate_state: state => state.iotDict.iot_nameplate_state // 铭牌参数单位\n        }),\n        listLength: function () {\n            return this.namePlate ? this.namePlate.length : false\n        }\n    },\n    mounted () {\n        this.getList()\n    },\n    methods: {\n        getList () {\n            if (this.$route.name == \"myProject\") {\n                Promise.all([api.queryProjectCode(this.code, this.row.deviceCode), api.queryNamePlate(this.code, this.row.deviceCode)]).then(\n                    val => {\n                        this.form = val[0].data\n                        if (this.manufacturersList && this.manufacturersList.length && this.form.manufacturersCode) {\n                            this.manufacturersList.forEach(i => {\n                                if (i.manufacturersCode == val[0].data.manufacturersCode) {\n                                    val[0].data.manufacturersName = i.manufacturersName\n                                }\n                            })\n                        }\n                        val[1].data = this.$myFun.srmCodeToName(val[1].data, [this.iot_nameplate_state], ['company'])\n\n                        this.namePlate = val[1].data\n                    }\n                )\n            }\n        },\n        // 编辑\n        handleUpdate () {\n            this.temp = this.form\n            this.dialogFormVisible = true\n        },\n        update: throttle(\n            function () {\n                this.$refs.tempRef.validate(valid => {\n                    if (valid) {\n                        api.updateProjectCode(this.code, this.row.deviceCode, this.temp).then(() => {\n                            this.getList()\n                            this.dialogFormVisible = false\n                            this.resTemp()\n                            this.$notify({\n                                title: '成功',\n                                message: '更新成功',\n                                type: 'success',\n                                duration: 2000\n                            })\n                        })\n                    } else {\n                        return false\n                    }\n                })\n            },\n            2000,\n            {\n                leading: true,\n                trailing: false\n            }\n        ),\n        handleUpdateName () {\n            this.namePlateFrom.data = JSON.parse(JSON.stringify(this.namePlate))\n            this.dialogFormVisibleName = true\n        },\n        updateName: throttle(\n            function () {\n                let arr = this.namePlateFrom.data.filter(i => {\n                    return !i.tagCode || !i.tagName || !i.company\n                })\n                if (arr.length || !this.namePlateFrom.data.length) {\n                    this.$message({\n                        title: this.$t('message.warning'),\n                        message: \"铭牌编码、名称、单位不能为空\",\n                        type: \"warning\"\n                    })\n                    return\n                }\n                let regArr = this.namePlateFrom.data.filter(i => {\n                    return i.tagCode && i.tagName\n                })\n                var reg = /^[\\u4e00-\\u9fa5]+$/\n                var codeReg = /^[a-zA-Z0-9]+$/\n                let getRes = new Promise((resolve, reject) => {\n                    regArr.forEach(i => {\n                        let result = reg.exec(i.tagName)\n                        let resultCode = codeReg.exec(i.tagCode)\n                        if (!result) {\n                            return reject('铭牌铭牌请输入中文')\n                        }\n                        if (!resultCode) {\n                            return reject('编码请输入大小写英文及数字字符')\n                        }\n                    })\n                    resolve(true)\n                })\n                getRes.then((res) => {\n                    if (res) {\n                        api.updateNamePlate(this.code, this.row.deviceCode, this.namePlateFrom.data).then(() => {\n                            this.getList()\n                            this.dialogFormVisibleName = false\n                            this.$notify({\n                                title: '成功',\n                                message: '编辑成功',\n                                type: 'success',\n                                duration: 2000\n                            })\n                        })\n                    }\n                }).catch(error => {\n                    this.$message({\n                        title: this.$t('message.warning'),\n                        message: error,\n                        type: \"warning\"\n                    })\n                    return\n                })\n            },\n            2000,\n            {\n                leading: true,\n                trailing: false\n            }\n        ),\n        addDomain () {\n            this.namePlateFrom.data.push({\n                tagCode: undefined,\n                tagName: undefined,\n                tagValue: undefined,\n                company: undefined\n            })\n        },\n        removeDomain (item) {\n            var index = this.namePlateFrom.data.indexOf(item)\n            if (index !== -1) {\n                this.namePlateFrom.data.splice(index, 1)\n            }\n        },\n        resTemp () {\n            this.temp = {}\n        }\n    }\n};\n",null]}