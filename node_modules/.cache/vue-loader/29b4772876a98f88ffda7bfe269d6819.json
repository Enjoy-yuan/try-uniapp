{"remainingRequest":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/cf_web/src/views/system/dataPermissions/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/cf_web/src/views/system/dataPermissions/index.vue","mtime":1600927611528},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Pagination from '@/components/Pagination' // Secondary package based on el-pagination\n\n// import waves from '@/directive/waves' // Waves directive\nimport { DICT_CODE, DT_ORG_FUNCTION, DT_ORG_TYPE } from \"@/utils/constant\"\nimport dictItemSelect from '@/components/Select/dictItemSelect.vue'\nimport orgSelect from \"@/components/Select/orgSelect.vue\"\nimport * as api from '@/api/system/data_permissions'\nexport default {\n    name: 'dataPermissions',\n    components: { Pagination, dictItemSelect, orgSelect },\n    // directives: { waves },\n    data () {\n        const sourceMap = {\n            \"kg\": 1,\n            \"iwms\": 2,\n            \"scc\": 3,\n            \"mes\": 4\n        }\n        return {\n            DICT_CODE: DICT_CODE,\n            DT_ORG_FUNCTION: DT_ORG_FUNCTION,\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            list: null,\n            list1: null,\n            theight: 0,\n            stheight: 0,//右子表高度\n            cols: [],\n            objectCode: '',\n            objectName: '',\n            edlist: [],\n            total: 0,\n            total1: 0,\n            qxlb: null,\n            listLoading: true,\n            url: undefined,\n            tableKey: [0, 1],//表格索引，虚拟dom渲染表格时使用\n            sourceMap: sourceMap,\n            listQuery: {\n                currentPage: 1,\n                pageSize: 15,\n                page: 1,\n                employeeCode: undefined,\n                employeeName: undefined,\n                domainScope: undefined,\n                orgCode: undefined\n            },\n            listQuery1: {\n                // currentPage: 1,\n                // pageSize: 10,\n                // page: 1,\n                accessTypeCode: undefined,\n                metaDataCode: undefined,\n                metaDataType: undefined\n            },\n            //根据权限类型获取数据\n            getAuthoData: {\n                url: undefined,\n                endpointGroup: undefined,\n                endpointCode: undefined,\n                conditions: undefined\n            },\n            temp: {\n                customerCode: undefined,\n                customerName: undefined,\n                orgCode: undefined,\n                warehouseCode: undefined,\n                purchaseName: undefined\n            },\n            dto: {\n                accessType: undefined,\n                metaDataCode: undefined,\n\n                metaDataDTOList: undefined\n            },\n            lb: {\n                conditionColumn: undefined,\n                conditionValue: undefined\n\n            },\n            dialogFormVisible: false,\n            dialogFormUser: false,\n            dialogStatus: '',\n            dialogPvVisible: false,\n            pvData: [],\n            defaultProps: {\n                children: 'children',\n                label: 'organizationName'\n            },\n        }\n    },\n    created () {\n        this.getList()\n    },\n    mounted () {\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.getList()\n    },\n    methods: {\n        getList () {//查询\n            api.selectlists(this.listQuery).then(response => {\n                this.list = response.data.list\n                this.total = response.data.pages.count\n                setTimeout(() => {\n                    this.listLoading = false\n                }, 1.5 * 100)\n            })\n        },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() + 55\n            this.stheight = this.theight + 40\n        },\n        //模板变化\n        changeMoudle (val) {\n            this.$emit('changeSelect', val)\n        },\n        getEndpointCode () {\n            let metaDataCode = this.listQuery1.metaDataCode\n            let accessTypeCode = this.listQuery1.accessTypeCode\n            this.listQuery1 = {\n                currentPage: 1,\n                pageSize: 10,\n                page: 1,\n                accessTypeCode: accessTypeCode,\n                metaDataCode: metaDataCode,\n                metaDataType: undefined\n            }\n            if (metaDataCode) {\n                this.edlist = this.qxlb.filter(item => {\n                    return item.metaDataCode === metaDataCode\n                })\n                this.getAuthoData.endpointCode = this.edlist[0].endpointCode\n                this.getAuthoData.endpointGroup = this.edlist[0].endpointGroup\n                if (typeof (this.edlist[0].conditions) !== \"undefined\") {\n                    this.getAuthoData.conditions = JSON.parse(this.edlist[0].conditions)\n                }\n                let labelList = JSON.parse(this.edlist[0].disFieldsChn)\n                let filedList = JSON.parse(this.edlist[0].disFields)\n                this.objectCode = filedList[\"object_code\"]\n                this.objectName = filedList[\"object_name\"]\n                let arrList = new Array()\n                arrList.push({ label: \"选择\", prop: \"selection\" })\n                Object.keys(labelList).forEach(function (key) {\n                    let a = { label: labelList[key], prop: key, objectCode: key, objectName: labelList[key] }\n\n                    arrList.push(a)\n                })\n                this.cols = arrList\n\n            }\n            this.list1 = []\n        },\n        handleFilterqxlb () { //查询权限类别\n            this.listQuery1.metaDataCode = ''\n            api.queryqx(this.listQuery1.accessTypeCode).then(response => {\n                this.qxlb = response.data\n            })\n        },\n        handleQuerylb () {  //查询元数据列表查询\n            let ysq = []\n\n            this.listQuery1.metaDataType = this.listQuery1.metaDataCode\n            if (this.selectlistRow1 && this.listQuery1.accessTypeCode && this.listQuery1.metaDataCode) {\n                //查询已授权的数据\n                api.querylb(this.selectlistRow1.userName, this.listQuery1.accessTypeCode, this.listQuery1.metaDataType).then(response => {\n                    ysq = response.data\n                    api.queryzy(this.getAuthoData.endpointCode).then(response => {  //查询路径        \n                        this.getAuthoData.url = response.data.url.replace('/v1', '')\n                        console.log(this.getAuthoData.endpointGroup, this.getAuthoData, 11111)\n                        api.queryurl(this.getAuthoData.endpointGroup, this.getAuthoData).then(res => {\n                            this.list1 = res.data\n                            this.total1 = res.length\n                            this.$nextTick(function () { //在渲染之后执行toggleRowSelection方法\n                                this.list1.forEach((val, index) => {\n                                    ysq.forEach((val1) => {\n                                        if (val[this.objectCode] == val1.objectCode) {\n                                            this.$refs.dd.toggleRowSelection(this.list1[index])\n                                        }\n                                    })\n                                })\n                            })\n                        })\n                        // console.log(this.sourceMap[this.getAuthoData.endpointGroup],this.getAuthoData)\n                        // switch (this.sourceMap[this.getAuthoData.endpointGroup]) {\n                        //     case 1: {\n                        //         api.queryurlkg(this.getAuthoData).then(res => {\n                        //             this.list1 = res.data;\n                        //             this.total1 = res.length;\n                        //             this.$nextTick(function () { //在渲染之后执行toggleRowSelection方法\n                        //                 this.list1.forEach((val, index) => {\n                        //                     ysq.forEach((val1) => {\n                        //                         if (val[this.objectCode] == val1.objectCode) {\n                        //                             this.$refs.dd.toggleRowSelection(this.list1[index])\n                        //                         }\n                        //                     })\n                        //                 })\n                        //             })\n                        //         });\n                        //         break;\n                        //     }\n                        //     case 2: {\n                        //         api.queryurliwms(this.getAuthoData).then(res => {\n                        //             this.list1 = res.data;\n                        //             this.total1 = res.length;\n                        //             this.$nextTick(function () { //在渲染之后执行toggleRowSelection方法\n                        //                 this.list1.forEach((val, index) => {\n                        //                     ysq.forEach((val1) => {\n                        //                         if (val[this.objectCode] == val1.objectCode) {\n                        //                             this.$refs.dd.toggleRowSelection(this.list1[index])\n                        //                         }\n                        //                     })\n                        //                 })\n                        //             })\n                        //         });\n                        //         break;\n                        //     }\n                        //     case 3: {\n                        //         api.queryurlscc(this.getAuthoData).then(res => {\n                        //             this.list1 = res.data;\n                        //             this.total1 = res.length;\n                        //             this.$nextTick(function () { //在渲染之后执行toggleRowSelection方法\n                        //                 this.list1.forEach((val, index) => {\n                        //                     ysq.forEach((val1) => {\n                        //                         if (val[this.objectCode] == val1.objectCode) {\n                        //                             this.$refs.dd.toggleRowSelection(this.list1[index])\n                        //                         }\n                        //                     })\n                        //                 })\n                        //             })\n                        //         });\n                        //         break;\n                        //     }\n                        //     case 4: {\n                        //         api.queryurlmes(this.getAuthoData).then(res => {\n                        //             this.list1 = res.data;\n                        //             this.total1 = res.length;\n                        //             this.$nextTick(function () { //在渲染之后执行toggleRowSelection方法\n                        //                 this.list1.forEach((val, index) => {\n                        //                     ysq.forEach((val1) => {\n                        //                         if (val[this.objectCode] == val1.objectCode) {\n                        //                             this.$refs.dd.toggleRowSelection(this.list1[index])\n                        //                         }\n                        //                     })\n                        //                 })\n                        //             })\n                        //         });\n                        //         break;\n                        //     }\n                        //     default: {\n                        //         break;\n                        //     }\n                        // }\n                    })\n                })\n\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择权限类型和权限类别',\n                    type: 'warning'\n                })\n            }\n        },\n        // cx(){  //确认之后复选框选上方法\n        //     this.$nextTick(function(){ //在渲染之后执行toggleRowSelection方法\n        //     this.list1.forEach((val,index) => {\n        //     if(val.isAuthorization=='1'){\n        //         this.$refs.dd.toggleRowSelection(this.list1[index]) //判断a的值是不是在b数组里并返回索引\n        //     }\n        //     })          \n        // })              \n        // },\n        toggleSelection (rows) {\n            if (rows) {\n                rows.forEach(row => {\n                    this.$refs.dd.toggleRowSelection(row)\n                })\n            } else {\n                this.$refs.dd.clearSelection()\n            }\n        },\n        handleConfirm () { //确认方法\n            if (this.selectlistRow3) {\n                this.dto.metaDataCode = this.listQuery1.metaDataCode\n                this.dto.accessType = this.listQuery1.accessTypeCode\n                // console.log('aaaaaaa',this.selectlistRow3);\n                this.dto.metaDataDTOList = this.selectlistRow3.map(v => {\n                    console.log('bbbbbbbb', v, this.objectCode, this.objectName)\n                    let objectList = {}\n                    objectList.objectName = v[this.objectName]\n                    objectList.objectCode = v[this.objectCode]\n                    return objectList\n                })\n                api.confirm(this.selectlistRow1.userName, this.dto).then(() => {\n                    this.handleQuerylb()\n                    // this.cx()\n                    this.$notify({\n                        title: '成功',\n                        message: '确认成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n                })\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择信息',\n                    type: 'warning'\n                })\n            }\n        },\n        handleFilter () {//搜索\n            this.getList()\n        },\n        resetTemp () {//重置表单Temp\n            this.temp = {\n                employeeCode: undefined,\n                employeeName: undefined,\n                sex: 1,\n                organizationId: undefined,\n                state: undefined,\n                mobile: undefined,\n                email: undefined,\n                officePhone: undefined,\n                birthday: undefined,\n                hireDate: undefined,\n                idNumber: undefined,\n                address: undefined,\n                remarks: undefined\n            }\n        },\n        handleQuery () {\n            this.listQuery.currentPage = 1\n            this.getList()\n        },\n\n        selectRow1 (val) {// 获取表格1复选框选中\n            this.selectlistRow1 = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.tb.clearSelection()\n                this.$refs.tb.toggleRowSelection(val.pop())\n            }\n            if (this.selectlistRow1) { //this.selectlistRow1有值的时候才调查询方法（切换的时候会有一个空值的过程）\n                this.handleQuerylb()\n            }\n            // alert(this.selectlistRow1+'2')\n            // console.log(this.selectlistRow1)\n        },\n        selectRow2 (val) {  //表一单击行选中方法\n            this.selectlistRow2 = val\n            this.$refs.tb.clearSelection()\n            this.$refs.tb.toggleRowSelection(val)//单击行绑定点击事件\n            // this.getList1()        \n        },\n        selectRow3 (val) {\n            // console.log('row3',val);\n            this.selectlistRow3 = val\n\n        }\n    }\n\n};\n",null]}