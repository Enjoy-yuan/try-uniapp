{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/components/srmSupplierTab/Tab/tab3.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/components/srmSupplierTab/Tab/tab3.vue","mtime":1603420637324},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport dialogscyjMain from \"./dialog/dialogscyjMain\"\nimport dialogscyjSub from \"./dialog/dialogscyjSub\"\nimport * as api from \"@/api/project/srm/supplierManagement/supplierRegister\"\nimport { mapState } from \"vuex\"\nimport ImportFile from \"@/components/srmImportFile\"\nexport default {\n    name: \"delivery_Publish\",\n    components: { dialogscyjMain, dialogscyjSub, ImportFile },\n    props: ['rowData'],\n    data () {\n        return {\n            theight: 0,//表格高度\n            isSingle: true,//表格是否单选 点击各按钮根据流程逻辑控制单多选\n            currentSelectedRow: null,//当前选中的行\n            selectedRows: null,//多选时选中的所有行\n            list: null,\n            listSub: null,\n            rowId: null,\n            selectedrow: null,//主表选中行\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10\n            },\n            sublistQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10\n            },\n            tableKey: [0, 1], //表格索引，虚拟dom渲染表格时使用\n            importDialogVisible: false,\n            status: '',\n            modalNo: 'EXTP-BAS-0012',  // 主表导入模板编号\n            modalNoSub: 'EXTP-BAS-0018'   // 从表导入模板编号\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_pdq: state => state.dict.dt_srm_pdq,\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pdq\"])\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n    },\n    methods: {\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() / 2\n        },\n        setTabData (val) {\n            this.list = val\n        },\n        setTabDataSub (val) {\n            this.listSub = val\n        },\n        //新增编辑删除成功之后刷新表格数据\n        getFreshList () {\n            let b = {\n                rowId: this.rowId\n            }\n            api.updateRecords(b).then(res => {\n                this.list = res.data.achievementInfoDTOList\n                this.list.forEach((item)=>{\n                    if(!item.creatorName){\n                        item.creatorName = item.creator\n                    }\n                })\n\n                let options = [this.dt_srm_pdq]\n                res.data.productInfoDTOList = this.$myFun.srmCodeToName(res.data.productInfoDTOList, options, ['level'])\n                this.listSub = res.data.productInfoDTOList\n                this.listSub.forEach((item)=>{\n                    if(!item.levelCN && !item.creatorName){\n                        item.levelCN = item.level\n                        item.creatorName = item.creator\n                    }\n                })\n            })\n        },\n        //显示主表\n        getList (row) {\n            this.$refs.nnzcl.temp.supplierId = row.rowId\n            this.$refs.cpqd.temp.supplierId = row.rowId\n            this.rowId = row.rowId\n            let a = {\n                rowId: row.rowId\n            }\n            api.updateRecords(a).then(res => {\n                this.list = res.data.achievementInfoDTOList\n                this.list.forEach((item)=>{\n                    if(!item.creatorName){\n                        item.creatorName = item.creator\n                    }\n                })\n\n                let options = [this.dt_srm_pdq]\n                res.data.productInfoDTOList = this.$myFun.srmCodeToName(res.data.productInfoDTOList, options, ['level'])\n                this.listSub = res.data.productInfoDTOList\n                this.listSub.forEach((item)=>{\n                    if(!item.levelCN && !item.creatorName){\n                        item.levelCN = item.level\n                        item.creatorName = item.creator\n                    }\n                })\n            })\n        },\n        //年度总产量新增按钮单击事件\n        handleCreate () {\n            this.$refs.nnzcl.resetTemp()\n            this.$nextTick(() => {\n                this.$refs.nnzcl.$refs['dataForm'].clearValidate()\n            })\n            this.$refs.nnzcl.dialogStatus = 'create'\n            this.$refs.nnzcl.dialogVisible = true\n        },\n        //年度总产量行内编辑按钮单击事件\n        handleUpdate (index, val) {\n            this.$refs.nnzcl.dialogStatus = 'update'\n            this.$refs.nnzcl.dialogVisible = true\n            this.$refs.nnzcl.temp = val\n\n        },\n        //年度总产量行内删除按钮单击事件\n        handleDelete (index, val) {\n            api.deleteRecordachieve(this.$refs.nnzcl.temp.supplierId, val.rowId).then(() => {\n                this.$message({\n                    title: '成功',\n                    message: '删除成功',\n                    type: 'success',\n                    duration: 2000\n                })\n                this.getFreshList()\n            })\n        },\n        //产品清单新增按钮单击事件\n        handleCreateSub () {\n            this.$refs.cpqd.resetTemp()\n            this.$nextTick(() => {\n                this.$refs.cpqd.$refs['dataForm'].clearValidate()\n            })\n            this.$refs.cpqd.dialogStatus = 'create'\n            this.$refs.cpqd.dialogVisible = true\n        },\n        //产品清单行内编辑按钮单击事件\n        handleUpdateSub (index, val) {\n            this.$refs.cpqd.dialogStatus = 'update'\n            this.$refs.cpqd.dialogVisible = true\n            this.$refs.cpqd.temp = val\n        },\n        //产品清单行内删除按钮单击事件\n        handleDeleteSub (index, val) {\n            api.deleteRecordproduct(this.$refs.cpqd.temp.supplierId, val.rowId).then(() => {\n                this.$message({\n                    title: '成功',\n                    message: '删除成功',\n                    type: 'success',\n                    duration: 2000\n                })\n                this.getFreshList()\n            })\n        },\n        // 主表导入导出\n        // 导入\n        handleImport () {\n            // 判断是主表还是从表\n            this.status = 'one'\n            this.importDialogVisible = true\n            this.$nextTick(() => {\n                // 将rowId传给 srmImportFile\n                this.$refs.importDialog.supplierId = this.rowData.rowId\n                this.$refs.importDialog.creator = this.rowData.creatorName\n                // 传递模板下载文件名称\n                this.$refs.importDialog.excelName = '市场业绩表1.xlsx'\n                this.$refs.importDialog.getList()\n            })\n        },\n        // // 导出\n        // handleExport () {\n        //     this.downloadLoading = true\n        //     import('@/vendor/Export2Excel').then(excel => {\n        //         const tHeader = ['年度', '年度生产数量', '年度生产总值', '年度销售收入', '市场占有率', '利润总额', '出口金额', '售服金额', '行业排名', '行业前十企业', '创建人', '创建时间', '修改人', '修改时间']\n        //         const filterVal = ['year', 'productionQuantity', 'outputValue', 'salesRevenue', 'marketShare', 'profit', 'exportValue', 'saleServiceValue', 'ranking', 'topTen', 'creatorName', 'createTime', 'updatorName', 'updateTime']\n        //         const data = this.formatJson(filterVal, this.list)\n        //         excel.export_json_to_excel({\n        //             header: tHeader,\n        //             data,\n        //             filename: '市场业绩表导出1'\n        //         })\n        //         this.downloadLoading = true\n        //     })\n        // },\n        // formatJson (filterVal, jsonData) {\n        //     return jsonData.map(v => filterVal.map(j => {\n        //         if (j === 'timestamp') {\n        //             return\n        //         } else {\n        //             return v[j]\n        //         }\n        //     }))\n        // },\n        // 从表导入导出\n        // 导入\n        handleImportSub () {\n            this.status = 'second'\n            this.importDialogVisible = true\n            this.$nextTick(() => {\n                // 将rowId传给 srmImportFile\n                this.$refs.importDialogSub.supplierId = this.rowData.rowId\n                this.$refs.importDialogSub.creator = this.rowData.creatorName\n                // 传递模板下载文件名称\n                this.$refs.importDialogSub.excelName = '市场业绩表2.xlsx'\n                this.$refs.importDialogSub.getList()\n            })\n        },\n        // // 导出\n        // handleExportSub () {\n        //     this.downloadLoading = true\n        //     import('@/vendor/Export2Excel').then(excel => {\n        //         const tHeader = ['产品名称', '供货级别', '直接客户名', '具体车型商品名简称', '配套主机厂名称', '年产量', '产品年产总值', '对主机厂年供货额', '供货比例(%)', '设备年产能(套/年)', '0公里缺陷率(%)', '创建人', '创建时间', '修改人', '修改时间']\n        //         const filterVal = ['name', 'level', 'customerName', 'productModelName', 'factoryName', 'yield', 'outputValue', 'supplyVolume', 'supplyProportion', 'productCapacity', 'defectRate', 'creatorName', 'createTime', 'updatorName', 'updateTime']\n        //         const data = this.formatJson(filterVal, this.listSub)\n        //         excel.export_json_to_excel({\n        //             header: tHeader,\n        //             data,\n        //             filename: '市场业绩表导出2'\n        //         })\n        //         this.downloadLoading = true\n        //     })\n        // },\n        // 弹框右上角关闭\n        handleClose () {\n            this.importDialogVisible = false\n            // 清空已选文件列表\n            if(this.status == 'one'){\n                this.$refs.importDialog.fileList = [] \n            } else if (this.status == 'second') {\n                this.$refs.importDialogSub.fileList = [] \n            }\n            this.getFreshList()\n        }\n    }\n};\n",null]}