{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/saleOut/saleOutQuery/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/saleOut/saleOutQuery/index.vue","mtime":1596610934201},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/project/wms/saleOut/saleOutIndicate'\nimport { selectlists } from '@/api/system/organization'\nimport Pagination from \"@/components/Pagination\"\nimport { DICT_CODE, DT_ORG_TYPE, THE_STATE_OPTIONS } from \"@/utils/constant\"\nimport { mapState, mapGetters } from \"vuex\"\nimport AuthoType from \"@/components/Select/AuthoType.vue\" //权限类型下拉组件\nimport qrcode from \"@/components/QRCode\"\nimport khxz from \"@/components/Select/khxz\" //客户选择\n\nexport default {\n    name: \"saleOutQuery\",\n    components: { Pagination, AuthoType, khxz, qrcode },\n    data () {\n        let compareDate = (rule, value, callback) => {\n            if (value < this.temp.goodsReadyTime) {\n                return callback(new Error(\"发货日期不能小于备货日期\"))\n            } else {\n                callback()\n            }\n        }\n        return {\n            theight: 0,\n            isSingle: true,//表格是否单选 点击各按钮根据流程逻辑控制单多选\n            tableKey: [0, 1],\n            list: null,\n            listSub: null,\n            list2: [],\n            total: 0,\n            totalSub: 0,\n            totalwl: 0,\n            value1: \"\",\n            value2: \"\",\n            dialogPrintVisible: false,\n            printData: {},//打印数据\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                businessType: undefined,\n                orgCode: undefined,\n                productionline: undefined,\n                station: undefined,\n                feedType: undefined,\n                state: 'sales10',\n                batchNumber: undefined,\n                leadTime: undefined,\n                feedTime: undefined,\n                feedwarehouse: undefined,\n                workShop: undefined,\n                deliverTimeStart: undefined,\n                deliverTimeEnd: undefined\n            },\n            listQuerySub: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                supplierCode: undefined,\n                orderNumber: undefined\n            },\n            listQuerywl: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10\n            },\n            dto: {\n                businessType: undefined,\n                customerCode: undefined,\n                deliverTime: undefined,\n                goodsReadyTime: undefined,\n                method: undefined,\n                note: undefined,\n                orgCode: undefined,\n                orgName: undefined,\n                salesOutInstructDetails: undefined,\n                warehouseCode: undefined\n            },\n            listLoading: true,\n            isEaid: false,\n            isEdit: false,\n            temp: {\n                state: undefined,\n                remark: undefined,\n                rowNo: undefined,\n                materielCode: undefined,\n                materielName: undefined,\n                orgCode: undefined,\n                productionline: undefined,\n                station: undefined,\n                feedType: undefined,\n                batchNumber: undefined,\n                leadTime: undefined,\n                feedTime: undefined,\n                feedwarehouse: undefined,\n                workShop: undefined,\n                goodsReadyEmpName: undefined,\n                materialputEmpName: undefined\n            },\n            bianji: {\n                businessType: undefined,\n                customerCode: undefined,\n                deliverTime: undefined,\n                goodsReadyTime: undefined,\n                method: undefined,\n                note: undefined,\n                orgCode: undefined,\n                salesOutInstructDetails: undefined,\n                warehouseCode: undefined\n            },\n            khxzDialogFormVisible: undefined,\n            xzwlDialogFormVisible: undefined,\n            parentsRows: [],\n            // measureCode: undefined,\n            selectCode: [],\n            dialogFormVisible: false,\n            employeeDialogFormVisible: false,\n            dialogStatus: \"\",\n            DICT_CODE: DICT_CODE,\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            // dimensionOptions: DICT_CODE,\n            THE_STATE_OPTIONS: THE_STATE_OPTIONS,\n            rules: {\n                goodsReadyTime: [\n                    { required: true, message: \"请选择\", trigger: \"blur\" }\n                ],\n                deliverTime: [\n                    { required: true, message: \"请选择\", trigger: \"blur\" },\n                    { validator: compareDate, trigger: \"blur\" }\n                ]\n            }\n        }\n    },\n    computed: {\n        ...mapGetters([\"name\", \"superRoles\"]),\n        ...mapState({\n            dt_dd_state: state => state.dict.dt_dd_state,\n            dt_ckyw_tpye: state => state.dict.dt_ckyw_tpye,\n            dt_purchase_class: state => state.dict.dt_purchase_class,\n            dt_sales_out_instruct_state: state =>\n                state.dict.dt_sales_out_instruct_state,\n            dt_busi_type_screenGroupNum: state =>\n                state.businessComponent.dt_busi_type_screenGroupNum\n        })\n    },\n    mounted () {\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.$store.dispatch(\"dict/getDicData\", [\n            \"dt_dd_state\",\n            \"dt_ckyw_tpye\",\n            \"dt_purchase_class\",\n            \"dt_sales_out_instruct_state\"\n        ])\n        this.$store.dispatch(\"businessComponent/getBusinessComponentData\", [\n            \"dt_busi_type_screenGroupNum\"\n        ])\n        this.getList()\n    },\n    methods: {\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 195\n        },\n        getList () {//查询主表\n            if (this.superRoles) {\n                this.listQuery.creator = null\n            } else {\n                this.listQuery.creator = this.name\n            }\n            if (this.value2) {\n                var d1 = this.value2[0]\n                var d2 = this.value2[1]\n                this.listQuery.deliverTimeStart = d1\n                this.listQuery.deliverTimeEnd = d2\n            } else {\n                this.listQuery.deliverTimeStart = \"\"\n                this.listQuery.deliverTimeEnd = \"\"\n            }\n            selectlists().then(response => {\n                api.queryRecords(this.listQuery).then(res => {\n                    res = res.data\n                    res.list.forEach((item, index) => {\n                        response.data.forEach((option) => {\n                            if (option.organizationCode == item['orgCode']) {\n                                res.list[index]['orgName'] = option.organizationName\n                            }\n                        })\n                    })\n                    this.list = res.list\n                    this.total = res.pages.count\n                    if (this.total == 0) {\n                        this.listSub = []\n                    }\n                    this.$nextTick(function () {\n                        this.checked()\n                    })\n                })\n            })\n        },\n        checked () {\n            this.$refs.tb.toggleRowSelection(this.list[0], true)//官网方法，重点\n        },\n        getListSub () {//查询从表\n            api.queryRecorditems(this.selectlistRow.instructCode).then(res => {\n                res = res.data\n                this.listSub = res.salesOutInstructDetails\n                this.totalSub = res.salesOutInstructDetails.length\n            })\n        },\n        handleQuery () {\n            this.listQuery.currentPage = 1\n            this.getList()\n        },\n        selectPartRow (rows) {\n            rows.map(v => {\n                v.productCode = v.materielCode\n                v.productName = v.materielName\n                v.model = v.specification\n                return v\n            })\n            this.parentsRows1 = rows\n        },\n        materialxz () { //物料选中中弹窗确认按钮\n            if (this.parentsRows1.length) {\n                this.setDetails(this.parentsRows1)\n                this.xzwlDialogFormVisible = false\n            } else {\n                this.$message({\n                    title: this.$t(\"message.warning\"),\n                    message: this.$t(\"message.checkedplease\"),\n                    type: \"warning\"\n                })\n            }\n        },\n        //单据打印\n        receiptPrint () {\n            if (this.selectlistRow) {\n                this.dialogPrintVisible = true\n                this.dialogStatus = \"print\"\n                this.printData = this.selectlistRow\n                this.$nextTick(() => {\n                    this.$refs.childQRcode.qrCreate(this.printData.instructCode)\n                })\n\n            } else {\n                this.$message.warning(this.$t('message.checkedplease'))\n                return false\n            }\n\n        },\n        //单据打印执行\n        doReceiptPrint () {\n            let newWin = window.open(\"\")\n            var newstr = document.getElementById('receipt').innerHTML\n            newWin.document.write(newstr)\n            newWin.document.close()//IE添加\n\n            setTimeout(function () {\n                newWin.print()\n                newWin.close()\n            }, 100)\n        },\n        handleCreate () {\n            this.resetTemp()\n            this.dialogStatus = \"create\"\n            this.isEdit = false\n            this.dialogFormVisible = true\n            this.list2 = []\n        },\n        orgname (name) {//获取组织名称\n            this.dto.orgName = name\n        },\n        create () {//新增\n            this.dto.businessType = this.temp.businessType\n            this.dto.customerCode = this.temp.customerCode\n            this.dto.deliverTime = this.temp.deliverTime\n            this.dto.goodsReadyTime = this.temp.goodsReadyTime\n            this.dto.method = \"MODIFY\"\n            this.dto.note = this.temp.note\n            this.dto.orgCode = this.temp.orgCode\n            this.dto.salesOutInstructDetails = this.list2\n            this.dto.warehouseCode = this.temp.warehouseCode\n            api.addRecord(this.dto).then(() => {\n                this.getList()\n                this.list2 = []\n                this.dialogFormVisible = false\n                this.$message({\n                    title: \"成功\",\n                    message: \"新增成功\",\n                    type: \"success\",\n                    duration: 2000\n                })\n            })\n        },\n        handleDelete () {// 删除\n            if (this.selectlistRow) {\n                this.$confirm(\"确认要删除该数据项吗?\", \"提示\", {\n                    confirmButtonText: \"确定\",\n                    cancelButtonText: \"取消\",\n                    type: \"warning\"\n                }).then(() => {\n                    api.deleteRecord(this.selectlistRow.instructCode).then(() => {\n                        this.getList()\n                        this.getListSub()\n                        this.$message({\n                            type: \"success\",\n                            message: \"删除成功\"\n                        })\n                    })\n                }).catch(() => {\n                    this.$message({\n                        type: \"info\",\n                        message: \"已取消\"\n                    })\n                })\n            } else {\n                this.$message.warning(\"请勾选记录！\")\n                return\n            }\n        },\n        handleDeleteitems () {//删除物料\n            if (this.selectlistRowwl) {\n                this.$confirm(\"确认要删除该数据项吗?\", \"提示\", {\n                    confirmButtonText: \"确定\",\n                    cancelButtonText: \"取消\",\n                    type: \"warning\"\n                }).then(() => {\n                    this.list2 = this.list2.filter(item => {\n                        let isD = true\n                        this.selectlistRowwl.forEach((itemr) => {\n                            if (itemr.materielCode === item.materielCode) {\n                                isD = false\n                            }\n                        })\n                        return isD\n                    })\n\n                    this.$message({\n                        type: \"success\",\n                        message: \"删除成功\"\n                    })\n                }).catch(() => {\n                    this.$message({\n                        type: \"info\",\n                        message: \"已取消\"\n                    })\n                })\n            } else {\n                this.$message.warning(\"请勾选记录！\")\n                return\n            }\n        },\n        setDetails (data) {\n            data.forEach((item) => {\n                this.list2.push(item)\n            })\n            this.$set(this.$refs.wlxzRef.list, this.list2)\n        },\n        handleCreatewl () {//新增物料\n            if (this.temp.orgCode && this.temp.warehouseCode && this.temp.businessType && this.temp.customerCode) {\n                this.xzwlDialogFormVisible = !this.xzwlDialogFormVisible\n                this.isEdit = true\n                setTimeout(() => {\n                    this.$refs.wlxzRef.selectedDetails = this.list2\n                    this.$refs.wlxzRef.getList()\n                }, 0)\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择组织,仓库,业务类型,客户编码\",\n                    type: \"warning\",\n                    duration: 2000\n                })\n            }\n        },\n\n\n        handleUpdate () {//编辑\n            if (this.selectlistRow) {\n                if (this.selectlistRow.state == \"sales10\") {\n                    this.temp.orgCode = this.selectlistRow.orgCode\n                    this.temp.warehouseCode = this.selectlistRow.warehouseCode\n                    this.temp.customerCode = this.selectlistRow.customerCode\n                    this.temp.businessType = this.selectlistRow.businessType\n                    this.temp.goodsReadyTime = this.selectlistRow.goodsReadyTime\n                    this.temp.deliverTime = this.selectlistRow.deliverTime\n                    this.temp.note = this.selectlistRow.note\n                    api.queryRecorditems(this.selectlistRow.instructCode).then(res => {\n                        res = res.data\n                        this.list2 = res.salesOutInstructDetails\n                        this.totalwl = res.salesOutInstructDetails.length\n                    })\n                    this.dialogFormVisible = true\n                    this.isEdit = true\n                    this.dialogStatus = \"update\"\n                } else {\n                    this.$message({\n                        title: \"警告\",\n                        message: \"非编辑状态下不可编辑\",\n                        type: \"warning\",\n                        duration: 2000\n                    })\n                }\n\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\",\n                    duration: 2000\n                })\n            }\n        },\n        update () {\n            this.temp.salesOutInstructDetails = this.list2\n            this.temp.method = \"MODIFY\"\n            api.updateRecord(this.selectlistRow.instructCode, this.temp).then(() => {\n                // this.getList()\n                this.dialogFormVisible = false\n                this.$message({\n                    title: \"成功\",\n                    message: \"编辑成功\",\n                    type: \"success\",\n                    duration: 2000\n                })\n                this.getList()\n                this.getListSub()\n            })\n        },\n        handleSubmit () {//提交\n            if (this.selectlistRow) {\n                this.selectlistRow.salesOutInstructDetails = this.list2\n                this.selectlistRow.method = \"SUBMIT\"\n                api.updateRecord(this.selectlistRow.instructCode, this.selectlistRow).then(() => {\n                    this.$message({\n                        title: \"成功\",\n                        message: \"编辑成功\",\n                        type: \"success\",\n                        duration: 2000\n                    })\n                    this.getList()\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\",\n                    duration: 2000\n                })\n            }\n        },\n        handleCancel () {\n            if (this.selectlistRow) {\n                this.selectlistRow.salesOutInstructDetails = this.list2\n                this.selectlistRow.method = \"CLOSE\"\n                api.updateRecord(this.selectlistRow.instructCode, this.selectlistRow).then(() => {\n                    this.$message({\n                        title: \"成功\",\n                        message: \"关闭成功\",\n                        type: \"success\",\n                        duration: 2000\n                    })\n                    this.getList()\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\",\n                    duration: 2000\n                })\n            }\n        },\n        handleClickgysxz () {\n            this.khxzDialogFormVisible = true\n        },\n        handleDblclickgysxz (row) {//父子页面通信\n            this.parentsRows = row\n            // this.gysxzDialogFormVisible = false;\n        },\n        update1 () {//客户选中弹窗确认按钮\n            if (!this.parentsRows[0]) {\n                this.listQuery.customerCode = \"\"\n                this.temp.customerCode = \"\"\n                this.khxzDialogFormVisible = false\n            } else {\n                if (this.dialogFormVisible) {\n                    this.temp.customerCode = this.parentsRows[0].customerCode\n                    this.khxzDialogFormVisible = false\n                    // this.listQuery.customerCode = \"\";\n                } else {\n                    this.listQuery.customerCode = this.parentsRows[0].customerCode\n                    // this.temp.customerCode = \"\";\n                    this.khxzDialogFormVisible = false\n                }\n            }\n        },\n\n        handleDeleteBatch () {\n            if (this.selectCode.length == 0) {\n                this.$message.warning(\"请勾选记录！\")\n                return\n            }\n            this.delete(this.selectCode)\n        },\n        selectRow (val) {//表一复选框选中方法\n            this.selectlistRow = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.tb.clearSelection()\n                this.$refs.tb.toggleRowSelection(val[val.length - 1])\n            }\n            this.$refs.tb.setCurrentRow(this.selectlistRow)\n            if (this.selectlistRow) {\n                this.getListSub()\n            }\n        },\n        selectRowMain (val) { //表一单击行选中方法\n            this.selectlistRowMain = val\n            this.$refs.tb.clearSelection()\n            this.$refs.tb.toggleRowSelection(val)\n        },\n\n        selectRowSub (val) {//表二复选框选中方法\n            this.selectlistRowSub = val\n        },\n\n        selectRowSubClick (val) {//表二单击行选中方法\n            this.selectlistRowSubClick = val\n        },\n        selectRowwl (val) {//弹窗物料选中方法\n            this.selectlistRowwl = val\n        },\n        cancel () {\n            this.dialogFormVisible = false\n        },\n        handelRefresh () {//刷新\n            this.isEdit = false\n            this.list2 = []\n        },\n        resetTemp () {\n            this.temp = {\n                measureCode: undefined,\n                measureName: undefined,\n                dimension: undefined,\n                transferRate: undefined,\n                isBase: 0,\n                isEnabled: 1,\n                remark: undefined\n            }\n        },\n        handleClose () {\n            this.resetTemp()\n            this.$refs.temp.resetFields()\n        },\n        handleSelectionChange (selection) {\n            this.selectCode = selection.map(v => v.measureCode)\n        },\n        setdefault (val, i) {\n            if (i === 1) {\n                this.listQuery.orgCode = val\n            } else if (i === 3) {\n                this.listQuery.warehouseCode = val\n                this.listQuery.businessType = this.dt_busi_type_screenGroupNum.options[0].wareRuleCode\n                this.getList()\n            }\n        },\n    }\n};\n",null]}