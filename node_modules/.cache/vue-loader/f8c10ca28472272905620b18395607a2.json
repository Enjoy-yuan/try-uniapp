{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentRental/addApplication.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentRental/addApplication.vue","mtime":1596610933378},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Pagination from '@/components/Pagination'\nimport caiGou from '@/components/Select/xtpt/caigou'\nimport { DT_ORG_TYPE } from '@/utils/constant'\nimport personSelect from \"@/components/Select/personSelect.vue\"\nimport eqmtSelect from '../../components/eqmtSelect'\nimport khxz from \"@/components/Select/khxz\"\nimport { getRealName, getName } from '@/utils/auth'\nimport { mapState } from 'vuex'\n\nexport default {\n    name: 'color',\n    components: { Pagination, caiGou, personSelect, khxz, eqmtSelect },\n    data () {\n        return {\n            list: [],\n            subList: [],\n            parentList: [],\n            equipRows: [],\n            total: 0,\n            total1: 0,\n            theight: 0, //表格高度\n            orgCodeA: undefined,\n            employee: undefined,\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 15,\n                applicant: getRealName(),\n                applicantName: getName(),\n                customerCode: undefined,\n                deposit: undefined,\n                leaseAmount: undefined,\n                leaseType: undefined,\n                orgCode: undefined,\n                orgName: undefined,\n                planLeaseTime: undefined,\n                planReturnTime: undefined,\n                remark: undefined,\n                renter: undefined,\n                useAddress: undefined,\n                useDescription: undefined\n            },\n\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            hiddenList: true,\n            hiddenSubList: false,\n            personnelDialogFormVisible: false,\n            khxzDialogFormVisible: false,\n            colorCode: undefined,\n            selectCode: [],\n            dialogFormVisible: false,\n            dialogStatus: '',\n            tableKey: [0, 1],\n            rules: {\n                orgCode: [\n                    {\n                        required: true,\n                        message: '组织编码不能为空',\n                        trigger: 'blur'\n                    }\n                ],\n                applicant: [\n                    {\n                        required: true,\n                        message: '申请人不能为空',\n                        trigger: 'blur'\n                    }\n                ],\n                planLeaseTime: [\n                    {\n                        required: true,\n                        message: '计划租借时间不能为空',\n                        trigger: 'blur'\n                    }\n                ],\n                planReturnTime: [\n                    {\n                        required: true,\n                        message: '计划归还时间不能为空',\n                        trigger: 'blur'\n                    }\n                ]\n            },\n\n            pickerOptionsStart: {\n                disabledDate: time => {\n                    let endDateVal = this.listQuery.planReturnTime\n                    if (endDateVal) {\n                        return time.getTime() > new Date(endDateVal).getTime()\n                    }\n                }\n            },\n            pickerOptionsEnd: {\n                disabledDate: time => {\n                    let beginDateVal = this.listQuery.planLeaseTime\n                    if (beginDateVal) {\n                        return (\n                            time.getTime() <\n                            new Date(beginDateVal).getTime()\n                        )\n                    }\n                }\n            },\n        }\n    },\n    created () {\n    },\n    computed: {\n        // 过滤器下拉框item数据\n        ...mapState({\n            dt_lease_type: state => state.eamDict.dt_lease_type\n\n        }),\n    },\n    mounted () {\n        this.$store.dispatch('eamDict/getDicData', [\n            'dt_lease_type'\n        ])\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n    },\n    methods: {\n        getList () {\n            // api.queryRecords(this.listQuery).then(res => {\n            //     this.list = res.data.list\n            //     this.total = res.data.pages.count\n            // })\n        },\n        validateForm () {\n            let flag = false\n            this.$refs['childRef'].validate((valid) => {\n                flag = valid\n            })\n            return flag\n        },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight()\n        },\n        leaseTypeChange (val) {\n            if (val == 'lease_type_lend') {\n                this.hiddenList = true\n                this.hiddenSubList = false\n                this.parentList = []\n                this.list = []\n            } else {\n                this.hiddenList = false\n                this.hiddenSubList = true\n                this.parentList = []\n                this.subList = []\n            }\n        },\n        //打开租借单位弹窗\n        handleClickgysxz () {\n            this.khxzDialogFormVisible = true\n        },\n        //租借父子传值\n        handleDblclickgysxz (row) {\n            this.parentsRows = row\n        },\n        khxzUpdate () {\n            this.listQuery.customerCode = this.parentsRows.customerCode\n            this.khxzDialogFormVisible = false\n        },\n        //打开申请人弹窗\n        handlegPersonnel (val) {\n            this.employee = val\n            this.personnelDialogFormVisible = true\n        },\n        //申请人父子传值\n        purchasingPersonnels (row) {\n            this.personRow = row\n        },\n        personUpdate () {\n            if (this.employee == 'applicant') {\n                this.listQuery.applicant = this.personRow.employeeCode\n                this.listQuery.applicantName = this.personRow.employeeName\n            } else {\n                this.listQuery.renter = this.personRow.employeeCode\n                this.listQuery.renterName = this.personRow.employeeName\n            }\n\n            this.personnelDialogFormVisible = false\n        },\n        resetTemp () {\n            this.listQuery.applicant = getRealName()\n            this.listQuery.applicantName = getName()\n            this.listQuery.customerCode = undefined\n            this.listQuery.deposit = undefined\n            this.listQuery.leaseAmount = undefined\n            this.listQuery.leaseType = undefined\n            this.listQuery.orgCode = undefined\n            this.listQuery.planLeaseTime = undefined\n            this.listQuery.planReturnTime = undefined\n            this.listQuery.remark = undefined\n            this.listQuery.renter = undefined\n            this.listQuery.useAddress = undefined\n            this.listQuery.useDescription = undefined\n            this.list = []\n            this.subList = []\n        },\n        init (val) {\n            this.$set(this.listQuery, 'applicant', val.applicant)\n            this.$set(this.listQuery, 'customerCode', val.customerCode)\n            this.$set(this.listQuery, 'deposit', val.deposit)\n            this.$set(this.listQuery, 'leaseAmount', val.leaseAmount)\n            this.$set(this.listQuery, 'leaseType', val.leaseType)\n            this.$set(this.listQuery, 'orgCode', val.orgCode)\n            this.$set(this.listQuery, 'planLeaseTime', val.planLeaseTime)\n            this.$set(this.listQuery, 'planReturnTime', val.planReturnTime)\n            this.$set(this.listQuery, 'remark', val.remark)\n            this.$set(this.listQuery, 'renter', val.renter)\n            this.$set(this.listQuery, 'useAddress', val.useAddress)\n            this.$set(this.listQuery, 'useDescription', val.useDescription)\n            this.list = val.deviceLeaseDetails\n            this.subList = val.deviceLeaseDetails\n        },\n\n        handleCreate () {\n            //新增\n            if (this.listQuery.leaseType && this.listQuery.orgCode) {\n                this.orgCodeA = this.listQuery.orgCode\n                setTimeout(() => {\n                    this.$refs.eqmtSelect.getList()\n                }, 0)\n                this.dialogFormVisible = true\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择租借类型与组织',\n                    type: 'warning'\n                })\n            }\n        },\n        create () {\n            if (this.listQuery.leaseType == 'lease_type_lend') {\n                let states = this.$refs.eqmtSelect.currentSelect.filter(v => {\n                    return v.state == 'device_state50'\n                })\n                if (states.length > 0) {\n                    this.$message({\n                        title: '警告',\n                        message: '无法新增租借出状态的数据',\n                        type: 'warning'\n                    })\n                    return false\n                }\n                this.list = this.list.concat(\n                    this.$refs.eqmtSelect.currentSelect\n                )\n                this.$nextTick(() => {\n                    this.parentList = this.list\n                })\n                this.dialogFormVisible = false\n            } else if (this.listQuery.leaseType == 'lease_type_lease') {\n                let states = this.$refs.eqmtSelect.currentSelect.filter(v => {\n                    return v.state == 'device_state50'\n                })\n                if (states.length > 0) {\n                    this.$message({\n                        title: '警告',\n                        message: '无法新增租借出状态的数据',\n                        type: 'warning'\n                    })\n                    return false\n                }\n                this.subList = this.subList.concat(\n                    this.$refs.eqmtSelect.currentSelect\n                )\n                this.$nextTick(() => {\n                    this.parentList = this.subList\n                })\n                this.dialogFormVisible = false\n            }\n        },\n        // 获取表格选中时的数据\n        selectRow (val) {\n            this.selectlistRow = val\n        },\n        handleDelete () {\n            //删除列表\n            if (this.selectlistRow) {\n                this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                }).then(() => {\n                    if (this.listQuery.leaseType == 'lease_type_lend') {\n                        this.selectlistRow.forEach((item) => {\n                            this.list.forEach((val, indexs) => {\n                                if (item == val) {\n                                    this.list.splice(indexs, 1)\n                                }\n                            })\n                        })\n                        this.$message({\n                            title: '成功',\n                            message: '删除成功',\n                            type: 'success',\n                            duration: 2000\n                        })\n                    } else if (this.listQuery.leaseType == 'lease_type_lease') {\n                        this.selectlistRow.forEach((item) => {\n                            this.subList.forEach((val, indexs) => {\n                                if (item == val) {\n                                    this.subList.splice(indexs, 1)\n                                }\n                            })\n                        })\n                        this.$message({\n                            title: '成功',\n                            message: '删除成功',\n                            type: 'success',\n                            duration: 2000\n                        })\n\n                    }\n                }).catch(() => {\n                    this.$message({\n                        type: 'info',\n                        message: '已取消删除'\n                    })\n                })\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n            }\n        },\n\n        getTotal () {\n            let a = []\n            this.subList.map((item) => {\n                if (item.deposit !== \"\" && item.deposit !== undefined) {\n                    a.push(item.deposit)\n                }\n            })\n            let b = a.map((v) => {\n                return parseInt(v)\n            })\n            this.listQuery.deposit = 0\n            for (var i in b) {\n                this.listQuery.deposit += b[i]\n            }\n        },\n        getTotal1 () {\n            let a = []\n            this.subList.map((item) => {\n                if (item.leaseAmount !== \"\" && item.leaseAmount !== undefined) {\n                    a.push(item.leaseAmount)\n                }\n            })\n            let b = a.map((v) => {\n                return parseInt(v)\n            })\n            this.listQuery.leaseAmount = 0\n            for (var i in b) {\n                this.listQuery.leaseAmount += b[i]\n            }\n        },\n    }\n}\n",null]}