{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/ruleAttrDefine/content/contentReferData.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/ruleAttrDefine/content/contentReferData.vue","mtime":1596610933348},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { queryRecords, queryRecordsDetail, addMainRecords, deleteMainRecords } from \"@/api/data-base/ruleAttrDefine\"\nimport Pagination from \"@/components/Pagination\"\nimport { mapState } from 'vuex'\n\nexport default {\n    name: \"contentBatch\",\n    components: { Pagination },\n    data () {\n        return {\n            list: [],\n            addList: {},\n            listDetail: [],\n            theight: 0,\n            stheight: 0,//右子表高度\n            tableKey: [0, 1],//表格索引，虚拟dom渲染表格时使用\n            total: 0,\n            totalDetail: 0,\n            selectRowsDetail: [],\n            selectRows: null,\n            parentId: null,\n            listQuery: {\n                currentPage: 0,\n                pageSize: 10,\n                referentType: '',\n                referentObject: '',\n                remark: '',\n                objectType: ''\n            },\n            listQueryDetail: {\n                rowId: null,\n                attributeCode: '',\n                attributeName: '',\n                currentPage: 0,\n                pageSize: 10,\n            }\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_referdata_resource: state => state.dict.dt_referdata_resource,\n        })\n    },\n    mounted () {\n        this.$store.dispatch('dict/getDicData', ['dt_referdata_resource'])\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.getList()\n    },\n    methods: {\n        //显示主表\n        getList () {\n            queryRecords(this.listQuery).then(res => {\n                this.total = res.data.pages.count\n                this.list = res.data.list\n            })\n        },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 120\n            this.stheight = this.theight + 40\n        },\n        getListDetail () {\n            if (this.selectRows) {\n                this.listQueryDetail.rowId = this.selectRows.rowId\n                queryRecordsDetail(this.listQueryDetail).then(res => {\n                    this.totalDetail = res.data.pages.count\n                    this.listDetail = res.data.list\n                })\n            }\n        },\n        handleQueryMain () {\n            this.listQuery.currentPage = 0\n            this.getList()\n        },\n        //每页大小变化\n        handleSizeChange (val) {\n            this.listQuery.pageSize = val\n            this.getList()\n        },\n        //当前页变化\n        handleCurrentChange (val) {\n            this.listQuery.currentPage = val\n            this.getList()\n        },\n        //主表勾选框选中\n        selectRow (val) {\n            this.selectRows = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.tbmain.clearSelection()\n                this.$refs.tbmain.toggleRowSelection(val[val.length - 1], 'selected')\n            }\n            this.getListDetail()\n        },\n        selectRowDetail (val) {\n            this.selectRowsDetail = val\n        },\n        handleDelete () {\n            if (this.selectRows.rowId) {\n                if (this.selectRowsDetail.length) {\n                    let rowIds = new Array()\n                    for (let i = 0; i < this.selectRowsDetail.length; i++) {\n                        rowIds.push(this.selectRowsDetail[i].rowId)\n                    }\n                    deleteMainRecords(this.selectRows.rowId, rowIds).then(() => {\n                        this.$message({\n                            type: 'success',\n                            message: '已删除'\n                        })\n                        this.getListDetail()\n                    })\n                } else {\n                    this.$message.warning(this.$t('message.checkedplease'))\n                }\n\n            } else {\n                this.$message.warning('请先选择左表数据')\n            }\n        },\n        //添加明细\n        handleAdd () {\n            if (this.selectRows) {\n                if (this.listQueryDetail.attributeCode && this.listQueryDetail.attributeName) {\n                    this.addList = Object.assign({}, this.selectRows)\n                    this.addList.referentDataItems = new Array()\n                    let delist = Object.assign({}, this.listQueryDetail)\n                    delist.parentRowId = this.selectRows.rowId\n                    this.addList.referentDataItems.push(delist)\n                    delete this.addList.referentDataItems.pageSize\n                    delete this.addList.referentDataItems.currentPage\n                    delete this.addList.referentDataItems.rowId\n\n                    addMainRecords(this.addList).then(() => {\n                        this.$message({\n                            type: 'success',\n                            message: '添加成功'\n                        })\n                        this.listQueryDetail = {\n                            rowId: this.selectRows.rowId,\n                            attributeCode: '',\n                            attributeName: '',\n                            currentPage: 0,\n                            pageSize: 10,\n                        }\n                        this.getListDetail()\n                    })\n                } else {\n                    this.$message.warning(this.$t('请先填写属性码和属性名称'))\n                }\n            } else {\n                this.$message.warning(this.$t('请先选择一条规则属性'))\n            }\n        },\n        //左表新增\n        handleAddMain () {\n            this.addList = Object.assign({}, this.listQuery)\n            delete this.addList.currentPage\n            delete this.addList.pageSize\n            if (this.addList.objectType && this.addList.referentObject && this.addList.referentType) {\n                addMainRecords(this.addList).then(() => {\n                    this.$message({\n                        type: 'success',\n                        message: '添加成功'\n                    })\n                    this.listQuery = {\n                        currentPage: 0,\n                        pageSize: 10,\n                        referentType: '',\n                        referentObject: '',\n                        remark: '',\n                        objectType: ''\n                    }\n                    this.listDetail = []\n                    this.getList()\n                })\n            } else {\n                this.$message.warning(this.$t('请将条件填写完整'))\n            }\n        },\n        handleDeleteMain () {\n            if (this.selectRows.rowId) {\n                let rowIds = ''\n                deleteMainRecords(this.selectRows.rowId, rowIds).then(() => {\n                    this.$message({\n                        type: 'success',\n                        message: '已删除'\n                    })\n                    this.listDetail = []\n                    this.getList()\n                })\n            } else {\n                this.$message.warning(this.$t('message.checkedplease'))\n            }\n        },\n    }\n}\n",null]}