{"remainingRequest":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/cf_web/src/views/data-base/ruleAttrDefine/content/contentPurchaseCatalog.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/cf_web/src/views/data-base/ruleAttrDefine/content/contentPurchaseCatalog.vue","mtime":1600927611464},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n    getPurchaseDict,\n    addPurchaseRecords,\n    deletePurchaseRecords,\n    queryPurchaseRecords\n} from '@/api/data-base/ruleAttrDefine'\n\nexport default {\n    name: 'contentPurchaseCatalog',\n    components: {},\n    data () {\n        return {\n            addList: [],\n            theight: 0, //表格高度\n            tableKey: 0, //表格索引\n            purchaseList: null,\n            stockList: null,\n            selectRows: []\n        }\n    },\n    mounted () {\n        this.getSelectData()\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.getList()\n    },\n    methods: {\n        getSelectData () {\n            getPurchaseDict('dt_purchase_class').then(res => {\n                this.purchaseList = res.data.dictItemDTOs\n            })\n            getPurchaseDict('dt_stock_type').then(res => {\n                this.stockList = res.data.dictItemDTOs\n            })\n        },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() + 10\n        },\n        //显示主表\n        getList () {\n            queryPurchaseRecords().then(res => {\n                console.log(res)\n                this.addList = res.data\n            })\n        },\n        //主表勾选框选中\n        selectRow (val) {\n            this.selectRows = val\n        },\n        //新增\n        handleAdd () {\n            let addRow = {\n                purchaseClassKey: '',\n                //   purchaseCatalogName:'',\n                stockTypeKey: ''\n                //   stockTypeName:''\n            }\n            this.addList.push(addRow)\n        },\n        //保存\n        handleSave () {\n            if (this.selectRows.length === 1) {\n                addPurchaseRecords(this.selectRows[0]).then(() => {\n                    this.$message.warning('新增成功')\n                    this.getList()\n                })\n            } else {\n                this.$message.warning('请选择一条信息')\n            }\n        },\n        //删除\n        handleDelete () {\n            if (this.selectRows.length === 1) {\n                deletePurchaseRecords(this.selectRows[0].purchaseClassKey)\n                    .then(res => {\n                        console.log('删除', res)\n                        this.getList()\n                    })\n                    .catch(e => {\n                        console.log(1111, e.message)\n                        if (e.message === '采购分类对照库存类型不存在') {\n                            this.addList.forEach((item, index) => {\n                                this.selectRows.forEach(item1 => {\n                                    if (\n                                        item1.purchaseClassKey ===\n                                        item.purchaseClassKey\n                                    ) {\n                                        this.addList.splice(index, 1)\n                                    }\n                                })\n                            })\n                        } else {\n                            throw e\n                        }\n                    })\n            } else {\n                this.$message.warning('请选择一条信息')\n            }\n        },\n        changePurchase () {\n            // this.purchaseList.forEach((item,index)=>{\n            //     console.log(item,index);\n            //     if(item.dictItemKey===purchaseClassKey){\n            //         this.addList[i].purchaseCatalogName = item.dictItemValue;\n            //     }\n            // })\n        },\n        changeStockType () {\n            // this.stockList.forEach((item,index)=>{\n            //     console.log(item,index);\n            //     if(item.dictItemKey===stockTypeKey){\n            //         this.addList[i].stockTypeName = item.dictItemValue;\n            //     }\n            // })\n        }\n    }\n}\n",null]}