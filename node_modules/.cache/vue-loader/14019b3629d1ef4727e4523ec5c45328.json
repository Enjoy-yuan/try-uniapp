{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentArchives/tab1.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentArchives/tab1.vue","mtime":1596610933376},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/project/eas/el/equipmentArchives'\n// import Pagination from '@/components/Pagination'\nimport { mapState } from 'vuex'\n\nexport default {\n    name: 'dispatchOrderManagement',\n    components: {},\n    props: ['deviceCode'],\n    data () {\n        return {\n            // basurl:'113.57.169.228:7954',\n            fileList: [],\n            list: null,\n            newArr: [],\n            subList: [],\n            total: 0,\n            theight: 0, //表格高度\n            listQuery: {\n                fileType: undefined\n            },\n            temp: {\n                fileType: undefined,\n                category: undefined,\n                fileCode: undefined,\n                readName: undefined\n            },\n            files: undefined,\n            tableKey: [0]\n        }\n    },\n    created () {\n        this.getSetDefaults()\n    },\n\n    computed: {\n        ...mapState({\n            dt_file_equipment: state => state.eamDict.dt_file_equipment,\n            dt_file_type: state => state.eamDict.dt_file_type\n        })\n    },\n    mounted () {\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.temp.fileType = \"img\"\n        this.$store.dispatch('eamDict/getDicData', [\n            'dt_file_equipment',\n            'dt_file_type'\n        ])\n    },\n    methods: {\n        getList () {\n            let fileType = 'img'\n            api.queryFile(this.deviceCode, fileType).then(res => {\n                this.list = res.data\n                this.newArr = []\n                for (var i = 0; i < this.list.length; i++) {\n                    api.queryPic(this.list[i].readName).then(res => {\n                        res.config.url = res.config.url.replace(\n                            process.env.VUE_APP_BASE_API11,\n                            process.env.VUE_APP_BASE_API11_URL\n                        )\n                        this.newArr.push(res.config.url)\n                        return this.newArr\n                    })\n                }\n            })\n        },\n        getSetDefaults () {\n            this.$viewer.setDefaults({\n                // inline: true,\n                button: true, //右上角按钮\n                navbar: true, //底部缩略图\n                title: false, //当前图片标题\n                toolbar: true, //底部工具栏\n                tooltip: false, //显示缩放百分比\n                movable: true, //是否可以移动\n                zoomable: false, //是否可以缩放\n                rotatable: false, //是否可旋转\n                scalable: false, //是否可翻转\n                transition: false, //使用 CSS3 过度\n                fullscreen: false, //播放时是否全屏\n                keyboard: true, //是否支持键盘\n                url: 'data-source',\n                viewed: function (e) {\n                    if (e.detail.index === 1) {\n                        this.viewer.rotate(20)\n                    }\n                }\n            })\n        },\n        value () { },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 100\n        },\n\n        handleDelete () {\n            //删除列表\n            if (this.selectlistRow) {\n                this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                })\n                    .then(() => {\n                        api.deleteFile(this.selectlistRow.fileCode).then(() => {\n                            this.getList(),\n                                this.$message({\n                                    title: '成功',\n                                    message: '删除成功',\n                                    type: 'success',\n                                    duration: 2000\n                                })\n                        })\n                    })\n                    .catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消删除'\n                        })\n                    })\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n            }\n        },\n        init (val) {\n            this.newArr = []\n            this.subList = val\n            this.getList()\n        },\n        fileExceed () {\n            this.$message.error('一次最多上传10个文件')\n        },\n        beforeUpload (file) {\n            const isJPG = file.type === 'image/jpeg'\n            const isPNG = file.type === 'image/png'\n            const isPG = isJPG || isPNG //限制图片格式为jpg / png\n            const isLt2M = file.size / 1024 / 1024 < 10 //限制图片大小\n            if (!isPG) {\n                this.$message.error('上传头像图片只能是 JPG 或 PNG 格式!')\n            }\n            if (!isLt2M) {\n                this.$message.error('上传头像图片大小不能超过 10MB!')\n            }\n            return isPG && isLt2M\n        },\n        handleChange (file, fileList) {\n            this.files = fileList\n        },\n        uploadFile () {\n\n        },\n        handleUpload () {\n            if (!this.subList) {\n                this.$message({\n                    title: '警告',\n                    message: '请选择设备',\n                    type: 'warning'\n                })\n                return false\n            }\n            if (!this.temp.category) {\n                this.$message({\n                    title: '警告',\n                    message: '请选择文件类别',\n                    type: 'warning'\n                })\n                return false\n            }\n            var data = new FormData()\n            this.files.forEach(file => {\n                data.append('files', file.raw)\n            })\n            api.uploadFile(this.deviceCode, data, {\n                category: this.temp.category,\n                fileType: this.temp.fileType\n            }).then(() => {\n                this.$refs.upload.clearFiles()\n                this.$message({\n                    title: '成功',\n                    message: '上传成功',\n                    type: 'success',\n                    duration: 2000\n                })\n                this.getList()\n            })\n        },\n        // 获取表格选中时的数据\n        selectRow (val) {\n            this.selectlistRow = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.mainList.clearSelection()\n                this.$refs.mainList.toggleRowSelection(\n                    val[val.length - 1],\n                    'selected'\n                )\n            }\n        }\n    }\n}\n",null]}