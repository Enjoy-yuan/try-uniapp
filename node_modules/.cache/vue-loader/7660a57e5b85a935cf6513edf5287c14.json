{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/contractManage/contractTemplate/contractEstablishment/content/contentB.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/contractManage/contractTemplate/contractEstablishment/content/contentB.vue","mtime":1596610933605},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from \"@/api/project/srm/contractManage/contractEstablishment\"\nimport { DICT_CODE } from '@/utils/constant'\nimport caiGou from '@/components/Select/xtpt/caigou'//下拉组件\nimport dialogGysxz from '@/components/Dialog/dialogsGysxz'//供应商选择\nimport { mapState } from \"vuex\"\nimport pageSignA from '../dialog/pageSignA'\nimport pageSignB from '../dialog/pageSignB'\nimport pageSignC from '../dialog/pageSignC'\nimport pageSignD from '../dialog/pageSignD'\nimport addItem from '../dialog/addItem'\nimport templateSelect from '../dialog/templateSelect'\nimport partsList from '@/components/Dialog/partsList'\nexport default {\n    components: { caiGou, dialogGysxz, pageSignA, pageSignB, pageSignC, pageSignD, templateSelect, addItem, partsList },\n    data () {\n        return {\n            dataStatus: null,\n            editIndex: null,\n            DICT_CODE: DICT_CODE,\n            tabName: 'pageSignA',\n            temp: {\n                insideContractNo: undefined,\n                contractName: undefined,\n                orgCode: undefined,\n                outsideContractNo: undefined,\n                validTimeStart: undefined,\n                validTimeEnd: undefined,\n                contractType: undefined,\n                contractCategory: undefined,\n                contractAttribute: undefined,\n                years: undefined,\n                templateVersion: undefined,\n                description: undefined,\n                supplierCode: undefined,\n                supplierName: undefined\n            },\n            dialogStatus: '',\n            dialogVisibleItem: false,\n            status: '',\n            parentId: null,\n            rules: {\n                contractName: [{ required: true, message: '合同名称不能为空', trigger: 'blur' }],\n                validTimeStart: [{ required: true, message: '价格生效时间不能为空', trigger: 'blur' }],\n                validTimeEnd: [{ required: true, message: '价格失效时间不能为空', trigger: 'blur' }],\n                supplierCode: [{ required: true, message: '供应商编码不能为空', trigger: 'blur' }],\n                outsideContractNo: [{ required: true, message: '合同编号不能为空', trigger: 'blur' }],\n                contractType: [{ required: true, message: '合同类型不能为空', trigger: 'blur' }],\n                contractCategory: [{ required: true, message: '合同类别不能为空', trigger: 'blur' }],\n                contractAttribute: [{ required: true, message: '合同属性不能为空', trigger: 'blur' }],\n            }\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_pdv: state => state.dict.dt_srm_pdv,\n            dt_srm_pdw: state => state.dict.dt_srm_pdw,\n            dt_srm_pdx: state => state.dict.dt_srm_pdx,\n            dt_srm_p0: state => state.dict.dt_srm_p0,\n            dt_srm_pc9: state => state.dict.dt_srm_pc9,\n\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pdv\", 'dt_srm_pdw', 'dt_srm_pdx', 'dt_srm_p0', 'dt_srm_pc9'])\n\n    },\n    methods: {\n        handleClose () {\n            this.$emit('changeState', 'contentA')\n        },\n        //获取采购组织名称\n        selectName (val) {\n            this.temp.orgName = val\n        },\n        initForm (val, row) {\n            console.log(val, row)\n            this.dataStatus = val //新增编辑状态\n            this.$refs['dataForm'].resetFields()\n            this.$refs['dataForm'].clearValidate()\n            if (val === 'update') {\n                this.temp = { ...row }\n                this.$refs.pageSignA.list = row.contractMaterielDTOS\n                let listOne = []\n                let listTwo = []\n                let listThree = []\n                row.contractItemDTOS.forEach(v => {\n                    if (v.itemType == 'contract') {\n                        listOne.push(v)\n                    } else if (v.itemType == 'nomal') {\n                        listTwo.push(v)\n                    } else {\n                        listThree.push(v)\n                    }\n                })\n                this.$refs.pageSignB.list = listOne\n                this.$refs.pageSignC.list = listTwo\n                this.$refs.pageSignD.list = listThree\n            } else if (val === 'create') {\n\n                this.$refs.pageSignA.list = []\n                this.$refs.pageSignB.list = []\n                this.$refs.pageSignC.list = []\n                this.$refs.pageSignD.list = []\n            }\n        },\n        //保存按钮单击事件\n        handleSave () {\n            this.$refs.dataForm.validate(valid => {\n                if (valid) {\n                    if (this.dataStatus == 'create') {\n                        let limitState = this.$refs.pageSignA.list.every(v => {\n                            return v.quantity\n                        })\n                        if (limitState) {\n                            let dto = {\n                                contractItemDTOS: [],\n                                contractMaterielDTOS: this.$refs.pageSignA.list,\n                                contractAttribute: this.temp.contractAttribute,\n                                contractCategory: this.temp.contractCategory,\n                                contractName: this.temp.contractName,\n                                contractType: this.temp.contractType,\n                                description: this.temp.description,\n                                orgCode: this.temp.orgCode,\n                                orgName: this.temp.orgName,\n                                outsideContractNo: this.temp.outsideContractNo,\n                                supplierCode: this.temp.supplierCode,\n                                supplierName: this.temp.supplierName,\n                                templateVersion: this.temp.templateVersion,\n                                validTimeEnd: this.temp.validTimeEnd,\n                                validTimeStart: this.temp.validTimeStart,\n                                years: this.temp.years,\n                            }\n                            console.log(this.$refs.pageSignB.list, 'this.$refs.pageSignB.list')\n                            this.$refs.pageSignB.list.forEach(v => {\n                                dto.contractItemDTOS.push(v)\n                            })\n                            this.$refs.pageSignC.list.forEach(v => {\n                                dto.contractItemDTOS.push(v)\n                            })\n                            this.$refs.pageSignD.list.forEach(v => {\n                                dto.contractItemDTOS.push(v)\n                            })\n                            console.log(dto, 'dto')\n                            api.addRecord(dto).then(() => {\n                                this.$message({\n                                    title: '成功',\n                                    message: '新增成功',\n                                    type: 'success',\n                                    duration: 2000\n                                })\n                                this.$emit('changeState', 'contentA')\n                                this.$emit('refresh')\n                            })\n                        } else {\n                            this.$message({\n                                title: \"警告\",\n                                message: \"请填写数量\",\n                                type: \"warning\"\n                            })\n                        }\n                    } else {\n                        let limitState = this.$refs.pageSignA.list.every(v => {\n                            return v.quantity\n                        })\n                        if (limitState) {\n                            let dto = {\n                                contractItemDTOS: [],\n                                contractMaterielDTOS: this.$refs.pageSignA.list,\n                                contractAttribute: this.temp.contractAttribute,\n                                contractCategory: this.temp.contractCategory,\n                                contractName: this.temp.contractName,\n                                contractType: this.temp.contractType,\n                                description: this.temp.description,\n                                orgCode: this.temp.orgCode,\n                                orgName: this.temp.orgName,\n                                outsideContractNo: this.temp.outsideContractNo,\n                                supplierCode: this.temp.supplierCode,\n                                supplierName: this.temp.supplierName,\n                                templateVersion: this.temp.templateVersion,\n                                validTimeEnd: this.temp.validTimeEnd,\n                                validTimeStart: this.temp.validTimeStart,\n                                years: this.temp.years,\n                            }\n                            this.$refs.pageSignB.list.forEach(v => {\n                                dto.contractItemDTOS.push(v)\n                            })\n                            this.$refs.pageSignC.list.forEach(v => {\n                                dto.contractItemDTOS.push(v)\n                            })\n                            this.$refs.pageSignD.list.forEach(v => {\n                                dto.contractItemDTOS.push(v)\n                            })\n                            api.updateRecord(this.temp.rowId, dto).then(() => {\n                                this.$message({\n                                    title: '成功',\n                                    message: '编辑成功',\n                                    type: 'success',\n                                    duration: 2000\n                                })\n                                this.$emit('changeState', 'contentA')\n                                this.$emit('refresh')\n                            })\n                        } else {\n                            this.$message({\n                                title: \"警告\",\n                                message: \"请填写数量\",\n                                type: \"warning\"\n                            })\n                        }\n\n                    }\n                } else {\n                    return false\n                }\n            })\n        },\n        //供应商\n        showGys () {\n            this.$refs.refGys.dialogVisible = true\n            this.$refs.refGys.getList()\n        },\n        //供应商确定\n        handleGysClick (val) {\n            this.$set(this.temp, 'supplierCode', val[0].supplierCode)\n            this.$set(this.temp, 'supplierName', val[0].supplierName)\n        },\n        //模板\n        showTemplate () {\n            this.$refs.templateSelect.dialogVisible = true\n        },\n        //模板确定\n        handeTemplate (val) {\n            // this.temp.template = val.versionNo\n            this.parentId = val.rowId\n            this.$set(this.temp, 'templateVersion', val.versionNo)\n            this.$nextTick(function () {\n                this.$refs.pageSignB.getListData(val)\n                this.$refs.pageSignC.getListData(val)\n                this.$refs.pageSignD.getListData(val)\n            })\n\n        },\n        handleConfirm (val) {\n            let options = [this.dt_srm_pc9]\n            val = this.$myFun.codeToName(val, options, ['priceType'])\n            this.$nextTick(() => {\n                this.$refs.pageSignA.list = JSON.parse(JSON.stringify(val))\n            })\n        },\n        //合同明细新增\n        contractItem (val, dataList) {\n            if (this.temp.orgCode && this.temp.supplierCode && this.temp.validTimeStart && this.temp.validTimeEnd) {\n                this.$refs.partsList.dialogVisible = true\n                this.$nextTick(() => {\n                    this.$refs.partsList.listSelected = [...dataList]\n                    this.$refs.partsList.getList()\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请先选择组织,供应商,有效开始,有效结束\",\n                    type: \"warning\"\n                })\n            }\n\n        },\n        //合同条款，一般性条款新增\n        createA (val) {\n            this.status = val\n            setTimeout(() => {\n                if (this.status != 'pageSignD') {\n                    this.$refs.addItem.show = false\n                } else {\n                    this.$refs.addItem.show = true\n                }\n            }, 1.5 * 100)\n            setTimeout(() => {\n                this.$refs.addItem.resetTemp()\n            }, 1.5 * 100)\n            this.dialogStatus = 'create'\n            this.dialogVisibleItem = true\n        },\n        //合同条款，一般性条款新增确定\n        createDataItem () {\n            if (this.status === 'pageSignB') {\n                let dto = {\n                    content: this.removeTAG(this.$refs.addItem.temp.content),\n                    orderNo: this.$refs.addItem.temp.orderNo,\n                    itemType: 'contract',\n                    project: '',\n                    parentId: 1\n                }\n                // api.addRecordItem(this.parentId, dto).then(() => {\n                //     this.$message({\n                //         title: '成功',\n                //         message: '新增成功',\n                //         type: 'success',\n                //         duration: 2000\n                //     })\n                this.$refs.pageSignB.list.push(dto)\n                // this.$set(this.$refs.pageSignB.list, this.editIndex, this.$refs.pageSignB.list[this.editIndex])\n                this.dialogVisibleItem = false\n                //     this.$refs.pageSignB.getList()\n                // })\n            } else if (this.status === 'pageSignC') {\n                let dto = {\n                    content: this.removeTAG(this.$refs.addItem.temp.content),\n                    orderNo: this.$refs.addItem.temp.orderNo,\n                    itemType: 'nomal',\n                    project: '',\n                    parentId: 1\n                }\n                // api.addRecordItem(this.parentId, dto).then(() => {\n                //     this.$message({\n                //         title: '成功',\n                //         message: '新增成功',\n                //         type: 'success',\n                //         duration: 2000\n                //     })\n                this.$refs.pageSignC.list.push(dto)\n                this.dialogVisibleItem = false\n                //     this.$refs.pageSignC.getList()\n                // })\n            }\n        },\n        //合同条款，一般性条款，其他事项编辑\n        updateA (val, row, index) {\n            this.status = val\n            this.dialogStatus = 'update'\n            this.dialogVisibleItem = true\n            setTimeout(() => {\n                if (this.status != 'pageSignD') {\n                    this.$refs.addItem.show = false\n                } else {\n                    this.$refs.addItem.show = true\n                }\n                this.$refs.addItem.temp = { ...row }\n                this.editIndex = index\n                console.log(this.editIndex, ' this.editIndex')\n            }, 1.5 * 100)\n        },\n        //过滤标签\n        removeTAG (str) {\n            return str.replace(/<[^>]+>/g, \"\")\n        },\n        //合同条款，一般性条款，其他事项编辑确定\n        updateDataItem () {\n            if (this.status === 'pageSignB') {\n                let dto = {\n                    content: this.removeTAG(this.$refs.addItem.temp.content),\n                    orderNo: this.$refs.addItem.temp.orderNo,\n                    itemType: 'contract',\n                    parentId: this.parentId,\n                    project: ''\n                }\n                this.$refs.pageSignB.list[this.editIndex] = dto\n                this.$set(this.$refs.pageSignB.list, this.editIndex, this.$refs.pageSignB.list[this.editIndex])\n                // this.$set(this.$refs.pageSignB.list, this.editIndex, this.$refs.pageSignB.list[this.editIndex])\n                // api.updateRecordItem(this.$refs.addItem.temp.rowId, dto).then(() => {\n                //     this.$message({\n                //         title: '成功',\n                //         message: '编辑成功',\n                //         type: 'success',\n                //         duration: 2000\n                //     })\n                this.dialogVisibleItem = false\n                // this.$refs.pageSignB.getList()\n                // })\n            } else if (this.status === 'pageSignC') {\n                let dto = {\n                    content: this.removeTAG(this.$refs.addItem.temp.content),\n                    orderNo: this.$refs.addItem.temp.orderNo,\n                    itemType: 'nomal',\n                    parentId: this.parentId,\n                    project: ''\n                }\n                this.$refs.pageSignC.list[this.editIndex] = dto\n                this.$set(this.$refs.pageSignC.list, this.editIndex, this.$refs.pageSignC.list[this.editIndex])\n                // api.updateRecordItem(this.$refs.addItem.temp.rowId, dto).then(() => {\n                //     this.$message({\n                //         title: '成功',\n                //         message: '编辑成功',\n                //         type: 'success',\n                //         duration: 2000\n                //     })\n                this.dialogVisibleItem = false\n                //     this.$refs.pageSignC.getList()\n                // })\n            } else if (this.status === 'pageSignD') {\n                let dto = {\n                    content: this.removeTAG(this.$refs.addItem.temp.content),\n                    orderNo: this.$refs.addItem.temp.orderNo,\n                    itemType: 'other',\n                    parentId: this.parentId,\n                    project: this.$refs.addItem.temp.project,\n                    rowId: this.$refs.addItem.temp.rowId\n                }\n                this.$refs.pageSignD.list[this.editIndex] = dto\n                this.$set(this.$refs.pageSignD.list, this.editIndex, this.$refs.pageSignD.list[this.editIndex])\n                console.log(this.$refs.pageSignD.list[this.editIndex], 'this.$refs.pageSignD.list[this.editIndex]')\n                // api.updateRecordItem(this.$refs.addItem.temp.rowId, dto).then(() => {\n                //     this.$message({\n                //         title: '成功',\n                //         message: '编辑成功',\n                //         type: 'success',\n                //         duration: 2000\n                //     })\n                this.dialogVisibleItem = false\n                // this.$refs.pageSignD.getList()\n                // })\n            }\n        }\n    }\n}\n",null]}