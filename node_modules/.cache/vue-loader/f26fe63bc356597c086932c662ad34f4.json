{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EM/equipmentMaintain/wxbj.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EM/equipmentMaintain/wxbj.vue","mtime":1596610933386},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport *  as api from '@/api/project/eas/em/equipmentMaintain'\nimport { mapState } from \"vuex\"\nimport Pagination from '@/components/Pagination'\nimport warehouseSelect from '@/components/Select/warehouse-select'//下拉组件\nimport materiel from '@/components/Table/materiel-table'//下拉组件\n\nexport default {\n    name: 'dispatchOrderManagement',\n    components: { Pagination, warehouseSelect, materiel },\n    props: ['upkeepWorkOrderNumber', 'selectlist', 'org'],\n    data () {\n        return {\n            list: null,\n            total: 0,\n            edList: [],\n            subList: [],\n            ids: [],\n            materielRow: [],\n            warehouse: undefined,\n            theight: 0, //表格高度\n            dialogStatus: '',\n            dialogFormVisible: false,\n            materielDialogVisible: false,\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 15,\n                upkeepWorkOrderNumber: undefined\n            },\n            temp: {\n                warehouseName: undefined,\n                warehouseCode: undefined,\n                applyQuantity: undefined,\n                measureName: undefined,\n                measureCode: undefined,\n                materielName: undefined,\n                materielCode: undefined,\n                upkeepWorkOrderNumber: undefined\n            },\n            tableKey: [0],\n            rules: {\n                upkeepWorkOrderNumber: [\n                    {\n                        required: true,\n                        message: '保养工单不能为空',\n                        trigger: 'blur'\n                    },\n                ],\n                materielCode: [\n                    {\n                        required: true,\n                        message: '备件编码不能为空',\n                        trigger: 'blur'\n                    },\n                ],\n                materielName: [\n                    {\n                        required: true,\n                        message: '备件名称不能为空',\n                        trigger: 'blur'\n                    },\n                ],\n                applyQuantity: [\n                    {\n                        required: true,\n                        message: '申请数量不能为空',\n                        trigger: 'blur'\n                    },\n                ],\n                measureCode: [\n                    {\n                        required: true,\n                        message: '计量单位不能为空',\n                        trigger: 'blur'\n                    },\n                ],\n                warehouseCode: [\n                    {\n                        required: true,\n                        message: '备件仓库不能为空',\n                        trigger: 'blur'\n                    },\n                ],\n                remark: [\n                    { max: 255, message: '备注长度为255内', trigger: 'blur' }\n                ]\n            }\n        }\n    },\n    created () {\n    },\n    watch: {\n        'selectlist' () {\n            this.getList()\n        },\n        dt_maintain_sp_state () {\n            if (this.list && this.list.length) {\n                let options = [this.dt_maintain_sp_state]\n                this.list = this.$myFun.srmCodeToName(\n                    this.list,\n                    options,\n                    ['state']\n                )\n            }\n\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_maintain_sp_state: state => state.eamDict.dt_maintain_sp_state,\n            dt_unit_type: state => state.eamDict.dt_unit_type,\n        })\n    },\n    mounted () {\n        this.setTableHeight()\n        this.$store.dispatch(\"eamDict/getDicData\", [\n            \"dt_maintain_sp_state\",\n            \"dt_unit_type\"\n        ])\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n    },\n    methods: {\n        getList () {\n            this.listQuery.upkeepWorkOrderNumber = this.upkeepWorkOrderNumber\n            api.spRecords(this.listQuery).then(res => {\n                this.list = res.data.list\n                let options = [this.dt_maintain_sp_state]\n                this.list = this.$myFun.srmCodeToName(\n                    this.list,\n                    options,\n                    ['state']\n                )\n                this.total = res.data.pages.count\n            })\n        },\n        resetTemp () {\n            this.temp = {\n                warehouseName: undefined,\n                warehouseCode: undefined,\n                applyQuantity: undefined,\n                measureName: undefined,\n                measureCode: undefined,\n                materielName: undefined,\n                materielCode: undefined,\n                workOrderNumber: undefined,\n                upkeepWorkOrderNumber: undefined\n            }\n        },\n        // 获取表格选中时的数据\n        selectRow (val) {\n            this.selectlistRow = val\n        },\n        handleCreate () {\n            if (this.selectlist) {\n                if (this.selectlist.state == \"mwos80\") {\n                    this.$message({\n                        title: '警告',\n                        message: '无法对完工状态的工单进行新增',\n                        type: 'warning'\n                    })\n                    return false\n                }\n                this.resetTemp()\n                this.dialogStatus = 'create'\n                this.dialogFormVisible = true\n                this.temp.upkeepWorkOrderNumber = this.upkeepWorkOrderNumber\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择工单',\n                    type: 'warning'\n                })\n\n            }\n        },\n        getWareName (val) {\n            this.temp.warehouseName = val\n        },\n        //打开备件编码弹窗\n        handleClickmateriel () {\n            this.materielDialogVisible = true\n        },\n        //备件编码父子传值\n        handleMateriel (row) {\n            this.materielRow = row\n        },\n        //备件编码确认\n        materielCreate () {\n            this.temp.materielCode = this.materielRow.materielCode\n            this.temp.materielName = this.materielRow.materielName\n            this.temp.measureCode = this.materielRow.measuringUnit\n            this.temp.measureName = this.materielRow.measuringUnitName\n            this.materielDialogVisible = false\n\n        },\n        create () {\n            this.$refs['temp'].validate(valid => {\n                if (valid) {\n                    api.addSp(this.temp).then(() => {\n                        this.getList()\n                        this.dialogFormVisible = false\n                        this.$message({\n                            title: '成功',\n                            message: '新增成功',\n                            type: 'success',\n                            duration: 2000\n                        })\n                    })\n                } else {\n                    return false\n                }\n            })\n\n        },\n        handleUpdate () {\n            if (this.selectlistRow && this.selectlistRow.length == 1) {\n                if (this.selectlistRow[0].state == 'msps20') {\n                    this.$message({\n                        title: '警告',\n                        message: '当前数据已确认不可编辑',\n                        type: 'warning'\n                    })\n                    return\n                }\n                this.temp = JSON.parse(JSON.stringify(this.selectlistRow[0]))\n                this.dialogStatus = 'update'\n                this.dialogFormVisible = true\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n                return\n            }\n\n        },\n        update () {\n            this.$refs['temp'].validate(valid => {\n                if (valid) {\n                    api.modifySp(this.temp).then(() => {\n                        this.getList()\n                        this.dialogFormVisible = false\n                        this.$message({\n                            title: '成功',\n                            message: '更新成功',\n                            type: 'success',\n                            duration: 2000\n                        })\n                    })\n                } else {\n                    return false\n                }\n            })\n\n        },\n        handleDelete () {\n            this.selectlistRow.forEach((item, index) => {\n                this.ids[index] = item.rowId\n            })\n            if (this.selectlistRow) {\n                if (this.selectlistRow[0].state == 'msps20') {\n                    this.$message({\n                        title: '警告',\n                        message: '当前数据已确认不可编辑',\n                        type: 'warning'\n                    })\n                    return\n                }\n                this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                })\n                    .then(() => {\n                        api.deleteSp(this.ids).then(() => {\n                            this.getList(),\n                                this.$message({\n                                    title: '成功',\n                                    message: '删除成功',\n                                    type: 'success',\n                                    duration: 2000\n                                })\n                        })\n                    })\n                    .catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消删除'\n                        })\n                    })\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n            }\n\n        },\n        handleSave () {\n            this.selectlistRow.forEach((item, index) => {\n                this.ids[index] = item.rowId\n            })\n            api.confirmSp(this.ids).then(() => {\n                this.getList(),\n                    this.$message({\n                        title: '成功',\n                        message: '确认成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n            })\n\n        },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight()\n        },\n    }\n}\n",null]}