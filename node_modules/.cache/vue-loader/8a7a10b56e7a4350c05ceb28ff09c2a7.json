{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierManagement/supplierAccess/comprehensiveEvaluation/dialog/dialogResult.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierManagement/supplierAccess/comprehensiveEvaluation/dialog/dialogResult.vue","mtime":1596610933920},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// import { createRecords, updateRecords } from \"@/api/productionMaterial/hand_pull_material\";\nimport { mapState } from \"vuex\"\n\n\nexport default {\n    name: 'dialogResult',\n    components: {},\n    props: ['unMutiple', 'title', 'curdialogStatus'],\n    data () {\n        return {\n            isEdit: false,\n            formData: {\n                evaluationNo: null,\n                score: null,\n                grade: null,\n                recommendResult: null,\n                remark: null\n            },\n            tableData: [],\n            dialogVisible: false,\n\n            formConfig: [\n                { type: 'commonInput', disabled: true, label: '综合评价分数', prop: 'score', width: '' },\n                { type: 'srmBisSelect', disabled: true, dType: 'dt_cate_grade', label: '综合等级', prop: 'grade', width: '', key: 'code', value: 'name' },\n                { type: 'dictSelect', disabled: true, dType: 'dt_srm_pan', label: '推荐意见', prop: 'recommendResult', width: '' },\n                { type: 'textarea', label: '备注', prop: 'remark', width: '800px', rows: \"2\" }\n            ],\n            tableConfig: [\n                { label: '评价单号', prop: 'evaluationNo', align: 'center', width: 'auto' },\n                { label: '分项评价', prop: 'evaluationItemCN', align: 'center', width: 'auto' },\n                { label: '权重(%)', prop: 'weight', align: 'center', width: 'auto' },\n                { label: '评价分数', prop: 'score', align: 'center', width: 'auto' },\n                { label: '评价等级', prop: 'gradeCN', align: 'center', width: 'auto' },\n                { label: '推荐意见', prop: 'recommendResult', align: 'center', width: 'auto' },\n                { label: '评价结论', prop: 'auditResultCN', align: 'center', width: 'auto' },\n                { label: '状态', prop: 'stateCN', align: 'center', width: 'auto' },\n                { label: '评价人', prop: 'evaluationUserName', align: 'center', width: 'auto' },\n                { label: '考察人', prop: 'investigateUser', align: 'center', width: 'auto' }\n            ]\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_pb4: state => state.dict.dt_srm_pb4,//考察项\n            dt_srm_pam: state => state.dict.dt_srm_pam,//评价等级\n            dt_srm_pal: state => state.dict.dt_srm_pal,//评价状态\n            dt_cate_grade: state => state.srmBisSelect.dt_cate_grade,//综合评价等级\n            dt_srm_pan: state => state.dict.dt_srm_pan,//推荐意见\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pb4\", \"dt_srm_pam\", \"dt_srm_pal\", \"dt_srm_pan\"])\n        this.$store.dispatch(\"srmBisSelect/getBisData\", [\"dt_cate_grade\"])\n    },\n    methods: {\n        handleConfirm () {\n            this.$refs.refForm.validate((valid) => {\n                if (valid) {\n                    this.$confirm('确认保存吗?', '提示', {\n                        confirmButtonText: '确定',\n                        cancelButtonText: '取消',\n                        type: 'warning'\n                    }).then(() => {\n                        let cdata = {\n                            method: \"UPDATE\",\n                            remark: this.formData.remark\n                        }\n                        this.$emit('handleDialogClick', this.formData.evaluationNo, cdata)\n                        this.dialogVisible = false\n                    }).catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消'\n                        })\n                    })\n                }\n            })\n        },\n        //表格操作删除\n        handleView (row) {\n            this.$emit('handleView', row)\n        },\n        initForm (row) {\n            for (let key in this.formData) {\n                for (let par in row) {\n                    if (key === par) {\n                        this.$set(this.formData, key, row[key])\n                    }\n                }\n            }\n            let options = [this.dt_srm_pb4]\n            row.evaluationItemDTOs = this.$myFun.codeToName(row.evaluationItemDTOs, options, [\n                'evaluationItem'\n            ])\n            this.tableData = row.evaluationItemDTOs\n            this.calculateScore()\n        },\n        //计算得分\n        calculateScore () {\n            let score = 0\n            this.tableData.forEach((item) => {\n                if (!item.score) {\n                    item.score = 0\n                }\n                if (!item.weight) {\n                    item.weight = 0\n                }\n                score += parseInt(item.score) * parseInt(item.weight) / 100\n            })\n            this.$set(this.formData, 'score', score)\n            for (let i = 0; i < this.dt_cate_grade.data.length; i++) {\n                if (parseInt(this.dt_cate_grade.data[i].value1) < parseInt(score) && parseInt(score) <= parseInt(this.dt_cate_grade.data[i].value2)) {\n                    this.$set(this.formData, 'grade', this.dt_cate_grade.data[i].code)\n                    this.$set(this.formData, 'recommendResult', this.dt_cate_grade.data[i].weight)\n                    break\n                }\n            }\n        }\n    }\n}\n",null]}