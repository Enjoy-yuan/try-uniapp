{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/outSourcing/outSourcingDirectives/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/outSourcing/outSourcingDirectives/index.vue","mtime":1596610934137},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Pagination from \"@/components/Pagination\";\nimport orgSelect from \"@/components/Select/orgSelect.vue\";\nimport { DICT_CODE, DT_ORG_TYPE, THE_STATE_OPTIONS } from \"@/utils/constant\";\nimport { mapState, mapGetters } from \"vuex\";\nimport warehouseSelect from \"@/components/Select/warehouse-select.vue\"; //下拉组件\nimport AuthoType from \"@/components/Select/AuthoType.vue\"; //权限类型下拉组件\nimport zsjwlxz from \"@/components/Select/zsjwlxz.vue\";\nimport * as api from \"@/api/project/wms/outSourcing/outSourcingDirectives\";\nimport gysxz from \"@/components/Select/gysxz\"; //供应商选择\n\nexport default {\n    name: \"outSourcingDirectives\",\n    components: {\n        Pagination,\n        AuthoType,\n        orgSelect,\n        warehouseSelect,\n        gysxz,\n        zsjwlxz\n    },\n    data () {\n        return {\n            list: null,\n            list1: null,\n            list2: [],\n            total: 0,\n            total1: 0,\n            total2: 0,\n            value1: \"\",\n            show: false,\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                orgCode: undefined,\n                productionline: undefined,\n                station: undefined,\n                feedType: undefined,\n                state: undefined,\n                batchNumber: undefined,\n                leadTime: undefined,\n                feedTime: undefined,\n                feedwarehouse: undefined,\n                workShop: undefined,\n                pushTimeStart: undefined,\n                pushTimeEnd: undefined,\n                pushMaterialState: undefined,\n                creator: undefined,\n                toOrgCode: undefined\n            },\n            listQuery1: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                supplierCode: undefined,\n                orderNumber: undefined\n            },\n            listQuery2: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10\n            },\n            listQueryItems: {\n                currentPage: 1,\n                pageSize: 10,\n                allocNumber: undefined\n            },\n            dto: {\n                goodsReadyEmp: undefined,\n                goodsReadyEmpName: undefined,\n                goodsReadyTime: undefined,\n                lineCode: undefined,\n                lineName: undefined,\n                method: undefined,\n                note: undefined,\n                orgCode: undefined,\n                orgName: undefined,\n                pushEmp: undefined,\n                pushEmpName: undefined,\n                pushMaterialType: undefined,\n                pushOrderCode: undefined,\n                pushOrderDetails: undefined,\n                pushTime: undefined,\n                warehouseCode: undefined,\n                workshopCode: undefined,\n                toOrgName: undefined\n            },\n            warehouseCode: undefined,\n            orgCode: undefined,\n            listLoading: true,\n            isEaid: false,\n            isEdit: true,\n            Edit: false,\n            temp: {\n                allocNumber: undefined,\n                remark: undefined,\n                businessType: undefined,\n                warehouseCode: undefined,\n                toOrgCode: undefined,\n                orgCode: undefined,\n                toWarehouseCode: undefined,\n            },\n            xzwlDialogFormVisible: false,\n            wlxzQMDialog: false,\n            gysxzDialogFormVisible: false,\n            rules: {\n                orgCode: [{ required: true, message: \"组织不能为空\", trigger: \"blur\" }],\n                warehouseCode: [{ required: true, message: \"仓库不能为空\", trigger: \"blur\" }],\n                businessType: [{ required: true, message: \"业务类型不能为空\", trigger: \"blur\" }],\n                supplierCode: [{ required: true, message: \"委外单位不能为空\", trigger: \"blur\" }],\n\n            },\n            orgName: undefined,\n\n            selectCode: [],\n            dialogFormVisible: false,\n            dialogFormVisible1: false,\n            employeeDialogFormVisible: false,\n            dialogStatus: \"\",\n            tableKey: [0, 1],\n            DICT_CODE: DICT_CODE,\n            isChangeAddS: false,\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            THE_STATE_OPTIONS: THE_STATE_OPTIONS,\n            parentsRows: []\n        };\n    },\n    computed: {\n        ...mapGetters([\"name\", \"superRoles\"]),\n        ...mapState({\n            dt_sales_out_instruct_state: state => state.dict.dt_sales_out_instruct_state,\n            dt_business_type_screenGroupNum_ww: state => state.businessComponent.dt_business_type_screenGroupNum_ww\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\n            \"dt_sales_out_instruct_state\",\n        ]);\n        this.$store.dispatch(\"businessComponent/getBusinessComponentData\", [\n            \"dt_business_type_screenGroupNum_ww\"\n        ]);\n        // this.getList();\n    },\n    methods: {\n        handleClickgysxz () {\n            this.$refs.gysxz.dialogVisible = true;\n        },\n        showGysxz () {\n            this.isChangeAddS = true;\n            this.$refs.gysxz1.dialogVisible = true;\n        },\n        handleDblclickgysxz (row) {\n            this.parentsRows = row;\n            if (!this.isChangeAddS) {\n                if (!this.parentsRows[0]) {\n                    this.listQuery.supplierCode = \"\";\n                    this.listQuery.toOrgCode = \"\";\n                    this.$refs.gysxz.dialogVisible = false;\n                } else if (this.parentsRows.length === 1) {\n                    this.listQuery.supplierCode = this.parentsRows[0].supplierCode;\n                    this.listQuery.toOrgCode = this.parentsRows[0].supplierCode;\n                    this.$refs.gysxz.dialogVisible = false;\n                }\n            } else {\n                if (!this.parentsRows[0]) {\n                    this.$message({\n                        title: this.$t(\"message.warning\"),\n                        message: this.$t(\"message.checkedplease\"),\n                        type: \"warning\"\n                    });\n                } else if (this.parentsRows.length === 1) {\n                    this.temp.toOrgName = this.parentsRows[0].supplierName;\n                    this.temp.toOrgCode = this.parentsRows[0].supplierCode;\n                    this.$refs.gysxz1.dialogVisible = false;\n                }\n                this.isChangeAddS = false;\n            }\n        },\n        handleDblclickgysxz1 (row) {\n            this.parentsRows = row;\n            if (!this.isChangeAddS) {\n                if (!this.parentsRows[0]) {\n                    this.listQuery.supplierCode = \"\";\n                    this.listQuery.toOrgCode = \"\";\n                    this.$refs.gysxz.dialogVisible = false;\n                } else if (this.parentsRows.length === 1) {\n                    this.listQuery.supplierCode = this.parentsRows[0].supplierCode;\n                    this.listQuery.toOrgCode = this.parentsRows[0].supplierCode;\n                    this.$refs.gysxz.dialogVisible = false;\n                }\n            } else {\n                if (!this.parentsRows[0]) {\n                    this.$message({\n                        title: this.$t(\"message.warning\"),\n                        message: this.$t(\"message.checkedplease\"),\n                        type: \"warning\"\n                    });\n                } else if (this.parentsRows.length === 1) {\n                    this.temp.toOrgName = this.parentsRows[0].supplierName;\n                    this.temp.toOrgCode = this.parentsRows[0].supplierCode;\n                    this.$refs.gysxz1.dialogVisible = false;\n                }\n                this.isChangeAddS = false;\n            }\n        },\n        setdefault (val, i) {\n            if (i === 1) {\n                this.listQuery.orgCode = val;\n            } else if (i === 3) {\n                this.listQuery.warehouseCode = val;\n                this.listQuery.businessType = this.dt_business_type_screenGroupNum_ww.options[0].wareRuleCode;\n                this.getList()\n            }\n        },\n        getList () { //查询主表\n            if (this.superRoles) {\n                this.listQuery.creator = null;\n            } else {\n                this.listQuery.creator = this.name;\n            }\n            if (this.value1) {\n                var d1 = this.value1[0];\n                var d2 = this.value1[1];\n                this.listQuery.deliverTimeStart = d1;\n                this.listQuery.deliverTimeEnd = d2;\n            } else {\n                this.listQuery.deliverTimeStart = \"\";\n                this.listQuery.deliverTimeEnd = \"\";\n            }\n            api.queryRecords(this.listQuery).then(res => {\n                this.list = res.data.list;\n                this.total = res.data.pages.count;\n                if (this.total == 0) {\n                    this.list1 = []\n                }\n                this.$nextTick(function () {\n                    this.checked()\n                })\n            });\n        },\n        checked () {\n            this.$refs.tb.toggleRowSelection(this.list[0], true);//官网方法，重点\n        },\n        getItemsList () {  //查询订单明细\n            api.queryRecorditems1(this.selectlistRow.instructCode).then(response => {\n                this.list1 = response.data\n                this.total1 = response.data.length;\n            });\n        },\n        handleQuery () {\n            this.listQuery.currentPage = 1;\n            this.getList();\n        },\n        handleCreate () { //新增\n            this.resetTemp();\n            this.Edit = false\n            this.dialogStatus = \"create\";\n            this.dialogFormVisible = true;\n            this.list2 = [];\n        },\n\n        orgname (name) { //获取组织名称\n            this.orgName = name;\n        },\n\n        timeFormat () {\n            var d = new Date();\n            var year = d.getFullYear();       //年  \n            var month = d.getMonth() + 1;     //月  \n            var day = d.getDate();            //日  \n            var hh = d.getHours();            //时  \n            var mm = d.getMinutes();          //分  \n            var ss = d.getSeconds();          //秒  \n            var clock = year + \"-\";\n            if (month < 10)\n                clock += \"0\";\n            clock += month + \"-\";\n\n            if (day < 10)\n                clock += \"0\";\n            clock += day + \" \";\n\n            if (hh < 10)\n                clock += \"0\";\n            clock += hh + \":\";\n            if (mm < 10) clock += '0';\n            clock += mm + \":\";\n\n            if (ss < 10) clock += '0';\n            clock += ss;\n            return (clock);\n        },\n        create () { //新增\n            this.dto = this.temp;\n            this.dto.orgName = this.orgName\n            this.dto.goodsReadyTime = this.timeFormat()\n            this.dto.deliverTime = this.timeFormat()\n            this.dto.method = \"MODIFY\";\n            this.list2.map(v => {\n                v.linkOrderNumber = v.instructNumber\n                v.productCode = v.materielCode\n                v.productName = v.materielName\n                return v\n            })\n            this.dto.salesOutInstructDetails = this.list2;\n            api.addRecord(this.dto).then(() => {\n                this.getList();\n                this.list2 = [];\n                this.dialogFormVisible = false;\n                this.$message({\n                    title: \"成功\",\n                    message: \"新增成功\",\n                    type: \"success\",\n                    duration: 2000\n                });\n                this.list2 = [];\n            });\n        },\n\n        handleDelete () { //删除\n            if (this.selectlistRow) {\n                this.$confirm(\"此操作将永久删除该文件,是否继续?\", \"提示\", {\n                    confirmButtonText: \"确定\",\n                    cancelButtonText: \"取消\",\n                    type: \"warning\"\n                }).then(() => {\n                    api.deleteRecord(this.selectlistRow.instructCode).then(() => {\n                        this.getList();\n                        this.$message({\n                            title: \"成功\",\n                            message: \"删除成功\",\n                            type: \"success\",\n                            duration: 2000\n                        });\n                    });\n                }).catch(() => {\n                    this.$message({\n                        type: \"info\",\n                        message: \"已取消删除\"\n                    })\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\",\n                    duration: 2000\n                });\n            }\n        },\n        handleCreatewl () {//新增物料\n            if (this.temp.orgCode && this.temp.warehouseCode && this.temp.businessType && this.temp.toOrgCode && this.temp.toWarehouseCode) {\n                this.wlxzQMDialog = true;\n                this.Edit = true\n                this.$nextTick(function () {\n                    this.$refs.wlxzQMRef.getList();\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请先选择组织,仓库,业务类型，委外单位，委外仓库\",\n                    type: \"warning\",\n                    duration: 2000\n                });\n            }\n        },\n        setDetails (data) {\n            data.forEach((item) => {\n                this.list2.push(item)\n            });\n            this.$set(this.$refs.wlxzRef.list, this.list2);\n        },\n        materialxz () { //物料选中中弹窗确认按钮\n            if (this.$refs.wlxzQMRef.listSelected.length) {\n                this.list2 = this.$refs.wlxzQMRef.listSelected;\n                this.wlxzQMDialog = false\n            } else {\n                this.$message({\n                    title: this.$t('message.warning'),\n                    message: this.$t('message.checkedplease'),\n                    type: \"warning\"\n                });\n            }\n        },\n\n        handleDeleteitems () {//删除物料\n            if (this.selectlistRow4.length !== 0) {\n                this.$confirm(\"确认要删除该数据项吗?\", \"提示\", {\n                    confirmButtonText: \"确定\",\n                    cancelButtonText: \"取消\",\n                    type: \"warning\"\n                }).then(() => {\n                    this.list2 = this.list2.filter(item => {\n                        let isD = true;\n                        this.selectlistRow4.forEach((itemr) => {\n                            if (itemr.materielCode === item.materielCode) {\n                                isD = false;\n                            }\n                        });\n                        return isD;\n                    });\n\n                    this.$message({\n                        type: \"success\",\n                        message: \"删除成功\"\n                    });\n                }).catch(() => {\n                    this.$message({\n                        type: \"info\",\n                        message: \"已取消\"\n                    });\n                });\n            } else {\n                this.$message.warning(\"请勾选记录！\");\n                return;\n            }\n        },\n        handelRefresh () {//刷新\n            this.Edit = false\n            this.list2 = []\n        },\n        handleUpdate () {//编辑 \n            this.resetTemp();\n            if (this.selectlistRow) {\n                if (this.selectlistRow.state !== \"instruction20\") {\n                    this.temp = this.selectlistRow\n                    api.queryRecorditems(this.selectlistRow.instructCode).then(response => {\n                        this.list2 = response.data.salesOutInstructDetails.map(v => {\n                            v.materielCode = v.productCode\n                            v.materielName = v.productName\n                            return v\n                        })\n                    });\n                    this.Edit = true\n                    this.dialogFormVisible = true;\n                    this.dialogStatus = \"update\";\n                } else {\n                    this.$message({\n                        title: \"警告\",\n                        message: \"发布状态下不可编辑\",\n                        type: \"warning\",\n                        duration: 2000\n                    });\n                }\n\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\",\n                    duration: 2000\n                });\n            }\n        },\n\n        update () {//编辑\n            this.temp.salesOutInstructDetails = this.list2.map(v => {\n                v.productCode = v.materielCode\n                v.productName = v.materielName\n                return v\n            });\n            this.temp.method = \"MODIFY\";\n            api.updateRecord(this.selectlistRow.instructCode, this.temp).then(() => {\n                this.dialogFormVisible = false;\n                this.$message({\n                    title: \"成功\",\n                    message: \"编辑成功\",\n                    type: \"success\",\n                    duration: 2000\n                });\n                this.getList();\n                this.getItemsList();\n            });\n        },\n\n        handlezf () {//关闭\n\n        },\n        handlePublish () {//发布\n            if (this.selectlistRow) {\n                this.selectlistRow.salesOutInstructDetails = this.list2;\n                this.selectlistRow.method = \"SUBMIT\";\n                api.updateRecord(this.selectlistRow.instructCode, this.selectlistRow).then(() => {\n                    this.$message({\n                        title: \"成功\",\n                        message: \"编辑成功\",\n                        type: \"success\",\n                        duration: 2000\n                    });\n                    this.getList();\n                });\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\",\n                    duration: 2000\n                });\n            }\n        },\n        selectRow (val) {//表一复选框选中方法\n            this.selectlistRow = val[val.length - 1];\n            if (val.length > 1) {\n                this.$refs.tb.clearSelection();\n                this.$refs.tb.toggleRowSelection(val.pop());\n            }\n            this.$refs.tb.setCurrentRow(this.selectlistRow);\n            if (this.selectlistRow) {\n                this.getItemsList();\n            }\n        },\n        selectRow1 (val) { //表二复选框选中方法\n            this.selectlistRow1 = val;\n        },\n        selectRow2 (val) {//表一单击行选中方法\n            this.selectlistRow2 = val;\n            this.$refs.tb.clearSelection();\n            this.$refs.tb.toggleRowSelection(val);\n        },\n\n        selectRow3 (val) {//表二单击行选中方法\n            this.selectlistRow3 = val;\n        },\n        selectRow4 (val) {\n            this.selectlistRow4 = val;\n        },\n        cancel () {\n            this.dialogFormVisible = false;\n        },\n        resetTemp () {\n            this.temp = {\n                allocNumber: undefined,\n                remark: undefined,\n                businessType: undefined,\n                warehouseCode: undefined,\n                toOrgCode: undefined,\n                orgCode: undefined,\n                toWarehouseCode: undefined,\n            };\n        },\n        handleClose () {\n            this.resetTemp();\n            this.$refs.temp.resetFields();\n        },\n        handleSelectionChange (selection) {\n            this.selectCode = selection.map(v => v.measureCode);\n        }\n    }\n};\n",null]}