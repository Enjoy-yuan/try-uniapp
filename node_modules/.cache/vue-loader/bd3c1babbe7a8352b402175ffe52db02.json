{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierManagement/supplierAccess/evaluation/dialog/dialogConfirm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierManagement/supplierAccess/evaluation/dialog/dialogConfirm.vue","mtime":1603329739777},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapState } from \"vuex\"\nimport dialogGysxz from '@/components/Dialog/dialogsGysxz'//供应商选择\n\n\nexport default {\n    name: 'addMain',\n    props: ['unMutiple', 'title', 'curdialogStatus'],\n    components: { dialogGysxz },\n    data () {\n        return {\n            isMajor: false,//是否重大决策\n            formData: {\n                rowId: null,\n                evaluationNo: null,\n                supplierName: null,\n                evaluationType: null,\n                evaluationStage: null,\n                evaluationItem: null,\n                category: null,\n                evaluationYear: null,\n                score: null,\n                grade: null,\n                remark: null\n            },\n            spanArr: [],\n            listSelected: null,//已选项\n            selectRowData: null,\n            dialogVisible: false,\n            rules: {\n                orgCode: [\n                    { required: true, message: '请选择', trigger: 'blur' }\n                ]\n            },\n            formConfig: [\n                { type: 'commonInput', label: '评价单号', prop: 'evaluationNo', width: '' },\n                { type: 'inputBtnGys', label: '供应商', prop: 'supplierName', width: '' },\n                { type: 'dictSelect', dType: 'dt_srm_pak', label: '评价类型', prop: 'evaluationType', width: '' },\n                // { type: 'dictSelect', dType: 'dt_srm_pb3', label: '评价阶段', prop: 'evaluationStage', width: '' },\n                // { type: 'dictSelect', dType: 'dt_srm_pb2', label: '评价类别', prop: 'category', width: '' },\n                { type: 'dictSelect', dType: 'dt_srm_pb4', label: '评价项', prop: 'evaluationItem', width: '' },\n                // { type: 'dateyear', label: '评价年度', prop: 'evaluationYear', width: '' },\n                { type: 'commonInput', label: '得分', prop: 'score', width: '' },\n                { type: 'srmBisSelect', dType: 'dt_cate_grade', label: '综合等级', prop: 'grade', width: '', key: 'code', value: 'name' },\n                { type: 'textarea', label: '评语', prop: 'remark', width: '800px', rows: \"2\" }\n            ],\n            tableConfig: [\n                { label: '评价项目', prop: 'parentDetailName', align: 'left', width: '180' },\n                { label: '评价明细', prop: 'detail', align: 'left', width: '330' },\n                { label: '分制', prop: 'divideScore', align: 'center', width: 'auto' },\n                { label: '权重', prop: 'weight', align: 'center', width: 'auto' },\n                { label: '评分方式', prop: 'methodCN', align: 'center', width: 'auto' },\n                { label: '打分', prop: 'score', align: 'center', type: 'commonInput', width: 'auto' },\n                { label: '得分', prop: 'realScore', align: 'center', width: 'auto' },\n                { label: '备注', prop: 'remark', align: 'center', width: 'auto' }\n            ],\n            tableData: [],\n            dialogConfig: [\n                { title: '供应商信息', isRequired: false, unMutiple: false }\n            ],\n            showSave: true//是否显示保存\n        }\n    },\n    created () {\n\n    },\n    computed: {\n        ...mapState({\n            dt_srm_pb4: state => state.dict.dt_srm_pb4,//评价项\n            dt_srm_pak: state => state.dict.dt_srm_pak,//评价类型\n            dt_srm_pb5: state => state.dict.dt_srm_pb5,//评分方式\n            dt_cate_grade: state => state.srmBisSelect.dt_cate_grade//综合评价等级\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pb4\", \"dt_srm_pak\", \"dt_srm_pb5\"])\n        this.$store.dispatch(\"srmBisSelect/getBisData\", [\"dt_cate_grade\"])\n    },\n    watch: {\n        'formData.score' (val) {\n            if (val) {\n                for (let i = 0; i < this.dt_cate_grade.data.length; i++) {\n                    if (parseInt(this.dt_cate_grade.data[i].value1) < parseInt(val) && parseInt(val) <= parseInt(this.dt_cate_grade.data[i].value2)) {\n                        this.$set(this.formData, 'grade', this.dt_cate_grade.data[i].code)\n                        break\n                    }\n                }\n            } else {\n                this.$set(this.formData, 'grade', null)\n            }\n        }\n    },\n    methods: {\n        handleConfirm () {\n            this.$refs.refForm.validate((valid) => {\n                if (valid) {\n                    this.$confirm('确认保存吗?', '提示', {\n                        confirmButtonText: '确定',\n                        cancelButtonText: '取消',\n                        type: 'warning'\n                    }).then(() => {\n                        let gradeDetailDTOs = []\n                        this.tableData.forEach((item) => {\n                            if (item.score === false) {\n                                item.score = 0\n                            } else if (item.score === true) {\n                                item.score = 1\n                            }\n                            let iobj = { remark: item.remark, rowId: item.rowId, score: parseInt(item.score), weight: item.weight }\n                            gradeDetailDTOs.push(iobj)\n                        })\n                        let cdata = {\n                            gradeItemDTO: {\n                                evaluationNo: this.formData.evaluationNo,\n                                gradeDetailDTOs: gradeDetailDTOs,\n                                grade: this.formData.grade,\n                                score: this.formData.score,\n                                evaluationYear: this.formData.evaluationYear,\n                                remark: this.formData.remark,\n                                rowId: this.formData.rowId\n                            },\n                            method: \"GRADE\"\n                        }\n                        this.$emit('handleDialogClick', cdata)\n                        this.dialogVisible = false\n                    }).catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消'\n                        })\n                    })\n                }\n            })\n        },\n        getSpanArr (data) {\n            data.sort(this.compareObj(\"parentDetailName\"))\n            for (var i = 0; i < data.length; i++) {\n                if (i === 0) {\n                    this.spanArr.push(1)\n                    this.pos = 0\n                } else {\n                    // 判断当前元素与上一个元素是否相同\n                    if (data[i].parentDetailName === data[i - 1].parentDetailName) {\n                        this.spanArr[this.pos] += 1\n                        this.spanArr.push(0)\n                    } else {\n                        this.spanArr.push(1)\n                        this.pos = i\n                    }\n                }\n            }\n        },\n        compareObj (prop) {\n            return function (obj1, obj2) {\n                let val1 = obj1[prop]\n                let val2 = obj2[prop]\n                if (val1 < val2) {\n                    return -1\n                } else if (val1 > val2) {\n                    return 1\n                } else {\n                    return 0\n                }\n            }\n        },\n        objectSpanMethod ({ rowIndex, columnIndex }) {\n            if (columnIndex === 1) {\n                const _row = this.spanArr[rowIndex]\n                const _col = _row > 0 ? 1 : 0\n                return {\n                    rowspan: _row,\n                    colspan: _col\n                }\n            }\n        },\n        initForm (type, row) {\n            this.tableData = []\n            this.spanArr = []\n            for (let key in this.formData) {\n                for (let par in row) {\n                    if (key === par) {\n                        this.$set(this.formData, key, row[key])\n                    }\n                }\n            }\n            if (type !== 'judge') {\n                this.showSave = false\n            }\n            row.evaluationDetailDTOs.forEach(item => {\n                if (item.method === 'PB52') {\n                    if (item.score === 1) {\n                        item.score = true\n                    } else {\n                        item.score = false\n                    }\n                }\n            })\n            this.tableData = row.evaluationDetailDTOs\n            this.getSpanArr(this.tableData)\n            this.caculateScore()\n        },\n        showGys () {\n            this.$refs.refGys.initSelect()\n            this.$refs.refGys.dialogVisible = true\n        },\n        //供应商确认\n        handleGysClick (gysRows) {\n            this.$set(this.formData, 'supplierName', gysRows[0].supplierName)\n            this.formData.supplierCode = gysRows[0].supplierCode\n        },\n        //计算得分\n        caculateScore () {\n            let score = 0\n            this.tableData.forEach(item => {\n                console.log(item.score)\n                if (item.score) {\n                    score += parseInt(item.score) * parseInt(item.weight) / 100\n                }\n            })\n            this.$set(this.formData, 'score', score)\n        },\n        //重大决策变化\n        changMajor (val) {\n            if (!val) {\n                this.isMajor = false\n                this.caculateScore()\n            } else {\n                this.isMajor = true\n                this.$set(this.formData, 'score', 0)\n            }\n        },\n        //分制复制\n        handleCopy () {\n            this.tableData.map((item, index) => {\n                if (!item.score) {\n                    this.$set(this.tableData[index], 'score', item.divideScore)\n                }\n            })\n            this.caculateScore()\n        }\n    }\n}\n",null]}