{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/dialog/dialogQuoteLevel1.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/dialog/dialogQuoteLevel1.vue","mtime":1596610933761},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { createQuote, updateQuote } from \"@/api/project/srm/supplierSelect/supplierRFQ/supplierRFQAnswer\"\nimport { mapState } from \"vuex\"\nimport { DICT_CODE } from '@/utils/constant'\nimport caiGou from '@/components/Select/xtpt/caigou'//下拉组件\nimport dialogQuoteLevel1Ref from './dialogQuoteLevel1Ref' //参照报价\n\n\nexport default {\n    name: 'dialogQuoteLevel1',\n    props: ['title'],\n    components: { caiGou, dialogQuoteLevel1Ref },\n    data () {\n        let compareDate = (rule, value, callback) => {\n            if (value < this.formData.validDateStart) {\n                return callback(new Error('有效期起不能大于有效期止'))\n            } else {\n                callback()\n            }\n        }\n        return {\n            isComputed: undefined,\n            dialogVisible: false,\n            tabName: 'tabQuote',\n            DICT_CODE: DICT_CODE,\n            constVal: {\n                managementRate: 0,\n                profitRate: 0,\n                financialRate: 0\n            },\n            methodType: 'add',\n            formData: {\n                rowId: null,\n                rfqNo: null,\n                supplierCode: null,\n                supplierName: null,\n                quotedDate: null,\n                materielCode: null,\n                materielName: null,\n                materielClass: null,\n                materielClassName: null,\n                weight: null,\n                settlementMethod: null,\n                otherMethod: null,\n                currency: null,\n                validDateStart: null,\n                validDateEnd: null,\n                remark: null,\n                firstYearDecline: null,\n                secondYearDecline: null,\n                thirdYearDecline: null,\n                forthYearDecline: null,\n                fifthYearDecline: null,\n                rawMaterialCost: 0,\n                designCost: 0,\n                logisticsCost: 0,\n                recoveryValue: 0,\n                managementRate: 0,\n                otherCost: 0,\n                outsourcingCost: 0,\n                managementCost: 0,\n                profitRate: 0,\n                toolingCost: 0,\n                financialRate: 0,\n                processingCost: 0,\n                financialCost: 0,\n                realPrice: 0,\n                wasteLoss: 0,\n                packingCost: 0\n            },\n            totalQuotation: {\n                designCost: 0,\n                financialCost: 0,\n                financialRate: 0,\n                logisticsCost: 0,\n                managementCost: 0,\n                managementRate: 0,\n                materielCode: 0,\n                materielName: 0,\n                otherCost: 0,\n                outsourcingCost: 0,\n                packingCost: 0,\n                processingCost: 0,\n                profit: 0,\n                profitRate: 0,\n                quotedDate: null,\n                rawMaterialCost: 0,\n                realPrice: 0,\n                recoveryValue: 0,\n                toolingCost: 0,\n                version: 0,\n                wasteLoss: 0\n            },\n            rules: {\n                settlementMethod: [\n                    { required: true, message: '请选择', trigger: 'blur' }\n                ],\n                currency: [\n                    { required: true, message: '请选择', trigger: 'blur' }\n                ],\n                validDateEnd: [\n                    { validator: compareDate, trigger: 'blur' }\n                ]\n            },\n            formConfig: [\n                { type: 'commonInput', disabled: true, label: '供应商编码', prop: 'supplierCode', width: '' },\n                { type: 'commonInput', disabled: true, label: '供应商名称', prop: 'supplierName', width: '' },\n                { type: 'date', label: '报价时间', prop: 'quotedDate', width: '' },\n                { type: 'commonInput', disabled: true, label: '物料编码', prop: 'materielCode', width: '' },\n                { type: 'commonInput', disabled: true, label: '物料名称', prop: 'materielName', width: '' },\n                { type: 'commonInput', disabled: true, label: '物料分类', prop: 'materielClassName', width: '' },\n                { type: 'commonInput', label: '重量(KG)', prop: 'weight', width: '' },//wu\n                { type: 'dictSelect', dType: 'dt_srm_pdr', label: '结算方式', prop: 'settlementMethod', width: '' },//wu dict dt_srm_pdr\n                { type: 'commonInput', label: '其它方式说明', prop: 'otherMethod', width: '' },//wu\n                { type: 'dictSelect', dType: 'dt_srm_pdk', label: '币种', prop: 'currency', width: '' },//wu dict\n                { type: 'date', label: '有效期起', disabled: true, prop: 'validDateStart', width: '' },\n                { type: 'date', label: '有效期止', disabled: true, prop: 'validDateEnd', width: '' },\n\n                { type: 'textarea', label: '备注', prop: 'remark', width: '780px', rows: \"2\" },\n                {\n                    type: 'inputArr', label: '承诺降幅', prop: 'prop4', width: '', inputArr: [\n                        { type: 'commonInput', label: '第一年', prop: 'firstYearDecline', width: '', styleObj: {} },\n                        { type: 'commonInput', label: '第二年', prop: 'secondYearDecline', width: '', styleObj: { marginLeft: '10px' } },\n                        { type: 'commonInput', label: '第三年', prop: 'thirdYearDecline', width: '', styleObj: { marginLeft: '10px' } },\n                        { type: 'commonInput', label: '第四年', prop: 'forthYearDecline', width: '', styleObj: { marginLeft: '10px' } },\n                        { type: 'commonInput', label: '第五年', prop: 'fifthYearDecline', width: '', styleObj: { marginLeft: '10px' } },\n                    ]\n                },\n                { type: 'commonInput', inputType: 'number', label: '原材料费用', prop: 'rawMaterialCost', width: '' }, //A\n                { type: 'commonInput', inputType: 'number', label: '设计/实验费用', prop: 'designCost', width: '' },//M\n                { type: 'commonInput', inputType: 'number', label: '运输费用', prop: 'logisticsCost', width: '' },//I\n                { type: 'commonInput', inputType: 'number', label: '回收价值', prop: 'recoveryValue', width: '' },//A6\n                { type: 'commonInput', inputType: 'number', label: '管理费率', prop: 'managementRate', width: '' },//常量参数\n                { type: 'commonInput', inputType: 'number', label: '其他销售费用', prop: 'otherCost', width: '' },//J\n                { type: 'commonInput', inputType: 'number', label: '外购外协费用', prop: 'outsourcingCost', width: '' },//B\n                { type: 'commonInput', inputType: 'number', disabled: true, label: '管理费用', prop: 'managementCost', width: '' },//F=(A-A6+B+C+D+E) *管理费率\n                { type: 'commonInput', inputType: 'number', label: '利润率', prop: 'profitRate', width: '' },//常量参数\n                { type: 'commonInput', inputType: 'number', label: '专业工装分摊费', prop: 'toolingCost', width: '' },//C\n                { type: 'commonInput', inputType: 'number', label: '财务费率', prop: 'financialRate', width: '' },//常量参数\n                { type: 'commonInput', inputType: 'number', disabled: true, label: '利润', prop: 'profit', width: '' },//K=(A-A6+B+C+D+E+F+G) *利润率\n                { type: 'commonInput', inputType: 'number', label: '加工费', prop: 'processingCost', width: '' },//D\n                { type: 'commonInput', inputType: 'number', disabled: true, label: '财务费用', prop: 'financialCost', width: '' },//G=(A-A6+B+C+D+E) *财务费率\n                { type: 'commonInput', inputType: 'number', disabled: true, label: '核实价', prop: 'realPrice', width: '' },//L=A-A6+B+C+D+E+F+G+H+I+J+K+M\n                { type: 'commonInput', inputType: 'number', label: '废品损失', prop: 'wasteLoss', width: '' },//E\n                { type: 'commonInput', inputType: 'number', label: '包装费用', prop: 'packingCost', width: '' }//H\n            ],\n            dialogConfig: [\n                { title: '参照报价', unMutiple: false }\n            ],\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_pdr: state => state.dict.dt_srm_pdr,//结算方式\n            dt_srm_pdk: state => state.dict.dt_srm_pdk,//币种\n            dt_const: state => state.srmBisSelect.dt_const//常量\n        }),\n        managementCost: function () {\n            let val = (parseFloat(this.formData.rawMaterialCost ? this.formData.rawMaterialCost : 0) - parseFloat(this.formData.recoveryValue ? this.formData.recoveryValue : 0) + parseFloat(this.formData.outsourcingCost ? this.formData.outsourcingCost : 0) + parseFloat(this.formData.toolingCost ? this.formData.toolingCost : 0) + parseFloat(this.formData.processingCost ? this.formData.processingCost : 0) + parseFloat(this.formData.wasteLoss ? this.formData.wasteLoss : 0)) * parseFloat(this.formData.managementRate ? this.formData.managementRate : 0)\n            this.$set(this.formData, 'managementCost', val)\n            return val\n        },\n        profit: function () {\n            let val = (parseFloat(this.formData.rawMaterialCost ? this.formData.rawMaterialCost : 0)\n                - parseFloat(this.formData.recoveryValue ? this.formData.recoveryValue : 0)\n                + parseFloat(this.formData.outsourcingCost ? this.formData.outsourcingCost : 0)\n                + parseFloat(this.formData.toolingCost ? this.formData.toolingCost : 0)\n                + parseFloat(this.formData.processingCost ? this.formData.processingCost : 0)\n                + parseFloat(this.formData.wasteLoss ? this.formData.wasteLoss : 0)\n                + parseFloat(this.formData.managementCost ? this.formData.managementCost : 0)\n                + parseFloat(this.formData.financialCost ? this.formData.financialCost : 0))\n                * parseFloat(this.formData.profitRate ? this.formData.profitRate : 0)\n            this.$set(this.formData, 'profit', val)\n            return val\n        },\n        financialCost: function () {\n            let val = (parseFloat(this.formData.rawMaterialCost ? this.formData.rawMaterialCost : 0) - parseFloat(this.formData.recoveryValue ? this.formData.recoveryValue : 0) + parseFloat(this.formData.outsourcingCost ? this.formData.outsourcingCost : 0) + parseFloat(this.formData.toolingCost ? this.formData.toolingCost : 0) + parseFloat(this.formData.processingCost ? this.formData.processingCost : 0) + parseFloat(this.formData.wasteLoss ? this.formData.wasteLoss : 0)) * parseFloat(this.formData.financialRate ? this.formData.financialRate : 0)\n            this.$set(this.formData, 'financialCost', val)\n            return val\n        },\n        realPrice: function () {\n            let val = parseFloat(this.formData.rawMaterialCost ? this.formData.rawMaterialCost : 0)\n                - parseFloat(this.formData.recoveryValue ? this.formData.recoveryValue : 0)\n                + parseFloat(this.formData.outsourcingCost ? this.formData.outsourcingCost : 0)\n                + parseFloat(this.formData.toolingCost ? this.formData.toolingCost : 0)\n                + parseFloat(this.formData.processingCost ? this.formData.processingCost : 0)\n                + parseFloat(this.formData.wasteLoss ? this.formData.wasteLoss : 0)\n                + parseFloat(this.formData.managementCost ? this.formData.managementCost : 0)\n                + parseFloat(this.formData.financialCost ? this.formData.financialCost : 0)\n                + parseFloat(this.formData.packingCost ? this.formData.packingCost : 0)\n                + parseFloat(this.formData.logisticsCost ? this.formData.logisticsCost : 0)\n                + parseFloat(this.formData.otherCost ? this.formData.otherCost : 0)\n                + parseFloat(this.formData.profit ? this.formData.profit : 0)\n                + parseFloat(this.formData.designCost ? this.formData.designCost : 0)\n            this.$set(this.formData, 'realPrice', val)\n            return val\n        },\n    },\n    watch: {\n        'managementCost' () { },\n        'profit' () { },\n        'financialCost' () { },\n        'realPrice' () { }\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pdr\", \"dt_srm_pdk\"])\n        this.$store.dispatch(\"srmBisSelect/getBisData\", [\"dt_cate_platformSeries\", \"dt_const\"])\n    },\n    methods: {\n        setConst () {\n            if (this.dt_const) {\n                this.dt_const.data.forEach(item => {\n                    if (item.typeEncoding === 'PBE0') {\n                        this.constVal.managementRate = item.constantValue\n                        this.$set(this.formData, 'managementRate', item.constantValue)\n                    } else if (item.typeEncoding === 'PBE1') {\n                        this.constVal.profitRate = item.constantValue\n                        this.$set(this.formData, 'profitRate', item.constantValue)\n                    } else if (item.typeEncoding === 'PBE4') {\n                        this.constVal.financialRate = item.constantValue\n                        this.$set(this.formData, 'financialRate', item.constantValue)\n                    }\n                })\n            }\n        },\n        handleConfirm () {\n            this.$refs.formData.validate((valid) => {\n                if (valid) {\n                    this.$confirm('确认保存吗?', '提示', {\n                        confirmButtonText: '确定',\n                        cancelButtonText: '取消',\n                        type: 'warning'\n                    }).then(() => {\n                        if (this.methodType === 'add') {\n                            let cdata = {\n                                method: \"FIRST\",\n                                quotationSource: 'notice',\n                                quotedProposalDTO: this.formData\n                            }\n                            this.setTotalQuotation()\n                            //后面注释掉\n                            cdata.quotedProposalDTO.quotationSource = 'notice'\n                            cdata.quotedProposalDTO.totalQuotation = this.totalQuotation\n                            createQuote(cdata).then(res => {\n                                this.methodType = 'edit'\n                                this.formData.rowId = res.data\n                                this.$message({\n                                    type: 'success',\n                                    message: '新增报价成功'\n                                })\n                                this.dialogVisible = false\n                                this.$emit('refresh')\n                            })\n                        } else {\n                            let cdata = {\n                                method: \"FIRST\",\n                                quotationSource: 'notice',\n                                quotedProposalDTO: this.formData\n                            }\n                            //后面注释掉\n                            cdata.quotedProposalDTO.quotationSource = 'notice'\n                            let totalQuotation = {\n                                totalQuotation: parseFloat(this.formData.designCost),\n                                logisticsCost: parseFloat(this.formData.logisticsCost),\n                                recoveryValue: parseFloat(this.formData.recoveryValue),\n                                managementRate: parseFloat(this.formData.managementRate),\n                                otherCost: parseFloat(this.formData.otherCost),\n                                outsourcingCost: parseFloat(this.formData.outsourcingCost),\n                                managementCost: parseFloat(this.formData.managementCost),\n                                profitRate: parseFloat(this.formData.profitRate),\n                                toolingCost: parseFloat(this.formData.toolingCost),\n                                financialRate: parseFloat(this.formData.financialRate),\n                                profit: parseFloat(this.formData.profit),\n                                processingCost: parseFloat(this.formData.processingCost),\n                                financialCost: parseFloat(this.formData.financialCost),\n                                realPrice: parseFloat(this.formData.realPrice),\n                                wasteLoss: parseFloat(this.formData.wasteLoss),\n                                packingCost: parseFloat(this.formData.packingCost),\n                                materielCode: this.formData.materielCode,\n                                materielName: this.formData.materielName,\n                            }\n                            cdata.quotedProposalDTO.totalQuotation = totalQuotation\n                            console.log(cdata, 'rrr')\n                            updateQuote(cdata).then(() => {\n                                this.$message({\n                                    type: 'success',\n                                    message: '编辑报价成功'\n                                })\n                                this.dialogVisible = false\n                                this.$emit('refresh')\n                            })\n                        }\n                    }).catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消'\n                        })\n                    })\n                }\n            })\n        },\n        handleQuoteRef () {\n            this.$refs.refQuoteRef.dialogVisible = true\n        },\n        initTotalQuotation () {\n            for (let par in this.totalQuotation) {\n                this.$set(this.totalQuotation, par, 0)\n            }\n        },\n        setTotalQuotation () {\n            for (let key in this.formData) {\n                for (let par in this.totalQuotation) {\n                    if (key === par) {\n                        this.$set(this.totalQuotation, key, this.formData[key])\n                    }\n                }\n            }\n        },\n        initForm (fdata, row, status) {\n            this.isComputed = row\n            console.log(fdata, row, 'yyyy')\n            this.initTotalQuotation()\n            if (this.$refs['formData']) {\n                this.$refs['formData'].resetFields()\n                this.$refs['formData'].clearValidate()\n            }\n            if (row) {\n                for (let key in this.formData) {\n                    for (let par in row) {\n                        if (key === par) {\n                            this.$set(this.formData, key, row[key])\n                        }\n                    }\n                }\n            }\n            if (status == 'edit') {\n                this.formData.rawMaterialCost = row.totalQuotation.rawMaterialCost\n                this.formData.designCost = row.totalQuotation.designCost\n                this.formData.logisticsCost = row.totalQuotation.logisticsCost\n                this.formData.recoveryValue = row.totalQuotation.recoveryValue\n                this.formData.managementRate = row.totalQuotation.managementRate\n                this.formData.otherCost = row.totalQuotation.otherCost\n                this.formData.outsourcingCost = row.totalQuotation.outsourcingCost\n                this.formData.managementCost = row.totalQuotation.managementCost\n                this.formData.profitRate = row.totalQuotation.profitRate\n                this.formData.toolingCost = row.totalQuotation.toolingCost\n                this.formData.financialRate = row.totalQuotation.financialRate\n                this.formData.profit = row.totalQuotation.profit\n                this.formData.processingCost = row.totalQuotation.processingCost\n                this.formData.financialCost = row.totalQuotation.financialCost\n                this.formData.realPrice = row.totalQuotation.realPrice\n                this.formData.wasteLoss = row.totalQuotation.wasteLoss\n                this.formData.packingCost = row.totalQuotation.packingCost\n            }\n            if (fdata) {\n                for (let key in this.formData) {\n                    for (let par in fdata) {\n                        if (key === par) {\n                            console.log(key)\n                            if (fdata[key]) {\n                                this.$set(this.formData, key, fdata[key])\n                            }\n                        }\n                    }\n                }\n            }\n            this.setConst()\n\n            console.log(this.formData)\n        },\n        resetTemp () {\n            this.formData = {\n                rowId: null,\n                rfqNo: null,\n                supplierCode: null,\n                supplierName: null,\n                quotedDate: null,\n                materielCode: null,\n                materielName: null,\n                materielClass: null,\n                materielClassName: null,\n                weight: null,\n                settlementMethod: null,\n                otherMethod: null,\n                currency: null,\n                validDateStart: null,\n                validDateEnd: null,\n                remark: null,\n                firstYearDecline: null,\n                secondYearDecline: null,\n                thirdYearDecline: null,\n                forthYearDecline: null,\n                fifthYearDecline: null,\n                rawMaterialCost: 0,\n                designCost: 0,\n                logisticsCost: 0,\n                recoveryValue: 0,\n                managementRate: 0,\n                otherCost: 0,\n                outsourcingCost: 0,\n                managementCost: 0,\n                profitRate: 0,\n                toolingCost: 0,\n                financialRate: 0,\n                processingCost: 0,\n                financialCost: 0,\n                realPrice: 0,\n                wasteLoss: 0,\n                packingCost: 0\n            }\n        }\n    }\n}\n",null]}