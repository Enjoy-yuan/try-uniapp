{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/tab/tabZYcost.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/tab/tabZYcost.vue","mtime":1599136050834},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { queryQuoteItem, createQuoteItem, updateQuoteItem, deleteQuoteItem, queryQuoteDetails } from \"@/api/project/srm/supplierSelect/supplierRFQ/supplierRFQAnswer\"\nexport default {\n    name: 'tabZYcost',\n    props: ['parentRowId', 'rfqNo'],\n    data () {\n        return {\n            tableData: [],\n            rules: {\n                partName: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                processName: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                toolingName: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                mainMaterial: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                serviceLife: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                unitPrice: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                apportionmentQuantity: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                rejectRate: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ]\n            },\n            formData: {\n                // rfqNo: null,\n                partName: null,\n                processName: null,\n                toolingName: null,\n                mainMaterial: null,\n                serviceLife: null,\n                unitPrice: null,\n                apportionmentQuantity: null,\n                rejectRate: null,\n                apportionmentFee: null,\n                wasteLoss: null,\n                remark: null\n            },\n            formConfig: [\n                { type: 'commonInput', disabled: true, required: true, label: 'rfq单号', prop: 'rfqNo', width: '' },\n                { type: 'commonInput', required: true, label: '部件名称', prop: 'partName', width: '' },\n                { type: 'commonInput', required: true, label: '工序名称', prop: 'processName', width: '' },\n                { type: 'commonInput', required: true, label: '工装名称', prop: 'toolingName', width: '' },\n                { type: 'commonInput', required: true, label: '工装主要材质', prop: 'mainMaterial', width: '' },\n                { type: 'commonInput', required: true, label: '使用寿命(件)', prop: 'serviceLife', width: '' },\n                { type: 'commonInput', required: true, label: '金额', prop: 'unitPrice', width: '' },\n                { type: 'commonInput', required: true, label: '分摊数量', prop: 'apportionmentQuantity', width: '' },\n                { type: 'commonInput', required: true, label: '废品率', prop: 'rejectRate', width: '' },\n                { type: 'commonInput', disabled: true, label: '单件分摊费', prop: 'apportionmentFee', width: '' },\n                { type: 'commonInput', disabled: true, label: '废品损失', prop: 'wasteLoss', width: '' },\n                { type: 'textarea', label: '备注', prop: 'remark', width: '475px', rows: \"1\" },//wu\n            ],\n            tableConfig: [\n                { label: '部件名称', prop: 'partName', align: 'center', width: 'auto' },\n                { label: '工序名称', prop: 'processName', align: 'center', width: 'auto' },\n                { label: '工装名称', prop: 'toolingName', align: 'center', width: 'auto' },\n                { label: '工装主要材质', prop: 'mainMaterial', align: 'center', width: 'auto' },\n                { label: '使用寿命(件)', prop: 'serviceLife', align: 'center', width: 'auto' },\n                { label: '金额', prop: 'unitPrice', align: 'center', width: 'auto' },\n                { label: '每模件数', prop: 'prop8', align: 'center', width: 'auto' },\n                { label: '分摊数量', prop: 'apportionmentQuantity', align: 'center', width: 'auto' },\n                { label: '单件摊销费', prop: 'apportionmentFee', align: 'center', width: 'auto' },\n                { label: '废品率', prop: 'rejectRate', align: 'center', width: 'auto' },\n                { label: '废品损失', prop: 'wasteLoss', align: 'center', width: 'auto' },\n                { label: '备注', prop: 'remark', align: 'center', width: 'auto' }//wu\n            ]\n        }\n    },\n    watch: {\n\n        'formData.unitPrice' (val) {\n            this.$set(this.formData, 'apportionmentFee', (val / this.formData.apportionmentQuantity).toFixed(4))\n        },\n        'formData.apportionmentQuantity' (val) {\n            this.$set(this.formData, 'apportionmentFee', (this.formData.unitPrice / val).toFixed(4))\n        },\n        'formData.apportionmentFee' (val) {\n            this.$set(this.formData, 'recyclableWeight', (this.formData.rejectRate * val).toFixed(4))\n        },\n        'formData.rejectRate' (val) {\n            this.$set(this.formData, 'recyclableWeight', (this.formData.apportionmentFee * val).toFixed(4))\n        }\n    },\n    mounted () {\n        this.getItems()\n    },\n    methods: {\n        changeFormValue (prop, val) {\n            this.$set(this.formData, prop, val)\n        },\n        getItems () {\n            if (this.parentRowId) {\n                queryQuoteDetails({ parentRowId: this.parentRowId, method: 'TOOLING_COST' }).then(res => {\n                    this.tableData = res.data\n                    this.calculateSum()\n                })\n            }\n        },\n        calculateSum () {\n            let apportionmentFees = 0\n            let wasteLosses = 0\n\n            this.tableData.forEach(item => {\n                apportionmentFees += item.apportionmentFee\n                wasteLosses += item.wasteLoss\n            })\n\n            let dataSum = { key: 'sum', partName: '合计', apportionmentFee: apportionmentFees, wasteLoss: wasteLosses }\n            this.tableData.push(dataSum)\n        },\n        handleUpdate (row) {\n            queryQuoteItem({ rowId: row.rowId, method: 'TOOLING_COST' }).then(res => {\n                this.formData = res.data\n            })\n        },\n        handleDelete (row) {\n            this.$confirm('确认删除吗?', '提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning'\n            }).then(() => {\n                deleteQuoteItem({ parentRowId: this.parentRowId, rowId: row.rowId, method: 'TOOLING_COST' }).then(() => {\n                    this.getItems()\n                    this.$emit('getTotalQuotation')\n                })\n            }).catch(() => {\n                this.$message({\n                    type: 'info',\n                    message: '已取消'\n                })\n            })\n        },\n        resetForm () {\n            for (let par in this.formData) {\n                if (par !== 'parentRowId' && par !== 'rfqNo') {\n                    this.$set(this.formData, par, null)\n                }\n            }\n            this.$refs['refForm'].resetFields()\n            this.$refs['refForm'].clearValidate()\n        },\n        handleConfirm () {\n            this.$refs.refForm.validate((valid) => {\n                if (valid) {\n                    this.$confirm('确认保存吗?', '提示', {\n                        confirmButtonText: '确定',\n                        cancelButtonText: '取消',\n                        type: 'warning'\n                    }).then(() => {\n                        // 专用工装费用 DTO(TOOLING_COST)专用工装费用 DTO\n                        this.formData.parentRowId = this.parentRowId\n                        if (this.formData.rowId) {\n                            let cdata = {\n                                toolingCostDTO: this.formData,\n                                method: \"TOOLING_COST\"\n                            }\n                            updateQuoteItem(this.formData.rowId, cdata).then(() => {\n                                this.getItems()\n                                this.$emit('getTotalQuotation')\n                                this.$message({\n                                    type: 'success',\n                                    message: '编辑成功'\n                                })\n                                this.resetForm()\n                            })\n                        } else {\n                            let cdata = {\n                                toolingCostDTO: this.formData,\n                                method: \"TOOLING_COST\"\n                            }\n                            createQuoteItem(cdata).then(() => {\n                                this.getItems()\n                                this.$emit('getTotalQuotation')\n                                this.resetForm()\n                                this.$message({\n                                    type: 'success',\n                                    message: '新增成功'\n                                })\n                            })\n\n                        }\n                    }).catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消'\n                        })\n                    })\n                }\n            })\n        }\n    }\n}\n",null]}