{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/knProcessing/wzsknProcessing/content/contentProof.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/knProcessing/wzsknProcessing/content/contentProof.vue","mtime":1596610934130},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { queryRecords, queryRecordsDetail } from \"@/api/project/wms/knProcessing/wzsknProcessing\";\nimport Pagination from '@/components/Pagination' // 分页组件\nimport AuthoType from '@/components/Select/AuthoType.vue'//权限类型下拉组件\n// import { parseTime, json2excel } from \"@/utils/setMethods\"\nimport { DT_ORG_TYPE } from '@/utils/constant'\n\nexport default {\n    name: \"Hand_pulled_material\",\n    components: { Pagination, AuthoType },\n    data () {\n        return {\n            rheight: 0,\n            lheight: 0,\n            list: null,\n            listDetail: null,\n            listDetailSub: null,\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            total: 0,\n            totals: 0,\n            rangeTime: \"\",\n            accountRangeTime: \"\",\n            selectRows: [],\n            businessTypeList: [],\n            dialogGys: false,\n            supplierRows: [],\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                orgCode: '',\n                warehouseCode: '',\n                dicType: '',\n            },\n            sublistQueryf: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                method: 'proofDetai'\n            },\n            sublistQuerys: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                method: 'processingDetail'\n            },\n            tableKey: 0,\n            rules: {\n\n            },\n            dialogPrintVisible: false,\n            printData: {},//打印数据\n            printList: []\n        };\n    },\n    filters: {\n        timestampToTime (val, timestamp) {\n            this.$myFun.parseTime(val, timestamp)\n        }\n    },\n    mounted () {\n        this.setTableHeight();\n    },\n    methods: {\n        //表格高度计算\n        setTableHeight () {\n            this.lheight = this.$myFun.getSingleTbHeight() + 80;\n            this.rheight = this.lheight / 2 - 42;\n        },\n        //主表数据获取\n        getListData () {\n            if (!this.listQuery.orgCode || !this.listQuery.warehouseCode || !this.listQuery.dicType) {\n                this.$message({\n                    title: this.$t(\"message.warning\"),\n                    message: '请先选择组织编码、仓库编码、业务类型',\n                    type: \"warning\"\n                });\n            } else {\n                this.listDetailSub = []\n                this.listDetail = []\n                queryRecords(this.listQuery.orgCode, this.listQuery.warehouseCode, this.listQuery.dicType, this.listQuery).then(res => {\n                    this.list = res.data.list;\n                    this.total = res.data.pages.count;\n                })\n            }\n        },\n        //显示主表\n        getList () {\n            if (this.rangeTime) {\n                let d1 = this.rangeTime[0];\n                let d2 = this.rangeTime[1];\n                this.listQuery.createDateBegin = d1;\n                this.listQuery.createDateEnd = d2;\n            } else {\n                this.listQuery.createDateBegin = null;\n                this.listQuery.createDateEnd = null;\n            }\n            if (this.accountRangeTime) {\n                let d1 = this.accountRangeTime[0];\n                let d2 = this.accountRangeTime[1];\n                this.listQuery.accountDateBegin = d1;\n                this.listQuery.accountDateEnd = d2;\n            } else {\n                this.listQuery.accountDateBegin = null;\n                this.listQuery.accountDateEnd = null;\n            }\n            this.getListData();\n        },\n        //显示从表\n        getSubList (row) {\n            let proofNo = row.proofNo;\n            queryRecordsDetail(proofNo, this.sublistQueryf).then(res => {\n                this.listDetail = res.data.list;\n                queryRecordsDetail(proofNo, this.sublistQuerys).then(resd => {\n                    this.listDetailSub = resd.data.list;\n                    this.totals = resd.data.pages.count;\n                });\n            });\n        },\n        //查询\n        handleQuery () {\n            this.listRow = [];\n            this.listQuery.currentPage = 1;\n            this.getList();\n        },\n        //每页大小变化\n        handleSizeChange (val) {\n            this.listQuery.pageSize = val;\n            this.getList();\n        },\n        //当前页变化\n        handleCurrentChange (val) {\n            this.listQuery.currentPage = val;\n            this.getList();\n        },\n        //主表勾选框选中\n        selectRow (val) {\n            this.selectRows = val[val.length - 1];\n            if (val.length > 1) {\n                this.$refs.tbmain.clearSelection()\n                this.$refs.tbmain.toggleRowSelection(val[val.length - 1], 'selected')\n            }\n\n            if (val.length !== 0) {\n                this.getSubList(val[val.length - 1]);\n            }\n        },\n        //主表点击显示从表\n        showSubTable (val) {\n            this.selectRows = val;\n            this.$refs.tbmain.clearSelection()\n            this.$refs.tbmain.toggleRowSelection(val, 'selected');\n            this.getSubList(val);\n        },\n        setdefault (val, i) {\n            if (i === 1) {\n                this.listQuery.orgCode = val;\n            } else if (i === 3) {\n                this.listQuery.warehouseCode = val;\n            }\n        },\n        //打印\n        handlePrint () {\n            this.dialogPrintVisible = true;\n            this.printData = this.selectRows;\n            //处理打印数据\n        },\n        handleExport () {\n            if (this.selectRows) {\n                let selectRow = [];\n                selectRow.push(this.selectRows);\n                if (selectRow.length === 1) {\n                    var excelDatas = [\n                        {\n                            tHeader: [\"凭证号\", \"业务类型\", \"物料编码\", \"物料名称\", \"数量\", \"组织编码\", \"组织名称\", \"仓库编码\", \"仓库名称\", \"记账日期\", \"创建日期\", \"记账人\", \"库存类型\", \"库存状态\"], // sheet表一头部\n                            filterVal: [\"proofNo\", \"dicTypeName\", \"materielCode\", \"materielName\", \"quantity\", \"orgCode\", \"orgName\", \"warehouseCode\", \"warehouseName\", \"createTime\", \"createTime\", \"accountor\", \"stockTypeName\", \"stockStateName\"], // 表一的数据字段\n                            tableDatas: this.listDetail, // 表一的整体json数据\n                            sheetName: \"无指示凭证\"// 表一的sheet名字\n                        },\n                        {\n                            tHeader: [\"凭证号\", \"业务类型\", \"物料编码\", \"物料名称\", \"数量\", \"记账日期\", \"库区\", \"库位\", \"库存类型\", \"库存状态\"],\n                            filterVal: [\"proofNo\", \"dicTypeName\", \"materielCode\", \"materielName\", \"quantity\", \"createTime\", \"wareAreaCode\", \"wareLocationCode\", \"stockTypeName\", \"stockStateName\"],\n                            tableDatas: this.listDetailSub,\n                            sheetName: \"凭证详情\"\n                        }\n                    ]\n                    //   引入的函数\n                    this.$myFun.json2excel(excelDatas, \"无指示库内凭证\", true, \"xlsx\")\n                } else {\n                    this.$message.warning(this.$t('message.checkedoneplease'));\n                }\n            }\n        },\n        //执行打印\n        doPrint () {\n\n        }\n    }\n}\n",null]}