{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/productIssue/issueFormation/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/productIssue/issueFormation/index.vue","mtime":1596610934141},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport Pagination from \"@/components/Pagination\"\nimport orgSelect from \"@/components/Select/orgSelect.vue\"\nimport { DICT_CODE, DT_ORG_TYPE, THE_STATE_OPTIONS } from \"@/utils/constant\"\nimport { mapState, mapGetters } from \"vuex\"\nimport warehouseSelect from \"@/components/Select/warehouse-select.vue\" //下拉组件\nimport wlxzbyorgpar from \"@/components/Select/wlxzbyorgpar.vue\" //下拉组件\nimport personSelect from \"@/components/Select/personSelect.vue\" //下拉组件\nimport * as api from \"@/api/project/wms/productIssue/issueFormation\"\nimport workCenterSelect from \"@/components/Select/work-center-select.vue\" //下拉组件\nimport qrcode from \"@/components/QRCode\"\n\nexport default {\n    name: \"issueFormation\",\n    components: {        Pagination,\n        personSelect,\n        orgSelect,\n        warehouseSelect,\n        workCenterSelect,\n        qrcode,\n        wlxzbyorgpar    },\n    data () {\n        let compareDate = (rule, value, callback) => {\n            if (value < this.temp.goodsReadyTime) {\n                return callback(new Error(\"投料日期不能小于备货日期\"))\n            } else {\n                callback()\n            }\n        }\n        return {\n            theight: 0,\n            isSingle: true,//表格是否单选 点击各按钮根据流程逻辑控制单多选\n            tableKey: [0, 1],\n            list: null,\n            subList: null,\n            dataFormList: null,\n            total: 0,\n            total1: 0,\n            total2: 0,\n            tlDate: \"\",\n            tkq: \"\",\n            Edit: false,\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                orgCode: undefined,\n                productionline: undefined,\n                station: undefined,\n                feedType: undefined,\n                state: undefined,\n                batchNumber: undefined,\n                leadTime: undefined,\n                feedTime: undefined,\n                feedwarehouse: undefined,\n                workShop: undefined,\n                pushTimeStart: undefined,\n                pushTimeEnd: undefined,\n                pushMaterialState: undefined,\n                creator: undefined\n            },\n            listQuerySub: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                supplierCode: undefined,\n                orderNumber: undefined\n            },\n            listQueryItems: {\n                currentPage: 1,\n                pageSize: 10,\n                pushOrderCode: undefined\n            },\n            dto: {\n                goodsReadyEmp: undefined,\n                goodsReadyEmpName: undefined,\n                goodsReadyTime: undefined,\n                lineCode: undefined,\n                lineName: undefined,\n                method: undefined,\n                note: undefined,\n                orgCode: undefined,\n                orgName: undefined,\n                pushEmp: undefined,\n                pushEmpName: undefined,\n                pushMaterialType: undefined,\n                pushOrderCode: undefined,\n                pushOrderDetails: undefined,\n                pushTime: undefined,\n                warehouseCode: undefined,\n                workshopCode: undefined\n            },\n            listLoading: true,\n            isEaid: false,\n            orgCode: undefined,\n            isEdit: true,\n            parentsRows1: undefined,\n            gw: undefined,\n            feedArea: undefined,\n            temp: {\n                state: undefined,\n                remark: undefined,\n                rowNo: undefined,\n                materielCode: undefined,\n                materielName: undefined,\n                orgCode: undefined,\n                productionline: undefined,\n                station: undefined,\n                feedType: undefined,\n                batchNumber: undefined,\n                leadTime: undefined,\n                feedTime: undefined,\n                feedwarehouse: undefined,\n                workShop: undefined,\n                goodsReadyEmpName: undefined,\n                materialputEmpName: undefined\n            },\n            xzwlDialogFormVisible: undefined,\n            blPersonnelDialogFormVisible1: undefined,\n            tlPersonnelDialogFormVisible2: undefined,\n            rules: {\n                factory: [{ required: true, message: \"请选择\", trigger: \"blur\" }],\n                pushMaterialType: [\n                    { required: true, message: \"请选择\", trigger: \"blur\" }\n                ],\n                lineCode: [{ required: true, message: \"请选择\", trigger: \"blur\" }],\n                workshopCode: [{ required: true, message: \"请选择\", trigger: \"blur\" }],\n                warehouseCode: [{ required: true, message: \"请选择\", trigger: \"blur\" }],\n                goodsReadyTime: [\n                    { required: true, message: \"请选择\", trigger: \"blur\" }\n                ],\n                pushTime: [\n                    { required: true, message: \"请选择\", trigger: \"blur\" },\n                    { validator: compareDate, trigger: \"blur\" }\n                ]\n            },\n            // measureCode: undefined,\n            selectCode: [],\n            dialogFormVisible: false,\n            dialogFormVisible1: false,\n            employeeDialogFormVisible: false,\n            dialogPrintVisible: false,\n            printData: {},//打印数据\n            dialogStatus: \"\",\n            DICT_CODE: DICT_CODE,\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            // dimensionOptions: DICT_CODE,\n            THE_STATE_OPTIONS: THE_STATE_OPTIONS\n        }\n    },\n    watch: {\n        'temp.orgCode': {\n            handler (newValue) {\n                this.temp.orgCode = newValue\n            },\n            deep: true,\n            immediate: true\n        }\n    },\n    computed: {\n        ...mapGetters([\"name\", \"superRoles\"]),\n        ...mapState({\n            dt_pushmaterial_type: state => state.dict.dt_pushmaterial_type,\n            dt_pushmaterial_state: state => state.dict.dt_pushmaterial_state\n        })\n    },\n    mounted () {\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.$store.dispatch(\"dict/getDicData\", [\n            \"dt_pushmaterial_type\",\n            \"dt_pushmaterial_state\",\n            \"dt_station_type\"\n        ])\n        this.getList()\n    },\n    methods: {\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 195\n        },\n        changeGw (stationCode, index) {\n            this.dataFormList[index].feedArea = this.getFeedArea(stationCode)\n        },\n        getFeedArea (a) { //根据工位查投控区\n            let b\n            b = this.gw.filter(n => {\n                return n.stationCode === a\n            }).map(v => {\n                return v.feedArea\n            })\n            this.tkq = b[0]\n            return this.tkq\n        },\n        cxgw () { //查询工位\n            api.queryRecordsgw(this.temp.lineCode).then(response => {\n                response = response.data\n                this.gw = response\n            })\n        },\n        queryworkshop (v) { //查询车间仓库\n            this.temp.workshopCode = v[0].feedArea\n        },\n\n        getList () { //查询主表\n            if (this.superRoles) {\n                this.listQuery.creator = null\n            } else {\n                this.listQuery.creator = this.name\n            }\n            if (this.tlDate) {\n                var d1 = this.tlDate[0]\n                var d2 = this.tlDate[1]\n                this.listQuery.pushTimeStart = d1\n                this.listQuery.pushTimeEnd = d2\n            } else {\n                this.listQuery.pushTimeStart = \"\"\n                this.listQuery.pushTimeEnd = \"\"\n            }\n            //  this.listQuery.pushMaterialState='push10'\n            api.queryRecords(this.listQuery).then(response => {\n                response = response.data\n                this.list = response.list\n                this.total = response.pages.count\n                if (this.total == 0) {\n                    this.subList = []\n                }\n                this.$nextTick(function () {\n                    this.checked()\n                })\n            })\n        },\n        checked () {\n            this.$refs.tb.toggleRowSelection(this.list[0], true)//官网方法，重点\n        },\n        getItemsList () {  //查询订单明细\n            this.listQueryItems.pushOrderCode = this.selectlistRow.pushOrderCode\n            api.queryRecorditems(this.listQueryItems).then(response => {\n                response = response.data\n                this.subList = response.list\n                this.total1 = response.pages.count\n            })\n        },\n        handlegPersonnel1 () {  //业务人员（备料员）\n            this.blPersonnelDialogFormVisible1 = true\n            //  this.$refs.ww1.dd1()\n        },\n        handlegPersonnel2 () { //业务人员（投料员）\n            this.tlPersonnelDialogFormVisible2 = true\n            // this.$refs.ww2.dd1()\n        },\n        update4 () {  //备料员中弹窗确认按钮\n            if (this.parentsRows3 && this.parentsRows3.length == 1) {\n                // this.temp.supplierCode = this.parentsRows3[0].employeeCode;\n                this.temp.goodsReadyEmpName = this.parentsRows3[0].employeeName\n                this.blPersonnelDialogFormVisible1 = false\n            } else {\n                this.$message({\n                    title: this.$t(\"message.warning\"),\n                    message: this.$t(\"message.checkedoneplease\"),\n                    type: \"warning\"\n                })\n            }\n        },\n\n        update5 () { //投料员中弹窗确认按钮\n            if (this.parentsRows4 && this.parentsRows4.length == 1) {\n                // this.temp.supplierCode = this.parentsRows3[0].employeeCode;\n                this.temp.pushEmpName = this.parentsRows4[0].employeeName\n                this.tlPersonnelDialogFormVisible2 = false\n            } else {\n                this.$message({\n                    title: this.$t(\"message.warning\"),\n                    message: this.$t(\"message.checkedoneplease\"),\n                    type: \"warning\"\n                })\n            }\n        },\n        purchasingPersonnels (row) { //业务人员选中行(备料员)\n            this.parentsRows3 = row\n        },\n        purchasingPersonnels1 (row) { //业务人员选中行(投料员)\n            this.parentsRows4 = row\n        },\n        handleQuery () {\n            this.listQuery.currentPage = 1\n            this.getList()\n        },\n        handleCreate () { //新增\n            this.resetTemp()\n            this.dialogStatus = \"create\"\n            this.Edit = false\n            // this.temp.pushOrderCode=this.selectlistRow.pushOrderCode\n            this.cxgw()\n            this.dialogFormVisible = true\n            this.dataFormList = []\n        },\n        orgname (name) {\n            this.dto.orgName = name\n        },\n        linename (name) {\n            this.dto.lineName = name\n        },\n        create () { //新增\n            // this.dto = this.temp;\n            this.dto.goodsReadyEmp = this.temp.goodsReadyEmp\n            this.dto.goodsReadyEmpName = this.temp.goodsReadyEmpName\n            this.dto.goodsReadyTime = this.temp.goodsReadyTime\n            this.dto.lineCode = this.temp.lineCode\n            this.dto.note = this.temp.note\n            this.dto.orgCode = this.temp.orgCode\n            this.dto.pushEmpName = this.temp.pushEmpName\n            this.dto.pushMaterialType = this.temp.pushMaterialType\n            this.dto.pushOrderCode = this.temp.pushOrderCode\n            this.dto.pushTime = this.temp.pushTime\n            this.dto.warehouseCode = this.temp.warehouseCode\n            this.dto.workshopCode = this.temp.workshopCode\n            this.dto.method = \"MODIFY\"\n            this.dto.pushOrderDetails = this.dataFormList\n            api.addRecord(this.dto).then(() => {\n                this.getList()\n                this.dialogFormVisible = false\n                this.$message({\n                    title: this.$t(\"message.success\"),\n                    message: this.$t(\"message.createSuccessed\"),\n                    type: \"success\",\n                    duration: 2000\n                })\n                this.dataFormList = []\n            })\n        },\n\n        handleDelete () { //删除\n            if (this.selectlistRow) {\n                this.$confirm(this.$t(\"message.isDeleteContinue\"),\n                    this.$t(\"message.prompt\"), {\n                    confirmButtonText: this.$t(\"message.confirm\"),\n                    cancelButtonText: this.$t(\"message.cancel\"),\n                    type: \"warning\"\n                }).then(() => {\n                    api.deleteRecord(this.selectlistRow.pushOrderCode).then(() => {\n                        this.getList()\n                        this.$message({\n                            title: this.$t(\"message.success\"),\n                            message: this.$t(\"message.deleteSuccessed\"),\n                            type: \"success\",\n                            duration: 2000\n                        })\n                    })\n                }).catch(() => {\n                    this.$message({\n                        type: \"info\",\n                        message: this.$t(\"message.deleteCanceled\")\n                    })\n                })\n\n            } else {\n                this.$message({\n                    title: this.$t(\"message.warning\"),\n                    message: this.$t(\"message.checkedoneplease\"),\n                    type: \"warning\",\n                    duration: 2000\n                })\n            }\n        },\n        handleCreatewl () {//新增物料\n            if (this.temp.orgCode && this.temp.lineCode && this.temp.pushMaterialType && this.temp.warehouseCode) {\n                this.xzwlDialogFormVisible = true\n                this.Edit = true\n                this.orgCode = this.temp.orgCode\n                this.$nextTick(() => {\n                    this.$refs.wlxzRef.listSelected = [...this.dataFormList]\n                    this.$refs.wlxzRef.getList()\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请先选择组织,生产线,投料类型,投料仓库\",\n                    type: \"warning\",\n                    duration: 2000\n                })\n            }\n        },\n        materialxz () {\n            if (this.$refs.wlxzRef.listSelected.length > 0) {\n                this.dataFormList = this.$refs.wlxzRef.listSelected.map(v => {\n                    v.snp = v.stockContain\n                    return v\n                })\n                this.xzwlDialogFormVisible = false\n            } else {\n                this.$message({\n                    title: this.$t(\"message.warning\"),\n                    message: this.$t(\"message.checkedplease\"),\n                    type: \"warning\"\n                })\n            }\n        },\n        selectPartRow (rows) { //父子通信\n            this.parentsRows = rows\n        },\n        handleDeleteitems () {//删除物料\n            if (this.selectlistRow4.length !== 0) {\n                this.$confirm(\"确认要删除该数据项吗?\", \"提示\", {\n                    confirmButtonText: \"确定\",\n                    cancelButtonText: \"取消\",\n                    type: \"warning\"\n                }).then(() => {\n                    this.dataFormList = this.dataFormList.filter(item => {\n                        let isD = true\n                        this.selectlistRow4.forEach((itemr) => {\n                            if (itemr.materielCode === item.materielCode) {\n                                isD = false\n                            }\n                        })\n                        return isD\n                    })\n\n                    this.$message({\n                        type: \"success\",\n                        message: \"删除成功\"\n                    })\n                }).catch(() => {\n                    this.$message({\n                        type: \"info\",\n                        message: \"已取消\"\n                    })\n                })\n            } else {\n                this.$message.warning(\"请勾选记录！\")\n                return\n            }\n        },\n\n        handleUpdate () {//编辑 \n            this.resetTemp()\n            if (this.selectlistRow) {\n                if (this.selectlistRow.pushMaterialState !== \"push30\") {\n                    this.temp = this.selectlistRow\n                    this.Edit = true\n                    api.queryRecorditems(this.temp).then(response => {\n                        response = response.data\n                        this.dataFormList = response\n                        this.total2 = response.length\n                    })\n                    this.cxgw()\n                    this.dialogFormVisible = true\n                    this.dialogStatus = \"update\"\n                } else {\n                    this.$message({\n                        title: \"警告\",\n                        message: \"发布状态下不可编辑\",\n                        type: \"warning\",\n                        duration: 2000\n                    })\n                }\n\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\",\n                    duration: 2000\n                })\n            }\n        },\n\n        update () {//编辑\n            this.temp.pushOrderDetails = this.dataFormList\n            this.temp.method = \"MODIFY\"\n            api.updateRecord(this.selectlistRow.pushOrderCode, this.temp).then(() => {\n                this.dialogFormVisible = false\n                this.$message({\n                    title: \"成功\",\n                    message: \"编辑成功\",\n                    type: \"success\",\n                    duration: 2000\n                })\n                this.getList()\n                this.getItemsList()\n            })\n        },\n        handleDblclickgysxz (row) { //父子页面通信\n            this.parentsRows = row\n            // this.gysxzDialogFormVisible = false;\n        },\n        handlezf () {//作废\n            if (this.selectlistRow) {\n                this.selectlistRow.pushOrderDetails = this.subList\n                this.selectlistRow.method = \"CANCELLATION\"\n                api.updateRecord(this.selectlistRow.pushOrderCode, this.selectlistRow).then(() => {\n                    this.$message({\n                        title: \"成功\",\n                        message: \"作废成功\",\n                        type: \"success\",\n                        duration: 2000\n                    })\n                    this.getList()\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\",\n                    duration: 2000\n                })\n            }\n        },\n        handlePublish () {//发布\n            if (this.selectlistRow) {\n                this.selectlistRow.pushOrderDetails = this.subList\n                this.selectlistRow.method = \"PUBLISH\"\n                api.updateRecord(this.selectlistRow.pushOrderCode, this.selectlistRow).then(() => {\n                    this.$message({\n                        title: \"成功\",\n                        message: \"发布成功\",\n                        type: \"success\",\n                        duration: 2000\n                    })\n                    this.getList()\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\",\n                    duration: 2000\n                })\n            }\n        },\n        handleCancel () {//关闭\n            if (this.selectlistRow) {\n                this.selectlistRow.pushOrderDetails = this.subList\n                this.selectlistRow.method = \"CLOSE\"\n                api.updateRecord(this.selectlistRow.pushOrderCode, this.selectlistRow).then(() => {\n                    this.$message({\n                        title: \"成功\",\n                        message: \"关闭成功\",\n                        type: \"success\",\n                        duration: 2000\n                    })\n                    this.getList()\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\",\n                    duration: 2000\n                })\n            }\n        },\n        //打印\n        receiptPrint () {\n            if (this.selectlistRow) {\n                this.dialogPrintVisible = true\n                this.dialogStatus = \"print\"\n                this.printData = this.selectlistRow\n                this.$nextTick(() => {\n                    this.$refs.childQRcode.qrCreate(this.printData.pushOrderCode)\n                })\n\n            } else {\n                this.$message.warning(this.$t('message.checkedplease'))\n                return false\n            }\n\n        },\n        //打印执行\n        doReceiptPrint () {\n            let newWin = window.open(\"\")\n            var newstr = document.getElementById('receipt').innerHTML\n            newWin.document.write(newstr)\n            newWin.document.close()//IE添加\n\n            setTimeout(function () {\n                newWin.print()\n                newWin.close()\n            }, 100)\n        },\n        update1 () {//供应商选中弹窗确认按钮\n            if (this.parentsRows.length && this.parentsRows.length == 1) {\n                this.temp.supplierCode = this.parentsRows[0].supplierCode\n                this.temp.supplierName = this.parentsRows[0].supplierName\n                this.xzwlDialogFormVisible = false\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                })\n            }\n        },\n\n        handleDeleteBatch () {\n            if (this.selectCode.length == 0) {\n                this.$message.warning(\"请勾选记录！\")\n                return\n            }\n            this.delete(this.selectCode)\n        },\n        selectRow (val) {//表一复选框选中方法\n            this.selectlistRow = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.tb.clearSelection()\n                this.$refs.tb.toggleRowSelection(val.pop())\n            }\n            this.$refs.tb.setCurrentRow(this.selectlistRow)\n            if (this.selectlistRow) {\n                this.getItemsList()\n            }\n        },\n        selectRow1 (val) { //表二复选框选中方法\n            this.selectlistRow1 = val\n        },\n        showSubTable (val) {//表一单击行选中方法\n            this.selectlistRow2 = val\n            this.$refs.tb.clearSelection()\n            this.$refs.tb.toggleRowSelection(val)\n        },\n\n        selectRow3 (val) {//表二单击行选中方法\n            this.selectlistRow3 = val\n            // this.$refs.tb.clearSelection()\n            // this.$refs.tb.toggleRowSelection(val)//单击行绑定点击事件\n        },\n        selectRow4 (val) {\n            this.selectlistRow4 = val\n        },\n        cancel () {\n            this.dialogFormVisible = false\n        },\n        resetTemp () {\n            this.temp = {\n                orgCode: undefined,\n                pushMaterialType: undefined,\n                lineCode: undefined,\n                goodsReadyTime: undefined,\n                pushTime: undefined,\n                warehouseCode: undefined,\n                workshopCode: undefined,\n                goodsReadyEmpName: undefined,\n                pushEmpName: undefined,\n                note: undefined\n            }\n        },\n        handleClose () {\n            this.resetTemp()\n            this.$refs.temp.resetFields()\n        },\n        handleSelectionChange (selection) {\n            this.selectCode = selection.map(v => v.measureCode)\n        }\n    }\n};\n",null]}