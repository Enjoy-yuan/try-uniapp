{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/optNotice/optNoticeFormation/dialog/dialogRefplan.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/optNotice/optNoticeFormation/dialog/dialogRefplan.vue","mtime":1596610934037},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// import { createRecords, updateRecords } from \"@/api/productionMaterial/hand_pull_material\";\nimport { DICT_CODE } from '@/utils/constant'\nimport caiGou from '@/components/Select/xtpt/caigou'//下拉组件\nimport dialogGysxz from '@/components/Dialog/dialogsGysxz'//供应商选择\nimport { mapState } from \"vuex\"\n// import * as api from \"@/api/project/srm/supplierSelect/optNotice/optNoticeFormation\"\nimport * as api from \"@/api/project/srm/supplierSelect/optNotice/optNoticeFormation\"\n// import { queryRFQItems, queryRFQRecords } from \"@/api/project/srm/supplierSelect/supplierRFQ/supplierRFQAnswer\"\n\nexport default {\n    name: 'dialogAdd',\n    components: { caiGou, dialogGysxz },\n    props: ['unMutiple', 'title', 'curdialogStatus'],\n    data () {\n        return {\n            DICT_CODE: DICT_CODE,\n            isEdit: false,\n            iscgEdit: false,//采购是否可编辑\n            tableData: [],\n            formData: {\n\n            },\n            listSelected: null,//已选项\n            selectRowData: null,\n            dialogVisible: false,\n            rules: {\n                orgCode: [\n                    { required: true, message: '请选择', trigger: 'blur' }\n                ],\n                materielClassName: [\n                    { required: true, message: '请选择', trigger: 'blur' }\n                ],\n                remark: [\n                    { max: 128, message: '长度应小于128个字符', trigger: 'blur' }\n                ]\n            },\n\n            dialogConfig: [\n                { title: '供应商信息', isRequired: false, unMutiple: false },\n                { title: '申请人选择', unMutiple: true, propCode: 'creator', propName: 'creatorName' },\n                { title: '选择物料分类信息', isRequired: false, unMutiple: true }\n            ]\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_pc1: state => state.dict.dt_srm_pc1,//供应商定位 合作层次\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pc1\"])\n    },\n    watch: {\n        'rangeDate' (value) {\n            if (value) {\n                this.listQuery.startDate = value[0]\n                this.listQuery.endDate = value[1]\n            }\n        },\n    },\n    methods: {\n        selectName (val) {\n            this.formData.orgName = val\n        },\n        selectMain (selection, row) {\n            console.log(selection, row, 'yyyy')\n            // this.tableData.forEach((item, indexa) => {\n            //     selection.forEach(val => {\n            //         if (item.rfqNo == val.rfqNo) {\n            //             val.rfqReplyItemVOS.forEach((v, index) => {\n            //                 console.log(v)\n            //                 this.$nextTick(() => {\n            //                     console.log(indexa, index, 'index')\n            //                     this.$refs.tbSub.toggleRowSelection(this.tableData[indexa].rfqReplyItemVOS[index], true)\n            //                 })\n            //             })\n            //         }\n            //     })\n            // })\n            // if (selection.length == 0 && row) {\n            //     this.$refs.tbSub.clearSelection()\n            // }\n        },\n        handleQuery () {\n            if (this.formData.orgCode) {\n                let dto = {\n                    orgCode: this.formData.orgCode,\n                    selectedState: 1\n                }\n                api.queryRFQRecordsCKBJ(dto).then(res => {\n                    console.log(res, '987654')\n                    this.tableData = res.data.list.map(v => {\n                        v.rfqReplyItemVOS.forEach(val => {\n                            val.supplierCode = v.supplierCode\n                            val.supplierName = v.supplierName\n                            val.planNo = v.planNo\n                        })\n                        return v\n                    })\n                })\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择组织编码',\n                    type: 'warning'\n                })\n            }\n        },\n        handleConfirm () {\n            this.$refs.refForm.validate((valid) => {\n                if (valid) {\n                    this.$confirm('确认保存吗?', '提示', {\n                        confirmButtonText: '确定',\n                        cancelButtonText: '取消',\n                        type: 'warning'\n                    }).then(() => {\n                        let dto = {\n                            businessType: this.formData.businessType,\n                            content: this.formData.content,\n                            orgCode: this.formData.orgCode,\n                            orgName: this.formData.orgName,\n                            remark: this.formData.remark,\n                            materialDTOS: []\n                        }\n                        if (this.selectlistRow) {\n                            console.log(this.selectlistRow, 'kkkllll')\n                            this.selectlistRow.forEach((val) => {\n                                val.rfqReplyItemVOS.forEach(v => {\n                                    dto.materialDTOS.push(v)\n                                })\n                                // dto.materialDTOS[index] = val.rfqReplyItemVOS\n                            })\n                        }\n                        if (this.selectlistRowSub) {\n                            this.selectlistRowSub.forEach(val => {\n                                dto.materialDTOS.push(val)\n                            })\n                        }\n                        dto.materialDTOS.map(v => {\n                            v.materialCode = v.materielCode\n                            v.materialName = v.materielName\n                            v.materialClass = v.materielClass\n                            v.materialClassName = v.materielClassName\n                            return v\n                        })\n                        console.log(dto, '9999')\n                        api.createPlan(dto).then(() => {\n                            this.$message({\n                                title: '成功',\n                                message: '保存成功',\n                                type: 'success',\n                                duration: 2000\n                            })\n                        })\n                        this.dialogVisible = false\n                        this.$emit('refresh')\n                    }).catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消'\n                        })\n                    })\n                }\n            })\n        },\n        initForm (type, row) {\n            console.log(type, row)\n            this.tableData = [{\n                index: 0,\n                orgCode: 1,\n                tableInnerData: [\n                    {\n                        index: 0,\n                        materielCode: '0001',\n                        materielName: 'XXX'\n                    }\n                ]\n            }]\n            // if (type === 'add') {\n            //     this.$nextTick(() => {\n            //         // this.$refs['refForm'].resetFields()\n            //         // this.$refs['refForm'].clearValidate()\n            //         // this.$set(this.formData, 'proposalItemDTOs', [])\n            //         // this.$set(this.formData, 'creator', this.domainCode)\n            //         // this.$set(this.formData, 'creatorName', this.domainCodeName)\n            //         for (let key in this.formData) {\n            //             for (let par in row) {\n            //                 if (key === par) {\n            //                     this.$set(this.formData, key, row[key])\n            //                 }\n            //             }\n            //         }\n            //     })\n            // } else {\n            //     for (let key in this.formData) {\n            //         for (let par in row) {\n            //             if (key === par) {\n            //                 if (row[key]) {\n            //                     this.$set(this.formData, key, row[key])\n            //                 }\n            //             }\n            //         }\n            //     }\n            // }\n        },\n        showGys () {\n            this.$refs.refGys.getList()\n            this.$refs.refGys.dialogVisible = true\n        },\n        //供应商确认\n        handleGysClick (gysRows) {\n            this.$set(this.formData, 'supplierCode', gysRows[0].supplierCode)\n            this.$set(this.formData, 'supplierName', gysRows[0].supplierName)\n        },\n        setOrgName (name) {\n            this.formData.orgName = name\n        },\n        // 表格选择框选中 注:参数为选中的所有行的数组\n        selectChange (val) {\n            this.selectlistRow = val\n\n        },\n        selectChangeSub (val) {\n            this.selectlistRowSub = val\n\n        },\n        resetTemp () {\n            this.formData = {\n                orgCode: undefined,\n                supplierName: undefined,\n                planNo: undefined,\n                businessType: undefined,\n                content: undefined,\n                remark: undefined,\n                tableData: []\n            }\n        }\n    }\n}\n",null]}