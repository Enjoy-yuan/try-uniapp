{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/materielTransferType/dialog/dialogAddSub1.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/materielTransferType/dialog/dialogAddSub1.vue","mtime":1596610933334},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n    createSub1,\n    updateSub1,\n    getAttrRules,\n    getAttrRulesDetail\n} from '@/api/data-base/material_transfer_type'\nimport { mapState } from 'vuex'\nexport default {\n    name: 'addSub1',\n    components: {},\n    data () {\n        return {\n            referData: [],\n            booleanValue: [\n                [\n                    {\n                        value: '1',\n                        label: '是'\n                    },\n                    {\n                        value: '0',\n                        label: '否'\n                    }\n                ],\n                [\n                    {\n                        value: 1,\n                        label: '有效'\n                    },\n                    {\n                        value: 0,\n                        label: '无效'\n                    }\n                ],\n                [\n                    {\n                        value: 1,\n                        label: '+'\n                    },\n                    {\n                        value: 0,\n                        label: '-'\n                    }\n                ]\n            ],\n            selectRows: [],\n            obList: [],\n            obListDefault: [],\n            AddSublist: {\n                wareRuleCode: '',\n                wareRuleName: '',\n                refRowId: '', //更新对象id\n                objectType: '', //主体或明细\n                updateObject: '', //更新对象code\n                status: '',\n                description: '',\n                refSources: '',\n                linkPrimaryKeyOne: '',\n                linkPrimaryKeyTwo: '',\n                updatePrimaryKeyOne: '',\n                serviceName: '',\n                updatePrimaryKeyTwo: '',\n                wareRuleTriggerDetails: []\n            },\n            dialogStatus: 0,\n            dialogFormVisible: false,\n            rules: {\n                refSources: [\n                    {\n                        required: true,\n                        message: this.$t('validate.required'),\n                        trigger: 'blur'\n                    }\n                ],\n                updateObject: [\n                    {\n                        required: true,\n                        message: this.$t('validate.required'),\n                        trigger: 'blur'\n                    }\n                ],\n                status: [\n                    {\n                        required: true,\n                        message: this.$t('validate.required'),\n                        trigger: 'blur'\n                    }\n                ],\n                updatePrimaryKeyTwo: [\n                    {\n                        required: true,\n                        message: this.$t('validate.required'),\n                        trigger: 'blur'\n                    }\n                ],\n                serviceName: [\n                    {\n                        required: true,\n                        message: this.$t('validate.required'),\n                        trigger: 'blur'\n                    }\n                ],\n                updatePrimaryKeyOne: [\n                    {\n                        required: true,\n                        message: this.$t('validate.required'),\n                        trigger: 'blur'\n                    }\n                ],\n                linkPrimaryKeyOne: [\n                    {\n                        required: true,\n                        message: this.$t('validate.required'),\n                        trigger: 'blur'\n                    }\n                ],\n                linkPrimaryKeyTwo: [\n                    {\n                        required: true,\n                        message: this.$t('validate.required'),\n                        trigger: 'blur'\n                    }\n                ]\n            }\n        }\n    },\n    mounted () {\n        this.$store.dispatch('dict/getDicData', ['dt_referdata_resource'])\n    },\n    computed: {\n        ...mapState({\n            dt_referdata_resource: state => state.dict.dt_referdata_resource\n        })\n    },\n    methods: {\n        getAttrRule (val) {\n            let queryRules = {\n                referentType: val\n            }\n            getAttrRules(queryRules).then(res => {\n                this.obListDefault = res.data\n                this.obList = res.data\n            })\n        },\n        changeObject () {\n            this.AddSublist.wareRuleTriggerDetails = []\n            this.setObject()\n        },\n        setObject () {\n            this.obList.forEach(item => {\n                if (item.referentObject === this.AddSublist.updateObject) {\n                    this.AddSublist.refRowId = item.rowId\n                    this.AddSublist.objectType = item.objectType\n                }\n            })\n        },\n        addSubConfirm () {\n            this.$refs.subform.validate(valid => {\n                if (valid) {\n                    createSub1(\n                        this.AddSublist.wareRuleCode,\n                        this.AddSublist\n                    ).then(() => {\n                        this.$message.success(this.$t('message.successed'))\n                        this.$emit('refresh')\n                        this.dialogFormVisible = false\n                    })\n                }\n            })\n        },\n        updateSubConfirm () {\n            this.$refs.subform.validate(valid => {\n                if (valid) {\n                    updateSub1(\n                        this.AddSublist.wareRuleCode,\n                        this.AddSublist.updateObject,\n                        this.AddSublist\n                    ).then(() => {\n                        this.$message.success(this.$t('message.successed'))\n                        this.$emit('refresh')\n                        this.dialogFormVisible = false\n                    })\n                }\n            })\n        },\n        //编辑时加载行\n        setTableRow (id) {\n            if (this.referData.length === 0) {\n                getAttrRulesDetail(id).then(res => {\n                    this.referData = res.data\n                })\n            }\n        },\n        addTableRow () {\n            if (this.AddSublist.updateObject) {\n                if (\n                    this.AddSublist.wareRuleTriggerDetails.length === 0 ||\n                    this.referData.length === 0\n                ) {\n                    getAttrRulesDetail(this.AddSublist.refRowId).then(res => {\n                        this.referData = res.data\n                        let newValue = {\n                            refItemRowId: null,\n                            updateConfig: '',\n                            updateConfigName: '',\n                            updateDirection: '',\n                            updateObject: this.AddSublist.updateObject,\n                            wareRuleCode: this.AddSublist.wareRuleCode\n                        }\n                        this.AddSublist.wareRuleTriggerDetails.push(newValue)\n                    })\n                } else {\n                    let newValue = {\n                        refItemRowId: null,\n                        updateConfig: '',\n                        updateConfigName: '',\n                        updateDirection: '',\n                        updateObject: this.AddSublist.updateObject,\n                        wareRuleCode: this.AddSublist.wareRuleCode\n                    }\n                    this.AddSublist.wareRuleTriggerDetails.push(newValue)\n                }\n            } else {\n                this.$message.warning('请先选择更新对象')\n            }\n        },\n        deleteTableRow () {\n            this.AddSublist.wareRuleTriggerDetails = this.AddSublist.wareRuleTriggerDetails.filter(\n                item => {\n                    if (item.updateConfig === this.selectRows[0].updateConfig) {\n                        return false\n                    } else {\n                        return true\n                    }\n                }\n            )\n        },\n        //表格勾选框选中\n        selectRow (val) {\n            this.selectRows = val\n        },\n        setUpdateConfig (row) {\n            this.AddSublist.wareRuleTriggerDetails.forEach((item, index) => {\n                if (item.refItemRowId === row.refItemRowId) {\n                    this.referData.forEach(itemr => {\n                        if (itemr.rowId === item.refItemRowId) {\n                            this.AddSublist.wareRuleTriggerDetails[\n                                index\n                            ].updateConfig = itemr.attributeCode\n                            this.AddSublist.wareRuleTriggerDetails[\n                                index\n                            ].updateConfigName = itemr.attributeName\n                        }\n                    })\n                }\n            })\n        },\n        //change事件\n        getAttrRuleChange (val) {\n            let queryRules = {\n                referentType: val\n            }\n            getAttrRules(queryRules).then(res => {\n                this.obList = res.data\n            })\n        },\n        //选择参照数据来源变化时状态变化\n        changeReferData (val) {\n            if (val) {\n                this.getAttrRuleChange(val)\n            } else {\n                this.obList = this.obListDefault\n            }\n        }\n    }\n}\n",null]}