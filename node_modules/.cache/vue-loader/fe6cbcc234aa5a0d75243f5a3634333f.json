{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/components/UserAvatar/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/components/UserAvatar/index.vue","mtime":1596610933184},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getUserAvatar, userAvatar } from '@/api/system/user'\nexport default {\n    computed: {\n        myHeader () {\n            return {\n                authToken: window.sessionStorage.getItem('authToken')\n            }\n        }\n    },\n    created () {\n        this.handleAvatarSuccess()\n    },\n    data () {\n        return {\n            imageUrl: null\n        }\n    },\n    methods: {\n        upLoad (file) {\n            const formData = new FormData()\n            formData.append('file', file.file)\n            userAvatar(formData)\n                .then(() => {\n                    this.handleAvatarSuccess()\n                })\n                .catch(() => {\n                    this.$message.error('上传失败，请重新上传')\n                })\n        },\n        handleAvatarSuccess () {\n            getUserAvatar()\n                .then(res => {\n                    //获取用户头像信息\n                    return (\n                        'data:image/png;base64,' +\n                        btoa(\n                            new Uint8Array(res.data).reduce(\n                                (data, byte) =>\n                                    data + String.fromCharCode(byte),\n                                ''\n                            )\n                        )\n                    )\n                })\n                .then(data => {\n                    this.imageUrl = data || ''\n                })\n        },\n        beforeAvatarUpload (file) {\n            const isJPG = file.type === 'image/jpeg'\n            const isPNG = file.type === 'image/png'\n            const isGIF = file.type === 'image/gif'\n            const isLt2M = file.size / 1024 < 200 //图片大小不能超过65k\n\n            if (!isJPG && !isPNG && !isGIF) {\n                this.$message.error('上传头像图片只能是 JPG/PNG/GIF 格式!')\n            }\n            if (!isLt2M) {\n                this.$message.error('上传头像图片大小不能超过 200k!')\n            }\n            // return isJPG && isLt2M;\n            return isLt2M && (isJPG || isPNG || isGIF)\n        }\n    }\n}\n",null]}