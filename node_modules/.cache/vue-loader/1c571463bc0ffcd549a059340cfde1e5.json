{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/ESC/definePointInspectionPlan/tab3.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/ESC/definePointInspectionPlan/tab3.vue","mtime":1596610933409},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/project/eas/ESC/definePointInspectionPlan'\nimport Pagination from '@/components/Pagination'\nimport eqmtSelect from '../../components/eqmtSelect'\nimport pcSelect from '../../components/pointCheckStandardSelect'\n\nexport default {\n    name: 'tab3',\n    components: { Pagination, eqmtSelect, pcSelect },\n    data () {\n        return {\n            list: [],\n            total: 0,\n            theight: 0, //表格高度\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10\n            },\n            selectlistRow: [],\n            tempRow: undefined,\n            wlxzDialogVisible: false,\n            pcVisible: false,\n            tableKey: [0]\n        }\n    },\n    created () {\n        this.getList()\n    },\n\n    mounted () {\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.getList()\n    },\n    methods: {\n        handleCheck () {\n            if (!this.selectlistRow.length) {\n                this.$message({\n                    title: '警告',\n                    message: '请选择设备',\n                    type: 'warning'\n                })\n                return\n            }\n            this.pcVisible = true\n            this.tempRow = undefined\n        },\n        handleCheckRow (row) {\n            this.pcVisible = true\n            this.tempRow = row\n        },\n        getList () {\n            if (this.$parent.$parent.$parent.selectlistRow.length) {\n                api.queryDpipEqmt(\n                    this.$parent.$parent.$parent.selectlistRow[0]\n                        .inspectionPlanCode,\n                    this.listQuery\n                ).then(res => {\n                    this.list = res.data.list\n                    this.total = res.data.pages.count\n                })\n            }\n        },\n\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight()\n        },\n\n        handleCreate () {\n            if (!this.$parent.$parent.$parent.selectlistRow.length) {\n                this.$message({\n                    title: '警告',\n                    message: '请选择计划',\n                    type: 'warning'\n                })\n                return false\n            }\n            this.wlxzDialogVisible = true\n            setTimeout(() => {\n                this.$forceUpdate()\n                this.$refs.eqmtSelect.getList(\n                    this.$parent.$parent.$parent.selectlistRow[0].orgCode\n                )\n                this.$refs.eqmtSelect.currentSelect = []\n            }, 0)\n        },\n\n        handleDelete () {\n            if (!this.selectlistRow.length) {\n                this.$message({\n                    title: '警告',\n                    message: '请选择设备',\n                    type: 'warning'\n                })\n                return\n            }\n            //删除列表\n            api.deleteDpipEqmt(\n                this.$parent.$parent.$parent.selectlistRow[0]\n                    .inspectionPlanCode,\n                this.selectlistRow.map(item => item.rowId).join(',')\n            ).then(() => {\n                this.getList(),\n                    this.$message({\n                        title: '成功',\n                        message: '删除成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n            })\n        },\n        update () {\n            api.addDpipEqmt(\n                this.$parent.$parent.$parent.selectlistRow[0]\n                    .inspectionPlanCode,\n                this.$refs.eqmtSelect.currentSelect\n            ).then(res => {\n                if (res.status == 201) {\n                    this.getList(\n                        this.$parent.$parent.$parent.selectlistRow[0]\n                            .inspectionPlanCode\n                    )\n                    this.$message({\n                        title: '成功',\n                        message: '添加成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n                    this.wlxzDialogVisible = false\n                }\n            })\n        },\n        updateCheck () {\n            if (!this.tempRow) {\n                api.addEqmtAllCheck(\n                    this.$parent.$parent.$parent.selectlistRow[0]\n                        .inspectionPlanCode,\n                    {\n                        deviceCodes: this.selectlistRow.map(\n                            item => item.deviceCode\n                        ),\n                        inspectionPlanDeviceIns: this.$refs.pcSelect\n                            .currentSelect\n                    }\n                ).then(res => {\n                    if (res.status == 201) {\n                        this.$message({\n                            title: '成功',\n                            message: '点检项批量添加成功',\n                            type: 'success',\n                            duration: 2000\n                        })\n                        this.pcVisible = false\n                        this.getList()\n                    }\n                })\n                return\n            }\n            api.addEqmtCheck(\n                this.$parent.$parent.$parent.selectlistRow[0]\n                    .inspectionPlanCode,\n                this.tempRow.deviceCode,\n                this.$refs.pcSelect.currentSelect\n            ).then(res => {\n                if (res.status == 201) {\n                    this.$message({\n                        title: '成功',\n                        message: '点检项添加成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n                    this.pcVisible = false\n                    this.getList()\n                }\n            })\n        },\n        // 获取表格选中时的数据\n        selectRow (val) {\n            this.selectlistRow = val\n        },\n        //主表行点击\n        showSubTable (val) {\n            this.$refs.mainList.toggleRowSelection(val, 'selected')\n        }\n    }\n}\n",null]}