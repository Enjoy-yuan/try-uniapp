{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/dialog/dialogQuote.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/dialog/dialogQuote.vue","mtime":1596610933761},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { createQuote, updateQuote, queryQuoteRow } from \"@/api/project/srm/supplierSelect/supplierRFQ/supplierRFQAnswer\"\nimport { mapState } from \"vuex\"\nimport { DICT_CODE } from '@/utils/constant'\nimport caiGou from '@/components/Select/xtpt/caigou'//下拉组件\nimport tabQuote from '../tab/tabQuote'\nimport tabYCLcost from '../tab/tabYCLcost'\nimport tabWGcost from '../tab/tabWGcost'\nimport tabZYcost from '../tab/tabZYcost'\nimport tabJGcost from '../tab/tabJGcost'\nimport tabBZcost from '../tab/tabBZcost'\nimport tabWLcost from '../tab/tabWLcost'\nimport dialogQuoteRef from './dialogQuoteRef' //参照报价\n\n\nexport default {\n    name: 'dialogQuote',\n    props: ['title'],\n    components: { caiGou, dialogQuoteRef, tabQuote, tabYCLcost, tabWGcost, tabZYcost, tabJGcost, tabBZcost, tabWLcost, },\n    data () {\n        return {\n            dialogVisible: false,\n            tabName: 'tabQuote',\n            methodType: 'add',\n            DICT_CODE: DICT_CODE,\n            orgCode: null,\n            params: null,\n            formData: {\n                rowId: null,\n                rfqNo: null,\n                supplierCode: null,\n                supplierName: null,\n                quotedDate: null,\n                materielCode: null,\n                materielName: null,\n                materielClass: null,\n                materielClassName: null,\n                weight: null,\n                settlementMethod: null,\n                otherMethod: null,\n                currency: null,\n                validDateStart: null,\n                validDateEnd: null,\n                designCost: null,\n                otherCost: null,\n                firstYearDecline: null,\n                secondYearDecline: null,\n                thirdYearDecline: null,\n                forthYearDecline: null,\n                fifthYearDecline: null,\n                remark: null,\n                totalQuotation: null\n            },\n            totalQuotation: {\n                designCost: 0,\n                financialCost: 0,\n                financialRate: 0,\n                logisticsCost: 0,\n                managementCost: 0,\n                managementRate: 0,\n                materielCode: 0,\n                materielName: 0,\n                otherCost: 0,\n                outsourcingCost: 0,\n                packingCost: 0,\n                processingCost: 0,\n                profit: 0,\n                profitRate: 0,\n                quotedDate: null,\n                rawMaterialCost: 0,\n                realPrice: 0,\n                recoveryValue: 0,\n                toolingCost: 0,\n                version: 0,\n                wasteLoss: 0\n            },\n            rules: {\n                settlementMethod: [\n                    { required: true, message: '请选择', trigger: 'blur' }\n                ]\n            },\n            formConfig: [\n                { type: 'commonInput', disabled: true, label: '供应商编码', prop: 'supplierCode', width: '' },\n                { type: 'commonInput', disabled: true, label: '供应商名称', prop: 'supplierName', width: '' },\n                { type: 'date', label: '报价时间', prop: 'quotedDate', width: '' },\n                { type: 'commonInput', disabled: true, label: '物料编码', prop: 'materielCode', width: '' },\n                { type: 'commonInput', disabled: true, label: '物料名称', prop: 'materielName', width: '' },\n                { type: 'commonInput', disabled: true, label: '物料分类', prop: 'materielClassName', width: '' },\n                { type: 'commonInput', label: '重量(KG)', prop: 'weight', width: '' },//wu\n                { type: 'dictSelect', dType: 'dt_srm_pdr', label: '结算方式', prop: 'settlementMethod', width: '' },//wu dict dt_srm_pdr\n                { type: 'commonInput', label: '其它方式说明', prop: 'otherMethod', width: '' },//wu\n                { type: 'dictSelect', dType: 'dt_srm_pdk', label: '币种', prop: 'currency', width: '' },//wu dict\n                { type: 'date', label: '有效期起', prop: 'validDateStart', width: '' },\n                { type: 'date', label: '有效期止', prop: 'validDateEnd', width: '' },\n                { type: 'commonInput', label: '设计/实验费用', prop: 'designCost', width: '' },\n                { type: 'commonInput', label: '其他费用', prop: 'otherCost', width: '' },\n\n                {\n                    type: 'inputArr', label: '承诺降幅', prop: 'prop4', width: '', inputArr: [\n                        { type: 'commonInput', label: '第一年', prop: 'firstYearDecline', width: '', styleObj: {} },\n                        { type: 'commonInput', label: '第二年', prop: 'secondYearDecline', width: '', styleObj: { marginLeft: '8px' } },\n                        { type: 'commonInput', label: '第三年', prop: 'thirdYearDecline', width: '', styleObj: { marginLeft: '8px' } },\n                        { type: 'commonInput', label: '第四年', prop: 'forthYearDecline', width: '', styleObj: { marginLeft: '8px' } },\n                        { type: 'commonInput', label: '第五年', prop: 'fifthYearDecline', width: '', styleObj: { marginLeft: '8px' } },\n                    ]\n                },\n                { type: 'textarea', label: '备注', prop: 'remark', width: '800px', rows: \"2\" }\n            ],\n            tabConfig: [\n                { label: '报价表', name: 'tabQuote', prop: 'tabQuote' },\n                { label: '原材料费用', name: 'tabYCLcost', prop: 'tabYCLcost' },\n                { label: '外购/协费用', name: 'tabWGcost', prop: 'tabWGcost' },\n                { label: '专用工装费用', name: 'tabZYcost', prop: 'tabZYcost' },\n                { label: '加工费用', name: 'tabJGcost', prop: 'tabJGcost' },\n                { label: '包装费用', name: 'tabBZcost', prop: 'tabBZcost' },\n                { label: '物流费用', name: 'tabWLcost', prop: 'tabWLcost' }\n            ],\n            dialogConfig: [\n                { title: '参照报价', unMutiple: false }\n            ],\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_pdr: state => state.dict.dt_srm_pdr,//结算方式\n            dt_srm_pdk: state => state.dict.dt_srm_pdk,//币种\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pdr\", \"dt_srm_pdk\"])\n    },\n    watch: {\n        'formData.designCost' (val) {\n            if (this.$refs.tabQuoteRef)\n                this.$refs.tabQuoteRef[0].changeFormValue('designCost', val)\n        },\n        'formData.otherCost' (val) {\n            if (this.$refs.tabQuoteRef)\n                this.$refs.tabQuoteRef[0].changeFormValue('otherCost', val)\n        }\n    },\n    methods: {\n        handleConfirm () {\n            this.$refs.formData.validate((valid) => {\n                if (valid) {\n                    this.$confirm('确认保存吗?', '提示', {\n                        confirmButtonText: '确定',\n                        cancelButtonText: '取消',\n                        type: 'warning'\n                    }).then(() => {\n                        if (this.methodType === 'add' && !this.formData.rowId) {\n                            let cdata = {\n                                method: \"ITEM\",\n                                quotationSource: 'notice',\n                                quotedProposalDTO: this.formData\n                            }\n                            // 后面注释掉\n                            cdata.quotedProposalDTO.quotationSource = 'notice'\n                            cdata.quotedProposalDTO.totalQuotation = this.totalQuotation\n                            cdata.quotedProposalDTO.totalQuotation.quotedDate = this.formData.quotedDate\n                            createQuote(cdata).then(res => {\n                                this.methodType = 'edit'\n                                this.formData.rowId = res.data\n                                this.$message({\n                                    type: 'success',\n                                    message: '新增报价成功'\n                                })\n                                this.dialogVisible = false\n                                this.$emit('refresh')\n                            })\n                        } else {\n                            let cdata = {\n                                method: \"ITEM\",\n                                quotationSource: 'notice',\n                                quotedProposalDTO: this.formData\n                            }\n                            // 后面注释掉\n                            cdata.quotedProposalDTO.quotationSource = 'notice'\n                            updateQuote(cdata).then(() => {\n                                this.$message({\n                                    type: 'success',\n                                    message: '编辑报价成功'\n                                })\n                                this.dialogVisible = false\n                                this.$emit('refresh')\n                            })\n                        }\n                    })\n                }\n            })\n        },\n        handleQuoteRef () {\n            this.$refs.refQuoteRef.dialogVisible = true\n        },\n        initForm (fdata, row) {\n            if (this.$refs['formData']) {\n                this.$refs['formData'].resetFields()\n                this.$refs['formData'].clearValidate()\n            }\n\n            if (row) {\n                for (let key in this.formData) {\n                    for (let par in row) {\n                        if (key === par) {\n                            this.$set(this.formData, key, row[key])\n                        }\n                    }\n                }\n            } else {\n                for (let key in this.formData) {\n                    this.$set(this.formData, key, null)\n                }\n            }\n\n            if (fdata) {\n                for (let key in this.formData) {\n                    for (let par in fdata) {\n                        if (key === par) {\n                            this.$set(this.formData, key, fdata[key])\n                        }\n                    }\n                }\n            }\n            if (row && row.totalQuotation) {\n                this.$nextTick(() => {\n                    this.$refs.tabQuoteRef[0].initTable(row.totalQuotation)\n                })\n            }\n        },\n        getTotalQuotation () {\n            queryQuoteRow(this.params).then(res => {\n                this.$nextTick(() => {\n                    this.$refs.tabQuoteRef[0].initTable(res.data.totalQuotation)\n                })\n            })\n        }\n    }\n}\n",null]}