{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/contractManage/supplierPerformance/dailyEvaluation/dailyEvaluate/dialog/addMain.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/contractManage/supplierPerformance/dailyEvaluation/dailyEvaluate/dialog/addMain.vue","mtime":1597995949078},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/project/srm/contractManage/dailyEvaluate'\nimport { queryRecords } from \"@/api/project/srm/dataBase/dictMaintenance\"\nimport { mapState } from \"vuex\"\nexport default {\n    data () {\n        return {\n            phaseList: [],\n            dialogVisible: false,\n            tableKey: 0,\n            list: [],\n            temp: {\n                evaluationNo: undefined,\n                supplierCode: undefined,\n                evaluationType: undefined,\n                evaluationCategory: undefined,\n                evaluationStageCN: undefined,\n                evaluationItem: undefined,\n                evaluationYear: undefined,\n                score: undefined,\n                grade: undefined,\n                evaluationTime: undefined,\n                remark: undefined,\n            },\n            type: ''\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_pak: state => state.dict.dt_srm_pak,   // 评价类型\n            dt_srm_pam: state => state.dict.dt_srm_pam,   // 综合等级\n            dt_srm_pb2: state => state.dict.dt_srm_pb2,   // 评价类别\n            dt_srm_pb3: state => state.dict.dt_srm_pb3,   // 评价阶段\n            dt_srm_pb4: state => state.dict.dt_srm_pb4,   // 评价项 \n            dt_srm_pb5: state => state.dict.dt_srm_pb5    // 评分方式\n        })\n    },\n    mounted () {\n        this.$store.dispatch('dict/getDicData', [\n            'dt_srm_pak',\n            'dt_srm_pam',\n            'dt_srm_pb2',\n            'dt_srm_pb3',\n            'dt_srm_pb4',\n            'dt_srm_pb5'\n        ])\n    },\n    watch: {\n        'temp.evaluationCategory' (val) {\n            if (!val) {\n                this.temp.evaluationStage = undefined\n                this.phaseList = []\n            } else {\n                this.getPhaseData(val)\n            }\n        },\n        'temp' (val) {\n            this.getList(val)\n        }\n    },\n    methods: {\n        getPhaseData (val) {\n            if (val) {\n                let dto = {\n                    currentPage: 1,\n                    pageSize: 15,\n                    parentCode: val\n                }\n                queryRecords(dto).then(res => {\n                    this.phaseList = res.data.list\n                })\n            }\n        },\n        getList (val) {\n            api.queryOneItem(val.rowId).then((res) => {\n                let options = [this.dt_srm_pb5]\n                this.list = this.$myFun.srmCodeToName(res.data, options, ['method'])\n                this.list.forEach((item, index) => {\n                    item.number = index + 1\n                })\n                // console.log(res, '22')\n            })\n\n        },\n        // 保存\n        handleSave () {\n            // 评分保存\n            if (this.type == 'grade') {\n                let dto = {\n                    gradeItemDTO: {\n                        evaluationNo: this.temp.evaluationNo,\n                        rowId: this.temp.rowId,\n                        grade: this.temp.grade,\n                        score: this.temp.score,\n                        remark: this.temp.remark,\n                        evaluationYear: this.temp.evaluationYear\n                    },\n                    method: \"GRADE\"\n                }\n                // console.log(JSON.stringify(dto))\n                api.submitRecord(this.temp.evaluationNo, this.temp.rowId, dto).then(() => {\n                    this.$message({\n                        title: '成功',\n                        type: 'success',\n                        message: '评分成功！',\n                        duration: 2000\n                    })\n                    this.dialogVisible = false\n                    this.$emit('handleSave', this.temp)\n                })\n            } else {\n                this.dialogVisible = false\n            }\n        }\n    }\n}\n",null]}