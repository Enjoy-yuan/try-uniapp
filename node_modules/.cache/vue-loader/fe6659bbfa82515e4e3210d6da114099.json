{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/dataBase/replaceDefinition/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/dataBase/replaceDefinition/index.vue","mtime":1597995949099},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/project/srm/dataBase/replaceDefinition'\nimport Pagination from '@/components/Pagination'\nimport { DICT_CODE } from '@/utils/constant'\nimport caiGou from '@/components/Select/xtpt/caigou'//下拉组件\nimport addMain from './dialog/addMain'//下拉组件\nimport dialogWlxzbyzsj from '@/components/Dialog/dialogWlxzbyzsj.vue'//主数据物料选择\nexport default {\n    name: 'replaceDefinition',\n    components: { Pagination, caiGou, addMain, dialogWlxzbyzsj },\n    data () {\n        return {\n            DICT_CODE: DICT_CODE,\n            list: null,\n            listSub: null,\n            total: 0,\n            totalSub: 0,\n            theight: 0, //表格高度\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 15,\n            },\n            listQuerySub: {\n                page: true,\n                currentPage: 1,\n                pageSize: 15,\n                orgCode: 'dtcg0001'\n            },\n            tableKey: [0, 1],\n            // 主表选中的数据\n            selectedRow: null,\n            // 从表选中的数据\n            selectedRowSub: null,\n        }\n    },\n    created () {\n    },\n    mounted () {\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.getList()\n    },\n    methods: {\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight()\n        },\n        // 获取采购组织名称\n        selectName (val) {\n            this.listQuery.orgName = val\n        },\n        // 重新渲染主表列表\n        refresh () {\n            this.getList()\n        },\n        getList () {\n            // console.log(JSON.stringify(this.listQuery))\n            api.queryRecord(this.listQuery).then((res) => {\n                console.log(res)\n                this.list = res.data.list\n                this.list.forEach((item, index) => {\n                    item.num = index + 1\n                })\n            })\n        },\n        getListSub () {\n            if (!this.selectedRow) {\n                this.$message({\n                    message: '请选择左表一条信息！',\n                    type: 'warning',\n                })\n            } else {\n                api.queryOneRecord(this.selectedRow.groupCode).then((res) => {\n                    // console.log(res, 'cong')\n                    this.listSub = res.data\n                    this.listSub.forEach((item, index) => {\n                        item.num = index + 1\n                    })\n                })\n            }\n        },\n        //查询\n        handleQuery () {\n            this.getList()\n        },\n        // 主表新增\n        handleCreate () {\n            this.$refs.addMain.resetTemp()\n            this.$refs.addMain.dialogStatus = 'create'\n            this.$refs.addMain.disabled = false\n            this.$refs.addMain.dialogVisible = true\n        },\n        // 主表行内修改\n        handleUpdate (index, row) {\n            this.$refs.addMain.dialogStatus = 'update'\n            this.$refs.addMain.disabled = true\n            this.$refs.addMain.temp = { ...row }\n            this.$refs.addMain.dialogVisible = true\n        },\n        // 主表行内删除\n        handleDelete (index, row) {\n            // console.log(index, row)\n            this.$confirm('是否删除该信息', ' 提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning'\n            })\n                .then(() => {\n                    api.deleteRecord(row.rowId).then(() => {\n                        this.$message({\n                            title: '成功',\n                            message: '删除成功',\n                            type: 'success',\n                            duration: 1000\n                        })\n                        this.getList()\n                        this.getListSub()\n                    })\n                })\n                .catch(() => {\n                    this.$message({\n                        type: 'info',\n                        message: '已取消'\n                    })\n                })\n        },\n        // 从表内删除\n        handleOneDelete (index, row) {\n            // console.log(index, row)\n            this.$confirm('是否删除该信息', ' 提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning'\n            })\n                .then(() => {\n                    api.deleteOneRecord(row.rowId).then(() => {\n                        this.$message({\n                            title: '成功',\n                            message: '删除成功',\n                            type: 'success',\n                            duration: 1000\n                        })\n                        this.getList()\n                        this.getListSub()\n                    })\n                })\n                .catch(() => {\n                    this.$message({\n                        type: 'info',\n                        message: '已取消'\n                    })\n                })\n        },\n        // 从表新增\n        handleCreatewl () {\n            if (!this.selectedRow) {\n                this.$message({\n                    message: '请选择左表一条信息！',\n                    type: 'warning',\n                })\n            } else {\n                this.$refs.refZsjWlxz.dialogVisible = true\n                this.$refs.refZsjWlxz.listQuery = this.listQuery\n                // this.$refs.refZsjWlxz.listSelected = [...this.listSub]\n                this.$refs.refZsjWlxz.getList()\n            }\n        },\n        // 物料选择(右侧新增)\n        confirmMateriel (data) {\n            console.log(data)\n            let dto = {\n                groupCode: this.selectedRow.groupCode,\n                groupName: this.selectedRow.groupName,\n                materielCode: data[0].materialCode,\n                materielName: data[0].materialName,\n                orgCode: this.selectedRow.orgCode,\n                orgName: this.selectedRow.orgName,\n            }\n            api.addRecordItem(dto).then(() => {\n                this.$message({\n                    title: '成功',\n                    message: '新增成功',\n                    type: 'success',\n                    duration: 2000\n                })\n                this.getList()\n                this.getListSub()\n            })\n        },\n        // 获取主表选中时的数据\n        rowClick (val) {\n            this.selectedRow = val\n            this.getListSub()\n        },\n    }\n}\n\n",null]}