{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentSpotCheck/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentSpotCheck/index.vue","mtime":1596610933381},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport *  as api from '@/api/project/eas/el/equipmentSpotCheck'\nimport Pagination from '@/components/Pagination'\nimport pointSelection from \"./pointSelection\"\nimport selectTree from \"@/components/Select/selectTree\"; //下拉组件\nimport fileUpload from '../../components/fileUpload'\nimport { queryRecords } from '@/api/project/eas/database/eqmt'\nimport { mapState } from 'vuex' // 基本数据引入\n\nexport default {\n    name: 'equipmentSpotCheck',\n    components: { Pagination, pointSelection, selectTree, fileUpload },\n    data () {\n        return {\n            list: [],\n            listSub: [],\n            baseList: [],\n            fromList: [],\n            cols: [],\n            fromListAdd: [],\n            selectlistRow: undefined,\n            selectRows: undefined,\n            total: 0,\n            total1: 0,\n            total2: 0,\n            theight: 0, //表格高度\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 15,\n                typeCode: undefined\n            },\n            temp: {\n                deviceCode: undefined,\n                deviceName: undefined,\n                modelNumber: undefined,\n                inspectionCode: undefined,\n                inspectionName: undefined,\n            },\n            isClearable: true, // 可清空（可选）\n            isAccordion: true, // 可收起（可选）\n            valueId: undefined, // 初始ID（可选）\n            props: {\n                // 配置项（必选）\n                rowId: 'rowId', // 父级唯一标识\n                children: 'children',\n                label: 'typeName'\n                // disabled:true\n            },\n            optionData: [],\n            previewDialogVisible: false,\n            importDialogVisible: false,\n            uploadVisible: false,\n            tableKey: [0, 1, 2],\n            transCode: undefined\n        }\n    },\n    computed: {\n        // 过滤器下拉框item数据\n        ...mapState({\n            dt_file_equipment: state => state.eamDict.dt_file_equipment\n        })\n    },\n    created () {\n        this.getList()\n    },\n    mounted () {\n        this.$store.dispatch('eamDict/getDicData', ['dt_file_equipment'])\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.getList()\n\n        queryRecords().then(res => {\n            this.optionData = this.$myFun.buildTree(\n                res.data,\n                'typeCode',\n                'superiorCode'\n            )[0].children\n        })\n    },\n    methods: {\n        handleUpload () {\n            if (!this.selectlistRow) {\n                this.$message({\n                    title: '警告',\n                    message: '请选择设备',\n                    type: 'warning'\n                })\n                return\n            }\n            if (!this.selectRows) {\n                this.$message({\n                    title: '警告',\n                    message: '请选择点检标准',\n                    type: 'warning'\n                })\n                return\n            }\n            this.uploadVisible = true\n            setTimeout(() => {\n                this.transCode = this.selectlistRow.deviceCode + this.selectRows.inspectionCode\n            }, 0)\n        },\n        //查主表\n        getList () {\n            api.queryMainlist(this.listQuery).then(res => {\n                this.list = res.data.list\n                this.total = res.data.pages.count\n                this.$nextTick(function () {\n                    this.checked()\n                })\n            })\n        },\n        checked () {\n            this.$refs.mainList.toggleRowSelection(this.list[0], true);\n        },\n        checkSublist () {\n            this.$refs.subList.toggleRowSelection(this.listSub[0], true);\n        },\n        getValue (value) {\n            if (value) {\n                this.listQuery.typeCode = value.typeCode;\n            } else {\n                this.listQuery.typeCode = undefined\n            }\n        },\n\n        // 获取表格选中时的数据\n        selectRow (val) {\n            this.baseList = []\n            this.selectlistRow = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.mainList.clearSelection();\n                this.$refs.mainList.toggleRowSelection(val.pop());\n            }\n            this.$refs.mainList.setCurrentRow(this.selectlistRow);\n            if (this.selectlistRow) {\n                this.getListSub()\n\n            }\n\n        },\n        //主表单行点击方法\n        selectRow_line (val) {\n            this.selectSublistRow = val\n            this.$refs.mainList.clearSelection();\n            this.$refs.mainList.toggleRowSelection(val);\n\n        },\n        //副表选择\n        selectSubRow (val) {\n            this.selectlistSubRow = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.subList.clearSelection()\n                this.$refs.subList.toggleRowSelection(val.pop())\n            }\n            this.$refs.subList.setCurrentRow(this.selectlistSubRow);\n            if (this.selectlistSubRow) {\n                this.getBaseList()\n            }\n\n\n        },\n        //副表单行点击方法\n        selectSubRow_line (val) {\n            this.selectRows = val;\n            this.$refs.subList.clearSelection()\n            this.$refs.subList.toggleRowSelection(val)\n\n        },\n        //左表\n        getListSub () {\n            api.queryRecords(this.selectlistRow.deviceCode).then(res => {\n                this.listSub = res.data\n                if (res.data.length) {\n                    this.selectRows = res.data[0]\n                } else {\n                    this.selectRows = undefined\n                }\n                this.$nextTick(function () {\n                    this.checkSublist()\n                })\n            })\n        },\n        //右表\n        getBaseList () {\n            api.queryBase(this.selectlistSubRow.inspectionCode).then(res => {\n                this.baseList = res.data\n            })\n        },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 200\n        },\n        handleQuery () {\n            //查询\n            this.listQuery.currentPage = 1\n            this.getList()\n        },\n        resetTemp () {\n            this.temp = {\n                deviceCode: undefined,\n                deviceName: undefined,\n                modelNumber: undefined,\n                inspectionCode: undefined,\n                inspectionName: undefined,\n            }\n            this.fromList = []\n        },\n        handlePreview () {\n            if (this.selectlistRow) {\n                api.queryPreview(this.selectlistRow.deviceCode).then(res => {\n                    if (res.data == 0) {\n                        this.$message({\n                            title: '警告',\n                            message: '此条数据下没有预览信息',\n                            type: 'warning'\n                        })\n                        return false\n                    }\n                    this.resetTemp()\n                    this.previewDialogVisible = true\n                    this.cols = res.data\n                    this.cols.forEach((v) => {\n                        this.temp = v\n                    })\n                })\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条设备编号',\n                    type: 'warning'\n                })\n            }\n\n        },\n        handleCreate () {\n            if (this.selectlistRow) {\n                this.importDialogVisible = true\n                setTimeout(() => {\n                    this.$refs.importDialog.getListSelected()\n                    this.$refs.importDialog.getList()\n                }, 0)\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条设备编号',\n                    type: 'warning'\n                })\n            }\n        },\n        handleChange (val) {\n            this.createChange = val\n            this.createChange.forEach(v => {\n                this.listSub.forEach(item => {\n                    if (v.inspectionCode == item.inspectionCode) {\n                        this.createChange = this.createChange.filter(items => {\n                            return items.inspectionCode != v.inspectionCode\n                        })\n                    }\n                })\n            });\n            this.fromListAdd = this.listSub.concat(this.createChange)\n        },\n        create () {\n            let deviceCode = this.selectlistRow.deviceCode\n            api.addRecords(deviceCode, this.fromListAdd).then(() => {\n                this.$refs.importDialog.subList,\n                    this.getListSub()\n                this.importDialogVisible = false\n                this.$message({\n                    title: '成功',\n                    message: '新增成功',\n                    type: 'success',\n                    duration: 2000\n                })\n            })\n        },\n        //删除列表\n        handleDelete () {\n            if (this.selectlistSubRow) {\n                this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                })\n                    .then(() => {\n                        api.deleteRecords(this.selectlistSubRow.deviceCode, this.selectlistSubRow.inspectionCode).then(() => {\n                            this.getListSub(),\n                                this.baseList = []\n                            this.$message({\n                                title: '成功',\n                                message: '删除成功',\n                                type: 'success',\n                                duration: 2000\n                            })\n                        })\n                    })\n                    .catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消删除'\n                        })\n                    })\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n            }\n\n        },\n    }\n}\n",null]}