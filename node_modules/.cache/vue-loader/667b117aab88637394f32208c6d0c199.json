{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/tab/tabWLcost.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/priceManage/supplierQuote/supplierQuoteInfo/tab/tabWLcost.vue","mtime":1596610933834},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { queryQuoteItem, createQuoteItem, updateQuoteItem, deleteQuoteItem, queryQuoteDetails } from \"@/api/project/srm/supplierSelect/supplierRFQ/supplierRFQAnswer\"\nimport { mapState } from 'vuex'\nexport default {\n    name: 'tabWLcost',\n    props: ['parentRowId'],\n    data () {\n        return {\n            tableData: [\n                { prop1: '1', prop2: '1', prop3: '2', prop4: '0', prop5: '5', prop6: '6', prop7: '7', prop8: '0', prop9: '0', prop10: '2%', prop11: '0.8', prop12: '', prop13: '', prop14: '', prop15: '', prop16: 'J', prop17: '', prop18: '', prop19: '15' },\n                { prop1: '1', prop2: '1', prop3: '2', prop4: '0', prop5: '5', prop6: '6', prop7: '7', prop8: '0', prop9: '0', prop10: '2%', prop11: '0.8', prop12: '', prop13: '', prop14: '', prop15: '', prop16: 'J', prop17: '', prop18: '', prop19: '15' },\n                { prop1: '', prop2: '合计', prop3: '', prop4: '', prop5: '5', prop6: '', prop7: '', prop8: '', prop9: '', prop10: '4', prop11: '', prop12: '', prop13: '', prop14: '', prop15: '', prop16: '', prop17: '', prop18: '', prop19: '' }\n            ],\n            rules: {\n                transportType: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                transportRoute: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                deliveryPlace: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                transportCompany: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                distance: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                eachShipmentNumber: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                singleCost: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ]\n            },\n            formData: {},\n            formConfig: [\n                { type: 'dictSelect', dType: 'dt_srm_pdm', required: true, label: '运输方式', prop: 'transportType', width: '' },\n                { type: 'textarea', required: true, label: '运输路线', prop: 'transportRoute', width: '475px', rows: \"1\" },\n                { type: 'commonInput', required: true, label: '交货地点', prop: 'deliveryPlace', width: '' },\n                { type: 'commonInput', required: true, label: '运输公司', prop: 'transportCompany', width: '' },\n                { type: 'commonInput', required: true, label: '距离(KM)', prop: 'distance', width: '' },\n                { type: 'commonInput', required: true, label: '每次发运零件数', prop: 'eachShipmentNumber', width: '' },//I1\n                { type: 'commonInput', required: true, label: '单次费用', prop: 'singleCost', width: '' },//I2\n                { type: 'commonInput', disabled: true, label: '费用小计', prop: 'subtotalCost', width: '' }//I=I2/I1\n            ],\n            tableConfig: [\n                { label: '运输方式', prop: 'transportTypeCN', align: 'center', width: 'auto' },//dictype\n                { label: '运输路线', prop: 'transportRoute', align: 'center', width: 'auto' },\n                { label: '距离', prop: 'distance', align: 'center', width: 'auto' },\n                { label: '交货地点', prop: 'deliveryPlace', align: 'center', width: 'auto' },\n                { label: '运输公司', prop: 'transportCompany', align: 'center', width: 'auto' },\n                { label: '每次发运零件数', prop: 'eachShipmentNumber', align: 'center', width: 'auto' },\n                { label: '单次费用', prop: 'singleCost', align: 'center', width: 'auto' },\n                { label: '小计费用', prop: 'subtotalCost', align: 'center', width: 'auto' }\n            ]\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_pdm: state => state.dict.dt_srm_pdm\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pdm\"])\n        this.getItems()\n    },\n    watch: {\n        'formData.eachShipmentNumber' () {\n            this.calculate('eachShipmentNumber', this.formData)\n        },\n        'formData.singleCost' () {\n            this.calculate('singleCost', this.formData)\n        }\n    },\n    methods: {\n        calculate (prop, row, index = null) {\n            switch (prop) {\n                case 'eachShipmentNumber': case 'singleCost': {\n                    if (!index) {\n                        this.$set(this.formData, 'subtotalCost', (row.singleCost / row.eachShipmentNumber).toFixed(4))\n                    } else {\n                        this.$set(this.tableData[index], 'subtotalCost', (row.singleCost / row.eachShipmentNumber).toFixed(4))\n                    }\n                    break\n                }\n            }\n        },\n        calculateSum () {\n            let subtotalCosts = 0\n\n            this.tableData.forEach(item => {\n                subtotalCosts += item.subtotalCost\n            })\n\n            let dataSum = { key: 'sum', transportTypeCN: '合计', subtotalCost: subtotalCosts }\n            this.tableData.push(dataSum)\n        },\n        getItems () {\n            if (this.parentRowId) {\n                queryQuoteDetails({ parentRowId: this.parentRowId, method: 'LOGISTICS_COST' }).then(res => {\n                    let options = [this.dt_srm_pdm]\n                    res.data = this.$myFun.codeToName(res.data, options, ['transportType'])\n                    this.tableData = res.data\n                    this.calculateSum()\n                })\n            }\n        },\n        handleUpdate (row) {\n            queryQuoteItem({ rowId: row.rowId, method: 'LOGISTICS_COST' }).then(res => {\n                this.formData = res.data\n            })\n        },\n        handleDelete (row) {\n            this.$confirm('确认删除吗?', '提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning'\n            }).then(() => {\n                deleteQuoteItem({ parentRowId: this.parentRowId, rowId: row.rowId, method: 'LOGISTICS_COST' }).then(() => {\n                    this.getItems()\n                    this.$emit('getTotalQuotation')\n                })\n            }).catch(() => {\n                this.$message({\n                    type: 'info',\n                    message: '已取消'\n                })\n            })\n        },\n        resetForm () {\n            for (let par in this.formData) {\n                if (par !== 'parentRowId') {\n                    this.$set(this.formData, par, null)\n                }\n            }\n            this.$refs['refForm'].resetFields()\n            this.$refs['refForm'].clearValidate()\n        },\n        handleConfirm () {\n            this.$refs.refForm.validate((valid) => {\n                if (valid) {\n                    this.$confirm('确认保存吗?', '提示', {\n                        confirmButtonText: '确定',\n                        cancelButtonText: '取消',\n                        type: 'warning'\n                    }).then(() => {\n                        // logisticsCostDTO\t加工费用 DTO(LOGISTICS_COST)\t\tfalse\t\n                        // 物流费用 DTO\n                        this.formData.parentRowId = this.parentRowId\n                        if (this.formData.rowId) {\n                            let cdata = {\n                                logisticsCostDTO: this.formData,\n                                method: \"LOGISTICS_COST\"\n                            }\n                            updateQuoteItem(this.formData.rowId, cdata).then(() => {\n                                this.getItems()\n                                this.$emit('getTotalQuotation')\n                                this.$message({\n                                    type: 'success',\n                                    message: '编辑成功'\n                                })\n                                this.resetForm()\n                            })\n                        } else {\n                            let cdata = {\n                                logisticsCostDTO: this.formData,\n                                method: \"LOGISTICS_COST\"\n                            }\n                            createQuoteItem(cdata).then(() => {\n                                this.getItems()\n                                this.$emit('getTotalQuotation')\n                                this.resetForm()\n                                this.$message({\n                                    type: 'success',\n                                    message: '新增成功'\n                                })\n                            })\n\n                        }\n                    }).catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消'\n                        })\n                    })\n                }\n            })\n        }\n    }\n}\n",null]}