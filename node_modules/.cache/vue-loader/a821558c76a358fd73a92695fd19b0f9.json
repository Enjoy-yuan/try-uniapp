{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/purchaseStorage/purchaseReceiving/content/contentRegister.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/purchaseStorage/purchaseReceiving/content/contentRegister.vue","mtime":1596610934176},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/project/wms/purchaseStorage/purchaseReceiving'\n\nimport { mapState } from 'vuex'\nimport Pagination from \"@/components/Pagination\"\nimport caiGou from '@/components/Select/caigou.vue'//下拉组件\nimport warehouseSelect from '@/components/Select/warehouse-select.vue'//下拉组件\nimport { DT_ORG_TYPE, DICT_CODE } from '@/utils/constant'\n\nexport default {\n    name: \"Register\",\n    components: { Pagination, warehouseSelect, caiGou },\n    data () {\n        return {\n            theight: 0,\n            list: null,\n            isSingle: true,\n            list_a: [],\n            total_a: 0,\n            jareaList: null,\n            jlocatorList: [],\n            careaList: null,\n            clocatorList: [],\n            display: false,\n            listQuery_a: {\n                currentPage: 1,\n                pageSize: 10,\n                supplierCode: '',\n                itemStates: undefined,\n                accountDate: this.timeFormat()\n            },\n            selects: true,\n            Edit: false,\n            state: true,\n            queryState: ['ADD', 'PART'],\n            list_a_1: [],\n            total_a_1: 0,\n            listQuery_a_1: {\n                currentPage: 1,\n                pageSize: 10,\n                itemStates: undefined\n            },\n            list_b: [],\n            total_b: 0,\n            releaseDateStart: [this.timeFormat(), this.timeFormat()],\n            listQuery_b: {\n                currentPage: 1,\n                pageSize: 1000,\n\n            },\n            list_b_1: [],\n            total_b_1: 0,\n            listQuery_b_1: {\n                currentPage: 1,\n                pageSize: 10,\n            },\n            JHD: false,\n            CG: false,\n            name: undefined,\n            activeName2: 'first',\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            DICT_CODE: DICT_CODE,\n            temp: {},\n            dto: {\n                businessType: undefined,\n                orgCode: undefined,\n                wareMaterielDTOS: undefined,\n                warehouseCode: undefined\n            },\n            gysxzDialogFormVisible: false,\n            parentsRows: [],\n            downloadLoading: false\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_materiel_transfer_type_screenGroupNum: state => state.businessComponent.dt_materiel_transfer_type_screenGroupNum\n        })\n    },\n    mounted () {\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.$store.dispatch('businessComponent/getBusinessComponentData', ['dt_materiel_transfer_type_screenGroupNum'])\n    },\n    methods: {\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 30\n        },\n        //查询事件\n        queryList () {\n            if (this.listQuery_a.businessType && this.listQuery_a.businessType && this.listQuery_a.businessType) {\n                this.getList_a()\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请先选择业务类别,到货单位及仓库\",\n                    type: \"warning\"\n                })\n            }\n        },\n        checked () {\n            this.$refs.dt_a.toggleRowSelection(this.list_a[0], true)//官网方法，重点\n        },\n        timeFormat () {\n            var d = new Date()\n            var year = d.getFullYear()       //年  \n            var month = d.getMonth() + 1     //月  \n            var day = d.getDate()            //日  \n\n            var clock = year + \"-\"\n            if (month < 10)\n                clock += \"0\"\n            clock += month + \"-\"\n\n            if (day < 10)\n                clock += \"0\"\n            clock += day\n            return (clock)\n        },\n        handleName (val) {\n            this.name = val\n        },\n        getList_a () {//收货登记主表查询\n            this.listQuery_a.itemStates = this.queryState.join(\",\")\n            if (this.listQuery_a.businessType == '0520') {\n                this.JHD = true\n                api.getData_a_JHD(this.listQuery_a).then(res => {\n                    this.list_a = res.data.list\n                    this.total_a = res.data.pages.count\n                    this.$nextTick(function () {\n                        this.checked()\n                    })\n                })\n            } else {\n                this.JHD = false\n                api.getData_a_CG(this.listQuery_a).then(res => {\n                    this.list_a = res.data.list.map(v => {\n                        v.warehouseCode = this.listQuery_a.arrivalRepository\n                        v.warehouseName = this.name\n                        return v\n                    })\n\n                    this.total_a = res.data.pages.count\n                    this.$nextTick(function () {\n                        this.checked()\n                    })\n                })\n            }\n\n        },\n        getLocatorListj (warehouseCode, areaCode, i, val) {\n            api.getLocator(warehouseCode, areaCode).then(res => {\n                res = res.data\n                this.$set(this.jlocatorList, i, res)\n                if (val) {\n                    this.$set(this.list_a_1[i], 'wareLocationCode', val)\n                } else {\n                    this.$set(this.list_a_1[i], 'wareLocationCode', res[0].locationCode)\n                }\n                this.$set(this.list_a_1, i, this.list_a_1[i])\n            })\n        },\n        changeAreaSelj (areaCode, i, val) {\n            this.getLocatorListj(this.listQuery_a.arrivalRepository, areaCode, i, val)\n        },\n        getLocatorListc (warehouseCode, areaCode, i, val) {\n            api.getLocator(warehouseCode, areaCode).then(res => {\n                res = res.data\n                this.$set(this.clocatorList, i, res)\n                if (val) {\n                    this.$set(this.list_a_1[i], 'wareLocationCode', val)\n                } else {\n                    this.$set(this.list_a_1[i], 'wareLocationCode', res[0].locationCode)\n                }\n                this.$set(this.list_a_1, i, this.list_a_1[i])\n            })\n        },\n        changeAreaSelc (areaCode, i, val) {\n            this.getLocatorListc(this.listQuery_a.arrivalRepository, areaCode, i, val)\n        },\n        getList_a_1 (val) {//收货登记从表查询\n            console.log(val)\n            this.listQuery_a_1.itemStates = this.queryState.join(\",\")\n            // this.listQuery_a_1.orderNumber=val.orderNumber\n            this.listQuery_a_1.orderNumber = this.selectlistRow_a.orderNumber\n            this.listQuery_a_1.arrivalCompany = this.listQuery_a.arrivalCompany\n            this.listQuery_a_1.arrivalRepository = this.listQuery_a.arrivalRepository\n            this.listQuery_a_1.businessType = this.listQuery_a.businessType\n            if (this.JHD) {\n                api.getData_a_1_JHD(this.listQuery_a_1).then(res => {\n                    // this.list_a_1=res.list\n                    res = res.data\n                    api.getArea(this.listQuery_a.arrivalRepository).then(resa => {\n                        resa = resa.data\n                        this.jareaList = resa\n\n                        this.list_a_1 = res.list.map((v) => {\n                            // this.selectlistRow_a.warehouseCode=v.arrivalRepository\n                            v.giftQuantity = v.giftQuantity || 0\n                            v.receivedQuantity = v.actualQuantity\n                            v.receiveQuantity = v.RQuantit\n                            v.deliveryRowNo = v.rowNo\n                            v.receiveRowNo = v.rowNo\n                            v.preSourceRowNo = v.purchaseRowNo\n                            return v\n                        })\n                        this.list_a_1.forEach((val, index) => {\n                            if (val.wareAreaCode) {\n                                this.changeAreaSelc(val.wareAreaCode, index, val.wareLocationCode)\n                            } else {\n                                this.$set(this.list_a_1[index], 'wareAreaCode', resa[0].areaCode)\n                                this.changeAreaSelc(resa[0].areaCode, index, val.wareLocationCode)\n                            }\n                        })\n                        this.total_a_1 = res.pages.count\n                    })\n                })\n            } else {\n                api.getData_a_1_CG(this.listQuery_a_1).then(res => {\n                    res = res.data\n                    api.getArea(this.listQuery_a.arrivalRepository).then(resa => {\n                        resa = resa.data\n                        this.careaList = resa\n                        this.list_a_1 = res.list.map((v) => {\n                            // this.selectlistRow_a.warehouseCode=v.arrivalRepository\n                            v.giftQuantity = v.giftQuantity || 0\n                            v.actualQuantity = v.receiveQuantity + v.stockQuantity\n                            //  res.list[index].invalidQuantity = res.list[index].pushOrderNum-res.list[index].receiveOrderNum;\n                            // for (const key in val) {\n                            //     if (val.hasOwnProperty(key)) {\n                            //         v[key]=val[key]\n                            //     }\n                            // }\n                            return v\n                        })\n                        this.list_a_1.forEach((val, index) => {\n                            if (val.wareAreaCode) {\n                                this.changeAreaSelc(val.wareAreaCode, index, val.wareLocationCode)\n                            } else {\n                                this.$set(this.list_a_1[index], 'wareAreaCode', resa[0].areaCode)\n                                this.changeAreaSelc(resa[0].areaCode, index, val.wareLocationCode)\n                            }\n                        })\n                        this.total_a_1 = res.pages.count\n                    })\n                })\n            }\n\n        },\n\n        selectRow_a (val) {//收货登记主表选中\n            this.selectlistRow_a = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.dt_a.clearSelection()\n                this.$refs.dt_a.toggleRowSelection(val[val.length - 1], 'selected')\n            }\n            this.$refs.dt_a.setCurrentRow(this.selectListRow_a)\n            if (this.selectlistRow_a) {\n                this.listQuery_a_1.supplierCode = this.selectlistRow_a.supplierCode\n                // this.listQuery_a_1.orderNumber=this.selectlistRow_a.orderNumber\n                this.getList_a_1(this.selectlistRow_a)\n            } else {\n                this.list_a_1 = []\n                this.total_a_1 = 0\n            }\n        },\n        selectRow_a_1 (val) {//收货登记从表选中\n            this.selectListRow_a_1 = val\n        },\n\n        clickRow_a (val) {//收货登记从表信息\n            this.selectlistRow_a = val\n            this.$refs.dt_a.clearSelection()//清除其他行的选中\n            this.$refs.dt_a.toggleRowSelection(val)//单击行绑定点击事件\n        },\n\n        handleSave () {//保存\n            if (this.listQuery_a.accountDate && this.selectlistRow_a) {\n                let result = true\n                let saveList = []\n                let b = this.list_a_1.map(v => {\n\n                    // v.measuringUnit=v.purchaseMeasuringUnit\n                    v.sourceRowNo = v.rowNo\n                    v.deliveryRowNo = v.rowNo\n                    v.receiveRowNo = v.rowNo\n                    v.receiveQuantity = v.RQuantit\n                    v.toWareAreaCode = '*'\n                    v.toWareLocationCode = '*'\n                    return v\n\n                })\n                b.forEach(item => {\n                    if (item.RQuantit > 0) {\n                        result = false\n                        saveList.push(item)\n                    }\n                })\n                if (result) {\n                    this.$message({\n                        title: \"警告\",\n                        message: \"本次收货量不可全部为0或空\",\n                        type: \"warning\"\n                    })\n                } else {\n\n                    delete this.selectlistRow_a.deliveryOrderItemDTOList\n                    // delete this.selectlistRow_a.purchaseOrderItemList\n                    this.selectlistRow_a.businessType = this.listQuery_a.businessType\n                    this.selectlistRow_a.accountDate = this.listQuery_a.accountDate\n                    this.selectlistRow_a.deliveryOrderNumber = this.selectlistRow_a.orderNumber\n                    this.selectlistRow_a.orgCode = this.selectlistRow_a.arrivalCompany\n                    this.selectlistRow_a.sourceOrderNumber = this.selectlistRow_a.orderNumber\n                    this.selectlistRow_a.preSourceOrderNumber = this.selectlistRow_a.purchaseOrderNumber || this.selectlistRow_a.orderNumber\n                    this.selectlistRow_a.warehouseCode = this.selectlistRow_a.warehouseCode || this.selectlistRow_a.arrivalRepository\n                    this.selectlistRow_a.receiveOrderItemDTOs = saveList\n\n                    api.creatData_a(this.selectlistRow_a).then(() => {\n                        this.$message({\n                            title: \"成功\",\n                            message: \"保存成功\",\n                            type: \"success\"\n                        })\n                        this.getList_a_1()\n\n                    })\n                }\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条记录和记账日期\",\n                    type: \"warning\"\n                })\n            }\n        },\n        handleRecommend () {\n            if (this.selectListRow_a_1) {\n                this.dto.businessType = this.listQuery_a.businessType,\n                    this.dto.orgCode = this.selectlistRow_a.arrivalCompany,\n                    this.dto.wareMaterielDTOS = this.selectListRow_a_1.map(v => {\n                        let DTOSlist = {}\n                        DTOSlist.materielCode = v.materielCode\n                        DTOSlist.materielClassify = \"\"\n                        return DTOSlist\n                    }),\n                    this.dto.warehouseCode = this.listQuery_a.arrivalRepository,\n                    api.recommend(this.dto).then(res => {\n                        res = res.data\n                        res.forEach((val) => {\n                            this.list_a_1.forEach((val1, index) => {\n                                if (val.materielCode == val1.materielCode) {\n                                    this.$set(this.list_a_1[index], 'wareAreaCode', val.areaCode)\n                                    this.$set(this.list_a_1[index], 'wareLocationCode', val.locationCode)\n                                    this.$set(this.list_a_1, index, this.list_a_1[index])\n                                }\n                            })\n                        })\n                    })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择信息\",\n                    type: \"warning\"\n                })\n            }\n        },\n\n        change () {\n            this.list_a_1.map((item, index) => {\n                this.$set(this.list_a_1, index, this.list_a_1[index])\n            })\n        },\n        handleCopy () {//复制\n            if (this.selectListRow_a_1 && this.selectListRow_a_1.length > 0) {\n                if (this.JHD) {\n                    this.list_a_1.map((item, index) => {\n                        this.selectListRow_a_1.forEach(items => {\n                            if (items.materielCode === item.materielCode) {\n                                this.list_a_1[index].RQuantit = item.receivableQuantity\n                                this.$set(this.list_a_1, index, this.list_a_1[index])\n                            }\n                        })\n                    })\n                } else {\n                    this.list_a_1.map((item, index) => {\n                        this.selectListRow_a_1.forEach(items => {\n                            if (items.materielCode === item.materielCode) {\n                                this.list_a_1[index].RQuantit = item.deliverableQuantity\n                                this.$set(this.list_a_1, index, this.list_a_1[index])\n                            }\n                        })\n                    })\n                }\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                })\n            }\n        },\n        showGys () {\n            this.$emit('showGys', 'register')\n        },\n        setGys (rows) {\n            this.parentsRows = rows\n            if (!this.parentsRows[0]) {\n                this.$set(this.listQuery_a, 'supplierCode', '')\n                this.$set(this.listQuery_a, 'supplierName', '')\n            } else {\n                this.$set(this.listQuery_a, 'supplierCode', this.parentsRows[0].supplierCode)\n                this.$set(this.listQuery_a, 'supplierName', this.parentsRows[0].supplierName)\n            }\n        }\n    }\n}\n",null]}