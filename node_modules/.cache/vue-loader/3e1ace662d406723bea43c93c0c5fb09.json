{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/purchaseStorage/noIndicatorStorage/content/contentRegister.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/purchaseStorage/noIndicatorStorage/content/contentRegister.vue","mtime":1596610934168},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/project/wms/purchaseStorage/purchaseReceiving'\nimport { mapState } from 'vuex'\nimport Pagination from \"@/components/Pagination\"\nimport caiGou from '@/components/Select/caigou.vue'//下拉组件\nimport warehouseSelect from '@/components/Select/warehouse-select.vue'//下拉组件\nimport { getDomainId } from '@/utils/auth'\nimport { DT_ORG_TYPE, DICT_CODE } from '@/utils/constant'\n\nexport default {\n    name: \"Register\",\n    components: { Pagination, warehouseSelect, caiGou },\n    data () {\n        return {\n            theight: 0,\n            list: null,\n            isSingle: true,\n            list_a: [],\n            total_a: 0,\n            areaList: null,\n            locatorList: [],\n            listQuery_a: {\n                currentPage: 1,\n                pageSize: 10,\n                orgCode: undefined,\n                supplierCode: getDomainId(),\n                accountDate: this.timeFormat()\n            },\n            selects: true,\n            list_b: [],\n            total_b: 0,\n\n            dto: {\n                businessType: undefined,\n                orgCode: undefined,\n                wareMaterielDTOS: [],\n                warehouseCode: undefined\n            },\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            DICT_CODE: DICT_CODE,\n            temp: {},\n            gysxzDialogFormVisible: false,\n            wlxzDialogFormVisible: false,\n            parentsRows: undefined,\n            downloadLoading: false\n        }\n    },\n    computed: {\n        ...mapState({\n            dd_receivin_state: state => state.dict.dd_receivin_state,\n            dt_ReceivingBusiness_type: state => state.dict.dt_ReceivingBusiness_type,\n            dt_purchase_class: state => state.dict.dt_purchase_class,\n            dt_materiel_transfer_type_screenGroupNum_SH2: state => state.businessComponent.dt_materiel_transfer_type_screenGroupNum_SH2,\n            dt_stock_type: state => state.dict.dt_stock_type\n        })\n    },\n    mounted () {\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.$store.dispatch('dict/getDicData', ['dd_receivin_state', 'dt_ReceivingBusiness_type', 'dt_purchase_class', 'dt_stock_type'])\n        this.$store.dispatch('businessComponent/getBusinessComponentData', ['dt_materiel_transfer_type_screenGroupNum_SH2'])\n    },\n    methods: {\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() + 10\n        },\n        handleSave () {//保存\n            if (this.listQuery_a.businessType && this.listQuery_a.orgCode && this.listQuery_a.warehouseCode && this.listQuery_a.supplierCode && this.listQuery_a.accountDate && this.list_a.length > 0) {\n                this.listQuery_a.receiveOrderItemDTOs = []\n                this.listQuery_a.receiveOrderItemDTOs = this.list_a.filter(v => {\n                    return v.receiveQuantity > 0\n                })\n                api.creatData_a(this.listQuery_a).then(() => {\n                    this.$message({\n                        title: \"成功\",\n                        message: \"保存成功\",\n                        type: \"success\"\n                    })\n                    this.list_a = []\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"业务类型/到货单位/到货仓库/记账日期/供应商/物料明细不能为空\",\n                    type: \"warning\"\n                })\n            }\n        },\n        getLocatorList (warehouseCode, areaCode, i) {\n            api.getLocator(warehouseCode, areaCode).then(res => {\n                res = res.data\n                this.$set(this.locatorList, i, res)\n                this.$set(this.list_a[i], 'wareLocationCode', res[0].locationCode)\n                this.$set(this.list_a, i, this.list_a[i])\n            })\n        },\n        changeAreaSel (areaCode, i) {\n            this.getLocatorList(this.listQuery_a.warehouseCode, areaCode, i)\n        },\n        handleRecommend () {\n            if (this.selectlistRow_a) {\n                this.dto.businessType = this.listQuery_a.businessType,\n                    this.dto.orgCode = this.listQuery_a.orgCode,\n                    this.selectlistRow_a.materielClassify = \"\"\n                this.dto.wareMaterielDTOS = this.selectlistRow_a\n                this.dto.warehouseCode = this.listQuery_a.warehouseCode,\n                    api.recommend(this.dto).then(res => {\n                        res = res.data\n                        res.forEach((val) => {\n                            this.list_a.forEach((val1, index) => {\n                                if (val.materielCode == val1.materielCode) {\n                                    this.$set(this.list_a[index], 'wareAreaCode', val.areaCode)\n                                    this.$set(this.list_a[index], 'wareLocationCode', val.locationCode)\n                                    this.$set(this.list_a, index, this.list_a[index])\n                                }\n                            })\n                        })\n                    })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择信息\",\n                    type: \"warning\"\n                })\n            }\n        },\n        timeFormat () {\n            var d = new Date()\n            var year = d.getFullYear()       //年  \n            var month = d.getMonth() + 1     //月  \n            var day = d.getDate()            //日  \n\n            var clock = year + \"-\"\n            if (month < 10)\n                clock += \"0\"\n            clock += month + \"-\"\n\n            if (day < 10)\n                clock += \"0\"\n            clock += day\n            return (clock)\n        },\n        handleDelete () {//删除方法\n            if (this.selectlistRow_a) {\n                this.$confirm(\"确认要删除该数据项吗?\", \"提示\", {\n                    confirmButtonText: \"确定\",\n                    cancelButtonText: \"取消\",\n                    type: \"warning\"\n                }).then(() => {\n                    this.list_a = this.list_a.filter(item => {\n                        let isD = true\n                        this.selectlistRow_a.forEach((itemr) => {\n                            if (itemr.materielCode === item.materielCode) {\n                                isD = false\n                            }\n                        })\n                        return isD\n                    })\n\n                    this.$message({\n                        type: \"success\",\n                        message: \"删除成功\"\n                    })\n                }).catch(() => {\n                    this.$message({\n                        type: \"info\",\n                        message: \"已取消\"\n                    })\n                })\n            } else {\n                this.$message.warning(\"请勾选记录！\")\n                return\n            }\n        },\n        selectRow_a (val) {//收货凭证主表\n            this.selectlistRow_a = val\n            //    this.selectlistRow_a = val[val.length-1]\n            //     if (val.length > 1) {\n            //         this.$refs.dt_a.clearSelection()\n            //         this.$refs.dt_a.toggleRowSelection(val[val.length-1])\n            //     } \n        },\n        clickRow_a (val) {//收货登记从表信息\n            this.selectlistRow_a = val\n            this.$refs.dt_a.clearSelection()//清除其他行的选中\n            this.$refs.dt_a.toggleRowSelection(val)//单击行绑定点击事件\n        },\n\n        handleCreate () {//新增按钮\n            if (this.listQuery_a.orgCode && this.listQuery_a.warehouseCode && this.listQuery_a.businessType && this.listQuery_a.supplierName && this.listQuery_a.accountDate) {\n                this.$emit('showWlxz', 'register')\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择查询条件\",\n                    type: \"warning\"\n                })\n            }\n            api.getArea(this.listQuery_a.warehouseCode).then(resa => {\n                resa = resa.data\n                this.areaList = resa\n            })\n        },\n        setWlxz (wlRows) {//物料选中中弹窗确认按钮\n            if (wlRows) {\n                this.list_a = []\n                this.list_a = wlRows\n                this.list_a.forEach((val, index) => {\n                    this.$set(this.list_a[index], 'stockType', this.dt_stock_type[1].dictItemKey)\n                    this.$set(this.list_a, index, this.list_a[index])\n                })\n                let a = {}\n                a.businessType = this.listQuery_a.businessType\n                a.orgCode = this.listQuery_a.orgCode\n                a.warehouseCode = this.listQuery_a.warehouseCode\n                a.wareMaterielDTOS = wlRows\n                api.recommend(a).then(res => {\n                    res = res.data\n                    res.forEach((val) => {\n                        this.list_a.forEach((val1, index) => {\n                            if (val.materielCode == val1.materielCode) {\n                                this.$set(this.list_a[index], 'wareAreaCode', val.areaCode)\n                                this.$set(this.list_a[index], 'wareLocationCode', val.locationCode)\n                                this.$set(this.list_a, index, this.list_a[index])\n                                this.changeAreaSel(val.areaCode, index)\n                            }\n                        })\n                    })\n                })\n                this.$emit('showWlxz', false)\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                })\n            }\n        },\n        handleCopy () {//复制\n            if (this.selectListRow_a_1 && this.selectListRow_a_1.length > 0) {\n                this.selectListRow_a_1 = this.selectListRow_a_1.map(function (item) {\n                    if (item.RQuantit) {\n                        item.RQuantit = item.receiveQuantity\n                    } else {\n                        item.receiveQuantity = item.deliverableQuantity || item.receivableQuantity || 0//数据复制，本次发货=可发货数量\n                    }\n                    return item\n                })\n                this.list_a_1 = this.selectListRow_a_1\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                })\n            }\n        },\n        gysxzSelected () {//供应商选中弹窗确认按钮\n            if (this.parentsRows.length && this.parentsRows.length == 1) {\n                this.temp.supplierCode = this.parentsRows[0].supplierCode\n                this.temp.supplierName = this.parentsRows[0].supplierName\n                if (this.GYS) {\n                    this.listQuery_a.supplierCode = this.parentsRows[0].supplierCode\n                    this.listQuery_a.supplierName = this.parentsRows[0].supplierName\n                    // this.listQuery_b.supplierCode='';\n                    // this.listQuery_b.supplierName = '';\n                } else {\n                    // this.listQuery_a.supplierCode='';\n                    // this.listQuery_a.supplierName = '';\n                    this.listQuery_b.supplierCode = this.parentsRows[0].supplierCode\n                    this.listQuery_b.supplierName = this.parentsRows[0].supplierName\n                }\n\n\n                this.gysxzDialogFormVisible = false\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                })\n            }\n        },\n        handleDblclickgysxz (row) {//父子页面通信\n            this.parentsRows = row\n\n        },\n        showGys () {\n            this.$emit('showGys', 'register')\n        },\n        setGys (rows) {\n            this.parentsRows = rows\n            if (!this.parentsRows[0]) {\n                this.$set(this.listQuery_a, 'supplierCode', '')\n                this.$set(this.listQuery_a, 'supplierName', '')\n            } else {\n                this.$set(this.listQuery_a, 'supplierCode', this.parentsRows[0].supplierCode)\n                this.$set(this.listQuery_a, 'supplierName', this.parentsRows[0].supplierName)\n            }\n        }\n    }\n}\n",null]}