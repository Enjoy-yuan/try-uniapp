{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/RF/troubleshooting/downtime/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/RF/troubleshooting/downtime/index.vue","mtime":1596610933422},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/project/eas/rf/downTime'\nimport deviceType from '../../../components/deviceTypeSelect'\nimport useDept from '../../../components/useDeptSelect'\nimport deviceSelect from '../../../components/singleDeviceSelect'\nimport Pagination from '@/components/Pagination'\nimport { mapState } from 'vuex'\n\nexport default {\n    name: 'eas-downtime',\n    components: { Pagination, deviceType, useDept, deviceSelect },\n    data() {\n        return {\n            chart1: undefined,\n            chart2: undefined,\n            chart3: undefined,\n            list1: null,\n            list2: null,\n            list3: null,\n            total: 0,\n            total2: 0,\n            theight: 0, //表格高度\n            timeRange: null,\n            listQuery: {\n                currentPage: 1,\n                pageSize: 10,\n                fmStatDimensionality: 'FMSD_DEVICE_TYPE',\n                deviceCode: undefined,\n                useDept: undefined,\n                deviceType: undefined\n            },\n            listQuery2: {\n                currentPage: 1,\n                pageSize: 10,\n                fmStatDimensionality: 'FMSD_DATE'\n            },\n            deviceVisible: false,\n            tableKey: 0\n        }\n    },\n    watch: {\n        timeRange(val) {\n            if (val) {\n                this.listQuery.startTime = val[0]\n                this.listQuery.endTime = val[1]\n            } else {\n                delete this.listQuery.startTime\n                delete this.listQuery.endTime\n            }\n        },\n        'listQuery.fmStatDimensionality'(val) {\n            this.listQuery = {\n                currentPage: 1,\n                pageSize: 10,\n                fmStatDimensionality: val,\n                deviceCode: undefined,\n                useDept: undefined,\n                deviceType: undefined\n            }\n            this.$refs.deviceType.valueTitle = ''\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_f_m_stat_dimensionality: state =>\n                state.eamDict.dt_f_m_stat_dimensionality.filter(item => {\n                    if (\n                        (item.dictItemKey == 'FMSD_USE_DEPT') |\n                        (item.dictItemKey == 'FMSD_DEVICE_TYPE') |\n                        (item.dictItemKey == 'FMSD_DEVICE')\n                    )\n                        return item\n                })\n        })\n    },\n    mounted() {\n        this.$store.dispatch('eamDict/getDicData', ['dt_f_m_stat_dimensionality'])\n        this.setTableHeight()\n        //窗口变化\n        window.onresize = () => {\n            this.setTableHeight()\n            this.chart1.resize()\n            this.chart2.resize()\n            this.chart3.resize()\n        }\n        setTimeout(() => {\n            this.getList()\n        }, 1000)\n    },\n    methods: {\n        confirmDevice(val) {\n            this.listQuery.deviceCode = val.deviceCode\n        },\n        handleDevice() {\n            if (this.listQuery.fmStatDimensionality != 'FMSD_DEVICE') {\n                this.$message({\n                    title: '警告',\n                    message: '查询维度请选择设备',\n                    type: 'warning'\n                })\n                return\n            }\n            this.deviceVisible = true\n        },\n        // echarts渲染方法\n        renderChart() {\n            if (!document.getElementById('dchart1')) {\n                return\n            }\n            // 部门停机比\n            this.chart1 = this.$echarts.init(document.getElementById('dchart1'))\n            this.chart1.setOption({\n                title: {\n                    text: '部门停机比',\n                    right: '10%',\n                    top: '15%',\n                    textStyle: {\n                        fontSize: 14\n                    }\n                },\n                label: {\n                    show: true,\n                    position: 'inside',\n                    formatter: '{b0}: {d}%'\n                },\n                grid: {\n                    left: '7%',\n                    bottom: '0%',\n                    containLabel: true\n                },\n                tooltip: {\n                    //提示框组件\n                    trigger: 'item', //触发类型,'item'数据项图形触发，主要在散点图，饼图等无类目轴的图表中使用。 'axis'坐标轴触发，主要在柱状图，折线图等会使用类目轴的图表中使用。\n                    showContent: true, //是否显示提示框浮层\n                    formatter: '{b0}: {c0}<br /> {d}%' //提示框浮层内容格式器，支持字符串模板和回调函数两种形式,模板变量有 {a}, {b}，{c}，{d}，{e}，分别表示系列名，数据名，数据值等\n                },\n                legend: {\n                    right: '8%',\n                    top: 100,\n                    orient: 'vertical',\n                    data: []\n                },\n                series: [\n                    {\n                        name: '状态',\n                        type: 'pie',\n                        radius: '65%',\n                        center: ['40%', '50%'],\n                        data: []\n                    }\n                ]\n            })\n            // 部门停机时间\n            this.chart2 = this.$echarts.init(document.getElementById('dchart2'))\n            this.chart2.setOption({\n                title: {\n                    text: '部门停机时间',\n                    right: '5%',\n                    top: '15%',\n                    textStyle: {\n                        fontSize: 14\n                    }\n                },\n                label: {\n                    show: true,\n                    position: 'inside',\n                    formatter: '{c0}'\n                },\n                tooltip: {\n                    //提示框组件\n                    trigger: 'item', //触发类型,'item'数据项图形触发，主要在散点图，饼图等无类目轴的图表中使用。 'axis'坐标轴触发，主要在柱状图，折线图等会使用类目轴的图表中使用。\n                    showContent: true, //是否显示提示框浮层\n                    formatter: '{b0}: {c0}' //提示框浮层内容格式器，支持字符串模板和回调函数两种形式,模板变量有 {a}, {b}，{c}，{d}，{e}，分别表示系列名，数据名，数据值等\n                },\n                grid: {\n                    left: '7%',\n                    bottom: '7%',\n                    top: '10%',\n                    width: '70%',\n                    containLabel: true\n                },\n                xAxis: {\n                    data: []\n                },\n                yAxis: {\n                    type: 'value'\n                },\n                series: [\n                    {\n                        type: 'bar',\n                        data: []\n                    }\n                ]\n            })\n            // 停机统计\n            this.chart3 = this.$echarts.init(document.getElementById('dchart3'))\n            this.chart3.setOption({\n                title: {\n                    text: '停机统计',\n                    right: '50%',\n                    top: '5%',\n                    textStyle: {\n                        fontSize: 14\n                    }\n                },\n                label: {\n                    show: true,\n                    position: 'top',\n                    formatter: '{c0}'\n                },\n                tooltip: {\n                    //提示框组件\n                    trigger: 'item', //触发类型,'item'数据项图形触发，主要在散点图，饼图等无类目轴的图表中使用。 'axis'坐标轴触发，主要在柱状图，折线图等会使用类目轴的图表中使用。\n                    showContent: true, //是否显示提示框浮层\n                    formatter: '{b0}: {c0}' //提示框浮层内容格式器，支持字符串模板和回调函数两种形式,模板变量有 {a}, {b}，{c}，{d}，{e}，分别表示系列名，数据名，数据值等\n                },\n                grid: {\n                    left: '20%',\n                    right: '20%',\n                    bottom: '5%',\n                    containLabel: true\n                },\n                xAxis: {\n                    type: 'category'\n                },\n                yAxis: {\n                    type: 'value'\n                },\n                series: {\n                    name: '近七日收益',\n                    type: 'line',\n                    stack: '总量',\n                    data: []\n                }\n            })\n        },\n        getList() {\n            if (\n                this.listQuery.fmStatDimensionality == 'FMSD_DEVICE' &&\n                (!this.listQuery.deviceType ||\n                    !this.listQuery.useDept ||\n                    !this.listQuery.deviceCode)\n            ) {\n                this.$message({\n                    title: '警告',\n                    message: '请输入设备，设备类型，使用部门',\n                    type: 'warning'\n                })\n                return\n            }\n            const tmp = JSON.parse(JSON.stringify(this.listQuery))\n            // 饼图和柱图数据\n            api.queryRecords(this.listQuery).then(res => {\n                this.list1 = res.data.list\n                this.total = res.data.pages.count\n                // 折线图带查询条件，单独查询日期维度\n                tmp.fmStatDimensionality = 'FMSD_DATE'\n                delete tmp.currentPage\n                delete tmp.pageSize\n                api.queryRecords(tmp).then(res => {\n                    this.list3 = res.data\n                    this.list2 = []\n                    this.renderChart()\n                    this.formatChartData()\n                })\n            })\n        },\n        formatChartData() {\n            if (!document.getElementById('dchart1')) {\n                return\n            }\n            // 侧边选项\n            var pielegendData = this.list1.map(item =>\n                item.fieldName ? item.fieldName : item.fieldCode\n            )\n            // 主数据\n            var pieData = this.list1.map(item => {\n                return {\n                    value: item.time,\n                    name: item.fieldName ? item.fieldName : item.fieldCode\n                }\n            })\n            this.chart1.setOption({\n                legend: {\n                    data: pielegendData\n                },\n                series: {\n                    data: pieData\n                }\n            })\n            this.chart2.setOption({\n                xAxis: {\n                    data: pielegendData\n                },\n                series: {\n                    data: pieData\n                }\n            })\n            this.chart3.setOption({\n                xAxis: {\n                    data: this.list3.map(item =>\n                        item.fieldName ? item.fieldName : item.fieldCode\n                    )\n                },\n                series: {\n                    data: this.list3.map(item => item.time)\n                }\n            })\n        },\n        //表格高度计算\n        setTableHeight() {\n            this.theight = this.$myFun.getSingleTbHeight() - 200\n        },\n        handleQuery() {\n            //查询\n            this.listQuery.currentPage = 1\n            this.getList()\n        },\n        handleQuery2() {\n            //查询\n            this.listQuery.currentPage = 1\n            this.getList()\n        },\n        getList2() {\n            api.queryRecords(this.listQuery2).then(res => {\n                this.list2 = res.data.list\n                this.total2 = res.data.pages.count\n            })\n        },\n        selectRow(row) {\n            this.listQuery2 = JSON.parse(JSON.stringify(this.listQuery))\n            switch (this.listQuery.fmStatDimensionality) {\n                case 'FMSD_DEVICE_TYPE':\n                    this.listQuery2.deviceType = row.fieldCode\n                    break\n                case 'FMSD_USE_DEPT':\n                    this.listQuery2.useDept = row.fieldCode\n                    break\n                case 'FMSD_DEVICE':\n                    this.listQuery2.deviceCode = row.fieldCode\n                    break\n            }\n            this.listQuery2.fmStatDimensionality = 'FMSD_DATE'\n            this.getList2()\n        }\n    }\n}\n",null]}