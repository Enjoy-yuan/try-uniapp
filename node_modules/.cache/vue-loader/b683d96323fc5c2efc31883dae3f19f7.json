{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/exemptionList/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/exemptionList/index.vue","mtime":1596610933330},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from \"@/api/data-base/exemption-list\";\nimport Pagination from \"@/components/Pagination\";\nimport orgSelect from \"@/components/Select/orgSelect.vue\";\nimport { DICT_CODE, DT_ORG_FUNCTION, DT_ORG_TYPE, THE_STATE_OPTIONS } from \"@/utils/constant\";\nimport gysxz from \"@/components/Select/gysxz\"; //供应商选择\nimport wlxz from \"@/components/Select/wlxzbySourceList\"; //物料信息模块\n\nexport default {\n    name: \"exemptionList\",\n    components: { Pagination, orgSelect, gysxz, wlxz },\n    data () {\n        return {\n            list: null,\n            list1: null,\n            total: 0,\n            total1: 0,\n            theight: 0,\n            wlsupplierCode: \"\",\n            wlorgCode: \"\",\n            ok: false,\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                orgPurchas: undefined,\n                arrivalCompany: undefined,\n                supplierName: undefined\n            },\n            listQuery1: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                supplierCode: undefined,\n                orderNumber: undefined,\n                uncheckId: undefined\n            },\n\n            temp: {\n                orgPurchas: undefined,\n                arrivalCompany: undefined,\n                supplierCode: undefined,\n                rowId: undefined,\n                supplierName: undefined,\n                classify: undefined,\n                materielCode: undefined,\n                materielName: undefined,\n                uncheckType: 1\n            },\n            uncheckDTO: {\n                orgCode: undefined,\n                orgName: undefined,\n                rowId: undefined,\n                supplierCode: undefined,\n                supplierName: undefined,\n                toOrgCode: undefined,\n                toOrgName: undefined,\n                uncheckType: undefined,\n                method: undefined\n            },\n            uncheckItemsDTOList: [],\n            dto: {\n                orgCode: undefined,\n                orgName: undefined,\n                rowId: undefined,\n                supplierCode: undefined,\n                supplierName: undefined,\n                toOrgCode: undefined,\n                toOrgName: undefined,\n                uncheckType: undefined,\n                method: undefined\n            },\n            del: {\n                orgCode: undefined,\n                orgName: undefined,\n                rowId: undefined,\n                supplierCode: undefined,\n                supplierName: undefined,\n                toOrgCode: undefined,\n                toOrgName: undefined,\n                uncheckType: undefined\n            },\n            dtodel: {\n                materielCode: undefined,\n                materielName: undefined,\n                rowId: undefined\n            },\n            gysxzDialogFormVisible: undefined,\n            gysxzDialogFormVisible1: undefined,\n\n            // measureCode: undefined,\n            selectCode: [],\n            dialogFormVisible: false,\n            parentsRows: [],\n            dialogStatus: \"\",\n            tableKey: [0, 1],//表格索引，虚拟dom渲染表格时使用\n            isChangeAddS: false,\n            DICT_CODE: DICT_CODE,\n            DT_ORG_FUNCTION: DT_ORG_FUNCTION,\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            // dimensionOptions: DICT_CODE,\n            THE_STATE_OPTIONS: THE_STATE_OPTIONS\n        };\n    },\n    created () {\n        this.getList();\n    },\n    mounted () {\n        this.setTableHeight();\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        };\n    },\n    methods: {\n        getList () {//查询主表\n            api.queryRecords(this.listQuery).then(res => {\n                this.list = res.data.list;\n                this.total = res.data.pages.count;\n            });\n        },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 185;\n        },\n        getList1 () {//查询订单明细\n            this.listQuery1.uncheckId = this.selectlistRow.rowId;\n            api.queryRecordsmx(this.listQuery1).then(res => {\n                this.list1 = res.data.list;\n                this.total1 = res.data.pages.count;\n            });\n        },\n        //供应商显示\n        showGys (val) {\n            this.gysValue = val;\n            this.$refs.dialogRefgys.dialogVisible = true;\n        },\n        //供应商确认\n        handleGysClick (gysRows) {\n            this.supplierRows = gysRows;\n            if (this.gysValue === 'query') {\n                if (!this.supplierRows[0]) {\n                    this.listQuery.supplierCode = \"\";\n                    this.listQuery.supplierName = \"\";\n                    this.$refs.dialogRefgys.dialogVisible = false;\n                } else if (this.supplierRows.length === 1) {\n                    this.listQuery.supplierCode = this.supplierRows[0].supplierCode;\n                    this.listQuery.supplierName = this.supplierRows[0].supplierName;\n                    this.$refs.dialogRefgys.dialogVisible = false;\n                }\n            } else if (this.gysValue === 'add') {\n                if (!this.supplierRows[0]) {\n                    this.$message({\n                        title: this.$t(\"message.warning\"),\n                        message: this.$t(\"message.checkedplease\"),\n                        type: \"warning\"\n                    });\n                } else if (this.supplierRows.length === 1) {\n                    this.temp.supplierCode = this.supplierRows[0].supplierCode;\n                    this.temp.supplierName = this.supplierRows[0].supplierName;\n                    this.$refs.dialogRefgys.dialogVisible = false;\n                }\n            }\n        },\n        handleCreate () {//主表新增\n            this.resetTemp();\n            this.dialogStatus = \"create\";\n            this.dialogFormVisible = true;\n        },\n        orgname (name) {\n            this.uncheckDTO.orgName = name;\n        },\n        orgname1 (name) {\n            this.uncheckDTO.toOrgName = name;\n        },\n        create () {//主表新增\n            this.uncheckDTO.orgCode = this.temp.orgCode;\n            // this.uncheckDTO.orgName=this.temp.orgName\n            this.uncheckDTO.supplierCode = this.temp.supplierCode;\n            this.uncheckDTO.supplierName = this.temp.supplierName;\n            this.uncheckDTO.toOrgCode = this.temp.toOrgCode;\n            // this.uncheckDTO.toOrgName=this.temp.toOrgName\n            this.uncheckDTO.uncheckType = this.temp.uncheckType;\n            let dd = {\n                uncheckDTO: this.uncheckDTO,\n                uncheckItemsDTOList: [], //不能为空\n                method: \"uncheck\"\n            };\n            console.log(dd);\n            this.method = \"uncheck\";\n            api.addRecord1(dd).then(() => {\n                this.dialogFormVisible = false;\n                this.$notify({\n                    title: \"成功\",\n                    message: \"新增成功\",\n                    type: \"success\",\n                    duration: 2000\n                });\n                console.log(1);\n                this.getList();\n            });\n        },\n        handleCreatemx () {//新增明细\n            if (this.selectlistRow) {\n                setTimeout(() => {\n                    this.$refs.wlxzRef.listQuery.orgCode = this.selectlistRow.orgCode;\n                    this.$refs.wlxzRef.listQuery.supplierCode = this.selectlistRow.supplierCode;\n                    this.$refs.wlxzRef.getList();\n                }, 0);\n                this.dialogStatus = \"create1\";\n                this.gysxzDialogFormVisible1 = true;\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        create1 () { //新增明细\n            this.parentsRows2 = this.$refs.wlxzRef.listSelected;\n            if (this.parentsRows2 && this.parentsRows2.length > 0) {\n                console.log(this.parentsRows2);\n                this.uncheckItemsDTOList = [];\n                for (let i = 0; i < this.parentsRows2.length; i++) {\n                    this.uncheckItemsDTOList[i] = {}; //必须先声明它里面的每一项都是集合\n                    this.uncheckItemsDTOList[i].rowId = this.selectlistRow.rowId;\n                    this.uncheckItemsDTOList[i].materielCode = this.parentsRows2[i].materielCode;\n                    this.uncheckItemsDTOList[i].materielName = this.parentsRows2[i].materielName;\n                }\n                console.log(this.uncheckItemsDTOList);\n                let mx = {\n                    uncheckDTO: {},\n                    uncheckItemsDTOList: this.uncheckItemsDTOList,\n                    method: \"uncheckItems\"\n                };\n                api.addRecord(mx).then(() => {\n                    this.getList1();\n                    this.gysxzDialogFormVisible1 = false;\n                    this.$notify({\n                        title: \"成功\",\n                        message: \"新增成功\",\n                        type: \"success\",\n                        duration: 2000\n                    });\n                    this.$refs.wlxzRef.clearSelection();\n                });\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        handleUpdate () {//编辑\n            this.resetTemp();\n            if (this.selectlistRow) {\n                this.dialogStatus = \"update\";\n                this.dialogFormVisible = true;\n                this.temp.orgCode = this.selectlistRow.orgCode;\n                this.temp.toOrgCode = this.selectlistRow.toOrgCode;\n                this.temp.supplierCode = this.selectlistRow.supplierCode;\n                this.temp.supplierName = this.selectlistRow.supplierName;\n                this.temp.uncheckType = this.selectlistRow.uncheckType;\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        update () {//编辑\n            this.dto.orgCode = this.temp.orgCode;\n            this.dto.orgName = this.selectlistRow.orgName;\n            // console.log(this.selectlistRow1.orgName)\n            this.dto.supplierCode = this.temp.supplierCode;\n            this.dto.supplierName = this.temp.supplierName;\n            this.dto.toOrgCode = this.temp.toOrgCode;\n            this.dto.toOrgName = this.selectlistRow.toOrgName;\n            this.dto.uncheckType = this.temp.uncheckType;\n            console.log(this.dto.orgName);\n            api.updateRecord(this.selectlistRow.rowId, this.dto).then(() => {\n                this.getList();\n                this.dialogFormVisible = false;\n                this.$notify({\n                    title: \"成功\",\n                    message: \"新增成功\",\n                    type: \"success\",\n                    duration: 2000\n                });\n            });\n        },\n\n        handleDelete () {//主表删除\n            if (this.selectlistRow) {\n                this.$confirm(this.$t(\"message.isDeleteContinue\"), this.$t(\"message.prompt\"), {\n                    confirmButtonText: this.$t(\"message.confirm\"),\n                    cancelButtonText: this.$t(\"message.cancel\"),\n                    type: \"warning\"\n                }).then(() => {\n                    this.del = this.selectlistRow;\n                    api.deleteRecord(this.del).then(() => {\n                        this.getList();\n                        this.dialogFormVisible = false;\n                        this.$notify({\n                            title: this.$t(\"message.success\"),\n                            message: this.$t(\"message.deleteSuccessed\"),\n                            type: \"success\",\n                            duration: 2000\n                        });\n                    });\n                }).catch(() => {\n                    this.$message({\n                        type: \"info\",\n                        message: this.$t(\"message.deleteCanceled\")\n                    });\n                });\n            } else {\n                this.$message({\n                    title: this.$t(\"message.warning\"),\n                    message: this.$t(\"message.checkedoneplease\"),\n                    type: \"warning\"\n                });\n            }\n        },\n\n        handleDelete1 () {//删除明细\n            if (this.selectlistRow2 && this.selectlistRow2.length == 1) {\n                this.$confirm(this.$t(\"message.isDeleteContinue\"), this.$t(\"message.prompt\"), {\n                    confirmButtonText: this.$t(\"message.confirm\"),\n                    cancelButtonText: this.$t(\"message.cancel\"),\n                    type: \"warning\"\n                }).then(() => {\n                    console.log(this.selectlistRow2[0].rowId);\n                    this.dtodel.rowId = this.selectlistRow2[0].rowId;\n                    this.dtodel.materielCode = this.selectlistRow2[0].materielCode;\n                    this.dtodel.materielName = this.selectlistRow2[0].materielName;\n                    api.deleteRecordmx(this.dtodel).then(() => {\n                        this.getList1();\n                        this.dialogFormVisible = false;\n                        this.$notify({\n                            title: this.$t(\"message.success\"),\n                            message: this.$t(\"message.deleteSuccessed\"),\n                            type: \"success\",\n                            duration: 2000\n                        });\n                    });\n                }).catch(() => {\n                    this.$message({\n                        type: \"info\",\n                        message: this.$t(\"message.deleteCanceled\")\n                    });\n                })\n\n            } else {\n                this.$message({\n                    title: this.$t(\"message.warning\"),\n                    message: this.$t(\"message.checkedoneplease\"),\n                    type: \"warning\"\n                });\n            }\n        },\n        handleQuery () {\n            this.listQuery.currentPage = 1;\n            this.getList();\n        },\n        handleSizeChange (val) {\n            this.listQuery.pageSize = val;\n            this.getList();\n        },\n        handleCurrentChange (val) {\n            this.listQuery.currentPage = val;\n            this.getList();\n        },\n        handleClickgysxz () {\n            this.$refs.dialogRefgys.dialogVisible = true;\n        },\n        handleDblclickgysxz (row) {//父子页面通信\n            this.parentsRows = row;\n            // this.gysxzDialogFormVisible = false;\n        },\n        showGysxz () {\n            this.isChangeAddS = true;\n            this.gysxzDialogFormVisible = !this.gysxzDialogFormVisible;\n        },\n        update1 () {//供应商选中弹窗确认按钮\n            if (!this.isChangeAddS) {\n                if (!this.parentsRows[0]) {\n                    this.listQuery.supplierCode = \"\";\n                    this.listQuery.supplierName = \"\";\n                    this.gysxzDialogFormVisible = false;\n                } else if (this.parentsRows.length === 1) {\n                    this.listQuery.supplierCode = this.parentsRows[0].supplierCode;\n                    this.listQuery.supplierName = this.parentsRows[0].supplierName;\n                    this.gysxzDialogFormVisible = false;\n                }\n            } else {\n                if (!this.parentsRows[0]) {\n                    this.$message({\n                        title: this.$t(\"message.warning\"),\n                        message: this.$t(\"message.checkedplease\"),\n                        type: \"warning\"\n                    });\n                } else if (this.parentsRows.length === 1) {\n                    this.temp.supplierCode = this.parentsRows[0].supplierCode;\n                    this.temp.supplierName = this.parentsRows[0].supplierName;\n                    this.gysxzDialogFormVisible = false;\n                }\n                this.isChangeAddS = false;\n            }\n        },\n\n        handleDeleteBatch () {\n            if (this.selectCode.length == 0) {\n                this.$message.warning(\"请勾选记录！\");\n                return;\n            }\n            this.delete(this.selectCode);\n        },\n        selectRow (val) {//表一复选框选中方法\n            this.selectlistRow = val[val.length - 1];\n            if (val.length > 1) {\n                this.$refs.tb.clearSelection();\n                this.$refs.tb.toggleRowSelection(val.pop());\n            }\n            this.$refs.tb.setCurrentRow(this.selectlistRow);\n            if (this.selectlistRow) {\n                this.getList1();\n            }\n        },\n\n        selectRow1 (val) {//表一单击行选中方法\n            this.selectlistRow1 = val;\n            this.$refs.tb.clearSelection();\n            this.$refs.tb.toggleRowSelection(val); //单击行绑定点击事件\n        },\n\n        selectRow2 (val) {//明细表复选框选中方法\n            this.selectlistRow2 = val;\n        },\n\n        cancel () {\n            this.dialogFormVisible = false;\n        },\n        resetTemp () {\n            this.temp = {\n                measureCode: undefined,\n                measureName: undefined,\n                dimension: undefined,\n                transferRate: undefined,\n                isBase: 0,\n                isEnabled: 1,\n                remark: undefined,\n                uncheckType: 1,\n                supplierCode: undefined,\n                supplierName: undefined\n            };\n        },\n        handleClose () {\n            this.resetTemp();\n            this.$refs.temp.resetFields();\n        },\n        handleSelectionChange (selection) {\n            this.selectCode = selection.map(v => v.measureCode);\n        }\n    }\n};\n",null]}