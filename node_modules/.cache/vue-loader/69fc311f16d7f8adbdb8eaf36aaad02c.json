{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/materielTransferType/dialog/dialogAddSub2.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/materielTransferType/dialog/dialogAddSub2.vue","mtime":1596610933334},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n    createSubLeft,\n    updateSubLeft,\n    getAttrRules,\n    getPIList\n} from '@/api/data-base/material_transfer_type'\nimport { mapState } from 'vuex'\nexport default {\n    name: 'addSub2',\n    components: {},\n    props: ['statisticTypeList'],\n    data () {\n        return {\n            isEditO: false,\n            booleanValue: [\n                [\n                    {\n                        value: 1,\n                        label: '是'\n                    },\n                    {\n                        value: 0,\n                        label: '否'\n                    }\n                ],\n                [\n                    {\n                        value: 1,\n                        label: '有效'\n                    },\n                    {\n                        value: 0,\n                        label: '无效'\n                    }\n                ],\n                [\n                    {\n                        value: 1,\n                        label: '+'\n                    },\n                    {\n                        value: 0,\n                        label: '-'\n                    }\n                ]\n            ],\n            proofList: [],\n            AddSublist: {\n                wareRuleCode: '',\n                wareRuleName: '',\n                targetWareRuleCode: '',\n                status: '',\n                description: '',\n                wareRuleHandleDetails: []\n            },\n            indicateBizTypeList: [],\n            dialogStatus: 0,\n            dialogFormVisible: false,\n            rules: {\n                mainUpdateObject: [\n                    {\n                        required: true,\n                        message: '主体更新对象不能为空',\n                        trigger: 'blur'\n                    }\n                ],\n                detailUpdateObject: [\n                    {\n                        required: true,\n                        message: '明细更新对象不能为空',\n                        trigger: 'blur'\n                    }\n                ],\n                serviceName: [\n                    {\n                        required: true,\n                        message: 'service服务名称不能为空',\n                        trigger: 'blur'\n                    }\n                ]\n            }\n        }\n    },\n    mounted () {\n        this.$store.dispatch('dict/getDicData', ['dt_referdata_resource'])\n    },\n    computed: {\n        ...mapState({\n            dt_referdata_resource: state => state.dict.dt_referdata_resource\n        })\n    },\n    methods: {\n        addSubConfirm () {\n            console.log(33333, this.AddSublist)\n            createSubLeft(\n                this.AddSublist.wareRuleCode,\n                this.AddSublist,\n                'i'\n            ).then(() => {\n                this.$message({\n                    type: 'success',\n                    message: '添加成功'\n                })\n                this.$emit('refresh')\n                this.dialogFormVisible = false\n            })\n        },\n        updateSubConfirm () {\n            console.log(44444, this.AddSublist)\n            updateSubLeft(\n                this.AddSublist.wareRuleCode,\n                this.AddSublist.rowId,\n                this.AddSublist,\n                'i'\n            ).then(() => {\n                this.$message({\n                    type: 'success',\n                    message: '编辑成功'\n                })\n                this.$emit('refresh')\n                this.dialogFormVisible = false\n            })\n        },\n        setCorAttrName (row) {\n            let attributeName = ''\n            let rowId = ''\n            this.proofList.forEach(item => {\n                if (item.attributeCode === row.sourceConfigCode) {\n                    attributeName = item.attributeName\n                    rowId = item.rowId\n                }\n            })\n\n            this.AddSublist.wareRuleHandleDetails.forEach((item, index) => {\n                if (item.targetRefItemRowId === row.targetRefItemRowId) {\n                    this.AddSublist.wareRuleHandleDetails[\n                        index\n                    ].sourceConfigName = attributeName\n                    this.AddSublist.wareRuleHandleDetails[\n                        index\n                    ].sourceRefItemRowId = rowId\n                }\n            })\n        },\n        //指示凭证变化\n        changeItype () {\n            // this.AddSublist.wareRuleHandleDetails=[];\n            // let refSources = '';\n            // console.log(this.indicateBizTypeList);\n            // this.indicateBizTypeList.forEach((item,index)=>{\n            //     if(item.wareRuleCode===this.AddSublist.targetWareRuleCode){\n            //         refSources = item.refSources;\n            //     }\n            // });\n            // let queryRules = {\n            //     referentType:refSources\n            // }\n            // getAttrRules(queryRules).then(res=>{\n            //     res.forEach(item=>{\n            //         this.setDetail(item.rowId,item.objectType);\n            //     })\n            // })\n        },\n        checkVal () {\n            if (!this.AddSublist.targetWareRuleCode) {\n                return { state: false, info: '请选择指示类型' }\n            }\n            if (!this.AddSublist.wareRuleHandleDetails) {\n                return { state: false, info: '请选择对应指示名称' }\n            } else if (this.AddSublist.wareRuleHandleDetails.length) {\n                for (\n                    let i = 0;\n                    i < this.AddSublist.wareRuleHandleDetails.length;\n                    i++\n                ) {\n                    if (\n                        !this.AddSublist.wareRuleHandleDetails[i]\n                            .sourceConfigCode\n                    ) {\n                        return { state: false, info: '请选择对应指示名称' }\n                    }\n                }\n            }\n            return { state: true, info: '检验通过' }\n        },\n        setDetail (rowId, objectType) {\n            console.log(11111, rowId, objectType)\n            getPIList(rowId).then(resi => {\n                for (let j = 0; j < resi.data.length; j++) {\n                    this.AddSublist.wareRuleHandleDetails.push({\n                        targetRefRowId: rowId,\n                        targetRefItemRowId: resi.data[j].rowId,\n                        objectType: objectType,\n                        targetConfigCode: resi.data[j].attributeCode,\n                        targetConfigName: resi.data[j].attributeName\n                    })\n                }\n            })\n        },\n        //选择参照数据来源变化时状态变化\n        changeReferData (val) {\n            let queryRules = {\n                referentType: val\n            }\n            getAttrRules(queryRules).then(res => {\n                this.AddSublist.wareRuleHandleDetails = []\n                this.isEditO = false\n                res.data.forEach(item => {\n                    if (item.objectType === 1) {\n                        this.AddSublist.mainUpdateObject = item.referentObject\n                    } else if (item.objectType === 2) {\n                        this.AddSublist.detailUpdateObject = item.referentObject\n                    }\n                    this.setDetail(item.rowId, item.objectType)\n                })\n                this.isEditO = true\n            })\n        }\n    }\n}\n",null]}