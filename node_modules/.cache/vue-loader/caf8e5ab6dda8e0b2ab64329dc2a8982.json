{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/inventory/inventoryRegister/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/inventory/inventoryRegister/index.vue","mtime":1596610934121},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from \"@/api/project/wms/inventory/inventoryFormation\"\nimport AuthoType from '@/components/Select/AuthoType.vue'//权限类型下拉组件\nimport Pagination from \"@/components/Pagination\";\nimport { mapState } from 'vuex';\nexport default {\n    name: \"inventoryRegister\",\n    components: { Pagination, AuthoType },\n    data () {\n        return {\n            modalnum: null,//模板编号，非模板页面可删\n            theight: 0,//表格高度\n            isSingle: true,//表格是否单选 点击各按钮根据流程逻辑控制单多选\n            list: [],\n            listSub: null,\n            total: 0,\n            selectRows: [],\n            dialogGys: false,\n            dialogFormVisible: false,\n            supplierRows: [],\n            isChangeAddS: false,\n            listQuery: {\n                method: 'enter',\n                page: true,\n                currentPage: 1,\n                pageSize: 15,\n                orgCode: '',//组织编码\n                warehouseCode: '',//仓库编码\n                inventoryType: '',//盘点方式，类型\n                actived: '',//冻结方式:0锁库，1未锁库\n                inventoryDate: ''//盘点日期\n            },\n            sublistQuery: {\n                inventoryNo: ''\n            },\n            tableKey: 0\n        };\n    },\n    computed: {\n        ...mapState({\n            dt_inventory_type: state => state.dict.dt_inventory_type,\n            dt_stock_status: state => state.dict.dt_stock_status\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", ['dt_inventory_type', 'dt_stock_status']);\n        this.setTableHeight();\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        };\n    },\n    methods: {\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight();\n        },\n        //主表数据获取\n        getListData () {\n            api.queryRecords(this.listQuery).then(res => {\n                res = res.data;\n                this.list = res.list;\n            })\n        },\n        //显示主表\n        getList () {\n            this.getListData();\n        },\n        getSubList () {\n            this.sublistQuery.inventoryNo = this.selectRows.inventoryNo;\n            api.queryRowRecords(this.sublistQuery).then(res => {\n                res = res.data;\n                this.listSub = res;\n                this.dialogFormVisible = true;\n            });\n        },\n        //查询\n        handleQuery () {\n            this.listRow = [];\n            this.listQuery.currentPage = 1;\n            this.getList();\n        },\n        //每页大小变化\n        handleSizeChange (val) {\n            this.listQuery.pageSize = val;\n            this.getList();\n        },\n        //当前页变化\n        handleCurrentChange (val) {\n            this.listQuery.currentPage = val;\n            this.getList();\n        },\n        //确认\n        handleConfirm () {\n            if (this.selectRows) {\n                if (this.selectRows.inventoryStateName) {\n                    this.$confirm('是否要确认该盘点单?', this.$t('message.prompt'), {\n                        confirmButtonText: this.$t('message.yes'),\n                        cancelButtonText: this.$t('message.no'),\n                        type: 'warning'\n                    }).then(() => {\n                        let dataList = {};\n                        dataList.inventoryNoList = new Array();\n                        dataList.inventoryNoList.push(this.selectRows.inventoryNo)\n                        dataList.method = \"commit\";\n                        api.updateRecords(dataList).then(() => {\n                            this.getList();\n                            this.$message({\n                                type: 'success',\n                                message: '确认成功'\n                            });\n                        });\n                    }).catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: this.$t('已取消确认')\n                        });\n                    });\n                } else {\n                    this.$message.warning(this.$t('message.checkedplease'));\n                    return false;\n                }\n            } else {\n                this.$message.warning(this.$t('message.checkedplease'));\n                return false;\n            }\n        },\n        //打印\n        handlePrint () {\n            if (this.selectRows) {\n                {\n                    this.$message.warning(this.$t('message.checkedplease'));\n                    return false;\n                }\n            } else {\n                this.$message.warning(this.$t('message.checkedplease'));\n                return false;\n            }\n        },\n        //导出\n        handleExport () {\n            if (this.selectRows) {\n                {\n                    this.$message.warning(this.$t('message.checkedplease'));\n                    return false;\n                }\n            } else {\n                this.$message.warning(this.$t('message.checkedplease'));\n                return false;\n            }\n        },\n        //编辑\n        handleEdit () {\n            if (this.selectRows) {\n                console.log(this.selectRows);\n                if (this.selectRows.inventoryNo) {\n                    this.getSubList();\n                } else {\n                    this.$message.warning(this.$t('message.checkedplease'));\n                    return false;\n                }\n            } else {\n                this.$message.warning(this.$t('message.checkedplease'));\n                return false;\n            }\n        },\n        selectRow (val) {\n            this.selectRows = val[val.length - 1];\n            if (val.length > 1) {\n                this.$refs.tbmain.clearSelection()\n                this.$refs.tbmain.toggleRowSelection(val[val.length - 1], 'selected')\n            }\n        },\n        //编辑保存\n        handleSave () {\n            this.$confirm(this.$t('message.isSave'), this.$t('message.prompt'), {\n                confirmButtonText: this.$t('message.yes'),\n                cancelButtonText: this.$t('message.no'),\n                type: 'warning'\n            }).then(() => {\n                api.realityRecords(this.listSub).then(() => {\n                    this.$message({\n                        type: 'success',\n                        message: '编辑成功'\n                    });\n                    this.getList();\n                    this.dialogFormVisible = false;\n                })\n            }).catch(() => {\n                this.dialogFormVisible = false;\n                this.$message({\n                    type: 'info',\n                    message: this.$t('message.canceled')\n                });\n            });\n        },\n        setdefault (val, i) {\n            if (i === 1) {\n                this.listQuery.orgCode = val;\n            } else if (i === 3) {\n                this.listQuery.warehouseCode = val;\n                this.getList();\n            }\n        },\n        //复制\n        handleCopy () {\n            this.listSub.forEach((item, index) => {\n                console.log(this.listSub, item, index)\n                this.listSub[index].inventoryNum = item.accountNum;\n            })\n        }\n    }\n};\n",null]}