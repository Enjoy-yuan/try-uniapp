{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/optNotice/optNoticeFormation/dialog/dialogAdd.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/optNotice/optNoticeFormation/dialog/dialogAdd.vue","mtime":1599136050888},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { DICT_CODE } from '@/utils/constant'\nimport caiGou from '@/components/Select/xtpt/caigou'//下拉组件\nimport dialogGysxz from '@/components/Dialog/dialogsGysxz'//供应商选择\nimport { mapState } from \"vuex\"\nimport dialogWlxzbyzsj from '@/components/Dialog/dialogWlxzbyzsj.vue'//主数据物料选择\n\n\n\nexport default {\n    name: 'dialogAdd',\n    components: { caiGou, dialogGysxz, dialogWlxzbyzsj },\n    props: ['unMutiple', 'title', 'curdialogStatus'],\n    data () {\n        return {\n            DICT_CODE: DICT_CODE,\n            isEdit: false,\n            formData: {\n                orgCode: null,\n                orgName: null,\n                supplierCode: null,\n                supplierName: null,\n                materialClassName: null,\n                platformSeries: null,\n                position: null,\n                creator: null,\n                creatorName: null,\n                remark: null\n            },\n            dataListMaterial: [],\n            listSelected: null,//已选项\n            selectRowData: null,\n            dialogVisible: false,\n            rules: {\n                orgCode: [\n                    { required: true, message: '请选择', trigger: 'blur' }\n                ],\n                materialClassName: [\n                    { required: true, message: '请选择', trigger: 'blur' }\n                ],\n                remark: [\n                    { max: 128, message: '长度应小于128个字符', trigger: 'blur' }\n                ]\n            },\n            oprateBtnConfig: [\n                { id: 0, class: 'filter-item', icon: 'el-icon-plus', clickMethod: 'showMaterial', name: '新增' },\n                { id: 1, class: 'filter-item ml_5', icon: 'el-icon-refresh-right', clickMethod: 'handleRefresh', name: '刷新' },\n            ],\n            formConfig: [\n                { type: 'commonInput', disabled: true, label: '选择通知书号', prop: 'proposalNo', width: '' },\n                { type: 'selectcaiGou', disabled: false, label: '组织编码', prop: 'orgCode', width: '', copmNum: 0 },\n                { type: 'dictSelect', disabled: false, dType: 'dt_srm_pc1', label: '业务类型', prop: 'businessType', width: '' },//wu\n                { type: 'inputBtnGys', label: '供应商', prop: 'supplierName', key: 'code', value: 'name', width: '' },\n                { type: 'textarea', label: '主要内容', prop: 'content', width: '800px', rows: \"1\" },\n                { type: 'textarea', label: '备注', prop: 'remark', width: '800px', rows: \"2\" }\n            ],\n            tableConfig: [\n                { label: '物料编码', prop: 'materialCode', align: 'center', width: '120' },\n                { label: '物料名称', prop: 'materialName', align: 'center', width: '250' },\n                { label: '特殊区分', prop: 'specialDistinction', align: 'center', width: '120' },\n                { label: '物料分类', prop: 'materialClassName', align: 'center', width: '180' },\n                { label: '材质', prop: 'materialQuality', align: 'center', width: 'auto' },\n                { label: '重量', prop: 'weight', align: 'center', width: 'auto' },\n                { label: '项目号', prop: 'projectNo', align: 'center', width: 'auto' }\n            ],\n            dialogConfig: [\n                { title: '供应商信息', isRequired: false, unMutiple: true },\n                { title: '物料主数据选择', unMutiple: false, isRequired: false }\n            ]\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_pc1: state => state.dict.dt_srm_pc1,//业务类型\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pc1\"])\n    },\n    watch: {\n        'rangeDate' (value) {\n            if (value) {\n                this.listQuery.startDate = value[0]\n                this.listQuery.endDate = value[1]\n            }\n        },\n        'formData.orgCode' (val) {\n            this.$refs.refZsjWlxz.listQuery.purchaseOrg = val\n            this.$refs.refZsjWlxz.isEdit = true\n        }\n    },\n    methods: {\n        oprateClick (id) {\n            switch (id) {\n                case 0: {\n                    this.showMaterial()\n                    break\n                }\n                case 1: {\n                    this.handleRefresh()\n                    break\n                }\n            }\n        },\n        selectName (val) {\n            this.formData.orgName = val\n        },\n        handleRefresh () {\n            this.dataListMaterial = []\n            this.isEdit = false\n        },\n        handleConfirm () {\n            this.$refs.refForm.validate((valid) => {\n                if (valid) {\n                    this.$confirm('确认保存吗?', '提示', {\n                        confirmButtonText: '确定',\n                        cancelButtonText: '取消',\n                        type: 'warning'\n                    }).then(() => {\n                        if (this.curdialogStatus === 'edit') {\n                            this.formData.selectMaterials = this.dataListMaterial\n                            let cdata = {\n                                method: \"UPDATE\",\n                                selectNoticeDTO: this.formData\n                            }\n                            this.$emit('handleDialogClick', cdata)\n                        } else if (this.curdialogStatus === 'add') {\n                            this.formData.selectMaterials = this.dataListMaterial\n                            this.$emit('handleDialogClick', this.formData)\n                        }\n                        this.dialogVisible = false\n                    }).catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消'\n                        })\n                    })\n                }\n            })\n        },\n        //表格操作删除\n        handleDelete (index, row) {\n            this.$confirm('确认要删除该数据项吗?', '提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning'\n            }).then(() => {\n                this.dataListMaterial = this.dataListMaterial.filter(item => {\n                    let isD = true\n                    if (row.rowId === item.rowId) {\n                        isD = false\n                    }\n                    return isD\n                })\n\n                this.$message({\n                    type: 'success',\n                    message: '删除成功'\n                })\n            }).catch(() => {\n                this.$message({\n                    type: 'info',\n                    message: '已取消'\n                })\n            })\n        },\n        initForm (type, row) {\n            if (this.$refs['refForm']) {\n                this.$refs['refForm'].resetFields()\n                this.$refs['refForm'].clearValidate()\n            }\n            for (let key in this.formData) {\n                this.$set(this.formData, key, null)\n            }\n            for (let key in this.formData) {\n                for (let par in row) {\n                    if (key === par) {\n                        if (row[key]) {\n                            this.$set(this.formData, key, row[key])\n                        }\n                    }\n                }\n            }\n            if (type === 'add') {\n                this.dataListMaterial = []\n            } else {\n                this.dataListMaterial = row.selectMaterials\n            }\n        },\n        showGys () {\n            this.$refs.refGys.getList()\n            this.$refs.refGys.dialogVisible = true\n        },\n        //供应商确认\n        handleGysClick (gysRows) {\n            this.$set(this.formData, 'supplierCode', gysRows[0].supplierCode)\n            this.$set(this.formData, 'supplierName', gysRows[0].supplierName)\n        },\n        //新增物料\n        showMaterial () {\n            if (this.formData.orgCode) {\n                this.$refs.refZsjWlxz.valueType = 'row'\n                this.$refs.refZsjWlxz.listSelected = JSON.parse(JSON.stringify(this.dataListMaterial))\n                this.$refs.refZsjWlxz.dialogVisible = true\n            } else {\n                this.$message({\n                    type: 'warning',\n                    message: '请先选择组织编码'\n                })\n            }\n        },\n        confirmMaterial (data) {\n            data.map(item => {\n                item.materialClass = item.materialClassification\n                item.materialClassName = item.materialClassificationName\n            })\n            this.dataListMaterial = JSON.parse(JSON.stringify(data))\n            this.isEdit = true\n        },\n        setOrgName (name) {\n            this.formData.orgName = name\n        }\n    }\n}\n",null]}