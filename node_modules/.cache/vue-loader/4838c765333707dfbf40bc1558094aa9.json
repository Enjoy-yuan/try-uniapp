{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/contractManage/supplierPerformance/dailyEvaluation/evaluationPlan/dialog/addMain.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/contractManage/supplierPerformance/dailyEvaluation/evaluationPlan/dialog/addMain.vue","mtime":1597628790264},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from \"@/api/project/srm/contractManage/evaluationPlan\"\nimport { queryRecords } from \"@/api/project/srm/dataBase/dictMaintenance\"\nimport { DICT_CODE } from '@/utils/constant'\nimport caiGou from '@/components/Select/xtpt/caigou'//下拉组件\nimport { mapState } from \"vuex\"\nimport throttle from 'lodash/throttle'\nexport default {\n    components: { caiGou },\n    data () {\n        return {\n            phaseList: [],\n            DICT_CODE: DICT_CODE,\n            dialogStatus: '',\n            temp: {\n                evaluationPlanNo: undefined,\n                orgCode: undefined,\n                evaluationType: undefined,\n                evaluationClassification: undefined,\n                evaluationCategory: undefined,\n                phases: undefined,\n                years: undefined,\n                startTime: undefined,\n                endTime: undefined,\n                evaluationCycle: undefined,\n                remark: undefined,\n            },\n            dialogVisible: false,\n            rules: {\n                orgCode: [{ required: true, message: '采购组织不能为空', trigger: 'blur' }],\n                evaluationType: [{ required: true, message: '评价类型不能为空', trigger: 'blur' }],\n                evaluationClassification: [{ required: true, message: '评价分类不能为空', trigger: 'blur' }],\n                evaluationCategory: [{ required: true, message: '评价类别不能为空', trigger: 'blur' }],\n                evaluationStage: [{ required: true, message: '评价阶段不能为空', trigger: 'blur' }],\n                evaluationYear: [{ required: true, message: '评价年度不能为空', trigger: 'blur' }],\n                startTime: [{ required: true, message: '评价起日不能为空', trigger: 'blur' }],\n                endTime: [{ required: true, message: '评价止日不能为空', trigger: 'blur' }],\n            }\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_pak: state => state.dict.dt_srm_pak,\n            dt_srm_pb1: state => state.dict.dt_srm_pb1,\n            dt_srm_pb2: state => state.dict.dt_srm_pb2,\n        })\n    },\n    watch: {\n        'temp.evaluationCategory' (val) {\n            if (!val) {\n                this.temp.evaluationStage = undefined\n                this.phaseList = []\n            }\n        },\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pak\", 'dt_srm_pb1', 'dt_srm_pb2'])\n    },\n    methods: {\n        changeData (val) {\n            this.temp.evaluationStage = undefined\n            if (val) {\n                let dto = {\n                    currentPage: 1,\n                    pageSize: 15,\n                    parentCode: val\n                }\n                queryRecords(dto).then(res => {\n                    let options = [this.dt_srm_p0]\n                    res.data.list = this.$myFun.srmCodeToName(res.data.list, options, ['state'])\n                    this.phaseList = res.data.list\n                })\n            }\n        },\n        //获取组织编码名称\n        selectName (val) {\n            this.temp.orgName = val\n        },\n        createData: throttle(function () {\n            this.$refs.dataForm.validate(valid => {\n                if (valid) {\n                    api.addRecord(this.temp).then(() => {\n                        this.$message({\n                            title: '成功',\n                            message: '新增成功',\n                            type: 'success',\n                            duration: 2000\n                        })\n                        this.dialogVisible = false\n                        this.$emit('refresh')\n                    })\n                } else {\n                    return false\n                }\n            })\n        }, 2000,\n            {\n                leading: true,\n                trailing: false\n            }\n        ),\n        updateData: throttle(function () {\n            api.updateRecord(this.temp.rowId, this.temp).then(() => {\n                this.$message({\n                    title: '成功',\n                    message: '编辑成功',\n                    type: 'success',\n                    duration: 2000\n                })\n                this.dialogVisible = false\n                this.$emit('refresh')\n            })\n        }, 2000,\n            {\n                leading: true,\n                trailing: false\n            }\n        ),\n        resetTemp () {\n            this.temp = {\n                paymentPhase: undefined,\n                planCode: undefined,\n                orgCode: undefined,\n                evaluationType: undefined,\n                evaluationClassify: undefined,\n                evaluationCategory: undefined,\n                evaluationStage: undefined,\n                year: undefined,\n                dateEnd: undefined,\n                evaluationCycle: undefined,\n                remark: undefined\n\n            }\n        }\n    }\n}\n",null]}