{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/supplierRFQ/supplierRFQAnswer/tab/tabWGcost.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/supplierRFQ/supplierRFQAnswer/tab/tabWGcost.vue","mtime":1596610934115},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { queryQuoteItem, createQuoteItem, updateQuoteItem, deleteQuoteItem, queryQuoteDetails } from \"@/api/project/srm/supplierSelect/supplierRFQ/supplierRFQAnswer\"\nexport default {\n    name: 'tabWGcost',\n    props: ['parentRowId'],\n    data () {\n        return {\n            tableData: [],\n            rules: {\n                subpartName: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                subpartCode: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                specification: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                unitPrice: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                consumptionQuota: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ],\n                rejectRate: [\n                    { required: true, message: '请填写', trigger: 'blur' }\n                ]\n            },\n            formData: {\n                subpartName: null,\n                subpartCode: null,\n                specification: null,\n                measurement: null,\n                unitPrice: null,\n                consumptionQuota: null,\n                subtotalCost: null,\n                rejectRate: null,\n                wasteLoss: null,\n                supplier: null,\n                address: null,\n                contacts: null,\n                contactNumber: null,\n                alternativeSupplier: null,\n                alternativeSupplierPrice: null\n            },\n            formConfig: [\n                { type: 'commonInput', required: true, label: '子件名称', prop: 'subpartName', width: '' },\n                { type: 'commonInput', required: true, label: '子件编码', prop: 'subpartCode', width: '' },\n                { type: 'commonInput', required: true, label: '规格型号', prop: 'specification', width: '' },\n                { type: 'commonInput', label: '计量单位', prop: 'measurement', width: '' },\n                { type: 'commonInput', required: true, label: '单价', prop: 'unitPrice', width: '' },\n                { type: 'commonInput', required: true, label: '消耗定额', prop: 'consumptionQuota', width: '' },\n                { type: 'commonInput', label: '费用小计', disabled: true, prop: 'subtotalCost', width: '' },\n                { type: 'commonInput', required: true, label: '废品率', prop: 'rejectRate', width: '' },\n                { type: 'commonInput', label: '废品损失', disabled: true, prop: 'wasteLoss', width: '' },\n                { type: 'commonInput', label: '供应商', prop: 'supplier', width: '' },\n                { type: 'commonInput', label: '地址', prop: 'address', width: '' },\n                { type: 'commonInput', label: '联系人', prop: 'contacts', width: '' },\n                { type: 'commonInput', label: '联系方式', prop: 'contactNumber', width: '' },\n                { type: 'commonInput', label: '备选供应商', prop: 'alternativeSupplier', width: '' },\n                { type: 'commonInput', label: '备选供应商价格', prop: 'alternativeSupplierPrice', width: '' }\n            ],\n            tableConfig: [\n                { label: '子件名称', prop: 'subpartName', align: 'center', width: 'auto' },\n                { label: '子件编码', prop: 'subpartCode', align: 'center', width: 'auto' },\n                { label: '规格型号', prop: 'specification', align: 'center', width: 'auto' },\n                { label: '单价', prop: 'unitPrice', align: 'center', width: 'auto' },\n                { label: '消耗定额', prop: 'consumptionQuota', align: 'center', width: 'auto' },\n                { label: '计量单位', prop: 'measurement', align: 'center', width: 'auto' },\n                { label: '费用小计', prop: 'subtotalCost', align: 'center', width: 'auto' },\n                { label: '废品率', prop: 'rejectRate', align: 'center', width: 'auto' },\n                { label: '废品损失', prop: 'wasteLoss', align: 'center', width: 'auto' },\n                { label: '供应商', prop: 'supplier', align: 'center', width: 'auto' },\n                { label: '地址', prop: 'address', align: 'center', width: 'auto' },\n                { label: '联系人', prop: 'contacts', align: 'center', width: 'auto' },\n                { label: '联系方式', prop: 'contactNumber', align: 'center', width: 'auto' },\n                { label: '备选供应商', prop: 'alternativeSupplier', align: 'center', width: 'auto' },\n                { label: '备选供应商价格', prop: 'alternativeSupplierPrice', align: 'center', width: '160' }\n            ]\n        }\n    },\n    mounted () {\n        this.getItems()\n    },\n    watch: {\n        'formData.unitPrice' (val) {\n            this.$set(this.formData, 'subtotalCost', (val * this.formData.consumptionQuota).toFixed(4))\n        },\n        'formData.consumptionQuota' (val) {\n            this.$set(this.formData, 'subtotalCost', (val * this.formData.unitPrice).toFixed(4))\n        },\n        'formData.rejectRate' (val) {\n            this.$set(this.formData, 'wasteLoss', (this.formData.subtotalCost * val).toFixed(4))\n        }\n    },\n    methods: {\n        getItems () {\n            if (this.parentRowId) {\n                queryQuoteDetails({ parentRowId: this.parentRowId, method: 'OUTSOURCING_COST' }).then(res => {\n                    this.tableData = res.data\n                    this.calculateSum()\n                })\n            }\n        },\n        calculateSum () {\n            let subtotalCosts = 0\n            let wasteLosses = 0\n\n            this.tableData.forEach(item => {\n                subtotalCosts += item.subtotalCost\n                wasteLosses += item.wasteLoss\n            })\n\n            let dataSum = { key: 'sum', subpartName: '合计', subtotalCost: subtotalCosts, wasteLoss: wasteLosses }\n            this.tableData.push(dataSum)\n        },\n        handleUpdate (row) {\n            queryQuoteItem({ rowId: row.rowId, method: 'OUTSOURCING_COST' }).then(res => {\n                this.formData = res.data\n            })\n        },\n        handleDelete (row) {\n            this.$confirm('确认删除吗?', '提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning'\n            }).then(() => {\n                deleteQuoteItem({ parentRowId: this.parentRowId, rowId: row.rowId, method: 'OUTSOURCING_COST' }).then(() => {\n                    this.getItems()\n                    this.$emit('getTotalQuotation')\n                })\n            }).catch(() => {\n                this.$message({\n                    type: 'info',\n                    message: '已取消'\n                })\n            })\n        },\n        resetForm () {\n            for (let par in this.formData) {\n                if (par !== 'parentRowId') {\n                    this.$set(this.formData, par, null)\n                }\n            }\n            this.$refs['refForm'].resetFields()\n            this.$refs['refForm'].clearValidate()\n        },\n        handleConfirm () {\n            this.$refs.refForm.validate((valid) => {\n                if (valid) {\n                    this.$confirm('确认保存吗?', '提示', {\n                        confirmButtonText: '确定',\n                        cancelButtonText: '取消',\n                        type: 'warning'\n                    }).then(() => {\n                        //outsourcingCostDTO\t原材料 DTO(OUTSOURCING_COST) 外购/协费用 DTO\n                        this.formData.parentRowId = this.parentRowId\n                        if (this.formData.rowId) {\n                            let cdata = {\n                                outsourcingCostDTO: this.formData,\n                                method: \"OUTSOURCING_COST\"\n                            }\n                            updateQuoteItem(this.formData.rowId, cdata).then(() => {\n                                this.getItems()\n                                this.$emit('getTotalQuotation')\n                                this.$message({\n                                    type: 'success',\n                                    message: '编辑成功'\n                                })\n                                this.resetForm()\n                            })\n                        } else {\n                            let cdata = {\n                                outsourcingCostDTO: this.formData,\n                                method: \"OUTSOURCING_COST\"\n                            }\n                            createQuoteItem(cdata).then(() => {\n                                this.getItems()\n                                this.$emit('getTotalQuotation')\n                                this.resetForm()\n                                this.$message({\n                                    type: 'success',\n                                    message: '新增成功'\n                                })\n                            })\n                        }\n                    }).catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消'\n                        })\n                    })\n                }\n            })\n        }\n    }\n}\n",null]}