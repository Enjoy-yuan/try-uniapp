{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/supplierRFQ/supplierRFQAnswer/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierSelection/supplierRFQ/supplierRFQAnswer/index.vue","mtime":1599136050909},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from \"@/api/project/srm/supplierSelect/supplierRFQ/supplierRFQAnswer\"\nimport { DICT_CODE } from '@/utils/constant'\nimport caiGou from '@/components/Select/xtpt/caigou'//下拉组件\nimport { mapState } from \"vuex\"\n\nimport Pagination from \"@/components/Pagination\"\n// import dialogImport from '@/components/Dialog/dialogImport'\nimport dialogGysxz from '@/components/Dialog/dialogsGysxz'//供应商选择\nimport dialogQuote from './dialog/dialogQuote'//明细报价\nimport dialogQuoteTotal from './dialog/dialogQuoteTotal'//总价报价\nimport dialogQuoteLevel1 from './dialog/dialogQuoteLevel1'//一级报价\nimport technicalResponse from './dialog/technicalResponse'//一级报价\n\nexport default {\n    name: \"supplierRFQAnswer\",\n    components: { caiGou, Pagination, dialogGysxz, dialogQuote, dialogQuoteTotal, dialogQuoteLevel1, technicalResponse },\n    data () {\n        return {\n            theight: 0,//表格高度\n            isSingle: true,//表格是否单选 点击各按钮根据流程逻辑控制单多选\n            Single: false,\n            dataList: [],\n            itemList: [],//从表数据\n            total: 0,\n            totalItem: 0,\n            listQuery: {\n                //查询\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                orgCode: null,\n                supplierName: null,\n                supplierCode: null,\n                materielCode: null,\n                rfqNo: null,\n                state: null\n            },\n            itemQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                proposalNo: null\n            },\n            DICT_CODE: DICT_CODE,\n            currentSelectedSubRow: null,//从表当前选中行\n            selectedSubRows: [],//多选时选中的所有行从表\n            currentSelectedRow: null,//当前选中的行\n            selectedRows: [],//多选时选中的所有行\n            tableKey: 0, //表格索引\n            filterConfig: [\n                { type: 'selectcaiGou', label: '采购组织', prop: 'orgCode', width: '', copmNum: 0, class: 'filter-item' },\n                { type: 'inputBtnGys', label: '供应商名称', prop: 'supplierName', width: '', class: 'ml_5' },\n                { type: 'commonInput', label: '物料编码', prop: 'materielCode', width: '', class: 'filter-item ml_5' },\n                { type: 'commonInput', label: 'RFQ单号', prop: 'rfqNo', width: '', class: 'filter-item ml_5' },\n                { type: 'dictSelect', dType: 'dt_srm_p0', label: '状态', prop: 'state', width: '', class: 'filter-item ml_5' }\n            ],\n            oprateBtnConfig: {\n                main: [\n                    { id: 0, class: 'filter-item', icon: 'el-icon-download', clickMethod: 'handleDownload', name: '邀标资料下载' },\n                    { id: 1, class: 'filter-item ml_5', icon: 'el-icon-finished', clickMethod: 'handlePlanSubmit', name: '技术方案提交' },\n                    { id: 2, class: 'filter-item ml_5', icon: 'el-icon-finished', clickMethod: 'handleQuoteSubmit', name: '报价提交' }\n                ],\n                sub: [\n                    { id: 0, class: 'filter-item', icon: 'el-icon-plus', clickMethod: 'handleRfq', name: '技术应答' },\n                    { id: 1, class: 'filter-item ml_5', icon: 'el-icon-plus', clickMethod: 'handleQuote', name: '报价' },\n                    { id: 2, class: 'filter-item ml_5', icon: 'el-icon-download', clickMethod: 'handleSorDownload', name: 'SOR下载' },\n                    { id: 3, class: 'filter-item ml_5', icon: 'el-icon-upload2', clickMethod: 'handleFileImport', name: '附件上传' },\n                    { id: 4, class: 'filter-item ml_5', icon: 'el-icon-download', clickMethod: 'handleQuoteImport', name: '报价导入' },\n                    { id: 5, class: 'filter-item ml_5', icon: 'el-icon-plus', clickMethod: 'handleQuoteView', name: '报价预览' },\n                ]\n            },\n            tableConfig: {\n                main: [\n                    { label: 'RFQ状态', prop: 'stateCN', align: 'center', width: 'auto' },\n                    { label: 'RFQ单号', prop: 'rfqNo', align: 'center', width: '160' },\n                    { label: '方案号', prop: 'planNo', align: 'center', width: 'auto' },\n                    { label: '方案描述', prop: 'planDesc', align: 'center', width: '200' },\n                    { label: '选择方式', prop: 'choiceMethodCN', align: 'center', width: 'auto' },//type: 'dictSelect', dType: 'dt_srm_pdf', label: '选择方式', prop: 'choiceMethod', \n                    { label: '是否技术应答', prop: 'technicalProposal', align: 'center', width: '150' },//wu\n                    { label: '技术应答截止时间', prop: 'technicalBidDeadline', align: 'center', width: '150' },\n                    { label: '报价截止时间', prop: 'quotationDeadline', align: 'center', width: '150' },\n                    { label: '技术开标时间', prop: 'technicalBidOpeningTime', align: 'center', width: '150' },\n                    { label: '商务开标时间', prop: 'businessOpeningTime', align: 'center', width: '150' },\n                    { label: '报价方式', prop: 'quotationMethodCN', align: 'center', width: 'auto' },\n                    { label: '采购组织', prop: 'orgName', align: 'center', width: 'auto' },\n                    { label: '编制单位', prop: 'editOrgName', align: 'center', width: 'auto' },\n                    { label: '编制人', prop: 'editorName', align: 'center', width: 'auto' },\n                    { label: '编制时间', prop: 'createTime', align: 'center', width: '150' },\n                    { label: '备注', prop: 'remark', align: 'center', width: 'auto' }\n                ],\n                sub: [\n                    { label: '是否技术应答', prop: 'technicalProposalState', align: 'center', width: '120' },//wu\n                    { label: '是否已报价', prop: 'quotedProposalState', align: 'center', width: '' },//wu\n                    { label: '是否报价提交', prop: 'quoteCommitState', align: 'center', width: '' },//wu\n                    { label: '轮次', prop: 'quoteRounds', align: 'center', width: '' },//wu\n                    { label: '当前报价', prop: 'totalPrice', align: 'center', width: '150' },\n                    { label: '上轮报价', prop: 'preTotalPrice', align: 'center', width: '150' },\n                    { label: '物料编码', prop: 'materielCode', align: 'center', width: '120' },\n                    { label: '物料名称', prop: 'materielName', align: 'center', width: '120' },\n                    { label: '物料分类', prop: 'materielClass', align: 'center', width: '200' },\n                    { label: '特殊区分', prop: 'specialDistinction', align: 'center', width: 'auto' },\n                    { label: '项目号', prop: 'projectNo', align: 'center', width: 'auto' },\n                    { label: '车型', prop: 'carType', align: 'center', width: 'auto' },//wu\n                    { label: '基准年', prop: 'baseYearQuantity', align: 'center', width: '120' },\n                    { label: '第一年需求', prop: 'firstYearQuantity', align: 'center', width: '120' },\n                    { label: '第二年需求', prop: 'secondYearQuantity', align: 'center', width: '120' },\n                    { label: '第三年需求', prop: 'thirdYearQuantity', align: 'center', width: '120' },\n                    { label: '第四年需求', prop: 'forthYearQuantity', align: 'center', width: '120' },\n                    { label: '第五年需求', prop: 'fifthYearQuantity', align: 'center', width: '120' }\n                ]\n            },\n            dialogConfig: [\n                { title: '供应商信息', isRequired: false, unMutiple: true },\n                { title1: '总价报价', title2: '一级报价', title3: '明细报价' },\n            ],\n            modalNo: 'EXTP-BAS-0001',//导入模板编号,\n            orgCode: undefined,\n            planNo: undefined\n        }\n    },\n    created () { },\n    computed: {\n        ...mapState({\n            dt_srm_pdj: state => state.dict.dt_srm_pdj,\n            dt_srm_pdf: state => state.dict.dt_srm_pdf,//选择方式\n            dt_srm_pdi: state => state.dict.dt_srm_pdi,//报价方式\n            dt_srm_pdl: state => state.dict.dt_srm_pdl,\n            dt_srm_pdm: state => state.dict.dt_srm_pdm,\n            dt_cate_platformSeries: state => state.srmBisSelect.dt_cate_platformSeries,//平台系列\n            dt_const: state => state.srmBisSelect.dt_const,//平台系列\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_pdj\", \"dt_srm_pdf\", \"dt_srm_pdi\", \"dt_srm_pdl\", \"dt_srm_pdm\"])\n        this.$store.dispatch(\"srmBisSelect/getBisData\", [\"dt_cate_platformSeries\", \"dt_const\"])\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n    },\n    methods: {\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 185\n        },\n        refresh () {\n            this.getList()\n        },\n        //获取表格数据\n        getList () {\n            if (this.listQuery.orgCode) {\n                api.queryRFQRecords(this.listQuery).then(res => {\n                    let options = [this.dt_srm_pdj, this.dt_srm_pdf, this.dt_srm_pdi]\n                    res.data = this.$myFun.codeToName(res.data, options, ['state', 'choiceMethod', 'quotationMethod'])\n                    this.dataList = res.data.list\n                    this.total = res.data.pages.count\n                    if (this.dataList.length > 0) {\n                        this.setFirstLine()\n                    }\n                })\n            } else {\n                this.$message({\n                    type: 'warning',\n                    message: '查询时组织编码不能为空'\n                })\n            }\n\n        },\n        //单条数据获取\n        getRow () {\n            console.log(this.currentSelectedRow)\n            api.queryRFQItems(this.currentSelectedRow.rfqNo).then(res => {\n                this.itemList = res.data\n                this.totalItem = res.data.length\n            })\n        },\n        //从表详情获取\n        getItem () {\n            // this.itemQuery.proposalNo = this.currentSelectedRow.proposalNo\n            // api.queryItem(this.itemQuery).then(res => {\n            //     this.itemList = res.data.list\n            //     this.totalItem = res.data.pages.count\n            // })\n        },\n        //表格查询\n        handleQuery () {\n            this.listQuery.currentPage = 1\n            this.getList()\n        },\n        //表格显示条数变化\n        handleSizeChange (val) {\n            this.listQuery.pageSize = val\n            this.getList()\n        },\n        //表格当前页变化\n        handleCurrentChange (val) {\n            this.listQuery.currentPage = val\n            this.getList()\n        },\n        handleDownload () { console.log('邀标资料下载') },\n        handlePlanSubmit () {\n            console.log('技术方案提交')\n            let hdata = {\n                method: \"SUBMIT_TECHNICAL_PROPOSAL\",\n                // replyTechnicalProposalDTO: {\n                //     materielCode: \"\",\n                //     rfqNo: this.selectedRows[0].rfqNo,\n                //     technicalProposalDTOs: [\n                //         {\n                //             attachment: \"技术\",\n                //             audit: false,\n                //             auditor: 1001,\n                //             auditorName: \"许嘉璐\",\n                //             description: \"技术\",\n                //             download: false,\n                //             rfqName: \"技术\",\n                //             rfqType: 1001,\n                //             submit: false\n                //         }\n                //     ]\n                // },\n                rfqNo: this.selectedRows[0].rfqNo\n            }\n            api.handleRecords(hdata).then(() => {\n                this.$message({\n                    type: 'success',\n                    message: '技术方案提交成功'\n                })\n                this.getList()\n            })\n        },\n        handleQuoteSubmit () {\n            let hdata = {\n                method: \"SUBMIT_QUOTED_PROPOSAL\",\n                // replyTechnicalProposalDTO: {\n                //     materielCode: \"\",\n                //     rfqNo: this.selectedRows[0].rfqNo,\n                //     technicalProposalDTOs: [\n                //         {\n                //             attachment: \"技术\",\n                //             audit: false,\n                //             auditor: 1001,\n                //             auditorName: \"许嘉璐\",\n                //             description: \"技术\",\n                //             download: false,\n                //             rfqName: \"技术\",\n                //             rfqType: 1001,\n                //             submit: false\n                //         }\n                //     ]\n                // },\n                rfqNo: this.selectedRows[0].rfqNo\n            }\n            api.handleRecords(hdata).then(() => {\n                this.$message({\n                    type: 'success',\n                    message: '报价提交成功'\n                })\n                this.getList()\n            })\n        },\n        handleRfq () {\n            console.log(this.selectedRows, 'hgf')\n            if (this.selectedSubRows && this.selectedSubRows.length > 0) {\n                this.$nextTick(() => {\n                    this.$refs.technicalResponse.dialogVisible = true\n                    this.$refs.technicalResponse.getList(this.selectedRows[0])\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请勾选记录\",\n                    type: \"warning\"\n                })\n            }\n        },\n        confirmRfq (val) {\n            let hdata = {\n                method: \"REPLY\",\n                replyTechnicalProposalDTO: {\n                    materielCodeList: this.selectedSubRows.map(v => {\n                        return v.materielCode\n                    }),\n                    rfqNo: this.selectedRows[0].rfqNo,\n                    technicalProposalDTOs: val\n                },\n                rfqNo: this.selectedRows[0].rfqNo\n            }\n            api.handleRecords(hdata).then(() => {\n                this.$message({\n                    type: 'success',\n                    message: '报价提交成功'\n                })\n                this.getList()\n            })\n        },\n        quoto () {\n            let quotationMethod = this.selectedRows[0].quotationMethod\n            let fdata = {\n                rfqNo: this.selectedRows[0].rfqNo,\n                supplierCode: this.selectedRows[0].supplierCode,\n                supplierName: this.selectedRows[0].supplierName,\n                materielCode: this.selectedSubRows[0].materielCode,\n                materielName: this.selectedSubRows[0].materielName,\n                materielClass: this.selectedSubRows[0].materielClass,\n                materielClassName: this.selectedSubRows[0].materielClassName,\n            }\n            switch (quotationMethod) {\n                case 'PDI0': {\n                    //总价\n                    let params = {\n                        method: 'TOTAL',\n                        rfqNo: this.selectedRows[0].rfqNo,\n                        materielCodes: [],\n                        quoteRounds: this.selectedSubRows[0].quoteRounds\n                    }\n                    this.selectedSubRows.forEach((val, index) => {\n                        params.materielCodes[index] = val.materielCode\n                    })\n                    params.materielCodes = params.materielCodes.join(\",\")\n                    console.log(this.selectedSubRows[0].quotedProposalState, 'pppp')\n                    if (!this.selectedSubRows[0].quotedProposalState) {\n                        this.$refs.refQuoteTotal.methodType = 'add'\n                        this.$refs.refQuoteTotal.initForm(fdata, null, this.selectedSubRows)\n                        this.$refs.refQuoteTotal.dialogVisible = true\n                    } else {\n                        api.queryQuoteRow(params).then(res => {\n                            this.$refs.refQuoteTotal.methodType = 'edit'\n                            this.$refs.refQuoteTotal.initForm(fdata, res.data, this.selectedSubRows)\n                            this.$refs.refQuoteTotal.dialogVisible = true\n                        })\n                    }\n                    break\n                }\n                case 'PDI1': {\n                    //一级\n                    let params = {\n                        method: 'FIRST',\n                        rfqNo: this.selectedRows[0].rfqNo,\n                        materielCodes: this.selectedSubRows[0].materielCode,\n                        quoteRounds: this.selectedSubRows[0].quoteRounds\n                    }\n                    if (!this.selectedSubRows[0].quotedProposalState) {\n                        this.$refs.refQuoteLevel1.methodType = 'add'\n                        this.$refs.refQuoteLevel1.resetTemp()\n                        this.$refs.refQuoteLevel1.initForm(fdata, null, 'add')\n                        this.$refs.refQuoteLevel1.dialogVisible = true\n                    } else {\n                        api.queryQuoteRow(params).then(res => {\n                            this.$refs.refQuoteLevel1.methodType = 'edit'\n                            this.$refs.refQuoteLevel1.initForm(fdata, res.data, 'edit')\n                            this.$refs.refQuoteLevel1.dialogVisible = true\n                        })\n                    }\n                    break\n                }\n                case 'PDI2': {\n                    //明细\n                    this.$refs.refQuote.orgCode = this.selectedRows[0].orgCode\n                    let params = {\n                        method: 'ITEM',\n                        rfqNo: this.selectedRows[0].rfqNo,\n                        materielCodes: this.selectedSubRows[0].materielCode,\n                        quoteRounds: this.selectedSubRows[0].quoteRounds\n                    }\n                    this.$refs.refQuote.params = params\n                    if (!this.selectedSubRows[0].quotedProposalState) {\n                        this.$refs.refQuote.methodType = 'add'\n                        this.$refs.refQuote.initForm(fdata, null)\n                        this.$refs.refQuote.dialogVisible = true\n                    } else {\n                        api.queryQuoteRow(params).then(res => {\n                            this.$refs.refQuote.methodType = 'edit'\n                            this.$refs.refQuote.initForm(fdata, res.data)\n                            this.$refs.refQuote.dialogVisible = true\n                        })\n                    }\n                    break\n                }\n            }\n        },\n        handleQuote () {\n            if (this.selectedSubRows.length > 0 && this.selectedRows.length) {\n                if (this.selectedRows[0].quotationMethod !== \"PDI0\") {\n                    if (this.selectedSubRows.length > 1) {\n                        this.$message({\n                            title: \"警告\",\n                            message: \"请勾选一条记录\",\n                            type: \"warning\"\n                        })\n                    } else {\n                        this.quoto()\n                    }\n                } else {\n                    if (this.selectedSubRows.length > 1) {\n                        let status = this.selectedSubRows.some((value) => {\n                            // debugger\n                            return value !== this.selectedSubRows[0]\n                        })\n                        if (!status) {\n                            this.$message({\n                                title: \"警告\",\n                                message: \"请选择轮次一样的数据进行批量操作\",\n                                type: \"warning\"\n                            })\n                        }\n                    }\n                    this.quoto()\n                }\n            } else {\n                this.$message({\n                    type: 'warning',\n                    message: '请先选择一条数据'\n                })\n            }\n        },\n        handleSorDownload () { console.log('SOR下载') },\n        handleFileImport () { console.log('附件上传') },\n        handleQuoteImport () { console.log('报价导入') },\n        handleQuoteView () { console.log('报价预览') },\n        //操作按钮事件\n        oprateClick (clickMethod) {\n            switch (clickMethod) {\n                case 'handleDownload': {\n                    this.handleDownload()\n                    break\n                }\n                case 'handlePlanSubmit': {\n                    this.handlePlanSubmit()\n                    break\n                }\n                case 'handleQuoteSubmit': {\n                    this.handleQuoteSubmit()\n                    break\n                }\n                case 'handleRfq': {\n                    this.handleRfq()\n                    break\n                }\n                case 'handleQuote': {\n                    this.handleQuote()\n                    break\n                }\n                case 'handleSorDownload': {\n                    this.handleSorDownload()\n                    break\n                }\n                case 'handleFileImport': {\n                    this.handleFileImport()\n                    break\n                }\n                case 'handleQuoteImport': {\n                    this.handleQuoteImport()\n                    break\n                }\n                case 'handleQuoteView': {\n                    this.handleQuoteView()\n                    break\n                }\n            }\n        },\n        selectChangeSub (val) {\n            if (this.Single) {\n                if (val.length > 1) {\n                    this.$refs.tbSub.clearSelection() //清除其他行的选中\n                    this.$refs.tbSub.toggleRowSelection(val[val.length - 1], \"selected\") //单击行绑定点击事件\n                } else if (val.length === 1) {\n                    this.selectedSubRows = val\n                    this.currentSelectedSubRow = val[val.length - 1]\n                } else if (val.length === 0) {\n                    this.selectedSubRows = val\n                    this.currentSelectedSubRow = null\n                }\n            } else {\n                this.selectedSubRows = val\n                this.currentSelectedSubRow = val[val.length - 1]\n            }\n        },\n        // 表格选择框选中 注:参数为选中的所有行的数组\n        selectChange (val) {\n            if (this.isSingle) {\n                if (val.length > 1) {\n                    this.$refs.tb.clearSelection() //清除其他行的选中\n                    this.$refs.tb.toggleRowSelection(val[val.length - 1], \"selected\") //单击行绑定点击事件\n                } else if (val.length === 1) {\n                    this.selectedRows = val\n                    this.currentSelectedRow = val[val.length - 1]\n                    this.getRow()\n                } else if (val.length === 0) {\n                    this.selectedRows = val\n                    this.currentSelectedRow = null\n                    // this.itemList = []\n                }\n            } else {\n                this.selectedRows = val\n                this.currentSelectedRow = val[val.length - 1]\n                this.getRow()\n            }\n        },\n        //加载时默认选中第一行\n        setFirstLine () {\n            this.$nextTick(() => {\n                this.$refs.tb.toggleRowSelection(this.dataList[0], \"selected\")\n                this.$refs.tb.setCurrentRow(this.dataList[0])\n            })\n        },\n        showGys () {\n            this.$refs.refGys.dialogVisible = true\n        },\n        //供应商确认\n        handleGysClick (gysRows) {\n            this.$set(this.listQuery, 'supplierCode', gysRows[0].supplierCode)\n            this.$set(this.listQuery, 'supplierName', gysRows[0].supplierName)\n        },\n        //默认选中采购\n        setCaigou (options) {\n            if (options) {\n                if (options.length > 0) {\n                    this.listQuery.orgCode = options[0].organizationCode\n                    this.getList()\n                }\n            }\n        },\n    }\n};\n",null]}