{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/newProducts/projectManagement/projectMasterData/dialog/addMain.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/newProducts/projectManagement/projectMasterData/dialog/addMain.vue","mtime":1597995949100},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from \"@/api/project/srm/newProducts/projectMasterData\"\nimport { queryRecords } from \"@/api/project/srm/dataBase/dictMaintenance\"\nimport { DICT_CODE } from '@/utils/constant'\nimport caiGou from '@/components/Select/xtpt/caigou'//下拉组件\nimport dialogPersonSelect from '@/components/Dialog/dialogPersonSelect.vue'//选择人\nimport throttle from 'lodash/throttle'\nimport { mapState } from \"vuex\"\n\nexport default {\n    components: { caiGou, dialogPersonSelect },\n    data () {\n        return {\n            typeList: [],\n            dialogStatus: \"\",\n            dialogVisible: false,\n            person: \"\",\n            DICT_CODE: DICT_CODE,\n            dialogPersonVisible: false,\n            titlePerson: \"\",\n            parentsRows: [],\n            rowId: null,\n            temp: {\n                rowId: undefined,\n                companyCode: undefined,\n                companyName: undefined,\n                years: undefined,\n                projectApprovalTime: undefined,\n                projectCode: undefined,\n                projectName: undefined,\n                platformOrProduct: undefined,\n                projectType: undefined,\n                projectStartTime: undefined,\n                projectEndTime: undefined,\n                projectPrincipal: undefined,\n                purchaseAdminName: undefined,\n                contactWay: undefined,\n                remark: undefined\n            },\n            rules: {\n                companyCode: [{ required: true, message: '公司编码不能为空', trigger: 'blur' }],\n                orgCode: [{ required: true, message: '组织编码不能为空', trigger: 'blur' }],\n                years: [{ required: true, message: '年度不能为空', trigger: 'blur' }],\n                projectApprovalTime: [{ required: true, message: '项目立项日期不能为空', trigger: 'blur' }],\n                projectCode: [{ required: true, message: '项目编号不能为空', trigger: 'blur' }],\n                projectName: [{ required: true, message: '项目名称不能为空', trigger: 'blur' }],\n                platformOrProduct: [{ required: true, message: '平台/产品不能为空', trigger: 'blur' }],\n                projectType: [{ required: true, message: '项目类型不能为空', trigger: 'blur' }],\n                projectStartTime: [{ required: true, message: '开始日期不能为空', trigger: 'blur' }],\n                projectEndTime: [{ required: true, message: '结束日期不能为空', trigger: 'blur' }],\n                projectPrincipal: [{ required: true, message: '采购负责人不能为空', trigger: 'blur' }],\n            }\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_p0: state => state.dict.dt_srm_p0\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_p0\"])\n        this.getTypeData()\n    },\n    methods: {\n        initForm () {\n            this.temp = {\n                rowId: undefined,\n                companyCode: undefined,\n                companyName: undefined,\n                years: undefined,\n                projectApprovalTime: undefined,\n                projectCode: undefined,\n                projectName: undefined,\n                platformOrProduct: undefined,\n                projectType: undefined,\n                projectStartTime: undefined,\n                projectEndTime: undefined,\n                projectPrincipal: undefined,\n                purchaseAdminName: undefined,\n                contactWay: undefined,\n                remark: undefined\n            }\n            this.$refs.dataForm.resetFields()\n            this.$refs.dataForm.clearValidate()\n        },\n        handleClose () {\n            this.initForm()\n            this.$refs.dataForm.resetFields()\n            this.$refs.dataForm.clearValidate()\n        },\n        // 获得项目类型下拉数据\n        getTypeData () {\n            let dto = {\n                currentPage: 1,\n                pageSize: 15,\n                parentCode: 'dt_srm_pb7'\n            }\n            queryRecords(dto).then(res => {\n                let options = [this.dt_srm_p0]\n                res.data.list = this.$myFun.srmCodeToName(res.data.list, options, ['state'])\n                this.typeList = res.data.list\n            })\n        },\n        handleClassifyCode () {\n            this.$refs.classify.dialogCodeVisible = true\n        },\n        //人员选择\n        handlePersonCode (val) {\n            this.person = val\n            if (this.person == 'xmPerson') {\n                this.titlePerson = '项目负责人'\n            } else if (this.person == 'cgPerson') {\n                this.titlePerson = '采购负责人'\n            }\n            this.$refs.person.dialogVisible = true\n        },\n        //人员选择确定\n        personConfirm (val) {\n            // console.log(val[0].employeeName)\n            if (this.titlePerson === '项目负责人') {\n                this.$set(this.temp, 'projectPrincipal', val[0].employeeCode)\n                this.$set(this.temp, 'projectPrincipalName', val[0].employeeName)\n            }\n            if (this.titlePerson === '采购负责人') {\n                this.$set(this.temp, 'purchasePrincipal', val[0].employeeCode)\n                this.$set(this.temp, 'purchasePrincipalName', val[0].employeeName)\n            }\n        },\n        //获取组织编码名称\n        selectName (val) {\n            this.temp.orgName = val\n        },\n        //获取采购组名称\n        selectCompany (val) {\n            this.temp.companyName = val\n        },\n        createData: throttle(function () {\n            this.$refs.dataForm.validate(valid => {\n                if (valid) {\n                    api.createRecords(this.temp).then(() => {\n                        this.$message({\n                            title: '成功',\n                            message: '新增成功',\n                            type: 'success',\n                            duration: 2000\n                        })\n                        this.dialogVisible = false\n                        this.$emit('refresh')\n                    })\n                } else {\n                    return false\n                }\n            })\n        }, 2000,\n            {\n                leading: true,\n                trailing: false\n            }\n        ),\n        updateData: throttle(function () {\n            api.updateRecords(this.temp.rowId, this.temp).then(() => {\n                this.$message({\n                    title: '成功',\n                    message: '编辑成功',\n                    type: 'success',\n                    duration: 2000\n                })\n                this.dialogVisible = false\n                this.$emit('refresh')\n            })\n        }, 2000,\n            {\n                leading: true,\n                trailing: false\n            }\n        ),\n        listSelected (val) {\n            this.temp.parentRowId = val[0].parentRowId\n            this.$refs.classify.dialogCodeVisible = false\n        },\n        resetTemp () {\n            this.temp = {\n                orgCode: undefined,\n                classCode: undefined,\n                className: undefined,\n                purchaseOrgCode: undefined,\n                purchaseSupporter: undefined,\n                purchaseAdmin: undefined,\n                businessPeople: undefined,\n                platform: true,\n                remark: undefined\n\n            }\n        }\n    }\n}\n",null]}