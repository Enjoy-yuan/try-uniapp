{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/knProcessing/knjgPlan/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/knProcessing/knjgPlan/index.vue","mtime":1596610934129},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport * as api from \"@/api/project/wms/knProcessing/knjgplan.js\";\nimport AuthoType from \"@/components/Select/AuthoType.vue\"; //权限类型下拉组件\nimport knbomwlxz from '@/components/Select/knbomwlxz'//bom物料信息模块\nimport Pagination from \"@/components/Pagination\";\nimport dialogAddMain from \"./Dialog/DialogAddMain\";\nimport { mapState } from \"vuex\";\n// mapActions\n\nexport default {\n    name: \"knjgPlan\",\n    components: {\n        Pagination,\n        AuthoType,\n        dialogAddMain,\n        knbomwlxz\n    },\n    data () {\n        return {\n            list: null,\n            listSub: null,\n            AddMainlist: {},\n            total: 0,\n            totalSub: 0,\n            rangeTime: \"\",\n            selectRows: [],\n            unMutiplebom: false,\n            bomwlxzDialogFormVisible: false,\n            bomwlxzRows: [],\n            bomType: 'stores_processing_bom',\n            stateList: [\n                { key: '编制', value: 0 },\n                { key: '发布', value: 1 },\n                { key: '关闭', value: 2 },\n            ],\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                orgCode: \"\",\n                warehouseCode: \"\",\n                state: \"\"\n            },\n            sublistQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10\n            },\n            tableKey: 0,\n            businessTypeList: [],\n            addorgcode: ''\n        };\n    },\n    computed: {\n        ...mapState({\n            dt_pullmaterial_type: state => state.dict.dt_pullmaterial_type,\n            dt_pullmaterial_state: state => state.dict.dt_pullmaterial_state,\n            dt_business_type_screenGroupNum_zsknjg: state => state.businessComponent.dt_business_type_screenGroupNum_zsknjg\n        })\n    },\n\n    mounted () {\n        this.$store.dispatch('businessComponent/getBusinessComponentData', ['dt_business_type_screenGroupNum_zsknjg']);\n        this.$store.dispatch(\"dict/getDicData\", [\n            \"dt_pullmaterial_type\",\n            \"dt_pullmaterial_state\"\n        ]);\n        setTimeout(() => {\n            this.businessTypeList = this.dt_business_type_screenGroupNum_zsknjg.options;\n        }, 500);\n    },\n    methods: {\n        //主表数据获取\n        getListData () {\n            api.queryRecords(this.listQuery).then(res => {\n                this.list = res.data.list;\n                this.total = res.data.pages.count;\n            });\n        },\n        //显示主表\n        getList () {\n            if (this.rangeTime) {\n                var d1 = this.rangeTime[0];\n                var d2 = this.rangeTime[1];\n                this.listQuery.planDateBegin = d1;\n                this.listQuery.planDateEnd = d2;\n            } else {\n                this.listQuery.planDateBegin = null;\n                this.listQuery.planDateEnd = null;\n            }\n            this.listSub = []\n            this.getListData();\n        },\n        //显示从表\n        getSubList () {\n            let row = this.selectRows[this.selectRows.length - 1];\n            this.sublistQuery.method = 'plan';\n            this.sublistQuery.orgCode = row.orgCode;\n            this.sublistQuery.warehouseCode = row.warehouseCode;\n            this.sublistQuery.dicType = row.dicType;\n            this.sublistQuery.planNo = row.planNo;\n            if (this.rangeTime) {\n                var d1 = this.rangeTime[0];\n                var d2 = this.rangeTime[1];\n                this.sublistQuery.planDateBegin = d1;\n                this.sublistQuery.planDateEnd = d2;\n            } else {\n                this.sublistQuery.planDateBegin = null;\n                this.sublistQuery.planDateEnd = null;\n            }\n            api.queryRecordsDetail(this.sublistQuery).then(res => {\n                this.listSub = res.data.list;\n                this.totalSub = res.data.pages.count;\n            });\n        },\n        //查询\n        handleQuery () {\n            if (!this.listQuery.orgCode || !this.listQuery.warehouseCode || !this.listQuery.dicType) {\n                this.$message({\n                    title: this.$t(\"message.warning\"),\n                    message: '请先选择组织编码,仓库编码及业务类型再搜索',\n                    type: \"warning\"\n                });\n            } else {\n                this.getList();\n            }\n        },\n        //每页大小变化\n        handleSizeChange (val) {\n            this.listQuery.pageSize = val;\n            this.getList();\n        },\n        //当前页变化\n        handleCurrentChange (val) {\n            this.listQuery.currentPage = val;\n            this.getList();\n        },\n        //主表勾选框选中\n        selectRow (val) {\n            if (val[val.length - 1]) {\n                this.selectRows = [val[val.length - 1]];\n            } else {\n                this.selectRows = []\n            }\n\n            if (val.length > 1) {\n                this.$refs.tbmain.clearSelection()\n                this.$refs.tbmain.toggleRowSelection(val[val.length - 1], 'selected')\n            }\n\n            if (val.length !== 0) {\n                this.getSubList(val[val.length - 1]);\n            }\n        },\n        //新增\n        handleCreate () {\n            if (!this.listQuery.dicType) {\n                this.$message({\n                    title: this.$t(\"message.warning\"),\n                    message: '请先选择业务类型再进行新增操作',\n                    type: \"warning\"\n                });\n            } else {\n                this.$refs.addMain.AddMainlist = {};\n                this.$refs.addMain.isEdit = false;\n                this.$refs.addMain.selectedDetails = null;\n                this.$refs.addMain.titleShow(0);\n                this.$refs.addMain.dialogFormVisible = true;\n                this.$refs.addMain.planDetailCreateDTOList = []\n            }\n        },\n        //删除\n        handleDelete () {\n            if (this.selectRows.length) {\n                this.$confirm(\n                    this.$t(\"message.isDeleteContinue\"),\n                    this.$t(\"message.prompt\"),\n                    {\n                        confirmButtonText: this.$t(\"message.confirm\"),\n                        cancelButtonText: this.$t(\"message.cancel\"),\n                        type: \"warning\"\n                    }\n                ).then(() => {\n                    let processingPlanList = [];\n                    this.selectRows.forEach((item) => {\n                        processingPlanList.push(item.planNo);\n                    });\n                    api.deleteRecords(processingPlanList).then(() => {\n                        this.getList();\n                        this.$message({\n                            type: \"success\",\n                            message: this.$t(\"message.deleteSuccessed\")\n                        });\n                    });\n                })\n            } else {\n                this.$message.warning(this.$t(\"message.checkedplease\"));\n                return false;\n            }\n        },\n        //修改\n        handleUpdate () {\n            if (this.selectRows.length === 1) {\n                let uq = {\n                    page: true,\n                    currentPage: 1,\n                    pageSize: 10,\n                    orgCode: this.selectRows[0].orgCode,\n                    warehouseCode: this.selectRows[0].warehouseCode,\n                    dicType: this.selectRows[0].dicType,\n                    planNo: this.selectRows[0].planNo\n                }\n                api.queryRecords(uq).then(res => {\n                    console.log(res)\n                    this.$refs.addMain.titleShow(1);\n                    this.$refs.addMain.AddMainlist = res.data.list[0];\n                    let udq = {\n                        page: true,\n                        currentPage: 1,\n                        pageSize: 1000\n                    }\n                    let row = this.selectRows[0];\n                    udq.method = 'plan';\n                    udq.orgCode = row.orgCode;\n                    udq.warehouseCode = row.warehouseCode;\n                    udq.dicType = row.dicType;\n                    udq.planNo = row.planNo;\n                    if (this.rangeTime) {\n                        var d1 = this.rangeTime[0];\n                        var d2 = this.rangeTime[1];\n                        udq.planDateBegin = d1;\n                        udq.planDateEnd = d2;\n                    } else {\n                        udq.planDateBegin = null;\n                        udq.planDateEnd = null;\n                    }\n                    api.queryRecordsDetail(udq).then(res => {\n                        this.$refs.addMain.planDetailCreateDTOList = res.data.list;\n                        this.$refs.addMain.isEdit = true;\n                    });\n                    this.$refs.addMain.dialogFormVisible = true;\n                });\n            } else {\n                this.$message.warning('请选择一条信息');\n                return false;\n            }\n        },\n        //发布\n        handlePublish () {\n            if (this.selectRows.length > 0) {\n                this.$confirm(\n                    this.$t(\"message.isPublishOrder\"),\n                    this.$t(\"message.prompt\"),\n                    {\n                        confirmButtonText: this.$t(\"message.confirm\"),\n                        cancelButtonText: this.$t(\"message.cancel\"),\n                        type: \"warning\"\n                    }\n                ).then(() => {\n                    let processingPlanList = [];\n                    this.selectRows.forEach((item) => {\n                        processingPlanList.push(item.planNo);\n                    });\n                    let publishData = {\n                        method: \"publish\",\n                        processingPlanList: processingPlanList\n                    }\n                    api.publishRecords(publishData).then(() => {\n                        this.$message({\n                            type: \"success\",\n                            message: \"发布成功\"\n                        });\n                        this.getList();\n                    });\n                })\n            } else {\n                this.$message.warning(this.$t(\"message.checkedplease\"));\n                return false;\n            }\n        },\n        showbomwl (val) {\n            this.addorgcode = val;\n            this.bomwlxzDialogFormVisible = true;\n            this.$nextTick(() => {\n                this.$refs.bomwlxzRef.getList1();\n            })\n        },\n        handlebomwlClick (val) {\n            this.bomwlxzRows = val;\n        },\n        bomwlConfirm () {\n            //物料选中中弹窗确认按钮\n            if (this.bomwlxzRows.length) {\n                let bomAble = true\n                this.bomwlxzRows.forEach(item => {\n                    if (!item.measuringUnit) {\n                        bomAble = false\n                    }\n                })\n                if (bomAble) {\n                    this.$refs.addMain.setBomM(this.bomwlxzRows);\n                    this.bomwlxzDialogFormVisible = false;\n                } else {\n                    this.$message({\n                        title: this.$t(\"message.warning\"),\n                        message: '请选择有计量单位的bom数据',\n                        type: \"warning\"\n                    });\n                }\n\n            } else {\n                this.$message({\n                    title: this.$t(\"message.warning\"),\n                    message: this.$t(\"message.checkedplease\"),\n                    type: \"warning\"\n                });\n            }\n        },\n        // 设置业务类型\n        setBT (val) {\n            this.$refs.addMain.setDictype(val);\n        },\n        refresh () {\n            this.getList();\n            this.listSub = [];\n        },\n        rowClick (row) {\n            this.$refs.tbmain.toggleRowSelection(row, true)\n        }\n    }\n};\n",null]}