{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/OA/purchase/purchased-confirmation/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/OA/purchase/purchased-confirmation/index.vue","mtime":1596610933592},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport * as api from \"@/api/project/oa/purchase/purchased-confirmation\";\nimport Pagination from \"@/components/Pagination\";\nimport orgSelect from \"@/components/Select/orgSelect.vue\";\nimport { DICT_CODE, DT_ORG_TYPE, THE_STATE_OPTIONS } from \"@/utils/constant\";\nimport gysxz from \"@/components/Select/xtpt/gysxz\"; //供应商选择\nimport { getDomainName, getDomainId } from \"@/utils/auth\";\nimport { mapState } from \"vuex\";\nexport default {\n    name: \"purchased-confirmation\",\n    components: { Pagination, gysxz, orgSelect },\n    data () {\n        return {\n            modalnum: null,//模板编号\n            theight: 0,\n            tableKey: [0, 1],//表格索引，虚拟dom渲染表格时使用\n            isSingle: true,//表格是否单选 点击各按钮根据流程逻辑控制单多选\n            currentSelectedRow: null,//当前选中的行\n            selectedRows: null,//多选时选中的所有行\n            isGysRequired: false,//供应商非必选\n            gysMutiple: true,//供应商单选\n            list: null,\n            list1: null,\n            list2: null,\n            total: 0,\n            value1: \"\",\n            value2: \"\",\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                arrivalCompany: undefined,\n                orderNumber: undefined,\n                arrivalDateStart: undefined,\n                arrivalDateEnd: undefined,\n                state: \"RELEASE\",\n                supplierCode: undefined\n            },\n            listQuery1: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                supplierCode: undefined,\n                orderNumber: undefined\n            },\n            listQuery2: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10\n            },\n            isEaid: false,\n            temp: {\n                orderNumber: undefined,\n                orgCode: undefined,\n                groupCode: undefined,\n                supplierCode: getDomainId(),\n                businessType: undefined,\n                purchaseEmp: undefined,\n                state: undefined,\n                createTime: undefined,\n                releaseTime: undefined,\n                confirmDate: undefined,\n                remark: undefined,\n                rowNo: undefined,\n                materielCode: undefined,\n                materielName: undefined,\n                materielColor: undefined,\n                arrivalCompany: undefined,\n                arrivalRepository: undefined,\n                orderQuantity: undefined,\n                arrivalDate: undefined,\n                provide: undefined,\n                issueDate: undefined\n            },\n            selectCode: [],\n            dialogFormVisible: false,\n            dialogStatus: \"\",\n            DICT_CODE: DICT_CODE,\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            // dimensionOptions: DICT_CODE,\n            THE_STATE_OPTIONS: THE_STATE_OPTIONS\n        };\n\n    },\n    computed: {\n        ...mapState({\n            dt_dd_state: state => state.dict.dt_dd_state,\n            dt_ckyw_tpye: state => state.dict.dt_ckyw_tpye\n        })\n    },\n    mounted () {\n        this.setTableHeight();\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        };\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_dd_state\", \"dt_ckyw_tpye\"]);\n        this.getList2();\n    },\n    watch: {\n        tb () {\n            this.$nextTick(() => {\n                this.$refs.tb.toggleRowSelection(this.tb[0], true);\n            })\n        },\n    },\n    methods: {\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 185;\n        },\n        showGysxz () {\n            this.$refs.dialogRefgys.dialogVisible = !this.$refs.dialogRefgys.dialogVisible;\n        },\n        //供应商确认\n        handleGysClick (gysRows) {\n            this.parentsRows = gysRows;\n            if (!this.parentsRows[0]) {\n                this.$message({\n                    title: this.$t('message.warning'),\n                    message: this.$t('message.checkedoneplease'),\n                    type: \"warning\"\n                });\n            } else {\n                if (this.parentsRows.length && this.parentsRows.length == 1) {\n                    this.listQuery.supplierCode = this.parentsRows[0].supplierCode;\n                    this.temp.supplierName = this.parentsRows[0].supplierName;\n                    this.gysxzDialogFormVisible = false;\n                } else {\n                    this.$message({\n                        title: \"警告\",\n                        message: \"请选择一条信息\",\n                        type: \"warning\"\n                    });\n                }\n            }\n        },\n        getList2 () {\n            if (getDomainName() == 'supplier') {\n                this.listQuery.supplierCode = getDomainId()\n                this.isEaid = true;\n            } else {\n                this.isEaid = false;\n            }\n        },\n        getList () {//查询\n            if (this.value1) {\n                var d1 = this.value1[0];\n                var d2 = this.value1[1];\n                this.listQuery.arrivalDateStart = d1;\n                this.listQuery.arrivalDateEnd = d2;\n            } else {\n                this.listQuery.arrivalDateStart = \"\";\n                this.listQuery.arrivalDateEnd = \"\";\n            }\n            // this.listQuery.supplierCode = this.temp.supplierCode;\n            //  this.isEaid=true\n            this.listQuery.arrivalCompany = this.listQuery.orgCode;\n            this.listQuery.state = this.listQuery.state;\n            this.listQuery.orderNumber = this.listQuery.orderNumber;\n            this.list1 = []\n            api.queryRecords(this.listQuery).then(res => {\n                let options = [this.dt_dd_state, this.dt_ckyw_tpye];\n                res = this.$myFun.codeToName(res.data, options, [\"state\", \"businessType\"]);\n                this.list = res.list;\n                this.list.map(v => {\n                    this.list.supplierCode = v.supplierCode;\n                    this.list.orderNumber = v.orderNumber;\n                });\n                this.total = res.pages.count;\n                if (this.list && this.list.length > 0) {\n                    this.getList1();\n                }\n            });\n        },\n        getList1 () {//查询订单明细\n            if (this.selectlistRow) {\n                this.listQuery1.supplierCode = this.selectlistRow.supplierCode;\n                this.listQuery1.orderNumber = this.selectlistRow.orderNumber;\n                api.queryRecords1(this.listQuery1).then(res => {\n                    this.list1 = res.data.list;\n                    this.total = res.data.pages.count;\n                    this.list2 = this.list1;\n                });\n            }\n        },\n        handleConfirm () {  //单击确认按钮方法\n            if (this.selectlistRow) {\n                this.listQuery1.supplierCode = this.selectlistRow.supplierCode;\n                this.listQuery1.orderNumber = this.selectlistRow.orderNumber;\n                this.listQuery1.method = \"CONFIRM\";\n                api.confirm(this.listQuery1).then(() => {\n                    this.getList();\n                    this.$message({\n                        title: \"成功\",\n                        message: \"确认成功\",\n                        type: \"success\",\n                        duration: 2000\n                    });\n                    // this.total = res.pages.count\n                });\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        feedback () { //单击反馈按钮方法\n            if (this.selectlistRow) {\n                // this.temp = this.selectlistRow[0] // copy obj\n                this.listQuery1.supplierCode = this.selectlistRow.supplierCode;\n                this.listQuery1.orderNumber = this.selectlistRow.orderNumber;\n                this.listQuery1.method = \"FEEDBACK\";\n                api.confirm(this.listQuery1).then(() => {\n                    this.getList();\n                    this.$message({\n                        title: \"成功\",\n                        message: \"反馈成功\",\n                        type: \"success\",\n                        duration: 2000\n                    });\n                    // this.total = res.pages.count\n                });\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n\n        handleProvide () { //可供\n            if (this.selectlistRow) {\n                this.listQuery1.supplierCode = this.selectlistRow.supplierCode;\n                this.listQuery1.orderNumber = this.selectlistRow.orderNumber;\n                // this.selectlistRow1[0].provide='1'\n                this.selectlistRow1.map(v => {\n                    v.provide = \"1\";\n                });\n                api.updateRecord(this.listQuery1.supplierCode, this.listQuery1.orderNumber, this.selectlistRow1\n                ).then(() => {\n                    this.getList1();\n                    this.$message({\n                        title: \"成功\",\n                        message: \"可供保存成功\",\n                        type: \"success\",\n                        duration: 2000\n                    });\n                });\n            } else {\n                this.listQuery1.supplierCode = this.list.supplierCode;\n                this.listQuery1.orderNumber = this.list.orderNumber;\n                this.selectlistRow1.map(v => {\n                    v.provide = \"1\";\n                });\n                api.updateRecord(this.listQuery1.supplierCode, this.listQuery1.orderNumber, this.list2\n                ).then(() => {\n                    this.getList1();\n                    this.$message({\n                        title: \"成功\",\n                        message: \"可供保存成功\",\n                        type: \"success\",\n                        duration: 2000\n                    });\n                    // this.getList1()\n                    // this.total = res.pages.count\n                });\n            }\n        },\n\n        handleNoprovide () { //不可供\n            if (this.selectlistRow) {\n                this.listQuery1.supplierCode = this.selectlistRow.supplierCode;\n                this.listQuery1.orderNumber = this.selectlistRow.orderNumber;\n                // this.selectlistRow1[0].provide='1'\n                this.selectlistRow1.map(v => {\n                    v.provide = \"0\";\n                });\n                api.updateRecord(\n                    this.listQuery1.supplierCode,\n                    this.listQuery1.orderNumber,\n                    this.selectlistRow1\n                ).then(() => {\n                    this.getList1();\n                    this.$message({\n                        title: \"成功\",\n                        message: \"不可供保存成功\",\n                        type: \"success\",\n                        duration: 2000\n                    });\n                });\n            } else {\n                this.listQuery1.supplierCode = this.list.supplierCode;\n                this.listQuery1.orderNumber = this.list.orderNumber;\n                this.selectlistRow1.map(v => {\n                    v.provide = \"0\";\n                });\n                api.updateRecord(\n                    this.listQuery1.supplierCode,\n                    this.listQuery1.orderNumber,\n                    this.list2\n                ).then(() => {\n                    this.getList1();\n                    this.$message({\n                        title: \"成功\",\n                        message: \"不可供保存成功\",\n                        type: \"success\",\n                        duration: 2000\n                    });\n                    // this.getList1()\n                    // this.total = res.pages.count\n                });\n            }\n        },\n\n\n        handleUpdate () {//单击保存按钮方法\n            if (this.selectlistRow) {\n                this.listQuery1.supplierCode = this.selectlistRow.supplierCode;\n                this.listQuery1.orderNumber = this.selectlistRow.orderNumber;\n                api.updateRecord(\n                    this.listQuery1.supplierCode,\n                    this.listQuery1.orderNumber,\n                    this.list2\n                ).then(() => {\n                    this.getList1();\n                    this.$message({\n                        title: \"成功\",\n                        message: \"保存成功\",\n                        type: \"success\",\n                        duration: 2000\n                    });\n                    // this.getList1()\n                    // this.total = res.pages.count\n                });\n            } else {\n                this.listQuery1.supplierCode = this.list[0].supplierCode;\n                this.listQuery1.orderNumber = this.list[0].orderNumber;\n                api.updateRecord(\n                    this.listQuery1.supplierCode,\n                    this.listQuery1.orderNumber,\n                    this.list2\n                ).then(() => {\n                    this.$message({\n                        title: \"成功\",\n                        message: \"保存成功\",\n                        type: \"success\",\n                        duration: 2000\n                    });\n                    // this.getList1()\n                    // this.total = res.pages.count\n                });\n            }\n        },\n        handleQuery () {\n            this.listQuery.currentPage = 1;\n            this.getList();\n        },\n        handleSizeChange (val) {\n            this.listQuery.pageSize = val;\n            this.getList();\n        },\n        handleDeleteBatch () {\n            if (this.selectCode.length == 0) {\n                this.$message.warning(\"请勾选记录！\");\n                return;\n            }\n            this.delete(this.selectCode);\n        },\n        selectRow (val) {//表一复选框选中方法\n            this.selectlistRow = val[val.length - 1];\n            if (val.length > 1) {\n                this.$refs.tb.clearSelection();\n                this.$refs.tb.toggleRowSelection(val[val.length - 1]);\n            }\n            this.$refs.tb.setCurrentRow(this.selectlistRow);\n            if (this.selectlistRow) {\n                this.getList1();\n            }\n        },\n        selectRow1 (val) {//表二复选框选中方法\n            this.selectlistRow1 = val;\n        },\n        selectRow2 (val) {//表一单击行选中方法\n            this.selectlistRow2 = val;\n            this.$refs.tb.clearSelection();\n            this.$refs.tb.toggleRowSelection(val); //单击行绑定点击事件\n            // this.getList1();\n        },\n        selectRow3 (val) {//表二单击行选中方法\n            this.selectlistRow3 = val;\n            // this.$refs.tb.clearSelection()\n            // this.$refs.tb.toggleRowSelection(val)//单击行绑定点击事件\n        },\n        cancel () {\n            this.$refs.dialogRefgys.dialogVisible = false;\n        },\n        resetTemp () {\n            this.temp = {\n                measureCode: undefined,\n                measureName: undefined,\n                dimension: undefined,\n                transferRate: undefined,\n                isBase: 0,\n                isEnabled: 1,\n                remark: undefined\n            };\n        },\n        handleClose () {\n            this.resetTemp();\n            this.$refs.temp.resetFields();\n        },\n        handleSelectionChange (selection) {\n            this.selectCode = selection.map(v => v.measureCode);\n        }\n    }\n};\n",null]}