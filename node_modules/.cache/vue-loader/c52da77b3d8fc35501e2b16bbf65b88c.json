{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentArchives/tab3.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/EL/equipmentArchives/tab3.vue","mtime":1596610933377},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport *  as api from '@/api/project/eas/el/equipmentArchives'\nimport { queryRecords2 } from '@/api/project/eas/database/eqmt'\nimport bjqdAdd from \"./bjqdAdd\"\nimport { mapState } from \"vuex\"\n\nexport default {\n    name: 'dispatchOrderManagement',\n    components: { bjqdAdd },\n    props: ['deviceCode', 'typeCode', 'selectlist'],\n    data () {\n        return {\n            childDeviceCodes: [],\n            list: null,\n            subList: [],\n            total: 0,\n            theight: 0, //表格高度\n            importDialogVisible: false,\n            tableKey: [0],\n            ids: [],\n            options: [],\n            ifRapidWear: 'N'\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_yes_or_no: state => state.eamDict.dt_yes_or_no,\n        })\n    },\n    watch: {\n        typeCode () {\n            this.getOptions()\n        }\n    },\n    mounted () {\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.$store.dispatch(\"eamDict/getDicData\", [\n            \"dt_yes_or_no\"\n        ])\n    },\n    methods: {\n        haha (val) {\n            this.ifRapidWear = val\n        },\n        getList () {\n            api.queryPart(this.deviceCode).then(res => {\n                this.list = res.data.map(v => {\n                    if (!v.ifRapidWear) {\n                        v.ifRapidWear = \"N\"\n                    }\n                    v.partCode\n                    v.quantity\n                    return v\n                })\n            })\n        },\n        getOptions () {\n            queryRecords2(this.typeCode).then(res => {\n                this.options = res.data\n            })\n        },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 185\n        },\n        handleCreate () {\n            if (this.selectlist) {\n                this.importDialogVisible = true\n                setTimeout(() => {\n                    // this.$refs.importDialog.getListSelected()\n                    this.$refs.importDialog.getEquipmentData()\n                }, 0)\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择设备编码',\n                    type: 'warning'\n                })\n            }\n        },\n        handleChange (val) {\n            this.createChange = val\n            this.createChange.map((item) => {\n                item.deviceCode = this.deviceCode\n                return item\n            })\n        },\n        //新增方法\n        update () {\n            api.addPart(this.createChange).then(() => {\n                this.getList()\n                this.importDialogVisible = false\n                this.$message({\n                    title: '成功',\n                    message: '新增成功',\n                    type: 'success',\n                    duration: 2000\n                })\n            })\n        },\n        handleSave () {\n            let result = true\n            let saveList = []\n            this.list.forEach(v => {\n                if (v.ifRapidWear || v.quantity) {\n                    result = false\n                    saveList.push(v)\n                }\n            })\n            if (result) {\n                this.$message({\n                    title: \"警告\",\n                    message: \"数量与是否易损不能为空\",\n                    type: \"warning\"\n                })\n            } else {\n                api.updatePart(saveList).then(() => {\n                    this.getList()\n                    this.$message({\n                        title: '成功',\n                        message: '保存成功',\n                        type: 'success',\n                        duration: 2000\n                    })\n\n                })\n\n            }\n        },\n        handleDelete () {\n            //删除列表\n            this.selectlistRow.forEach((item, index) => {\n                this.ids[index] = item.rowId\n            })\n            if (this.selectlistRow) {\n                this.$confirm('此操作将永久删除该备件, 是否继续?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                })\n                    .then(() => {\n                        api.deletePart(this.ids).then(() => {\n                            this.getList(),\n                                this.$message({\n                                    title: '成功',\n                                    message: '删除成功',\n                                    type: 'success',\n                                    duration: 2000\n                                })\n                        })\n                    })\n                    .catch(() => {\n                        this.$message({\n                            type: 'info',\n                            message: '已取消删除'\n                        })\n                    })\n            } else {\n                this.$message({\n                    title: '警告',\n                    message: '请选择一条信息',\n                    type: 'warning'\n                })\n            }\n        },\n\n        // 获取表格选中时的数据\n        selectRow (val) {\n            this.selectlistRow = val\n        },\n\n    }\n}\n",null]}