{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/MES/qualityManagement/qualityReportWork/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/MES/qualityManagement/qualityReportWork/index.vue","mtime":1596610933588},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/project/mes/dataBase/unqualifiedProduct'\nimport * as workStationApi from '@/api/project/mes/productionExecution/manualScanCode'\nimport Pagination from '@/components/Pagination'\nimport { mapState } from 'vuex'\nimport { getWorkstation } from '@/utils/auth'\n\nexport default {\n    name: 'qualityReport',\n    components: { Pagination },\n    data() {\n        return {\n            list: [],\n            options: [],\n            listSub: null,\n            total: 0,\n            theight: 0, //表格高度\n            workOrderCode: undefined,\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                workStation: undefined,\n                workOrderCode: undefined\n            },\n            temp: {\n                workOrderCode: undefined,\n                barCode: undefined,\n                stationCode: getWorkstation(),\n                isQualified: 1\n            },\n            selected: undefined,\n            tableKey: 0,\n            reasonChoosen: [],\n            reasonData: [],\n            supReason: ''\n        }\n    },\n    filters: {\n        splitState: function(e) {\n            if (e === '1') {\n                return '是'\n            } else {\n                return '否'\n            }\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_below_standard_reason: state =>\n                state.mesDict.dt_below_standard_reason\n        })\n    },\n    mounted() {\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.getList()\n        this.getOptions()\n        this.$store.dispatch('mesDict/getDicData', ['dt_below_standard_reason'])\n        setTimeout(() => {\n            this.insertReasonCollect()\n        }, 500)\n    },\n    methods: {\n        //表格高度计算\n        setTableHeight() {\n            this.theight = this.$myFun.getSingleTbHeight() * 0.9\n        },\n        handleQuery() {\n            //查询\n            this.listQuery.currentPage = 1\n            this.getList()\n        },\n        getOptions() {\n            let workOrderState = 'work_order20'\n            workStationApi.getRecord(workOrderState).then(res => {\n                console.log(res)\n                this.options = res.data\n            })\n        },\n        getList() {\n            api.queryRecords(this.listQuery).then(res => {\n                this.list = res.data.list\n                this.total = res.data.pages.count\n            })\n        },\n        // 制造原因选中数组，清空数据\n        insertReasonCollect() {\n            this.reasonChoosen = []\n            this.reasonData = []\n            this.supReason = ''\n            for (var i = 0; i < this.dt_below_standard_reason.length; i++) {\n                this.reasonChoosen.push(0)\n            }\n        },\n        clearCode() {\n            this.workOrderCode = undefined\n            this.temp.workOrderCode = undefined\n        },\n        confirmCode() {\n            if (!this.workOrderCode) {\n                this.$message({\n                    title: '警告',\n                    message: '请选择随工单号',\n                    type: 'warning'\n                })\n                return false\n            }\n            this.temp.workOrderCode = this.workOrderCode\n        },\n        // 清空录入数据\n        resetTemp() {\n            this.temp = {\n                workOrderCode: undefined,\n                barCode: undefined,\n                stationCode: getWorkstation(),\n                isQualified: 1\n            }\n        },\n        // 切换到下一个input\n        toInputTarget() {\n            this.$refs.inputTarget.focus()\n        },\n        // 录入\n        handleCreate() {\n            if (!this.temp.workOrderCode) {\n                this.$message({\n                    title: '警告',\n                    message: '请选择随工单号',\n                    type: 'warning'\n                })\n                return false\n            }\n            if (!this.temp.barCode) {\n                this.$message({\n                    title: '警告',\n                    message: '请录入条码',\n                    type: 'warning'\n                })\n                return false\n            }\n            if (this.temp.isQualified == 0) {\n                if (!this.reasonData.length) {\n                    this.$message({\n                        title: '警告',\n                        message: '请录入不合格原因',\n                        type: 'warning'\n                    })\n                    return false\n                }\n                // 补充原因\n                this.supReason ? this.reasonData.push(this.supReason) : ''\n                this.temp.reason = this.reasonData.join('，')\n            }\n            api.createRecords(this.temp).then(res => {\n                if (res.status == 200) {\n                    this.$message({\n                        title: '成功',\n                        message: '录入成功',\n                        type: 'success'\n                    })\n                    this.getList()\n                    this.resetTemp()\n                }\n            })\n        },\n        // 点击原因\n        handleUnqualify(index, reason) {\n            if (this.reasonChoosen[index] == 1) {\n                this.$set(this.reasonChoosen, index, 0)\n                for (let i = 0; i < this.reasonData.length; i++) {\n                    if (this.reasonData[i] == reason) {\n                        this.reasonData.splice(i, 1)\n                    }\n                }\n            } else {\n                this.$set(this.reasonChoosen, index, 1)\n                this.reasonData.push(reason)\n            }\n        },\n        handlQualified() {\n            if (this.temp.isQualified == 1) {\n                this.temp.isQualified = undefined\n                return false\n            } else {\n                this.temp.isQualified = 1\n            }\n            this.reasonChoosen = []\n            this.reasonData = []\n        },\n        // 不合格\n        handleUnqualified() {\n            if (this.temp.isQualified == 0) {\n                this.temp.isQualified = undefined\n                return false\n            } else {\n                // this.$message({\n                //     title: '警告',\n                //     message: '请选择原因',\n                //     type: 'warning'\n                // })\n                this.temp.isQualified = 0\n            }\n            this.reasonChoosen = []\n            this.reasonData = []\n            // if (this.selected == undefined) {\n            //     this.$message({\n            //         title: '警告',\n            //         message: '请选择产品',\n            //         type: 'warning'\n            //     })\n            //     return false\n            // }\n            // if (this.reasonData.length == 0 && this.supReason == '') {\n            //     this.$message({\n            //         title: '警告',\n            //         message: '请选择或补充不合格原因',\n            //         type: 'warning'\n            //     })\n            //     return false\n            // }\n            // this.supReason ? this.reasonData.push(this.supReason) : ''\n            // api.unqualified({\n            //     rowId: this.selected.rowId,\n            //     reason: this.reasonData.join('，')\n            // }).then(res => {\n            //     if (res.status == 200) {\n            //         this.$message({\n            //             title: '成功',\n            //             message: '报工成功',\n            //             type: 'success'\n            //         })\n            //         this.getList()\n            //     }\n            // })\n            // 提交后清空\n            // this.insertReasonCollect()\n        },\n        // 获取表格选中时的数据\n        selectRow(val) {\n            this.selectlistRow = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.mainList.clearSelection()\n                this.$refs.mainList.toggleRowSelection(\n                    val[val.length - 1],\n                    'selected'\n                )\n            }\n        },\n        // 查看不合格原因\n        handleCheck(row) {\n            this.$alert(row.reason)\n        },\n        selectList(val) {\n            this.selected = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.list.clearSelection()\n                this.$refs.list.toggleRowSelection(\n                    val[val.length - 1],\n                    'selected'\n                )\n            }\n        },\n        selectListRow(val) {\n            this.selected = val\n            this.$refs.list.clearSelection()\n            this.$refs.list.toggleRowSelection(val, 'selected')\n        },\n        // 删除\n        handleDelete(row) {\n            api.deleteRecords(row.rowId).then(res => {\n                if (res.status == 204) {\n                    this.$message({\n                        title: '成功',\n                        message: '删除成功',\n                        type: 'success'\n                    })\n                    this.getList()\n                }\n            })\n        }\n    }\n}\n",null]}