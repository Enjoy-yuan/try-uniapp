{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/ruleAttrDefine/content/contentBar.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/ruleAttrDefine/content/contentBar.vue","mtime":1596610933347},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { queryBarRecords, queryBarRecordsDetail, addBarRecords, deleteBarRecords } from \"@/api/data-base/ruleAttrDefine\"\nimport Pagination from \"@/components/Pagination\"\nimport { mapState } from 'vuex'\n\nexport default {\n    name: \"contentBatch\",\n    components: { Pagination },\n    data () {\n        return {\n            list: [],\n            listDetail: [],\n            total: 0,\n            tableKey: [0, 1],//表格索引，虚拟dom渲染表格时使用\n            theight: 0,\n            stheight: 0,//右子表高度\n            totalDetail: 0,\n            selectRowsDetail: [],\n            selectRows: [],\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10\n            },\n            listQueryDetail: {\n                rulePrepCode: \"\",\n                rulePrepName: \"\",\n                page: true,\n                currentPage: 1,\n                pageSize: 10\n            },\n            rules: {\n\n            }\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_rules_type: state => state.dict.dt_rules_type\n        })\n    },\n    mounted () {\n        this.$store.dispatch('dict/getDicData', ['dt_rules_type'])\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.getList()\n    },\n    methods: {\n        //显示主表\n        getList () {\n            queryBarRecords(this.listQuery).then(res => {\n                this.list = res.data.list\n                this.total = res.data.pages.count\n            })\n        },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 35\n            this.stheight = this.theight + 43\n        },\n        getListDetail () {\n            if (this.selectRows) {\n                queryBarRecordsDetail(this.selectRows.ruleType, this.listQueryDetail).then(res => {\n                    this.listDetail = res.data\n                })\n            }\n        },\n        //查询\n        handleQuery () {\n            this.listQuery.currentPage = 1\n            this.getList()\n        },\n        //每页大小变化\n        handleSizeChange (val) {\n            this.listQuery.pageSize = val\n            this.getList()\n        },\n        //当前页变化\n        handleCurrentChange (val) {\n            this.listQuery.currentPage = val\n            this.getList()\n        },\n        //主表勾选框选中\n        selectRow (val) {\n            this.selectRows = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.tbmain.clearSelection()\n                this.$refs.tbmain.toggleRowSelection(val[val.length - 1], 'selected')\n            }\n            this.getListDetail()\n        },\n        selectRowDetail (val) {\n            this.selectRowsDetail = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.tbdetail.clearSelection()\n                this.$refs.tbdetail.toggleRowSelection(val[val.length - 1], 'selected')\n            }\n        },\n        handleDelete () {\n            if (this.selectRows.ruleType && this.selectRowsDetail.rulePrepCode) {\n                deleteBarRecords(this.selectRows.ruleType, this.selectRowsDetail.rulePrepCode).then(() => {\n                    this.$message({\n                        type: 'success',\n                        message: '删除成功'\n                    })\n                    this.selectRowsDetail = []\n                    this.getListDetail()\n                })\n            } else {\n                this.$message.warning(this.$t('message.checkedplease'))\n            }\n        },\n        handleAdd () {\n            if (this.selectRows.ruleType) {\n                if (this.listQueryDetail.rulePrepCode && this.listQueryDetail.rulePrepName) {\n                    let addData = Object.assign({}, this.listQueryDetail)\n                    delete addData.pageSize\n                    delete addData.page\n                    delete addData.currentPage\n                    addBarRecords(this.selectRows.ruleType, addData).then(() => {\n                        this.$message({\n                            type: 'success',\n                            message: '新增成功'\n                        })\n                        this.listQueryDetail.rulePrepCode = undefined\n                        this.listQueryDetail.rulePrepName = undefined\n                        this.selectRowsDetail = []\n                        this.getListDetail()\n                    })\n                } else {\n                    this.$message({\n                        title: '警告',\n                        message: '请填写属性编码,属性名称',\n                        type: \"warning\"\n                    })\n                }\n            } else {\n                this.$message.warning(this.$t('message.checkedplease'))\n            }\n        },\n    }\n}\n",null]}