{"remainingRequest":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/cf_web/src/views/data-base/materielTransferType/dialog/dialogAddSub3.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/cf_web/src/views/data-base/materielTransferType/dialog/dialogAddSub3.vue","mtime":1600927611455},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/cf_web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { createSubLeft, updateSubLeft, getAttrRules, getPIList } from \"@/api/data-base/material_transfer_type\";\nimport { mapState } from 'vuex';\nexport default {\n    name: 'addSub1',\n    components: {},\n    props: ['statisticTypeList'],\n    data () {\n        return {\n            isEditO: false,\n            booleanValue: [[{\n                value: 1,\n                label: '是'\n            }, {\n                value: 0,\n                label: '否'\n            }], [{\n                value: 1,\n                label: '有效'\n            }, {\n                value: 0,\n                label: '无效'\n            }], [{\n                value: 1,\n                label: '+'\n            }, {\n                value: 0,\n                label: '-'\n            }]],\n            proofList: [],\n            AddSublist: {\n                configType: \"p\",\n                wareRuleCode: '',\n                wareRuleName: '',\n                targetWareRuleCode: '',\n                status: '',\n                description: '',\n                mainUpdateObject: '',\n                detailUpdateObject: '',\n                serviceName: '',\n                wareRuleHandleDetails: []\n            },\n            indicateBizTypeList: [],\n            dialogStatus: 0,\n            dialogFormVisible: false,\n            rules: {\n                mainUpdateObject: [\n                    {\n                        required: true,\n                        message: \"主体更新对象不能为空\",\n                        trigger: \"blur\"\n                    },\n                ],\n                detailUpdateObject: [\n                    {\n                        required: true,\n                        message: \"明细更新对象不能为空\",\n                        trigger: \"blur\"\n                    },\n                ],\n                serviceName: [\n                    {\n                        required: true,\n                        message: \"service服务名称不能为空\",\n                        trigger: \"blur\"\n                    },\n                ],\n            },\n        }\n    },\n    mounted () {\n        this.$store.dispatch('dict/getDicData', ['dt_referdata_resource']);\n    },\n    computed: {\n        ...mapState({\n            dt_referdata_resource: state => state.dict.dt_referdata_resource\n        })\n    },\n    methods: {\n        addSubConfirm () {\n            createSubLeft(this.AddSublist.wareRuleCode, this.AddSublist, \"p\").then(() => {\n                this.$message({\n                    type: 'success',\n                    message: '添加成功'\n                });\n                this.$emit('refresh');\n                this.dialogFormVisible = false;\n            })\n        },\n        updateSubConfirm () {\n            updateSubLeft(this.AddSublist.wareRuleCode, this.AddSublist.rowId, this.AddSublist, \"p\").then(() => {\n                this.$message({\n                    type: 'success',\n                    message: '编辑成功'\n                });\n                this.$emit('refresh');\n                this.dialogFormVisible = false;\n            })\n        },\n        setCorAttrName (row) {\n            let attributeName = '';\n            let rowId = '';\n            this.proofList.forEach(item => {\n                if (item.attributeCode === row.sourceConfigCode) {\n                    attributeName = item.attributeName;\n                    rowId = item.rowId\n                }\n            });\n\n            this.AddSublist.wareRuleHandleDetails.forEach((item, index) => {\n                if (item.targetRefItemRowId === row.targetRefItemRowId) {\n                    this.AddSublist.wareRuleHandleDetails[index].sourceConfigName = attributeName;\n                    this.AddSublist.wareRuleHandleDetails[index].sourceRefItemRowId = rowId;\n                }\n            })\n        },\n        copyDetail () {\n            this.AddSublist.wareRuleHandleDetails.forEach((item, index) => {\n                this.AddSublist.wareRuleHandleDetails[index].sourceConfigCode = this.AddSublist.wareRuleHandleDetails[index].targetConfigCode;\n            })\n        },\n        setDetail (rowId, objectType) {\n            getPIList(rowId).then(resi => {\n                resi = resi.data\n                for (let j = 0; j < resi.length; j++) {\n                    this.AddSublist.wareRuleHandleDetails.push(\n                        {\n                            targetRefRowId: rowId,\n                            targetRefItemRowId: resi[j].rowId,\n                            objectType: objectType,\n                            targetConfigCode: resi[j].attributeCode,\n                            targetConfigName: resi[j].attributeName\n                        }\n                    );\n                }\n            })\n        },\n        //选择参照数据来源变化时状态变化\n        changeReferData (val) {\n            let queryRules = {\n                referentType: val\n            }\n            getAttrRules(queryRules).then(res => {\n                console.log(res)\n                this.AddSublist.wareRuleHandleDetails = [];\n                this.isEditO = false;\n                res.data.forEach(item => {\n                    if (item.objectType === 1) {\n                        this.AddSublist.mainUpdateObject = item.referentObject;\n                    } else if (item.objectType === 2) {\n                        this.AddSublist.detailUpdateObject = item.referentObject;\n                    }\n                    this.setDetail(item.rowId, item.objectType);\n                });\n                this.isEditO = true;\n            })\n        }\n    }\n}\n",null]}