{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/components/equipmentSelect/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/EAS/components/equipmentSelect/index.vue","mtime":1596610933436},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport *  as api from '@/api/project/eas/fm/failureRegister'\nimport Pagination from '@/components/Pagination'\nimport { mapState } from \"vuex\"\nimport selectTree from \"@/components/Select/selectTree\" //下拉组件\nimport { queryRecords } from '@/api/project/eas/database/faultType'\nexport default {\n    name: 'failureRegister',\n    components: {        Pagination, selectTree,\n    },\n    data () {\n        return {\n            list: null,\n            equipmentRow: [],\n            disposerRow: undefined,\n            dialogStatus: '',\n            dialogFormVisible: false,\n            employeeDialogVisible: false,\n            equipmentDialogVisible: false,\n            total: 0,\n            theight: 0, //表格高度\n            ids: [],\n            faultNumbers: [],\n            listQuery: {\n                page: true,\n                currentPage: 1,\n                pageSize: 10,\n                deviceCode: undefined,\n                state: 'fs20',\n                faultTypeCode: undefined,\n                faultNumber: undefined,\n            },\n            listQuery1: {\n                faultCode: undefined\n            },\n            temp: {\n                classCode: undefined,\n                description: undefined,\n                address: undefined,\n                deviceCode: undefined,\n                deviceName: undefined,\n                faultCode: undefined,\n                faultGrade: undefined,\n                faultTypeCode: undefined,\n                happenTime: undefined,\n                ifMachineHalt: undefined,\n                machineHaltTime: undefined,\n                mobile: undefined,\n                operator: undefined,\n                operatorName: undefined,\n                partCode: undefined,\n            },\n            faultList: [],\n            partCodeOption: [],\n            optionData: [],\n            isClearable: true, // 可清空（可选）\n            isAccordion: true, // 可收起（可选）\n            valueId: undefined, // 初始ID（可选）\n            props: {\n                // 配置项（必选）\n                rowId: 'rowId', // 父级唯一标识\n                children: 'children',\n                label: 'faultName'\n            },\n            gw: undefined,\n            tabName: 'sbtp',\n\n            tableKey: [0],\n\n        }\n    },\n    created () {\n        this.getList()\n    },\n    computed: {\n        ...mapState({\n            dt_fault_state: state => state.eamDict.dt_fault_state,\n            dt_urgency_degree: state => state.eamDict.dt_urgency_degree,\n            dt_fault_grade: state => state.eamDict.dt_fault_grade,\n            dt_yes_or_no: state => state.eamDict.dt_yes_or_no\n        })\n    },\n    mounted () {\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n        this.getList()\n        this.$store.dispatch(\"eamDict/getDicData\", [\n            \"dt_fault_state\", \"dt_urgency_degree\", \"dt_fault_grade\",\n            \"dt_yes_or_no\"\n        ])\n        this.getOptionData()\n        // this.getOptionData1()\n    },\n    methods: {\n        //故障类型\n        getValue (value) {\n            this.listQuery.faultTypeCode = value.faultCode\n        },\n        getValue1 (v) {\n            this.temp.faultTypeCode = v.faultCode\n        },\n        buildTree: (array, id, parent_id) => {\n            // 创建临时对象\n            let temp = {}\n            // 创建需要返回的树形对象\n            let tree = []\n            // 先遍历数组，将数组的每一项添加到temp对象中\n            for (let i in array) {\n                temp[array[i][id]] = array[i]\n            }\n            // 遍历temp对象，将当前子节点与父节点建立连接\n            for (let i in temp) {\n                // 判断是否是根节点下的项\n                if (temp[i][parent_id] != 0) {\n                    if (!temp[temp[i][parent_id]].children) {\n                        temp[temp[i][parent_id]].children = []\n                    }\n                    temp[temp[i][parent_id]].children.push(temp[i])\n                } else {\n                    tree.push(temp[i])\n                }\n            }\n            return tree\n        },\n        getOptionData () {\n            queryRecords().then(res => {\n                this.optionData = [\n                    {\n                        faultName: '故障类型',\n                        faultCode: 0,\n                        rowId: 0,\n                        children: this.buildTree(\n                            res.data,\n                            'faultCode',\n                            'preFaultCode'\n                        )                    }\n                ][0].children\n            })\n        },\n        //查询主表\n        getList () {\n            api.queryRecords(this.listQuery).then(res => {\n                this.list = res.data.list\n                this.total = res.data.pages.count\n            })\n        },\n\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 185\n        },\n        //查询\n        handleQuery () {\n            this.listQuery.currentPage = 1\n            this.getList()\n        },\n        // 获取表格选中时的数据\n        selectRow (val) {\n            this.selectlistRow = val\n            if (val.length > 1) {\n                this.$refs.mainList.clearSelection()\n                this.$refs.mainList.toggleRowSelection(val.pop())\n            }\n            this.$emit('change', this.selectlistRow)\n        },\n        //主表行点击\n        showSubTable (row) {\n            this.$refs.mainList.clearSelection()\n            this.$refs.mainList.toggleRowSelection(row)\n        },\n        resetTemp () {\n            this.temp = {\n                faultCode: undefined,\n                description: undefined,\n                faultGrade: undefined,\n                deviceCode: undefined,\n                deviceName: undefined,\n                happenTime: undefined,\n                ifMachineHalt: undefined,\n                operator: undefined,\n                operatorName: undefined,\n                partCode: undefined,\n                category: undefined,\n                urgencyDegree: undefined,\n                mobile: undefined\n\n            }\n        }\n    }\n}\n",null]}