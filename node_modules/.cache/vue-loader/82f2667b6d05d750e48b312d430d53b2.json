{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/materialScrap/scrapApplication/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/materialScrap/scrapApplication/index.vue","mtime":1596610934135},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/project/wms/materialScrap/scrapApplication'\nimport Pagination from '@/components/Pagination' // 分页组件\nimport { DT_ORG_TYPE, DICT_CODE } from '@/utils/constant'\nimport warehouseSelect from '@/components/Select/warehouse-select.vue'//下拉组件\nimport caiGou from '@/components/Select/caigou.vue'//下拉组件 \nimport AuthoType from '@/components/Select/AuthoType.vue'//权限类型下拉组件\nimport * as tool from '@/utils/tool'//函数工具\nimport purchasingPersonnel from './purchasingPersonnel'//采购计划员\nimport wlxzbykcz from '@/components/Select/wlxzbykcz'//库存帐物料信息模块\nimport { mapState, mapGetters } from 'vuex';\nexport default {\n    name: \"scrapApplication\",\n    components: { Pagination, AuthoType, caiGou, warehouseSelect, purchasingPersonnel, wlxzbykcz },\n    data () {\n        return {\n            purchasingPersonnelDialogFormVisible: false,\n            dialogFormVisible: false,\n            wlxzDialogFormVisible: false,\n            dialogStatus: '',\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            DICT_CODE: DICT_CODE,\n            theight: 0,\n            listQuery_a: {\n                currentPage: 1,\n                pageSize: 10,\n                arrivalCompany: undefined,\n                arrivalRepository: undefined,\n                state: \"scrap10\",\n                businessType: '0550',//报废业务类型\n                purchaseEmp: undefined,\n                creator: null\n            },\n            listQuery_b: {\n                currentPage: 1,\n                pageSize: 10,\n            },\n            listQuery_a_1: {\n                currentPage: 1,\n                pageSize: 10,\n            },\n            temp: {\n                orgCode: undefined\n            },\n            total_a: 0,\n            total_b: 0,\n            total_a_1: 0,\n            list_a: [],\n            list_a_1: [],\n            list_b: [],\n            parentsRows: [],\n            applyDate: [],//申请日期\n            unMutiple: false,\n            isEdit: false,\n            tableKey: [0, 1],//表格索引，虚拟dom渲染表格时使用\n            rules: {\n                orgCode: [\n                    { required: true, message: this.$t('validate.required'), trigger: 'blur' },\n                ],\n                warehouseCode: [\n                    { required: true, message: this.$t('validate.required'), trigger: 'blur' },\n                ],\n                businessType: [\n                    { required: true, message: this.$t('validate.required'), trigger: 'blur' },\n                ],\n                toWarehouseCode: [\n                    { required: true, message: this.$t('validate.required'), trigger: 'blur' },\n                ]\n            }\n        }\n    },\n    computed: {\n        ...mapGetters([\"name\", \"superRoles\"]),\n        ...mapState({\n            dt_scrap_order_state: state => state.dict.dt_scrap_order_state,\n            dt_materiel_transfer_type_bf: state => state.businessComponent.dt_materiel_transfer_type_bf,\n        }),\n        dt_type () {\n            return this.dt_materiel_transfer_type_bf.options\n        }\n    },\n    mounted () {\n        this.$store.dispatch('dict/getDicData', ['dt_scrap_order_state']);\n        this.$store.dispatch('businessComponent/getBusinessComponentData', ['dt_materiel_transfer_type_bf']);\n        this.setTableHeight()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight();\n        };\n    },\n    filters: {\n        stateFilter: function (a) {\n            if (a === \"scrap30\") {\n                return \"作废\"\n            } else if (a === \"scrap10\") {\n                return \"编制\"\n            } else {\n                return \"发布\"\n            }\n        }\n    },\n    methods: {\n        resetTemp () {//重置temp\n            this.temp = {}\n        },\n        //查询\n        getList_a () {\n            if (this.superRoles) {\n                this.listQuery_a.creator = null;\n            } else {\n                // this.listQuery_a.creator = this.name;\n            }\n            if (this.applyDate && this.applyDate.length > 0) {\n                this.listQuery_a.applyTimeStart = this.applyDate[0]\n                this.listQuery_a.applyTimeEnd = this.applyDate[1]\n            } else {\n                this.listQuery_a.applyTimeStart = ''\n                this.listQuery_a.applyTimeEnd = ''\n            }\n            api.getData_a(this.listQuery_a).then(res => {\n                this.list_a = res.data.list\n                this.total_a = res.data.pages.count;\n                this.$nextTick(function () {\n                    this.checked()\n                })\n            })\n        },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() - 195;\n        },\n        checked () {\n            this.$refs.tb_a.toggleRowSelection(this.list_a[0], true);//官网方法，重点\n        },\n        // 报废明细\n        getList_b () {\n            this.listQuery_b.scrapOrderCode = this.selectListRow_a.scrapOrderCode\n            api.getData_a_1(this.listQuery_b).then(res => {\n                this.list_b = res.data.list\n                this.total_b = res.data.pages.count\n            })\n        },\n        getList_a_1 () {\n\n        },\n        //新增\n        handleCreate () {\n            this.resetTemp()\n            this.list_a_1 = null;\n            this.dialogFormVisible = true;\n            this.isEdit = false;\n            this.dialogStatus = 'create';\n        },\n        createData () {//新增确认按钮\n            this.$refs['dataForm'].validate((valid) => {\n                if (valid) {\n                    this.temp.method = 'MODIFY'\n                    this.temp.scrapOrderDetails = this.list_a_1.map(v => {\n                        if (!v.scrapNumber) {\n                            v.scrapNumber = 0\n                        }\n                        if (!v.snp) {\n                            v.snp = 1\n                        }\n                        if (!v.transferRate) {\n                            v.transferRate = 1\n                        }\n                        if (!v.stockState) {\n                            v.stockState = 1\n                        }\n                        if (!v.stockType) {\n                            v.stockType = 1\n                        }\n                        return v\n                    })\n                    api.creatData_a(this.temp).then(() => {\n                        this.$message({\n                            title: \"成功\",\n                            message: \"新增成功\",\n                            type: \"success\"\n                        });\n                        this.dialogFormVisible = false\n                        this.getList_a()\n                    })\n\n                }\n            })\n        },\n        updateData () {//修改确认\n            this.temp.method = 'MODIFY'\n            this.temp.scrapOrderDetails = this.list_a_1.map(v => {\n                return v\n            })\n            api.updata_a(this.temp).then(() => {\n                this.$message({\n                    title: \"成功\",\n                    message: \"修改成功\",\n                    type: \"success\"\n                });\n                this.dialogFormVisible = false\n                this.getList_a()\n                this.list_b = []\n            })\n        },\n        //删除\n        handleDelete_a () {\n            if (this.selectListRow_a_1 && this.selectListRow_a_1.length > 0) {\n                this.list_a_1 = tool.getArrDifference(this.list_a_1, this.selectListRow_a_1)\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        //修改\n        handleUpdate () {\n            if (this.selectListRow_a) {\n                this.dialogFormVisible = true;\n                this.dialogStatus = 'edit';\n                this.isEdit = true;\n                this.temp = this.selectListRow_a;\n                this.getList_b();\n                this.list_a_1 = this.list_b;\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        //提交\n        handleSubmit () {\n            if (this.selectListRow_a) {\n                this.selectListRow_a.method = 'PUBLISH'\n                this.selectListRow_a.scrapOrderDetails = this.list_b.map(v => {\n                    return v\n                })\n                api.updata_a(this.selectListRow_a).then(() => {\n                    this.$message({\n                        title: \"成功\",\n                        message: \"提交成功\",\n                        type: \"success\"\n                    });\n                    this.dialogFormVisible = false\n                    this.getList_a()\n                    this.list_b = []\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        //作废\n        handleScrap () {\n            if (this.selectListRow_a) {\n                this.selectListRow_a.method = 'SCRAP'\n                this.selectListRow_a.scrapOrderDetails = this.list_b.map(v => {\n                    return v\n                })\n                api.updata_a(this.selectListRow_a).then(() => {\n                    this.$message({\n                        title: \"成功\",\n                        message: \"作废成功\",\n                        type: \"success\"\n                    });\n                    this.dialogFormVisible = false\n                    this.getList_a()\n                    this.list_b = []\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        handleCreate_a () {//物料信息弹窗\n            if (this.temp.orgCode && this.temp.warehouseCode && this.temp.businessType && this.temp.toWarehouseCode) {\n                this.wlxzDialogFormVisible = true;\n                this.isEdit = true\n                this.$nextTick(() => {\n                    this.$refs.wlxzRef.listSelected = this.list_a_1;\n                    this.$refs.wlxzRef.isEdit = true;\n                    this.$refs.wlxzRef.getList();\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择组织,仓库,业务类型,往来仓库\",\n                    type: \"warning\"\n                });\n            }\n        },\n        handelRefresh () {\n            this.isEdit = false\n            this.list_a_1 = []\n        },\n        handleDelete () {\n            if (this.selectListRow_a) {\n                this.$confirm('此操作将删除所选中数据, 是否继续?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning',\n                }).then(() => {\n                    api.deleteData_a(this.selectListRow_a).then(() => {\n                        this.getList_a()\n                        this.$message({\n                            title: \"成功\",\n                            message: \"删除成功\",\n                            type: \"success\"\n                        });\n                    })\n                }).catch(() => {\n                    this.$message({\n                        type: 'info',\n                        message: '已取消删除'\n                    });\n                });\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        handlegPersonnel () {//业务人员\n            this.purchasingPersonnelDialogFormVisible = true;\n        },\n        purchasingPersonnels (row) {\n            this.parentsRows = row\n        },\n        isIntegerNotMust (event) {//验证正整数\n            var value = event.target.value;\n            if (!/^\\+?[1-9][0-9]*$/.test(value)) {\n                this.$message({\n                    title: \"警告\",\n                    message: \"只能正整数\",\n                    type: \"warning\"\n                });\n                event.target.value = '';\n            }\n        },\n        getMateriel () {//物料选中中弹窗确认按钮\n            if (this.$refs.wlxzRef.listSelected) {\n                this.list_a_1 = this.$refs.wlxzRef.listSelected.map(v => {\n                    v.measuringUnit = v.unit\n                    return v\n                });\n                this.wlxzDialogFormVisible = false;\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        getEmp () {//采购计划员中弹窗确认按钮\n            if (this.dialogFormVisible) {\n                if (this.parentsRows.length && this.parentsRows.length == 1) {\n                    this.temp.applyEmp = this.parentsRows[0].employeeCode\n                    this.temp.applyEmpName = this.parentsRows[0].employeeName\n                    this.purchasingPersonnelDialogFormVisible = false;\n                } else {\n                    this.$message({\n                        title: \"警告\",\n                        message: \"请选择一条信息\",\n                        type: \"warning\"\n                    });\n                }\n            } else {\n                if (!this.parentsRows[0]) {\n                    this.listQuery_a.applyEmp = \"\"\n                    this.listQuery_a.applyEmpName = \"\"\n                    this.purchasingPersonnelDialogFormVisible = false;\n                } else {\n                    this.listQuery_a.applyEmp = this.parentsRows[0].employeeCode\n                    this.listQuery_a.applyEmpName = this.parentsRows[0].employeeName\n                    this.purchasingPersonnelDialogFormVisible = false;\n                }\n            }\n        },\n        selectRow_a (val) {\n            if (val.length > 1) {\n                this.$refs.tb_a.clearSelection()//清除其他行的选中\n                this.$refs.tb_a.toggleRowSelection(val[val.length - 1], 'selected')//单击行绑定点击事件\n            } else if (val.length === 1) {\n                this.selectListRow_a = val[val.length - 1]\n                this.getList_b()\n            }\n        },\n        selectRow_a_1 (val) {\n            this.selectListRow_a_1 = val\n        },\n        selectRow_b () {\n\n        },\n        rowClick_a (val) {\n            this.$refs.tb_a.clearSelection()//清除其他行的选中\n            this.$refs.tb_a.toggleRowSelection(val)//单击行绑定点击事件\n        },\n        rowClick_b () {\n\n        },\n        setdefault (val, i) {\n            if (i === 1) {\n                this.$set(this.listQuery_a, 'orgCode', val)\n            } else if (i === 3) {\n                this.$set(this.listQuery_a, 'warehouseCode', val)\n                this.getList_a();\n            }\n        },\n        arrivalCompanyName (val) {\n            this.temp.orgName = val\n        }\n    },\n}\n",null]}