{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierManagement/supplierAccess/platformNote/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/SRM/supplierManagement/supplierAccess/platformNote/index.vue","mtime":1596610933939},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapState } from \"vuex\"\nimport * as api from \"@/api/project/srm/supplierManage/supplierAccess/platformNote\"\nimport { DICT_CODE } from '@/utils/constant'\nimport tabNote from './tab/tabNote' // 分页组件\nimport tabDetail from './tab/tabDetail' // 分页组件\nimport caiGou from '@/components/Select/xtpt/caigou'//下拉组件\nimport dialogGysxz from '@/components/Dialog/dialogsGysxz'//供应商选择\nimport dialogMaterielCategory from '@/components/Dialog/dialogMaterielCategory'//物料分类选择\n\n\nimport dialogAdd from './dialog/dialogAdd'\nimport dialogSet from './dialog/dialogSet'\n\n\nexport default {\n    name: 'platformNotifiy',\n    components: { caiGou, tabNote, tabDetail, dialogGysxz, dialogAdd, dialogSet, dialogMaterielCategory },\n    data () {\n        return {\n            tabName: 'tabNote',\n            listQuery: {\n                orgCode: null,\n                supplierName: null,\n                noticeNo: null,\n                state: null\n            },\n            filterConfig: [\n                { type: 'selectcaiGou', label: '采购组织', prop: 'orgCode', width: '', copmNum: 0, class: 'filter-item' },\n                { type: 'commonInput', label: '供应商名称', prop: 'supplierName', width: '', class: 'filter-item ml_5' },\n                { type: 'commonInput', label: '通知书号', prop: 'noticeNo', width: '', class: 'filter-item ml_5' },\n                { type: 'dictSelect', dType: 'dt_srm_p0', label: '状态', prop: 'state', width: '', optionArr: [], class: 'filter-item ml_5' },\n            ],\n            tabConfig: [\n                { label: '平台通知', name: 'tabNote', prop: 'tabNote' },\n                { label: '提案详情', name: 'tabDetail', prop: 'tabDetail' }\n            ],\n            dialogConfig: [\n                { titleA: '入平台通知新增', title: '入平台通知编辑', curdialogStatus: 'add', unMutiple: false },\n                { title: '供应商信息', isRequired: false, unMutiple: true },\n                { title: '新增物料分类信息', isRequired: false, unMutiple: false },\n            ],\n            DICT_CODE: DICT_CODE,\n            gysType: null\n        }\n    },\n    computed: {\n        ...mapState({\n            dt_srm_p0: state => state.dict.dt_srm_p0,//状态\n            dt_srm_pae: state => state.dict.dt_srm_pae,//资质类型\n            dt_srm_pao: state => state.dict.dt_srm_pao,//引入类型\n            dt_srm_pap: state => state.dict.dt_srm_pap,//问题类型\n            dt_srm_paf: state => state.dict.dt_srm_paf,//审核状态\n        })\n    },\n    mounted () {\n        this.$store.dispatch(\"dict/getDicData\", [\"dt_srm_p0\", \"dt_srm_pae\", \"dt_srm_pao\", \"dt_srm_pap\", \"dt_srm_paf\"])\n        this.getList()\n    },\n    watch: {\n        listQuery: {\n            handler (val) {\n                for (let key in val) {\n                    this.$refs.refNote[0].listQuery[key] = val[key]\n                    this.$refs.refDetail[0].listQuery[key] = val[key]\n                }\n            },\n            deep: true\n        }\n    },\n    methods: {\n        handleQuery () {\n            this.listQuery.currentPage = 1\n            this.getList()\n        },\n        getList () {\n            this.$refs.refNote[0].getList()\n            this.$refs.refDetail[0].getList()\n        },\n        //供应商确认\n        handleGysClick (gysRows) {\n            if (this.gysType === 'mc') {\n                this.$refs.refMC.setGys(gysRows)\n            } else {\n                this.$refs.refadd.setGys(gysRows)\n            }\n        },\n        showGys (type) {\n            this.gysType = type\n            this.$refs.refGys.getList()\n            this.$refs.refGys.dialogVisible = true\n        },\n        //确认添加/编辑\n        confirmAddEdit (cdata) {\n            if (this.dialogConfig[0].curdialogStatus === 'add') {\n                api.createRecords(cdata).then(() => {\n                    this.$message({ type: 'success', message: '新增成功' })\n                    this.getList()\n                })\n            } else if (this.dialogConfig[0].curdialogStatus === 'edit') {\n                //编辑api patch\n                api.updateRecords(cdata.noticeDTO.noticeNo, cdata).then(() => {\n                    this.$message({ type: 'success', message: '编辑成功' })\n                    this.getList()\n                })\n            }\n        },\n        handleAdd (type, adata) {\n            if (type === 'add') {\n                this.dialogConfig[0].curdialogStatus = 'add'\n            } else if (type === 'edit') {\n                this.dialogConfig[0].curdialogStatus = 'edit'\n            }\n            this.$refs.refadd.initForm(type, adata)\n            this.$refs.refadd.dialogVisible = true\n        },\n        handleSet () {\n            // this.$refs.refSet.initForm()\n            this.$refs.refSet.dialogVisible = true\n        },\n        //批量设置确认\n        confirmSet (sdata) {\n            this.$refs.tabDetail.setData(sdata)\n        },\n        showMC (orgCode, mtableData) {\n            this.$refs.refMC.listQuery.orgCode = orgCode\n            this.$refs.refMC.selectedRows = mtableData\n            this.$refs.refMC.handleQuery()\n            this.$refs.refMC.dialogVisible = true\n        },\n        //materialcategory confirm\n        handleConfirmMC (mdata) {\n            mdata.map(item => {\n                item.materielClass = item.classCode\n                item.materielClassName = item.className\n            })\n            let data = []\n\n            mdata.forEach(item => {\n                let isD = true\n                if (this.$refs.refadd.tableData) {\n                    //save edited before\n                    this.$refs.refadd.tableData.forEach(itemt => {\n                        if (itemt.materielClass === item.classCode) {\n                            data.push(itemt)\n                            isD = false\n                        }\n                    })\n                }\n\n                if (isD) {\n                    data.push(item)\n                }\n            })\n            this.$refs.refadd.tableData = JSON.parse(JSON.stringify(data))\n        },\n        setData (sdata) {\n            this.$refs.refDetail[0].handleSetData(sdata)\n        }\n    }\n}\n",null]}