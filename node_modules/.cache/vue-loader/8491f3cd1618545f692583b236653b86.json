{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/storageMaterialDistribution/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/data-base/storageMaterialDistribution/index.vue","mtime":1596610933353},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api1 from \"@/api/data-base/warehouse\";\nimport * as api from \"@/api/data-base/warehouse-distribute\";\nimport Pagination from \"@/components/Pagination\";\nimport ImportFile from \"@/components/ImportFile\";\nimport { DT_ORG_TYPE } from \"@/utils/constant\";\nimport personSelect from \"@/components/Select/personSelect.vue\"; //物料信息模块\nimport ckbm from \"./ckbm\";\nimport ckwlfp from \"./ckwlfp\";\nimport zsjwlxz from \"@/components/Select/zsjwlxz.vue\";\n\nexport default {\n    name: \"storageMaterialDistribution\",\n    components: {\n        Pagination,\n        personSelect,\n        ckbm,\n        ImportFile,\n        zsjwlxz,\n        ckwlfp\n    },\n    data () {\n        return {\n            list: null,\n            listSub: [],\n            unMutiple: false,\n            theight: 0,\n            stheight: 0,//右子表高度\n            tableKey: [0, 1],//表格索引，虚拟dom渲染表格时使用\n            total: 0,\n            total1: 0,\n            modalNo: 'EXTP-BAS-0004',//导入模板编号\n            selectRows: {},\n            selectRowsSub: {},\n            listQuery: {\n                currentPage: 1,\n                pageSize: 15,\n                warehouseCode: undefined\n            },\n            listQuerySub: {\n                currentPage: 1,\n                pageSize: 15,\n                locationCode: undefined,\n                warehouseCode: undefined,\n                areaCode: undefined,\n                rule: 'materiel'\n            },\n            addList: {\n                warehouseCode: undefined,\n                warehouseName: undefined,\n                materielCode: undefined,\n                materielName: undefined,\n                locationCode: undefined,\n                locationName: undefined,\n                areaCode: undefined,\n                areaName: undefined,\n                stockEmp: undefined,\n                stockEmpName: undefined,\n                state: 1,\n                orgName: undefined,\n                orgCode: undefined\n            },\n            paramList: {\n                rowIds: [],\n                stockEmp: undefined,\n                stockEmpName: undefined\n            },\n            ckbmRows: {},\n            formWlRows: null,\n            keeperRows: null,\n            dtoscssz: {\n                stockEmp: undefined,\n                stockEmpName: undefined,\n                rowIds: [],\n                warehouseCode: undefined\n            },\n            ckbmDialogFormVisible: false,\n            dialogFormVisible: false,\n            dialogFormVisibleParams: false,\n            dialogFormVisible2: false,\n            importDialogVisible: false,//导入弹框\n            wlxzDialogFormVisible: false,\n            keeperFormVisibleParams: false,\n            ckwlDialogFormVisible: false,\n            warehouseCode: undefined,\n            dialogStatus: \"\",\n            dialogStatusParam: \"\",\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            rules: {}\n        };\n    },\n    watch: {\n        'listQuery.warehouseCode': {\n            handler (newValue) {\n                this.listQuery.warehouseCode = newValue\n            },\n            deep: true,\n            immediate: true\n        }\n    },\n    created () {\n        // this.getList()\n    },\n    mounted () {\n        this.setTableHeight();\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        };\n\n    },\n    methods: {\n        getList () {\n            api1.queryLocation(this.listQuery.warehouseCode, this.listQuery).then(res => {\n                this.list = res.data.list;\n                this.total = res.data.pages.count;\n            });\n        },\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight() + 52;\n            this.stheight = this.theight;\n        },\n        getlistSub () {\n            // this.listQuerySub.rule = 'materiel'\n            api.queryRecords(this.listQuerySub).then(res => {\n                this.listSub = res.data.list;\n                this.total1 = res.data.pages.count;\n            });\n        },\n        selectRowMain (val) {//左表复选框选中方法\n            this.selectRows = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.tbmain.clearSelection()\n                this.$refs.tbmain.toggleRowSelection(val[val.length - 1], 'selected')\n            }\n            if (val.length !== 0) {\n                this.listQuerySub.warehouseCode = this.selectRows.warehouseCode;\n                this.listQuerySub.areaCode = this.selectRows.areaCode;\n                this.listQuerySub.locationCode = this.selectRows.locationCode;\n                this.getlistSub();\n            }\n        },\n        selectRow_line (val) {//左表单击行选中方法\n            this.selectRows = val;\n            this.$refs.tbmain.clearSelection()\n            this.$refs.tbmain.toggleRowSelection(val, 'selected')\n        },\n        selectRowSub (val) {//右表复选框选中方法\n            this.selectRowsSub = val;\n            // console.log(this.selectRowsSub,11111)\n            // if (val.length > 1) {\n            //     this.$refs.mx.clearSelection();\n            //     this.$refs.mx.toggleRowSelection(val[val.length-1],'selected');\n            // }\n        },\n        handleDistribute () {\n            if (this.listQuery.warehouseCode) {\n                this.ckwlDialogFormVisible = true\n                this.warehouseCode = this.listQuery.warehouseCode\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请先选择仓库编码\",\n                    type: \"warning\"\n                })\n            }\n\n        },\n        //主表仓库选择设置\n        handleClickckbm () {\n            this.ckbmDialogFormVisible = true;\n        },\n        //仓库编码确认\n        confirmCkbm (row) {\n            this.ckbmRows = row;\n        },\n        confirmMateriel () {//新增物料确认按钮\n            if (this.$refs.wlxzRef.listSelected.length > 0) {\n                let dtos = [];\n                let wlList = this.$refs.wlxzRef.listSelected;\n                wlList.forEach((item) => {\n                    let obj = {\n                        areaCode: this.selectRows.areaCode,\n                        locationCode: this.selectRows.locationCode,\n                        warehouseCode: this.selectRows.warehouseCode,\n                        orgCode: this.ckbmRows.orgCode,\n                        orgName: this.ckbmRows.orgName,\n                        materielCode: item.materielCode,\n                        materielName: item.materielName,\n                        locationMaterielRule: 'materiel',\n                    };\n                    dtos.push(obj)\n                });\n                api.addRecord1(dtos).then(() => {\n                    this.getlistSub();\n                    this.wlxzDialogFormVisible = false;\n                    this.$notify({\n                        title: \"成功\",\n                        message: \"新增成功\",\n                        type: \"success\",\n                        duration: 2000\n                    });\n                });\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        update3 () {//新增物料编码弹窗确认按钮\n            this.formWlRows = this.$refs.wlxzRef.listSelected;\n            if (this.formWlRows && this.formWlRows.length == 1) {\n                this.addList.materielCode = this.formWlRows[0].materielCode;\n                this.addList.materielName = this.formWlRows[0].materielName;\n                this.wlxzDialogFormVisible = false;\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        confirmKeeper () {//参数设置保管员中弹窗确认按钮\n            if (this.keeperRows && this.keeperRows.length == 1) {\n                this.paramList.stockEmpName = this.keeperRows[0].employeeName;\n                this.paramList.stockEmp = this.keeperRows[0].employeeCode;\n                this.keeperFormVisibleParams = false;\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        confirmKeeperForm () {//新增编辑中弹窗确认按钮\n            if (this.keeperRows && this.keeperRows.length == 1) {\n                this.addList.stockEmpName = this.keeperRows[0].employeeName;\n                this.addList.stockEmp = this.keeperRows[0].employeeCode;\n                this.keeperFormVisibleParams = false;\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        handleSet () {//参数设置弹窗\n            console.log(this.selectRowsSub, '000')\n            if (this.selectRowsSub) {\n                this.dialogFormVisibleParams = true;\n                console.log(this.selectRowsSub, '000')\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        createcssz () {//参数设置确认\n            let rowIdsArry = [];\n            rowIdsArry.push(this.selectRowsSub[0].rowId);\n            this.paramList.rowIds = rowIdsArry;\n            api.updateRecordcssz(this.paramList).then(() => {\n                this.getlistSub();\n                this.dialogFormVisibleParams = false;\n                this.$notify({\n                    title: \"成功\",\n                    message: \"设置成功\",\n                    type: \"success\",\n                    duration: 2000\n                });\n            });\n        },\n        handleDelete () {//删除方法\n            if (this.selectRowsSub) {\n                this.$confirm(this.$t('message.isDeleteContinue'), this.$t('message.prompt'), {\n                    confirmButtonText: this.$t('message.yes'),\n                    cancelButtonText: this.$t('message.no'),\n                    type: 'warning'\n                }).then(() => {\n                    api.deleteRecord(this.selectRowsSub[0].rowId).then(() => {\n                        this.getlistSub();\n                        this.$notify({\n                            title: \"成功\",\n                            message: \"删除成功\",\n                            type: \"success\",\n                            duration: 2000\n                        });\n                    });\n                });\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        handleCreatewl () {//新增物料弹窗\n            if (this.selectRows.warehouseCode) {\n                this.dialogStatus = \"confirmMateriel\";\n                this.wlxzDialogFormVisible = true;\n                this.$nextTick(() => {\n                    this.unMutiple = false;\n                    this.$refs.wlxzRef.isEdit = true;\n                    this.$refs.wlxzRef.getList();\n                })\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n\n        },\n        handleCreate () {//新增方法\n            // this.resetTemp();\n            if (this.selectRows.warehouseCode) {\n                this.dialogStatus = \"create\";\n                this.setDefault();\n                this.dialogFormVisible = true;\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        handleUpdate () {//编辑方法\n            // this.resetTemp();\n            if (this.selectRowsSub) {\n                this.dialogStatus = \"update\";\n                this.setDefault();\n                this.addList.state = this.selectRowsSub[0].state;\n                this.addList.materielCode = this.selectRowsSub[0].materielCode;\n                this.addList.materielName = this.selectRowsSub[0].materielName;\n                this.addList.stockEmp = this.selectRowsSub[0].stockEmp;\n                this.addList.materialputEmpName = this.selectRowsSub[0].materialputEmpName;\n                this.dialogFormVisible = true;\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        handleLead () {\n            this.importDialogVisible = true;\n            this.$nextTick(() => {\n                this.$refs.importDialog.getList();\n            })\n        },\n        handlegPersonnel () {//业务人员\n            if (this.selectRowsSub) {\n                this.dialogStatusParam = \"keeperParam\";\n                this.keeperFormVisibleParams = true;\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条物料信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        handlegPersonnelForm () {\n            if (this.selectRowsSub) {\n                this.dialogStatusParam = \"keeperForm\";\n                this.keeperFormVisibleParams = true;\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条物料信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        purchasingPersonnels (row) {\n            this.keeperRows = row;\n        },\n        handleClickMateriel () {\n            this.wlxzDialogFormVisible = true;\n            this.$nextTick(() => {\n                this.unMutiple = true;\n                this.$refs.wlxzRef.isEdit = true;\n                this.$refs.wlxzRef.getList();\n            })\n        },\n        //固定值赋值\n        setDefault () {\n            this.addList.orgName = this.ckbmRows.orgCode;\n            this.addList.orgCode = this.ckbmRows.orgName;\n            this.addList.warehouseCode = this.ckbmRows.warehouseCode;\n            this.addList.warehouseName = this.ckbmRows.warehouseName;\n            this.addList.areaName = this.selectRows.areaName;\n            this.addList.locationName = this.selectRows.locationName;\n            this.addList.locationCode = this.selectRows.locationCode;\n            this.addList.areaCode = this.selectRows.areaCode;\n            this.addList.stockEmp = this.selectRows.stockEmp;\n            this.addList.stockEmpName = this.selectRows.stockEmpName;\n        },\n        create () {\n            // this.setDefault();\n            this.addList.locationMaterielRule = \"materiel\";\n            api.addRecord(this.addList).then(() => {\n                this.getlistSub();\n                this.dialogFormVisible = false;\n                this.$notify({\n                    title: \"成功\",\n                    message: \"新增成功\",\n                    type: \"success\",\n                    duration: 2000\n                });\n            });\n        },\n        update () {//编辑方法\n            this.addList.locationMaterielRule = \"materiel\";\n            api.updateRecord(this.selectRowsSub[0].rowId, this.addList).then(() => {\n                this.getlistSub();\n                this.dialogFormVisible = false;\n                this.$notify({\n                    title: \"成功\",\n                    message: \"编辑成功\",\n                    type: \"success\",\n                    duration: 2000\n                });\n            });\n        },\n        //仓库编码确认\n        confirmWarehouseCode () {\n            if (this.ckbmRows) {\n                this.listQuery.warehouseCode = this.ckbmRows.warehouseCode;\n                this.ckbmDialogFormVisible = false;\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                });\n            }\n        },\n        handleQuery () {\n            this.listQuery.currentPage = 1;\n            this.getList();\n        },\n        handleClose () {\n            this.resetTemp();\n            this.$refs.maintb.resetFields();\n        },\n        handleCloseParams () {\n            this.keeperFormVisibleParams = false;\n        },\n        resetTemp () {\n            this.addList = {\n                warehouseCode: undefined,\n                warehouseName: undefined,\n                materielCode: undefined,\n                materielName: undefined,\n                locationCode: undefined,\n                locationName: undefined,\n                areaCode: undefined,\n                areaName: undefined,\n                stockEmp: undefined,\n                stockEmpName: undefined,\n                goodsReadyEmp: undefined,\n                goodsReadyEmpName: undefined,\n                materialputEmp: undefined,\n                materialputEmpName: undefined,\n                state: 1,\n                orgName: undefined,\n                orgCode: undefined\n            };\n        }\n    }\n};\n",null]}