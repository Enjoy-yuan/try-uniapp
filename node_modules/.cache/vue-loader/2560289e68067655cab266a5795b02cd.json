{"remainingRequest":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/purchaseStorage/storageConfirm/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuan/Documents/大唐广电/dt-web/src/views/project/WMS/purchaseStorage/storageConfirm/index.vue","mtime":1596610934185},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuan/Documents/大唐广电/dt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport * as api from '@/api/project/wms/purchaseStorage/storageCheck'\nimport caiGou from '@/components/Select/caigou'//下拉组件\nimport warehouseSelect from '@/components/Select/warehouse-select'//下拉组件\n\nimport Pagination from \"@/components/Pagination\"\nimport { DT_ORG_TYPE } from '@/utils/constant'\n\nexport default {\n    name: \"storageCheck\",\n    components: { caiGou, warehouseSelect, Pagination },\n    data () {\n        return {\n            theight: 0,//表格高度\n            isSingle: true,//表格是否单选 点击各按钮根据流程逻辑控制单多选\n            list_a: [],\n            total_a: 0,\n            areaList: null,\n            locatorList: [],\n            listQuery_a: {\n                currentPage: 1,\n                pageSize: 15,\n                state: 'iqc2'\n            },\n            list_a_1: [],\n            total_a_1: 0,\n            listQuery_a_1: {\n                currentPage: 1,\n                pageSize: 15,\n            },\n            dto: {},\n            DT_ORG_TYPE: DT_ORG_TYPE,\n            dialogFormVisible: false,\n            temp: {},\n            rules: {\n                businessType: [\n                    { required: true, message: this.$t('validate.required'), trigger: 'blur' },\n                ],\n            }\n        }\n    },\n    mounted () {\n        this.setTableHeight()\n        this.getList_a()\n        //表格高度自适应\n        window.onresize = () => {\n            this.setTableHeight()\n        }\n    },\n    methods: {\n        //表格高度计算\n        setTableHeight () {\n            this.theight = this.$myFun.getSingleTbHeight()\n        },\n        getList_a () {//获取质检单主表\n            api.getData_a(this.listQuery_a).then(res => {\n                res = res.data\n                this.list_a = res.list\n                this.total_a = res.pages.count\n            })\n        },\n        getList_a_1 () {//获取质检单从表\n            this.listQuery_a_1.iqcOrderNumber = this.selectlistRow_a.iqcOrderNumber || this.selectlistRow_a.iqcOrderNumber\n            api.getData_a_1(this.listQuery_a_1).then(res => {\n                res = res.data\n                this.list_a_1 = res.list.map(v => {\n                    for (const key in this.selectlistRow_a) {\n                        if (!v.hasOwnProperty(key)) {\n                            v[key] = this.selectlistRow_a[key]\n                        }\n                    }\n                    return v\n                })\n                this.total_a_1 = res.pages.count\n            })\n            api.getArea(this.selectlistRow_a.warehouseCode).then(resa => {\n                resa = resa.data\n                this.areaList = resa\n            })\n        },\n        getLocatorList (warehouseCode, areaCode, i) {\n            api.getLocator(warehouseCode, areaCode).then(res => {\n                this.$set(this.locatorList, i, res.data)\n            })\n        },\n        changeAreaSel (areaCode, i) {\n            this.getLocatorList(this.selectlistRow_a.warehouseCode, areaCode, i)\n        },\n        selectRow_a (val) {//质检单主表选中事件\n            this.selectlistRow_a = val[val.length - 1]\n            if (val.length > 1) {\n                this.$refs.dt_a.clearSelection()\n                this.$refs.dt_a.toggleRowSelection(val.pop())\n            }\n            if (this.selectlistRow_a) {\n                this.getList_a_1(this.selectlistRow_a)\n            } else {\n                this.list_a_1 = []\n                this.total_a_1 = 0\n            }\n        },\n        selectRow_a_1 (val) {//质检从表主表选中事件\n            this.selectListRow_a_1 = val\n        },\n        clickRow_a (val) {//质检主表点击事件\n            this.selectlistRow_a = val\n            this.$refs.dt_a.clearSelection()//清除其他行的选中\n            this.$refs.dt_a.toggleRowSelection(val)//单击行绑定点击事件\n        },\n        confirm () {\n            let result = true\n            this.list_a_1.forEach(val => {\n                if (val.qualifiedQuantity + val.repairQuantity > 0 && val.nextWareAreaCode == \"\" && val.nextWareLocationCode == \"\") {\n                    result = false\n                }\n            })\n            if (result) {\n                return this.list_a_1\n            } else {\n                this.$message({\n                    title: this.$t(\"message.warning\"),\n                    message: \"请先选择区位和储位\",\n                    type: \"warning\"\n                })\n            }\n        },\n        qualityConfirmation () {//质检确认\n            let a = this.confirm()\n            this.dto = {\n                iqcOrderNumber: this.selectlistRow_a.iqcOrderNumber,\n                method: 'CONFIRM',\n                inboundQCDTO: {\n                    inboundQCItems: a\n                }\n            }\n            if (a) {\n                api.update_a(this.dto).then(() => {\n                    this.$message({\n                        title: \"成功\",\n                        message: \"质检确认成功\",\n                        type: \"success\"\n                    })\n                    this.getList_a()\n                })\n            }\n        },\n        qualityRejection () {//质检驳回\n            this.dto = {\n                iqcOrderNumber: this.selectlistRow_a.iqcOrderNumber,\n                method: 'REJECT'\n            }\n            api.update_a(this.dto).then(() => {\n                this.$message({\n                    title: \"成功\",\n                    message: \"质检驳回成功\",\n                    type: \"success\"\n                })\n                this.getList_a()\n            })\n        },\n        handleRecommend () {\n            if (this.selectlistRow_a) {\n                if (this.selectListRow_a_1) {\n                    this.dto.businessType = this.selectlistRow_a.businessType,\n                        this.dto.orgCode = this.selectlistRow_a.orgCode,\n                        this.dto.wareMaterielDTOS = this.selectListRow_a_1.map(v => {\n                            let DTOSlist = {}\n                            DTOSlist.materielCode = v.materielCode\n                            DTOSlist.materielClassify = \"\"\n                            return DTOSlist\n                        }),\n                        this.dto.warehouseCode = this.selectlistRow_a.warehouseCode,\n                        api.recommend(this.dto).then(res => {\n                            res = res.data\n                            res.forEach((val) => {\n                                this.list_a_1.forEach((val1, index) => {\n                                    if (val.materielCode == val1.materielCode) {\n                                        this.$set(this.list_a_1[index], 'nextWareAreaCode', val.areaCode)\n                                        this.$set(this.list_a_1[index], 'nextWareLocationCode', val.locationCode)\n                                        this.$set(this.list_a_1, index, this.list_a_1[index])\n                                    }\n                                })\n                            })\n                        })\n                } else {\n                    this.$message({\n                        title: \"警告\",\n                        message: \"请选择明细信息\",\n                        type: \"warning\"\n                    })\n                }\n\n            } else {\n                this.$message({\n                    title: \"警告\",\n                    message: \"请选择一条信息\",\n                    type: \"warning\"\n                })\n            }\n        }\n    }\n};\n",null]}